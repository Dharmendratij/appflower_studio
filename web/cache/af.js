Ext.namespace("Ext.ux.plugins");Ext.ux.plugins.HelpText={init:function(a){Ext.apply(a,{onRender:a.onRender.createSequence(function(f,b){if(typeof this.helpText=="string"){switch(this.helpType){case"comment":this.wrap=this.wrap||this.el.wrap();var d=this.el.dom;d=this.wrap.dom;Ext.DomHelper.append(d.parentNode,{tag:"div",cls:typeof this.helpTextClass!="undefined"?this.helpTextClass:"",style:typeof this.helpTextStyle!="undefined"?this.helpTextStyle:"clear: right; font-size: 11px; color: #888888;",html:this.helpText});break;case"inline":var h=this.getEl();var c=h.findParent(".x-form-item");if(c){var e=Ext.select("label",true,c);label=e.elements[0]}var g="padding-left:2px;";if(!label){break}switch(this.xtype){case"radio":label=e.elements[1];break;default:var g="padding-right:2px;float:left";break}this.helpText=(this.helpText+"").replace(/[\\"']/g,"'");Ext.DomHelper.insertFirst(label,{tag:"span",style:g,html:'<img src="/appFlowerExtjsThemePlugin/images/help.png" qtip="'+this.helpText+'">'});break}}}),findByClassName:function(d,c){var b;while(b=d.parentNode){if(b.className.match(c)){return b}d=b}return false}})}};Ext.ux.plugins.HelpText=Ext.extend(Ext.ux.plugins.HelpText,Ext.util.Observable);Ext.ns("Ext.ux.form");Ext.ux.form.DateTime=Ext.extend(Ext.form.Field,{timeIncrement:60,timeActive:true,defaultAutoCreate:{tag:"input",type:"hidden"},timeWidth:100,dtSeparator:" ",hiddenFormat:"Y-m-d H:i:s",otherToNow:true,timePosition:"right",dateFormat:"d/m/Y",timeFormat:"H:i",initComponent:function(){Ext.ux.form.DateTime.superclass.initComponent.call(this);var b=Ext.apply({},{id:this.id+"-date",format:this.dateFormat||Ext.form.DateField.prototype.format,width:this.timeWidth,selectOnFocus:this.selectOnFocus,listeners:{blur:{scope:this,fn:this.onBlur},focus:{scope:this,fn:this.onFocus}}},this.dateConfig);this.df=new Ext.form.DateField(b);this.df.ownerCt=this;delete (this.dateFormat);var a=Ext.apply({},{id:this.id+"-time",format:this.timeFormat||Ext.form.TimeField.prototype.format,width:this.timeWidth,selectOnFocus:this.selectOnFocus,increment:this.timeIncrement,listeners:{blur:{scope:this,fn:this.onBlur},focus:{scope:this,fn:this.onFocus}}},this.timeConfig);this.tf=new Ext.form.TimeField(a);this.tf.ownerCt=this;delete (this.timeFormat);this.relayEvents(this.df,["focus","specialkey","invalid","valid"]);this.relayEvents(this.tf,["focus","specialkey","invalid","valid"])},onRender:function(c,a){if(this.isRendered){return}Ext.ux.form.DateTime.superclass.onRender.call(this,c,a);var b;if("below"===this.timePosition||"bellow"===this.timePosition){b=Ext.DomHelper.append(c,{tag:"table",style:"border-collapse:collapse",children:[{tag:"tr",children:[{tag:"td",style:"padding-bottom:1px",cls:"ux-datetime-date"}]},{tag:"tr",children:[{tag:"td",cls:"ux-datetime-time"}]}]},true)}else{b=Ext.DomHelper.append(c,{tag:"table",style:"border-collapse:collapse",children:[{tag:"tr",children:[{tag:"td",style:"padding-right:4px",cls:"ux-datetime-date"},{tag:"td",cls:"ux-datetime-time"}]}]},true)}this.tableEl=b;this.wrap=b.wrap();this.wrap.on("mousedown",this.onMouseDown,this,{delay:10});this.df.render(b.child("td.ux-datetime-date"));this.tf.render(b.child("td.ux-datetime-time"));if(Ext.isIE&&Ext.isStrict){b.select("input").applyStyles({top:0})}this.on("specialkey",this.onSpecialKey,this);this.df.el.swallowEvent(["keydown","keypress"]);this.tf.el.swallowEvent(["keydown","keypress"]);if("side"===this.msgTarget){var d=this.el.findParent(".x-form-element",10,true);this.errorIcon=d.createChild({cls:"x-form-invalid-icon"});this.df.errorIcon=this.errorIcon;this.tf.errorIcon=this.errorIcon}this.el.dom.name=this.hiddenName||this.name||this.id;this.df.el.dom.removeAttribute("name");this.tf.el.dom.removeAttribute("name");this.isRendered=true;this.updateHidden();this.setActive(this.tf,this.timeActive)},adjustSize:Ext.BoxComponent.prototype.adjustSize,alignErrorIcon:function(){this.errorIcon.alignTo(this.tableEl,"tl-tr",[2,0])},initDateValue:function(){this.dateValue=this.otherToNow?new Date():new Date(1970,0,1,0,0,0)},clearInvalid:function(){this.df.clearInvalid();this.tf.clearInvalid()},markInvalid:function(a){this.df.markInvalid(a);this.tf.markInvalid(a)},beforeDestroy:function(){if(this.isRendered){this.wrap.removeAllListeners();this.wrap.remove();this.tableEl.remove();this.df.destroy();this.tf.destroy()}},disable:function(){if(this.isRendered){this.df.disabled=this.disabled;this.df.onDisable();this.tf.onDisable()}this.disabled=true;this.df.disabled=true;this.tf.disabled=true;this.fireEvent("disable",this);return this},enable:function(){if(this.rendered){this.df.onEnable();this.tf.onEnable()}this.disabled=false;this.df.disabled=false;this.tf.disabled=false;this.fireEvent("enable",this);return this},focus:function(){this.df.focus()},getPositionEl:function(){return this.wrap},getResizeEl:function(){return this.wrap},getValue:function(){return this.dateValue?new Date(this.dateValue):""},isValid:function(){return this.df.isValid()&&this.tf.isValid()},isVisible:function(){return this.df.rendered&&this.df.getActionEl().isVisible()},onBlur:function(a){if(this.wrapClick){a.focus();this.wrapClick=false}if(a===this.df){this.updateDate()}else{this.updateTime()}this.updateHidden();(function(){if(!this.df.hasFocus&&!this.tf.hasFocus){var b=this.getValue();if(String(b)!==String(this.startValue)){this.fireEvent("change",this,b,this.startValue)}this.hasFocus=false;this.fireEvent("blur",this)}}).defer(100,this)},onFocus:function(){if(!this.hasFocus){this.hasFocus=true;this.startValue=this.getValue();this.fireEvent("focus",this)}},onMouseDown:function(a){if(!this.disabled){this.wrapClick="td"===a.target.nodeName.toLowerCase()}},onSpecialKey:function(b,c){var a=c.getKey();if(a===c.TAB){if(b===this.df&&!c.shiftKey){c.stopEvent();this.tf.focus()}if(b===this.tf&&c.shiftKey){c.stopEvent();this.df.focus()}}if(a===c.ENTER){this.updateValue()}},setDate:function(a){this.df.setValue(a)},setTime:function(a){this.tf.setValue(a)},setSize:function(a,b){if(!a){return}if("below"===this.timePosition){this.df.setSize(a,b);this.tf.setSize(a,b);if(Ext.isIE){this.df.el.up("td").setWidth(a);this.tf.el.up("td").setWidth(a)}}else{this.df.setSize(a-this.timeWidth-4,b);this.tf.setSize(this.timeWidth,b);if(Ext.isIE){this.df.el.up("td").setWidth(a-this.timeWidth-4);this.tf.el.up("td").setWidth(this.timeWidth)}}},setValue:function(c){if(!c&&true===this.emptyToNow){this.setValue(new Date());return}else{if(!c){this.setDate("");this.setTime("");this.updateValue();return}}if("number"===typeof c){c=new Date(c)}else{if("string"===typeof c&&this.hiddenFormat){c=Date.parseDate(c,this.hiddenFormat)}}c=c?c:new Date(1970,0,1,0,0,0);var a,b;if(c instanceof Date){this.setDate(c);this.setTime(c);this.dateValue=new Date(c)}else{a=c.split(this.dtSeparator);this.setDate(a[0]);if(a[1]){if(a[2]){a[1]+=a[2]}this.setTime(a[1])}}this.updateValue()},setVisible:function(a){if(a){this.df.show();this.tf.show()}else{this.df.hide();this.tf.hide()}return this},show:function(){return this.setVisible(true)},hide:function(){return this.setVisible(false)},setActive:function(a,b){if(b){a.show();this.hiddenFormat="Y-m-d H:i:s";this.updateValue();return this}else{a.hide();this.hiddenFormat="Y-m-d";this.updateValue();return this}},updateDate:function(){var a=this.df.getValue();if(a){if(!(this.dateValue instanceof Date)){this.initDateValue();if(!this.tf.getValue()){this.setTime(this.dateValue)}}this.dateValue.setMonth(0);this.dateValue.setFullYear(a.getFullYear());this.dateValue.setMonth(a.getMonth(),a.getDate())}else{this.dateValue="";this.setTime("")}},updateTime:function(){var a=this.tf.getValue();if(a&&!(a instanceof Date)){a=Date.parseDate(a,this.tf.format)}if(a&&!this.df.getValue()){this.initDateValue();this.setDate(this.dateValue)}if(this.dateValue instanceof Date){if(a){this.dateValue.setHours(a.getHours());this.dateValue.setMinutes(a.getMinutes());this.dateValue.setSeconds(a.getSeconds())}else{this.dateValue.setHours(0);this.dateValue.setMinutes(0);this.dateValue.setSeconds(0)}}},updateHidden:function(){if(this.isRendered){var a=this.dateValue instanceof Date?this.dateValue.format(this.hiddenFormat):"";this.el.dom.value=a}},updateValue:function(){this.updateDate();this.updateTime();this.updateHidden();return},validate:function(){return this.df.validate()&&this.tf.validate()},renderer:function(c){var b=c.editor.dateFormat||Ext.ux.form.DateTime.prototype.dateFormat;b+=" "+(c.editor.timeFormat||Ext.ux.form.DateTime.prototype.timeFormat);var a=function(e){var d=Ext.util.Format.date(e,b);return d};return a}});Ext.reg("xdatetime",Ext.ux.form.DateTime);Ext.ux.DDView=function(b){if(!b.itemSelector){var a=b.tpl;if(this.classRe.test(a)){b.tpl=a.replace(this.classRe,"class=$1x-combo-list-item $2$1")}else{b.tpl=a.replace(this.tagRe,'$1 class="x-combo-list-item" $2')}b.itemSelector=".x-combo-list-item"}Ext.ux.DDView.superclass.constructor.call(this,Ext.apply(b,{border:false}))};Ext.extend(Ext.ux.DDView,Ext.DataView,{sortDir:"ASC",isFormField:true,classRe:/class=(['"])(.*)\1/,tagRe:/(<\w*)(.*?>)/,reset:Ext.emptyFn,clearInvalid:Ext.form.Field.prototype.clearInvalid,afterRender:function(){Ext.ux.DDView.superclass.afterRender.call(this);if(this.dragGroup){this.setDraggable(this.dragGroup.split(","))}if(this.dropGroup){this.setDroppable(this.dropGroup.split(","))}if(this.deletable){this.setDeletable()}this.isDirtyFlag=false;this.addEvents("drop")},validate:function(){return true},destroy:function(){this.purgeListeners();this.getEl().removeAllListeners();this.getEl().remove();if(this.dragZone){if(this.dragZone.destroy){this.dragZone.destroy()}}if(this.dropZone){if(this.dropZone.destroy){this.dropZone.destroy()}}},getName:function(){return this.name},setValue:function(a){if(!this.store){throw"DDView.setValue(). DDView must be constructed with a valid Store"}var b={};b[this.store.reader.meta.root]=a?[].concat(a):[];this.store.proxy=new Ext.data.MemoryProxy(b);this.store.load()},getValue:function(){var a="(";this.store.each(function(b){a+=b.id+","});return a.substr(0,a.length-1)+")"},getIds:function(){var b=0,a=new Array(this.store.getCount());this.store.each(function(c){a[b++]=c.id});return a},isDirty:function(){return this.isDirtyFlag},getTargetFromEvent:function(b){var a=b.getTarget();while((a!==null)&&(a.parentNode!=this.el.dom)){a=a.parentNode}if(!a){a=this.el.dom.lastChild||this.el.dom}return a},getDragData:function(d){var c=this.findItemFromChild(d.getTarget());if(c){if(!this.isSelected(c)){delete this.ignoreNextClick;this.onItemClick(c,this.indexOf(c),d);this.ignoreNextClick=true}var b={sourceView:this,viewNodes:[],records:[],copy:this.copy||(this.allowCopy&&d.ctrlKey)};if(this.getSelectionCount()==1){var a=this.getSelectedIndexes()[0];var f=this.getNode(a);b.viewNodes.push(b.ddel=f);b.records.push(this.store.getAt(a));b.repairXY=Ext.fly(f).getXY()}else{b.ddel=document.createElement("div");b.ddel.className="multi-proxy";this.collectSelection(b)}return b}return false},getRepairXY:function(a){return this.dragData.repairXY},collectSelection:function(b){b.repairXY=Ext.fly(this.getSelectedNodes()[0]).getXY();if(this.preserveSelectionOrder===true){Ext.each(this.getSelectedIndexes(),function(c){var e=this.getNode(c);var d=e.cloneNode(true);d.id=Ext.id();b.ddel.appendChild(d);b.records.push(this.store.getAt(c));b.viewNodes.push(e)},this)}else{var a=0;this.store.each(function(d){if(this.isSelected(a)){var e=this.getNode(a);var c=e.cloneNode(true);c.id=Ext.id();b.ddel.appendChild(c);b.records.push(this.store.getAt(a));b.viewNodes.push(e)}a++},this)}},setDraggable:function(a){if(a instanceof Array){Ext.each(a,this.setDraggable,this);return}if(this.dragZone){this.dragZone.addToGroup(a)}else{this.dragZone=new Ext.dd.DragZone(this.getEl(),{containerScroll:true,ddGroup:a});if(!this.multiSelect){this.singleSelect=true}this.dragZone.getDragData=this.getDragData.createDelegate(this);this.dragZone.getRepairXY=this.getRepairXY;this.dragZone.onEndDrag=this.onEndDrag}},setDroppable:function(a){if(a instanceof Array){Ext.each(a,this.setDroppable,this);return}if(this.dropZone){this.dropZone.addToGroup(a)}else{this.dropZone=new Ext.dd.DropZone(this.getEl(),{owningView:this,containerScroll:true,ddGroup:a});this.dropZone.getTargetFromEvent=this.getTargetFromEvent.createDelegate(this);this.dropZone.onNodeEnter=this.onNodeEnter.createDelegate(this);this.dropZone.onNodeOver=this.onNodeOver.createDelegate(this);this.dropZone.onNodeOut=this.onNodeOut.createDelegate(this);this.dropZone.onNodeDrop=this.onNodeDrop.createDelegate(this)}},getDropPoint:function(g,j,d){if(j==this.el.dom){return"above"}var f=Ext.lib.Dom.getY(j),a=f+j.offsetHeight;var i=f+(a-f)/2;var h=Ext.lib.Event.getPageY(g);if(h<=i){return"above"}else{return"below"}},isValidDropPoint:function(b,e,a){if(!a.viewNodes||(a.viewNodes.length!=1)){return true}var c=a.viewNodes[0];if(c==e){return false}if((b=="below")&&(e.nextSibling==c)){return false}if((b=="above")&&(e.previousSibling==c)){return false}return true},onNodeEnter:function(d,a,c,b){if(this.highlightColor&&(b.sourceView!=this)){this.el.highlight(this.highlightColor)}return false},onNodeOver:function(h,a,g,d){var b=this.dropNotAllowed;var f=this.getDropPoint(g,h,a);if(this.isValidDropPoint(f,h,d)){if(this.appendOnly||this.sortField){return"x-tree-drop-ok-below"}if(f){var c;if(f=="above"){b=h.previousSibling?"x-tree-drop-ok-between":"x-tree-drop-ok-above";c="x-view-drag-insert-above"}else{b=h.nextSibling?"x-tree-drop-ok-between":"x-tree-drop-ok-below";c="x-view-drag-insert-below"}if(this.lastInsertClass!=c){Ext.fly(h).replaceClass(this.lastInsertClass,c);this.lastInsertClass=c}}}return b},onNodeOut:function(d,a,c,b){this.removeDropIndicators(d)},onNodeDrop:function(c,k,h,f){if(this.fireEvent("drop",this,c,k,h,f)===false){return false}var m=this.getDropPoint(h,c,k);var d=(this.appendOnly||(c==this.el.dom))?this.store.getCount():c.viewIndex;if(m=="below"){d++}if(f.sourceView==this){if(m=="below"){if(f.viewNodes[0]==c){f.viewNodes.shift()}}else{if(f.viewNodes[f.viewNodes.length-1]==c){f.viewNodes.pop()}}if(!f.viewNodes.length){return false}if(d>this.store.indexOf(f.records[0])){d--}}if(f.node instanceof Ext.tree.TreeNode){var a=f.node.getOwnerTree().recordFromNode(f.node);if(a){f.records=[a]}}if(!f.records){alert("Programming problem. Drag data contained no Records");return false}for(var g=0;g<f.records.length;g++){var a=f.records[g];var b=this.store.getById(a.id);if(b&&(k!=this.dragZone)){if(!this.allowDup&&!this.allowTrash){Ext.fly(this.getNode(this.store.indexOf(b))).frame("red",1);return true}var j=new Ext.data.Record();a.id=j.id;delete j}if(f.copy){this.store.insert(d++,a.copy())}else{if(f.sourceView){f.sourceView.isDirtyFlag=true;f.sourceView.store.remove(a)}if(!this.allowTrash){this.store.insert(d++,a)}}if(this.sortField){this.store.sort(this.sortField,this.sortDir)}this.isDirtyFlag=true}this.dragZone.cachedTarget=null;return true},onEndDrag:function(a,b){var c=Ext.get(this.dragData.ddel);if(c&&c.hasClass("multi-proxy")){c.remove()}},removeDropIndicators:function(a){if(a){Ext.fly(a).removeClass(["x-view-drag-insert-above","x-view-drag-insert-left","x-view-drag-insert-right","x-view-drag-insert-below"]);this.lastInsertClass="_noclass"}},setDeletable:function(a){if(!this.singleSelect&&!this.multiSelect){this.singleSelect=true}var b=this.getContextMenu();this.contextMenu.on("itemclick",function(c){switch(c.id){case"delete":this.remove(this.getSelectedIndexes());break}},this);this.contextMenu.add({icon:a||AU.resolveUrl("/images/delete.gif"),id:"delete",text:AU.getMessage("deleteItem")})},getContextMenu:function(){if(!this.contextMenu){this.contextMenu=new Ext.menu.Menu({id:this.id+"-contextmenu"});this.el.on("contextmenu",this.showContextMenu,this)}return this.contextMenu},disableContextMenu:function(){if(this.contextMenu){this.el.un("contextmenu",this.showContextMenu,this)}},showContextMenu:function(b,a){a=this.findItemFromChild(b.getTarget());if(a){b.stopEvent();this.select(this.getNode(a),this.multiSelect&&b.ctrlKey,true);this.contextMenu.showAt(b.getXY())}},remove:function(b){b=[].concat(b);for(var a=0;a<b.length;a++){var c=this.store.getAt(b[a]);this.store.remove(c)}},onDblClick:function(f){var d=this.findItemFromChild(f.getTarget());if(d){if(this.fireEvent("dblclick",this,this.indexOf(d),d,f)===false){return false}if(this.dragGroup){var a=Ext.dd.DragDropMgr.getRelated(this.dragZone,true);while(a.indexOf(this.dropZone)!==-1){a.remove(this.dropZone)}if((a.length==1)&&(a[0].owningView)){this.dragZone.cachedTarget=null;var b=Ext.get(a[0].getEl());var c=b.getBox(true);a[0].onNodeDrop(b.dom,{target:b.dom,xy:[c.x,c.y+c.height-1]},null,this.getDragData(f))}}}},onItemClick:function(b,a,c){if(this.ignoreNextClick){delete this.ignoreNextClick;return}if(this.fireEvent("beforeclick",this,a,b,c)===false){return false}if(this.multiSelect||this.singleSelect){if(this.multiSelect&&c.shiftKey&&this.lastSelection){this.select(this.getNodes(this.indexOf(this.lastSelection),a),false)}else{if(this.isSelected(b)&&c.ctrlKey){this.deselect(b)}else{this.deselect(b);this.select(b,this.multiSelect&&c.ctrlKey);this.lastSelection=b}}c.preventDefault()}return true}});Ext.ux.Multiselect=Ext.extend(Ext.form.Field,{appendOnly:false,dataFields:[],data:[],width:100,height:100,displayField:0,valueField:1,allowBlank:true,minLength:0,maxLength:Number.MAX_VALUE,blankText:Ext.form.TextField.prototype.blankText,minLengthText:"Minimum {0} item(s) required",maxLengthText:"Maximum {0} item(s) allowed",delimiter:",",copy:false,allowDup:false,allowTrash:false,focusClass:undefined,sortDir:"ASC",defaultAutoCreate:{tag:"div"},initComponent:function(){Ext.ux.Multiselect.superclass.initComponent.call(this);this.addEvents({"dblclick":true,"click":true,"change":true,"drop":true})},onRender:function(e,b){Ext.ux.Multiselect.superclass.onRender.call(this,e,b);var c="ux-mselect";var a=new Ext.form.FieldSet({renderTo:this.el,title:this.legend,height:this.height,width:this.width,style:"padding:0;",tbar:this.tbar});a.body.addClass(c);var d='<tpl for="."><div class="'+c+"-item";if(Ext.isIE||Ext.isIE7){d+='" unselectable=on'}else{d+=' x-unselectable"'}d+=">{"+this.displayField+"}</div></tpl>";if(!this.store){this.store=new Ext.data.SimpleStore({fields:this.dataFields,data:this.data})}this.view=new Ext.ux.DDView({multiSelect:true,store:this.store,selectedClass:c+"-selected",tpl:d,allowDup:this.allowDup,copy:this.copy,allowTrash:this.allowTrash,dragGroup:this.dragGroup,dropGroup:this.dropGroup,itemSelector:"."+c+"-item",isFormField:false,applyTo:a.body,appendOnly:this.appendOnly,sortField:this.sortField,sortDir:this.sortDir});a.add(this.view);this.view.on("click",this.onViewClick,this);this.view.on("beforeClick",this.onViewBeforeClick,this);this.view.on("dblclick",this.onViewDblClick,this);this.view.on("drop",function(h,k,g,j,i){return this.fireEvent("drop",h,k,g,j,i)},this);this.hiddenName=this.name;var f={tag:"input",type:"hidden",value:"",name:this.name};if(this.isFormField){this.hiddenField=this.el.createChild(f)}else{this.hiddenField=Ext.get(document.body).createChild(f)}a.doLayout();a.on("afterlayout",function(g,h){if(this.ownerCt&&this.ownerCt.container){this.ownerCt.container.dom.style.width=((this.width*2)+20)+"px"}},this)},initValue:Ext.emptyFn,onViewClick:function(d,b,c,f){var a=this.preClickSelections.indexOf(b);if(a!=-1){this.preClickSelections.splice(a,1);this.view.clearSelections(true);this.view.select(this.preClickSelections)}this.fireEvent("change",this,this.getValue(),this.hiddenField.dom.value);this.hiddenField.dom.value=this.getValue();this.fireEvent("click",this,f);this.validate()},onViewBeforeClick:function(c,a,b,d){this.preClickSelections=this.view.getSelectedIndexes();if(this.disabled){return false}},onViewDblClick:function(c,a,b,d){return this.fireEvent("dblclick",c,a,b,d)},getValue:function(a){var d=[];var c=this.view.getSelectedIndexes();if(c.length==0){return""}for(var b=0;b<c.length;b++){d.push(this.store.getAt(c[b]).get(((a!=null)?a:this.valueField)))}return d.join(this.delimiter)},setValue:function(a){var b;var d=[];this.view.clearSelections();this.hiddenField.dom.value="";if(!a||(a=="")){return}if(!(a instanceof Array)){a=a.split(this.delimiter)}for(var c=0;c<a.length;c++){b=this.view.store.indexOf(this.view.store.query(this.valueField,new RegExp("^"+a[c]+"$","i")).itemAt(0));d.push(b)}this.view.select(d);this.hiddenField.dom.value=this.getValue();this.validate()},reset:function(){this.setValue("")},getRawValue:function(a){var b=this.getValue(a);if(b.length){b=b.split(this.delimiter)}else{b=[]}return b},setRawValue:function(a){setValue(a)},validateValue:function(a){if(a.length<1){if(this.allowBlank){this.clearInvalid();return true}else{this.markInvalid(this.blankText);return false}}if(a.length<this.minLength){this.markInvalid(String.format(this.minLengthText,this.minLength));return false}if(a.length>this.maxLength){this.markInvalid(String.format(this.maxLengthText,this.maxLength));return false}return true}});Ext.reg("multiselect",Ext.ux.Multiselect);Ext.ux.ItemSelector=Ext.extend(Ext.form.Field,{msWidth:200,msHeight:300,hideNavIcons:false,imagePath:"",iconUp:"up2.gif",iconDown:"down2.gif",iconLeft:"left2.gif",iconRight:"right2.gif",iconTop:"top2.gif",iconBottom:"bottom2.gif",drawUpIcon:true,drawDownIcon:true,drawLeftIcon:true,drawRightIcon:true,drawTopIcon:true,drawBotIcon:true,fromStore:null,toStore:null,fromData:null,toData:null,displayField:0,valueField:1,switchToFrom:false,allowDup:false,focusClass:undefined,delimiter:",",readOnly:false,toLegend:null,fromLegend:null,toSortField:null,fromSortField:null,toSortDir:"ASC",fromSortDir:"ASC",toTBar:null,fromTBar:null,bodyStyle:null,border:false,defaultAutoCreate:{tag:"div"},initComponent:function(){Ext.ux.ItemSelector.superclass.initComponent.call(this);this.addEvents({"rowdblclick":true,"change":true})},onRender:function(d,a){Ext.ux.ItemSelector.superclass.onRender.call(this,d,a);this.fromMultiselect=new Ext.ux.Multiselect({legend:this.fromLegend,delimiter:this.delimiter,allowDup:this.allowDup,copy:this.allowDup,allowTrash:this.allowDup,dragGroup:this.readOnly?null:"drop2-"+this.el.dom.id,dropGroup:this.readOnly?null:"drop1-"+this.el.dom.id,width:this.msWidth,height:this.msHeight,dataFields:this.dataFields,data:this.fromData,displayField:this.displayField,valueField:this.valueField,store:this.fromStore,isFormField:false,tbar:this.fromTBar,appendOnly:true,sortField:this.fromSortField,sortDir:this.fromSortDir});this.fromMultiselect.on("dblclick",this.onRowDblClick,this);if(!this.toStore){this.toStore=new Ext.data.SimpleStore({fields:this.dataFields,data:this.toData})}this.toStore.on("add",this.valueChanged,this);this.toStore.on("remove",this.valueChanged,this);this.toStore.on("load",this.valueChanged,this);this.toMultiselect=new Ext.ux.Multiselect({legend:this.toLegend,delimiter:this.delimiter,allowDup:this.allowDup,dragGroup:this.readOnly?null:"drop1-"+this.el.dom.id,dropGroup:this.readOnly?null:"drop2-"+this.el.dom.id+",drop1-"+this.el.dom.id,width:this.msWidth,height:this.msHeight,displayField:this.displayField,valueField:this.valueField,store:this.toStore,isFormField:false,tbar:this.toTBar,sortField:this.toSortField,sortDir:this.toSortDir});this.toMultiselect.on("dblclick",this.onRowDblClick,this);var g=new Ext.Panel({bodyStyle:this.bodyStyle,border:this.border,layout:"table",layoutConfig:{columns:3}});g.add(this.switchToFrom?this.toMultiselect:this.fromMultiselect);var c=new Ext.Panel({header:false});g.add(c);g.add(this.switchToFrom?this.fromMultiselect:this.toMultiselect);g.render(this.el);c.el.down("."+c.bwrapCls).remove();if(this.imagePath!=""&&this.imagePath.charAt(this.imagePath.length-1)!="/"){this.imagePath+="/"}this.iconUp=this.imagePath+(this.iconUp||"up2.gif");this.iconDown=this.imagePath+(this.iconDown||"down2.gif");this.iconLeft=this.imagePath+(this.iconLeft||"left2.gif");this.iconRight=this.imagePath+(this.iconRight||"right2.gif");this.iconTop=this.imagePath+(this.iconTop||"top2.gif");this.iconBottom=this.imagePath+(this.iconBottom||"bottom2.gif");var f=c.getEl();if(!this.toSortField){this.toTopIcon=f.createChild({tag:"img",src:this.iconTop,style:{cursor:"pointer",margin:"2px"}});f.createChild({tag:"br"});this.upIcon=f.createChild({tag:"img",src:this.iconUp,style:{cursor:"pointer",margin:"2px"}});f.createChild({tag:"br"})}this.addIcon=f.createChild({tag:"img",src:this.switchToFrom?this.iconLeft:this.iconRight,style:{cursor:"pointer",margin:"2px"}});f.createChild({tag:"br"});this.removeIcon=f.createChild({tag:"img",src:this.switchToFrom?this.iconRight:this.iconLeft,style:{cursor:"pointer",margin:"2px"}});f.createChild({tag:"br"});if(!this.toSortField){this.downIcon=f.createChild({tag:"img",src:this.iconDown,style:{cursor:"pointer",margin:"2px"}});f.createChild({tag:"br"});this.toBottomIcon=f.createChild({tag:"img",src:this.iconBottom,style:{cursor:"pointer",margin:"2px"}})}if(!this.readOnly){if(!this.toSortField){this.toTopIcon.on("click",this.toTop,this);this.upIcon.on("click",this.up,this);this.downIcon.on("click",this.down,this);this.toBottomIcon.on("click",this.toBottom,this)}this.addIcon.on("click",this.fromTo,this);this.removeIcon.on("click",this.toFrom,this)}if(!this.drawUpIcon||this.hideNavIcons){this.upIcon.dom.style.display="none"}if(!this.drawDownIcon||this.hideNavIcons){this.downIcon.dom.style.display="none"}if(!this.drawLeftIcon||this.hideNavIcons){this.addIcon.dom.style.display="none"}if(!this.drawRightIcon||this.hideNavIcons){this.removeIcon.dom.style.display="none"}if(!this.drawTopIcon||this.hideNavIcons){this.toTopIcon.dom.style.display="none"}if(!this.drawBotIcon||this.hideNavIcons){this.toBottomIcon.dom.style.display="none"}var b=g.body.first();this.el.setWidth(g.body.first().getWidth());g.body.removeClass();this.hiddenName=this.name;var e={tag:"input",type:"hidden",value:"",name:this.name};this.hiddenField=this.el.createChild(e);this.valueChanged(this.toStore)},initValue:Ext.emptyFn,toTop:function(){var c=this.toMultiselect.view.getSelectedIndexes();var a=[];if(c.length>0){c.sort();for(var b=0;b<c.length;b++){record=this.toMultiselect.view.store.getAt(c[b]);a.push(record)}c=[];for(var b=a.length-1;b>-1;b--){record=a[b];this.toMultiselect.view.store.remove(record);this.toMultiselect.view.store.insert(0,record);c.push(((a.length-1)-b))}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(c)},toBottom:function(){var c=this.toMultiselect.view.getSelectedIndexes();var a=[];if(c.length>0){c.sort();for(var b=0;b<c.length;b++){record=this.toMultiselect.view.store.getAt(c[b]);a.push(record)}c=[];for(var b=0;b<a.length;b++){record=a[b];this.toMultiselect.view.store.remove(record);this.toMultiselect.view.store.add(record);c.push((this.toMultiselect.view.store.getCount())-(a.length-b))}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(c)},up:function(){var a=null;var c=this.toMultiselect.view.getSelectedIndexes();c.sort();var d=[];if(c.length>0){for(var b=0;b<c.length;b++){a=this.toMultiselect.view.store.getAt(c[b]);if((c[b]-1)>=0){this.toMultiselect.view.store.remove(a);this.toMultiselect.view.store.insert(c[b]-1,a);d.push(c[b]-1)}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(d)}},down:function(){var a=null;var c=this.toMultiselect.view.getSelectedIndexes();c.sort();c.reverse();var d=[];if(c.length>0){for(var b=0;b<c.length;b++){a=this.toMultiselect.view.store.getAt(c[b]);if((c[b]+1)<this.toMultiselect.view.store.getCount()){this.toMultiselect.view.store.remove(a);this.toMultiselect.view.store.insert(c[b]+1,a);d.push(c[b]+1)}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(d)}},fromTo:function(){var d=this.fromMultiselect.view.getSelectedIndexes();var b=[];if(d.length>0){for(var c=0;c<d.length;c++){record=this.fromMultiselect.view.store.getAt(d[c]);b.push(record)}if(!this.allowDup){d=[]}for(var c=0;c<b.length;c++){record=b[c];if(this.allowDup){var a=new Ext.data.Record();record.id=a.id;delete a;this.toMultiselect.view.store.add(record)}else{this.fromMultiselect.view.store.remove(record);this.toMultiselect.view.store.add(record);d.push((this.toMultiselect.view.store.getCount()-1))}}}this.toMultiselect.view.refresh();this.fromMultiselect.view.refresh();if(this.toSortField){this.toMultiselect.store.sort(this.toSortField,this.toSortDir)}if(this.allowDup){this.fromMultiselect.view.select(d)}else{this.toMultiselect.view.select(d)}},toFrom:function(){var c=this.toMultiselect.view.getSelectedIndexes();var a=[];if(c.length>0){for(var b=0;b<c.length;b++){record=this.toMultiselect.view.store.getAt(c[b]);a.push(record)}c=[];for(var b=0;b<a.length;b++){record=a[b];this.toMultiselect.view.store.remove(record);if(!this.allowDup){this.fromMultiselect.view.store.add(record);c.push((this.fromMultiselect.view.store.getCount()-1))}}}this.fromMultiselect.view.refresh();this.toMultiselect.view.refresh();if(this.fromSortField){this.fromMultiselect.store.sort(this.fromSortField,this.fromSortDir)}this.fromMultiselect.view.select(c)},valueChanged:function(c){var a=null;var b=[];for(var d=0;d<c.getCount();d++){a=c.getAt(d);b.push(a.get(this.valueField))}this.hiddenField.dom.value=b.join(this.delimiter);this.fireEvent("change",this,this.getValue(),this.hiddenField.dom.value)},getValue:function(){return this.hiddenField.dom.value},onRowDblClick:function(c,a,b,d){return this.fireEvent("rowdblclick",c,a,b,d)},reset:function(){range=this.toMultiselect.store.getRange();this.toMultiselect.store.removeAll();if(!this.allowDup){this.fromMultiselect.store.add(range);this.fromMultiselect.store.sort(this.displayField,"ASC")}this.valueChanged(this.toMultiselect.store)}});Ext.reg("itemselector",Ext.ux.ItemSelector);Ext.ux.ItemSelectorAutoSuggest=Ext.extend(Ext.form.Field,{msWidth:200,msHeight:300,hideNavIcons:false,imagePath:"",iconUp:"up2.gif",iconDown:"down2.gif",iconLeft:"left2.gif",iconRight:"right2.gif",iconTop:"top2.gif",iconBottom:"bottom2.gif",drawUpIcon:true,drawDownIcon:true,drawLeftIcon:true,drawRightIcon:true,drawTopIcon:true,drawBotIcon:true,url:null,fromStore:null,toStore:null,fromData:null,toData:null,displayField:0,valueField:1,switchToFrom:false,allowDup:false,focusClass:undefined,delimiter:",",readOnly:false,toLegend:null,fromLegend:null,toSortField:null,fromSortField:null,toSortDir:"ASC",fromSortDir:"ASC",toTBar:null,fromTBar:null,bodyStyle:null,border:false,loadOnChange:true,defaultAutoCreate:{tag:"div"},keyword:null,randN:Math.floor(Math.random()*10000000),fromMultiselect:null,initComponent:function(){Ext.ux.ItemSelectorAutoSuggest.superclass.initComponent.call(this);this.addEvents({"rowdblclick":true,"change":true})},onOkButtonClick:function(a,b){this.fromMultiselect.el.mask("Loading...");this.fromStore.load({params:{like:a,option:b}});ms=this.fromMultiselect;this.fromStore.on("load",function(){ms.el.unmask()})},onDataLoad:function(){ms=this.fromMultiselect;this.fromMultiselect.el.mask("Loading...");this.fromMultiselect.store.load();this.fromMultiselect.store.on("load",function(){ms.el.unmask()})},onRender:function(h,g){Ext.ux.ItemSelectorAutoSuggest.superclass.onRender.call(this,h,g);var c=new Ext.form.ComboBox({parent:this,name:this.id+"_optioncombo_"+this.randN,store:new Ext.data.SimpleStore({fields:["value","display"],data:[["start_with","Starts with"],["any","Match Any"]]}),listeners:{change:function(){if(a.getValue()!=a.originalValue&&a.getValue()!=""){this.parent.onOkButtonClick(a.getValue(),c.getValue())}}},width:80,displayField:"display",valueField:"value",triggerAction:"all",mode:"local",lazyRender:true});c.setValue("any");this.fromStore=new Ext.data.JsonStore({url:this.url,fields:[this.valueField,this.displayField]});var k=new Ext.Button({name:this.id+"_okbutton_"+this.randN,text:"Go",parent:this,listeners:{click:function(){this.parent.onOkButtonClick(a.getValue(),c.getValue())}}});var i=new Ext.Button({name:this.id+"_listallbutton_"+this.randN,text:"List All",parent:this,listeners:{click:function(){this.parent.onOkButtonClick("%%","")}}});if(this.loadOnChange){var a=new Ext.form.TextField({name:this.id+"_keyword_"+this.randN,id:this.id+"_keyword_"+this.randN,emptyText:"Filter...",parent:this,width:100,enableKeyEvents:true,listeners:{keyup:function(){this.parent.onOkButtonClick(a.getValue(),c.getValue())}}});var b=new Ext.Toolbar({items:[c,a,i]})}else{var a=new Ext.form.TextField({name:this.id+"_keyword_"+this.randN,id:this.id+"_keyword_"+this.randN,emptyText:"Filter...",width:100});var b=new Ext.Toolbar({items:[c,a,k,i]})}this.fromTBar=b;this.fromMultiselect=new Ext.ux.Multiselect({legend:this.fromLegend,delimiter:this.delimiter,allowDup:this.allowDup,copy:this.allowDup,allowTrash:this.allowDup,dragGroup:this.readOnly?null:"drop2-"+this.el.dom.id,dropGroup:this.readOnly?null:"drop1-"+this.el.dom.id,width:this.msWidth,height:this.msHeight,dataFields:this.dataFields,data:this.fromData,displayField:this.displayField,valueField:this.valueField,store:this.fromStore,isFormField:false,tbar:this.fromTBar,appendOnly:true,sortField:this.fromSortField,sortDir:this.fromSortDir,id:this.id+"_from_multi_select_"+this.randN});this.fromMultiselect.on("dblclick",this.onRowDblClick,this);if(!this.toStore){this.toStore=new Ext.data.SimpleStore({fields:this.dataFields,data:this.toData})}this.toStore.on("add",this.valueChanged,this);this.toStore.on("remove",this.valueChanged,this);this.toStore.on("load",this.valueChanged,this);this.toMultiselect=new Ext.ux.Multiselect({legend:this.toLegend,delimiter:this.delimiter,allowDup:this.allowDup,dragGroup:this.readOnly?null:"drop1-"+this.el.dom.id,dropGroup:this.readOnly?null:"drop2-"+this.el.dom.id+",drop1-"+this.el.dom.id,width:this.msWidth,height:this.msHeight,displayField:this.displayField,valueField:this.valueField,store:this.toStore,isFormField:false,tbar:this.toTBar,sortField:this.toSortField,sortDir:this.toSortDir});this.toMultiselect.on("dblclick",this.onRowDblClick,this);var d=new Ext.Panel({bodyStyle:this.bodyStyle,border:this.border,layout:"table",layoutConfig:{columns:3},width:530});d.add(this.switchToFrom?this.toMultiselect:this.fromMultiselect);var m=new Ext.Panel({header:false});d.add(m);d.add(this.switchToFrom?this.fromMultiselect:this.toMultiselect);d.render(this.el);m.el.down("."+m.bwrapCls).remove();if(this.imagePath!=""&&this.imagePath.charAt(this.imagePath.length-1)!="/"){this.imagePath+="/"}this.iconUp=this.imagePath+(this.iconUp||"up2.gif");this.iconDown=this.imagePath+(this.iconDown||"down2.gif");this.iconLeft=this.imagePath+(this.iconLeft||"left2.gif");this.iconRight=this.imagePath+(this.iconRight||"right2.gif");this.iconTop=this.imagePath+(this.iconTop||"top2.gif");this.iconBottom=this.imagePath+(this.iconBottom||"bottom2.gif");var e=m.getEl();if(!this.toSortField){this.toTopIcon=e.createChild({tag:"img",src:this.iconTop,style:{cursor:"pointer",margin:"2px"}});e.createChild({tag:"br"});this.upIcon=e.createChild({tag:"img",src:this.iconUp,style:{cursor:"pointer",margin:"2px"}});e.createChild({tag:"br"})}this.addIcon=e.createChild({tag:"img",src:this.switchToFrom?this.iconLeft:this.iconRight,style:{cursor:"pointer",margin:"2px"}});e.createChild({tag:"br"});this.removeIcon=e.createChild({tag:"img",src:this.switchToFrom?this.iconRight:this.iconLeft,style:{cursor:"pointer",margin:"2px"}});e.createChild({tag:"br"});if(!this.toSortField){this.downIcon=e.createChild({tag:"img",src:this.iconDown,style:{cursor:"pointer",margin:"2px"}});e.createChild({tag:"br"});this.toBottomIcon=e.createChild({tag:"img",src:this.iconBottom,style:{cursor:"pointer",margin:"2px"}})}if(!this.readOnly){if(!this.toSortField){this.toTopIcon.on("click",this.toTop,this);this.upIcon.on("click",this.up,this);this.downIcon.on("click",this.down,this);this.toBottomIcon.on("click",this.toBottom,this)}this.addIcon.on("click",this.fromTo,this);this.removeIcon.on("click",this.toFrom,this)}if(!this.drawUpIcon||this.hideNavIcons){this.upIcon.dom.style.display="none"}if(!this.drawDownIcon||this.hideNavIcons){this.downIcon.dom.style.display="none"}if(!this.drawLeftIcon||this.hideNavIcons){this.addIcon.dom.style.display="none"}if(!this.drawRightIcon||this.hideNavIcons){this.removeIcon.dom.style.display="none"}if(!this.drawTopIcon||this.hideNavIcons){this.toTopIcon.dom.style.display="none"}if(!this.drawBotIcon||this.hideNavIcons){this.toBottomIcon.dom.style.display="none"}var f=d.body.first();this.el.setWidth(d.body.first().getWidth());d.body.removeClass();this.hiddenName=this.name;var j={tag:"input",type:"hidden",value:"",name:this.name};this.hiddenField=this.el.createChild(j);this.valueChanged(this.toStore)},initValue:Ext.emptyFn,toTop:function(){var c=this.toMultiselect.view.getSelectedIndexes();var a=[];if(c.length>0){c.sort();for(var b=0;b<c.length;b++){record=this.toMultiselect.view.store.getAt(c[b]);a.push(record)}c=[];for(var b=a.length-1;b>-1;b--){record=a[b];this.toMultiselect.view.store.remove(record);this.toMultiselect.view.store.insert(0,record);c.push(((a.length-1)-b))}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(c)},toBottom:function(){var c=this.toMultiselect.view.getSelectedIndexes();var a=[];if(c.length>0){c.sort();for(var b=0;b<c.length;b++){record=this.toMultiselect.view.store.getAt(c[b]);a.push(record)}c=[];for(var b=0;b<a.length;b++){record=a[b];this.toMultiselect.view.store.remove(record);this.toMultiselect.view.store.add(record);c.push((this.toMultiselect.view.store.getCount())-(a.length-b))}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(c)},up:function(){var a=null;var c=this.toMultiselect.view.getSelectedIndexes();c.sort();var d=[];if(c.length>0){for(var b=0;b<c.length;b++){a=this.toMultiselect.view.store.getAt(c[b]);if((c[b]-1)>=0){this.toMultiselect.view.store.remove(a);this.toMultiselect.view.store.insert(c[b]-1,a);d.push(c[b]-1)}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(d)}},down:function(){var a=null;var c=this.toMultiselect.view.getSelectedIndexes();c.sort();c.reverse();var d=[];if(c.length>0){for(var b=0;b<c.length;b++){a=this.toMultiselect.view.store.getAt(c[b]);if((c[b]+1)<this.toMultiselect.view.store.getCount()){this.toMultiselect.view.store.remove(a);this.toMultiselect.view.store.insert(c[b]+1,a);d.push(c[b]+1)}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(d)}},fromTo:function(){var d=this.fromMultiselect.view.getSelectedIndexes();var b=[];if(d.length>0){for(var c=0;c<d.length;c++){record=this.fromMultiselect.view.store.getAt(d[c]);b.push(record)}if(!this.allowDup){d=[]}for(var c=0;c<b.length;c++){record=b[c];if(this.allowDup){var a=new Ext.data.Record();record.id=a.id;delete a;this.toMultiselect.view.store.add(record)}else{this.fromMultiselect.view.store.remove(record);this.toMultiselect.view.store.add(record);d.push((this.toMultiselect.view.store.getCount()-1))}}}this.toMultiselect.view.refresh();this.fromMultiselect.view.refresh();if(this.toSortField){this.toMultiselect.store.sort(this.toSortField,this.toSortDir)}if(this.allowDup){this.fromMultiselect.view.select(d)}else{this.toMultiselect.view.select(d)}},toFrom:function(){var c=this.toMultiselect.view.getSelectedIndexes();var a=[];if(c.length>0){for(var b=0;b<c.length;b++){record=this.toMultiselect.view.store.getAt(c[b]);a.push(record)}c=[];for(var b=0;b<a.length;b++){record=a[b];this.toMultiselect.view.store.remove(record);if(!this.allowDup){this.fromMultiselect.view.store.add(record);c.push((this.fromMultiselect.view.store.getCount()-1))}}}this.fromMultiselect.view.refresh();this.toMultiselect.view.refresh();if(this.fromSortField){this.fromMultiselect.store.sort(this.fromSortField,this.fromSortDir)}this.fromMultiselect.view.select(c)},valueChanged:function(c){var a=null;var b=[];for(var d=0;d<c.getCount();d++){a=c.getAt(d);b.push(a.get(this.valueField))}this.hiddenField.dom.value=b.join(this.delimiter);this.fireEvent("change",this,this.getValue(),this.hiddenField.dom.value)},getValue:function(){return this.hiddenField.dom.value},onRowDblClick:function(c,a,b,d){return this.fireEvent("rowdblclick",c,a,b,d)},reset:function(){range=this.toMultiselect.store.getRange();this.toMultiselect.store.removeAll();if(!this.allowDup){this.fromMultiselect.store.add(range);this.fromMultiselect.store.sort(this.displayField,"ASC")}this.valueChanged(this.toMultiselect.store)}});Ext.reg("itemselectorautosuggest",Ext.ux.ItemSelectorAutoSuggest);Ext.override(Ext.layout.TableLayout,{getNextCell:function(i){var a=this.getNextNonSpan(this.currentColumn,this.currentRow);var f=this.currentColumn=a[0],e=this.currentRow=a[1];for(var h=e;h<e+(i.rowspan||1);h++){if(!this.cells[h]){this.cells[h]=[]}for(var d=f;d<f+(i.colspan||1);d++){this.cells[h][d]=true}}var g=document.createElement("td");if(i.cellId){g.id=i.cellId}var b="x-table-layout-cell";if(i.cellCls){b+=" "+i.cellCls}g.className=b;if(i.cellStyle){Ext.DomHelper.applyStyles(g,i.cellStyle)}if(i.colspan){g.colSpan=i.colspan}if(i.rowspan){g.rowSpan=i.rowspan}this.getRow(e).appendChild(g);return g}});Ext.ux.JsonTreeNode=function(a){a=a||{};Ext.applyIf(a,{leaf:(a.children===null)});Ext.ux.JsonTreeNode.superclass.constructor.call(this,a);if(a.children){this.createChildren(a.children)}};Ext.extend(Ext.ux.JsonTreeNode,Ext.tree.TreeNode,{createChildren:function(b){this.on("click",function(){this.toggle()},this);for(var a=0;a<b.length;a++){this.appendChild(new Ext.ux.JsonTreeNode(b[a]))}},destroyChildren:function(){while(this.firstChild){var a=this.firstChild;this.removeChild(a);if(a.destroy){a.destroy()}}},appendChild:function(b){if(!b.render&&!Ext.isArray(b)){b=this.getLoader().createNode(b)}var a=Ext.ux.JsonTreeNode.superclass.appendChild.call(this,b);if(a&&this.childrenRendered){a.render()}this.ui.updateExpandIcon();return a},renderChildren:function(b){if(b!==false){this.fireEvent("beforechildrenrendered",this)}var d=this.childNodes;for(var c=0,a=d.length;c<a;c++){d[c].render(true)}this.childrenRendered=true}});Ext.ux.TreeItemSelector=Ext.extend(Ext.form.Field,{fromRootText:"Options",toRootText:"Selected",width:400,height:"auto",hideNavIcons:false,imagePath:"",iconLeft:"left2.gif",iconRight:"right2.gif",drawLeftIcon:true,drawRightIcon:true,switchToFrom:false,readOnly:false,bodyStyle:null,border:true,defaultAutoCreate:{tag:"div"},fromChildren:[],toChildren:[],initComponent:function(){Ext.ux.TreeItemSelector.superclass.initComponent.call(this);this.addEvents({"change":true})},onRender:function(d,a){Ext.ux.TreeItemSelector.superclass.onRender.call(this,d,a);this.fromTreeConfig=this.fromTreeConfig||{};Ext.applyIf(this.fromTreeConfig,{animate:true,autoScroll:true,enableDD:true,containerScroll:true,cellStyle:"vertical-align:top;"});this.toTreeConfig=this.toTreeConfig||{};Ext.applyIf(this.toTreeConfig,{animate:true,autoScroll:true,enableDD:true,containerScroll:true,dropConfig:{appendOnly:true},cellStyle:"vertical-align:top;"});this.fromTree=new Ext.tree.TreePanel(this.fromTreeConfig);this.fromTree.setRootNode(new Ext.ux.JsonTreeNode({text:this.fromRootText,draggable:false,id:"source",expanded:true,leaf:false,children:this.fromChildren}));this.toTree=new Ext.tree.TreePanel(this.toTreeConfig);this.toTree.setRootNode(new Ext.ux.JsonTreeNode({text:this.toRootText,draggable:false,id:"target",expanded:true,leaf:false,children:this.toChildren}));this.toTree.on({beforenodedrop:{scope:this,fn:this.onBeforeNodeDrop},click:{scope:this,fn:this.onClick}});this.fromTree.on({beforenodedrop:{scope:this,fn:this.onBeforeNodeDrop},click:{scope:this,fn:this.onClick}});new Ext.tree.TreeSorter(this.fromTree,{folderSort:true});new Ext.tree.TreeSorter(this.toTree,{folderSort:true});var g=new Ext.Panel({bodyStyle:this.bodyStyle,border:this.border,layout:"table",layoutConfig:{columns:3}});g.add(this.switchToFrom?this.toTree:this.fromTree);var c=new Ext.Panel({header:false,cellStyle:"vertical-align:middle;"});g.add(c);g.add(this.switchToFrom?this.fromTree:this.toTree);g.render(this.el);c.el.down("."+c.bwrapCls).remove();if(this.imagePath!=""&&this.imagePath.charAt(this.imagePath.length-1)!="/"){this.imagePath+="/"}this.iconLeft=this.imagePath+(this.iconLeft||"left2.gif");this.iconRight=this.imagePath+(this.iconRight||"right2.gif");var f=c.getEl();this.addIcon=f.createChild({tag:"img",src:this.switchToFrom?this.iconLeft:this.iconRight,style:{cursor:"pointer",margin:"2px"}});f.createChild({tag:"br"});this.removeIcon=f.createChild({tag:"img",src:this.switchToFrom?this.iconRight:this.iconLeft,style:{cursor:"pointer",margin:"2px"}});f.createChild({tag:"br"});if(!this.readOnly){this.addIcon.on("click",this.fromTo,this);this.removeIcon.on("click",this.toFrom,this)}if(!this.drawLeftIcon||this.hideNavIcons){this.addIcon.dom.style.display="none"}if(!this.drawRightIcon||this.hideNavIcons){this.removeIcon.dom.style.display="none"}var b=g.body.first();this.el.setWidth(g.body.getWidth());g.body.removeClass();this.hiddenName=this.name;var e={tag:"input",type:"hidden",value:"",name:this.name};this.hiddenField=this.el.createChild(e)},initValue:Ext.emptyFn,fromTo:function(){if(this.selectedNode&&this.selectedNode!=null){var a={target:this.toTree.root,dropNode:this.selectedNode};this.selectedNode=null;this.onBeforeNodeDrop(a)}},toFrom:function(){if(this.selectedNode&&this.selectedNode!=null){var a={target:this.fromTree.root,dropNode:this.selectedNode};this.selectedNode=null;this.onBeforeNodeDrop(a)}},onBeforeNodeDrop:function(g){if(this.disabled){return false}var c=g.dropNode;var h=g.target.leaf?g.target.parentNode:g.target;if(c.parentNode===h){return false}if(h.isRoot){if(c.parentNode.isRoot){if(this.hasChild(h,c.attributes.value)){c.expand();var f=this.getChild(h,c.attributes.value);for(var b=0,a=c.childNodes.length;b<a;b++){if(!this.hasChild(f,c.childNodes[b].attributes.value)){f.appendChild(this.createNode(c.childNodes[b]))}}h.expand();f.expand();c.parentNode.removeChild(c)}else{var f=h.appendChild(this.createNode(c));for(var b=0,a=c.childNodes.length;b<a;b++){f.appendChild(this.createNode(c.childNodes[b]))}h.expand();f.expand();c.parentNode.removeChild(c)}}else{if(this.hasChild(h,c.parentNode.attributes.value)){var f=this.getChild(h,c.parentNode.attributes.value);h.expand();f.appendChild(this.createNode(c));f.expand();c.parentNode.removeChild(c)}else{var f=h.appendChild(this.createNode(c.parentNode));f.appendChild(this.createNode(c));f.expand();c.parentNode.removeChild(c)}}}else{if(h.parentNode.isRoot){if(c.parentNode.isRoot&&c.attributes.value==h.attributes.value){for(var b=0,a=c.childNodes.length;b<a;b++){if(!this.hasChild(h,c.childNodes[b].attributes.value)){h.appendChild(this.createNode(c.childNodes[b]))}}c.parentNode.removeChild(c)}else{if(!c.parentNode.isRoot){h.appendChild(this.createNode(c));h.expand();c.parentNode.removeChild(c)}}}}this.valueChanged();g.target.ui.endDrop();return false},onClick:function(a){this.selectedNode=a},createNode:function(a){return new Ext.ux.JsonTreeNode({text:a.text,value:a.attributes.value,leaf:a.isLeaf(),iconCls:a.attributes.iconCls})},hasChild:function(b,a){return(b.isLeaf()?b.parentNode:b).findChild("value",a)!==null},getChild:function(b,a){return(b.isLeaf()?b.parentNode:b).findChild("value",a)},valueChanged:function(){var a=new Ext.tree.JsonTreeSerializer(this.toTree);this.hiddenField.dom.value=a.toString();this.fireEvent("change",this,this.getValue(),this.hiddenField.dom.value)},getValue:function(){return this.hiddenField.dom.value}});Ext.reg("treeitemselector",Ext.ux.TreeItemSelector);Ext.ux.ColorField=Ext.extend(Ext.form.TriggerField,{valueVisible:true,invalidText:"'{0}' is not a valid color - it must be in a the hex format (# followed by 3 or 6 letters/numbers 0-9 A-F)",triggerClass:"x-form-color-trigger",defaultAutoCreate:{tag:"input",type:"text",size:"10",maxlength:"7",autocomplete:"off"},maskRe:/[#a-f0-9]/i,lazyInit:true,initComponent:function(){Ext.ux.ColorField.superclass.initComponent.call(this);this.addEvents("expand","collapse")},onRender:function(b,a){Ext.ux.ColorField.superclass.onRender.call(this,b,a);if(!this.lazyInit){this.initPicker()}},onDestroy:function(){Ext.destroy(this.picker);Ext.ux.ColorField.superclass.onDestroy.call(this)},initPicker:function(){if(!this.picker){var c=this.getValue();var a={tag:"div",style:{position:"absolute","z-index":"10000"}};var b=Ext.DomHelper.append(Ext.getBody(),a);this.picker=new Ext.ux.color.ColorPickerPanel({applyTo:b,hex:c.replace("#",""),mode:"hue",hidden:true});this.mon(this.picker.okButton,"click",this.pickColor,this)}},pickColor:function(){this.setValue(this.picker.hex.getValue());this.collapse()},isExpanded:function(){return this.picker&&this.picker.isVisible()},validateValue:function(b){if(!Ext.ux.ColorField.superclass.validateValue.call(this,b)){return false}if(b.length<1){this.setColor("");return true}var a=this.parseColor(b);if(!b||(a==false)){this.markInvalid(String.format(this.invalidText,b));return false}this.setColor(b);return true},setColor:function(a){if(a==""||a==undefined){a=(this.emptyText!=""&&this.parseColor(this.emptyText))?this.emptyText:"transparent"}if(this.trigger){if(this.valueVisible){this.trigger.setStyle({"background-color":a})}else{this.getEl().dom.style.backgroundColor=a}this.getEl().setStyle({"background-color":a})}else{this.on("render",function(){this.setColor(a)},this)}},setValue:function(a){Ext.ux.ColorField.superclass.setValue.call(this,this.formatColor(a));this.setColor(this.formatColor(a))},parseColor:function(a){return(!a||(a.substring(0,1)!="#"))?false:(a.length==4||a.length==7)},formatColor:function(a){if(!a||this.parseColor(a)){return a}if(a.length==3||a.length==6){return"#"+a}return""},collapse:function(){if(!this.isExpanded()){return}this.picker.hide();Ext.getDoc().un("mousewheel",this.collapseIf,this);Ext.getDoc().un("mousedown",this.collapseIf,this);this.fireEvent("collapse",this)},collapseIf:function(a){if(!this.isDestroyed&&!a.within(this.wrap)&&!a.within(this.picker.el)){this.collapse()}},expand:function(){if(this.isExpanded()){return}this.picker.show();this.picker.el.alignTo(this.el,"bl-tl?");this.mon(Ext.getDoc(),{scope:this,mousewheel:this.collapseIf,mousedown:this.collapseIf});this.fireEvent("expand",this)},onTriggerClick:function(a){if(this.readOnly||this.disabled){return}this.initPicker();if(this.isExpanded()){this.collapse();this.el.focus()}else{this.onFocus();this.expand()}}});Ext.reg("colorfield",Ext.ux.ColorField);Ext.namespace("Ext.ux.color");Ext.ux.color.Color=function(a){Ext.apply(this,this.defaultValues);Ext.apply(this,a)};Ext.ux.color.Color.prototype={setRgb:function(a){this.set("red",a);this.set("green",a);this.set("blue",a);this.rgbToHsv();this.produceHex()},setHsv:function(a){this.set("hue",a);this.set("saturation",a);this.set("brightness",a);this.hsvToRgb();this.produceHex()},setHex:function(c){var b,a;c=this.validateHex(c);a=this.splitHex(c);for(b in a){c=a[b];switch(b){case"red":this.setRed(parseInt(c,16));break;case"green":this.setGreen(parseInt(c,16));break;case"blue":this.setBlue(parseInt(c,16));break}}this.rgbToHsv();this.produceHex()},version:{major:0,minor:1,tiny:0,toString:function(){return[this.major,this.minor,this.tiny].join(".")}},defaultValues:{red:0,green:0,blue:0,hue:0,saturation:0,brightness:0,hex:"000000"},produceHex:function(){this.hex=this.intToHex(this.red)+this.intToHex(this.green)+this.intToHex(this.blue)},intToHex:function(b){var a=(parseInt(b,10).toString(16));if(a.length==1){a=("0"+a)}return a.toUpperCase()},constrainWithWarnings:function(d,c,b,a){if(isNaN(d)){d=b}else{if(d<b){d=b}else{if(d>a){d=a}}}return d},constrainRgb:function(b,a){b=this.constrainWithWarnings(b,a,0,255);if(a.match(/^(red|blue|green)$/)!==null){this[a]=b}},rgbToHsv:function(){var c,g,i,e,d,f,a,b,h;a=this.red/255;b=this.green/255;h=this.blue/255;g=Math.max(a,b,h);c=Math.min(a,b,h);i=g-c;f=g;d=(g)?((g-c)/g):0;if(!d){e=0}else{if(a===g){e=(b-h)/i}else{if(b===g){e=2+(h-a)/i}else{e=4+(a-b)/i}}e=e*60;if(e<0){e+=360}}this.setHue(parseInt(e,10));this.setSaturation(parseInt(d*100));this.setBrightness(parseInt(f*100))},hsvToRgb:function(){var c,e,g,b,a,m,h,j=this.brightness/100,d=this.saturation/100;if(this.saturation===0){var k=j*255;this.setRed(k);this.setGreen(k);this.setBlue(k)}e=this.hue/60;c=parseInt(e,10);g=e-c;b=j*(1-d);a=j*(1-d*g);m=j*(1-d*(1-g));h=[[j,m,b],[a,j,b],[b,j,m],[b,a,j],[m,b,j],[j,b,a]][c];this.setRed(h[0]*255);this.setGreen(h[1]*255);this.setBlue(h[2]*255)},validateHex:function(b){var a=b||this.hex;a=a.toUpperCase();if(a.charAt[0]==="#"){a=a.slice(1)}a=a.replace(/[^A-F0-9]/g,"0");if(a.length>6){a=a.substring(0,6)}return a},capitalize:function(a){return a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()},set:function(b,a){if(a[b]){this["set"+this.capitalize(b)](a[b])}},splitHex:function(a){return{red:a.slice(0,2),green:a.slice(2,4),blue:a.slice(4,6)}},setRed:function(a){this.constrainRgb(a,"red")},setGreen:function(a){this.constrainRgb(a,"green")},setBlue:function(a){this.constrainRgb(a,"blue")},setHue:function(a){a=this.constrainWithWarnings(a,"hue",0,359);this.hue=a},setSaturation:function(a){a=this.constrainWithWarnings(a,"saturation",0,100);this.saturation=a},setBrightness:function(a){a=this.constrainWithWarnings(a,"brightness",0,100);this.brightness=a}};Ext.ux.Radio={groups:{},callbacks:{},registerGroup:function(a){if(!a.radioGroupId){a.radioGroupId=Ext.id()}if(!this.groups[a.radioGroupId]){this.groups[a.radioGroupId]={dialed:null,members:[]}}},registerMember:function(a,c,b){this.registerGroup(a);if(!c.radioGroupMemberId){c.radioGroupMemberId=Ext.id()}if(this.groups[a.radioGroupId].members.indexOf(c.radioGroupMemberId)===-1){this.groups[a.radioGroupId].members.push(c.radioGroupMemberId);this.callbacks[c.radioGroupMemberId]=b}},unregisterMember:function(b,c){var a=this.groups[b.radioGroupId].members;Ext.each(a,function(e,d){if(e===e.radioGroupMember.id){a=a.splice(d,1)}})},dial:function(a,b){this.groups[a.radioGroupId].dialed=b.radioGroupMemberId;Ext.each(this.groups[a.radioGroupId].members,function(c){this.callbacks[c].un()},this);this.callbacks[b.radioGroupMemberId].dial()},dialed:function(a,b){return(this.groups[a.radioGroupId].dialed===b.radioGroupMemberId)}};Ext.ux.color.ColorPickerPanel=function(){this.modeFields={};this.preloads=[];Ext.ux.color.ColorPickerPanel.superclass.constructor.apply(this,arguments)};Ext.extend(Ext.ux.color.ColorPickerPanel,Ext.Panel,{width:400,height:305,hex:"FF0000",mode:"saturation",baseCls:"x-color-picker x-panel",iconCls:"x-color-wheel",imagePath:"/appFlowerExtjsThemePlugin/extjs-3/plugins/form/adv-color-picker/images/",images:["bar-blue-bl","bar-blue-br","bar-blue-tl","bar-blue-tr","bar-brightness","bar-green-bl","bar-green-br","bar-green-tl","bar-green-tr","bar-hue","bar-red-bl","bar-red-br","bar-red-tl","bar-red-tr","bar-saturation","map-blue-max","map-blue-min","map-brightness","map-green-max","map-green-min","map-hue","map-red-max","map-saturation","map-saturation-overlay"],modes:{red:{name:"red",abbr:"R",min:0,max:255},green:{name:"green",abbr:"G",min:0,max:255},blue:{name:"blue",abbr:"B",min:0,max:255},hue:{name:"hue",abbr:"H",min:0,max:359,unit:"%"},saturation:{name:"saturation",abbr:"S",min:0,max:100,unit:"%"},brightness:{name:"brightness",abbr:"B",min:0,max:100,unit:"%"}},initComponent:function(){if(this.frame){this.width=410;this.height=310}this.preloadImages();Ext.ux.color.ColorPickerPanel.superclass.initComponent.apply(this,arguments);this.color=new Ext.ux.color.Color();this.color.setHex(this.hex)},onRender:function(){if(this.el){Ext.ux.color.ColorPickerPanel.superclass.onRender.apply(this,arguments);this.initMarkup();this.initLayers();this.initConsole();this.initMap();this.initSlider();this.writeToConsole();this.setMode(this.mode)}},write:function(d,a){var b=this.modeFields[d.name],c=parseInt(a,10);c=c.constrain(d.min,d.max);b.setRawValue(c.toString().replace(new RegExp(d.unit||""),"")+(d.unit||""))},isRgb:function(a){return !("red green blue rgb".indexOf(a.name)===-1)},isHsv:function(a){return !("hue saturation brightness hsv".indexOf(a.name)===-1)},setFromConsole:function(a){if(this.isRgb({name:a})){this.color.setRgb({red:this.modeFields.red.getValue(),green:this.modeFields.green.getValue(),blue:this.modeFields.blue.getValue()});this.writeToConsole("Hsv")}else{this.color.setHsv({hue:this.modeFields.hue.getValue(),saturation:this.modeFields.saturation.getValue(),brightness:this.modeFields.brightness.getValue()});this.writeToConsole("Rgb")}},setFromTrack:function(a){switch(this.mode){case"hue":this.write(this.modes.hue,360-(a/255)*360);break;case"saturation":this.write(this.modes.saturation,100-(a/255)*100);break;case"brightness":this.write(this.modes.brightness,100-(a/255)*100);break;case"red":this.write(this.modes.red,255-(a/255)*255);break;case"green":this.write(this.modes.green,255-(a/255)*255);break;case"blue":this.write(this.modes.blue,255-(a/255)*255);break}switch(this.mode){case"hue":case"saturation":case"brightness":this.setFromConsole("hsv");break;case"red":case"green":case"blue":this.setFromConsole("rgb");break}this.paint()},setFromMap:function(a,b){switch(this.mode){case"hue":this.write(this.modes.saturation,(a/255)*100);this.write(this.modes.brightness,100-((b/255)*100));break;case"saturation":this.write(this.modes.hue,(a/255)*360);this.write(this.modes.brightness,100-((b/255)*100));break;case"brightness":this.write(this.modes.hue,(a/255)*360);this.write(this.modes.saturation,100-((b/255)*100));break;case"red":this.write(this.modes.blue,a);this.write(this.modes.green,255-b);break;case"green":this.write(this.modes.blue,a);this.write(this.modes.red,255-b);break;case"blue":this.write(this.modes.red,a);this.write(this.modes.green,255-b);break}switch(this.mode){case"hue":case"saturation":case"brightness":this.setFromConsole("hsv");break;case"red":case"green":case"blue":this.setFromConsole("rgb");break}this.paint()},writeToConsole:function(a){var c,b;for(c in this.modes){b=this.modes[c];if((a&&this["is"+a](b))||!a){this.write(b,this.color[b.name])}}this.hex.setValue(this.color.hex)},setMode:function(a){this.mode=a;Ext.each(this.layers.map.concat(this.layers.track),function(b){this.setClass(b,"x-layer");this.setAlpha(b,100);this.setBackground(b,null)},this);this[this.mode+"Mode"]();this.paint();this.paintSliders()},hueMode:function(){this.setBackground(this.layers.map[0],this.color.hex);this.setClass(this.layers.map[1],"map-hue");this.setClass(this.layers.track[3],"bar-hue")},saturationMode:function(){this.setClass(this.layers.map[0],"map-saturation");this.setClass(this.layers.map[1],"map-saturation-overlay");this.setBackground(this.layers.track[2],this.color.hex);this.setClass(this.layers.track[3],"bar-saturation")},brightnessMode:function(){this.setBackground(this.layers.map[0],"000000");this.setClass(this.layers.map[1],"map-brightness");this.setBackground(this.layers.track[2],this.color.hex);this.setClass(this.layers.track[3],"bar-brightness")},redMode:function(){this.colorMode("red")},greenMode:function(){this.colorMode("green")},blueMode:function(){this.colorMode("blue")},colorMode:function(a){this.setClass(this.layers.map[1],"map-"+a+"-max");this.setClass(this.layers.map[0],"map-"+a+"-min");this.setClass(this.layers.track[3],"bar-"+a+"-tl");this.setClass(this.layers.track[2],"bar-"+a+"-tr");this.setClass(this.layers.track[1],"bar-"+a+"-br");this.setClass(this.layers.track[0],"bar-"+a+"-bl")},initMarkup:function(){this.body.dom.innerHTML+=['<div class="x-map">','<div class="x-layer"></div>','<div class="x-layer"></div>','<div class="x-pointer"></div>',"</div>",'<div class="x-track">','<div class="x-layer"></div>','<div class="x-layer"></div>','<div class="x-layer"></div>','<div class="x-layer"></div>','<div class="x-slider"></div>',"</div>",'<ul class="x-console">','<li class="preview"></li>','<li class="hue"></li>','<li class="saturation"></li>','<li class="brightness"></li>','<li class="red"></li>','<li class="green"></li>','<li class="blue"></li>','<li class="hex"></li>','<li class="okButton" style="float:right"></li>',"</ul>"].join("")},initConsole:function(){var f=this.body.first(".x-console"),a,c=Ext.id(),e,d,b=this;this.preview=f.first(".preview");for(e in this.modes){(function(g){el=f.first("."+g.name);a=new Ext.Element(document.createElement("div"));a.addClass("x-radio");Ext.ux.Radio.registerMember(b,a.dom,{dial:function(){Ext.fly(this).addClass("x-dialed")}.createDelegate(a),un:function(){Ext.fly(this).removeClass("x-dialed")}.createDelegate(a)});g.radio=a;a.dom.mode=g.name;el.appendChild(a);l=document.createElement("div");l.innerHTML=g.abbr+": ";label=new Ext.Element(l);label.addClass("x-label");el.appendChild(label);if(b.mode===g.name){Ext.ux.Radio.dial(b,a.dom)}a.on({"click":function(i,h){b.setMode(h.mode);Ext.ux.Radio.dial(b,h)}});b.modeFields[g.name]=new Ext.form.NumberField({allowBlank:false,allowNegative:false,allowDecimals:false,fieldLabel:g.unit,minValue:g.min,maxValue:g.max,renderTo:el,validator:function(h){b.write(g,h);b.setFromConsole(g);b.paint();b.paintSliders();return true}});b.modeFields[g.name].el.on({"click":function(h){}})})(b.modes[e])}this.hex=new Ext.form.TextField({renderTo:f.first(".hex"),allowBlank:false,fieldLabel:"hex",label:true,validator:function(g){this.setRawValue("#"+Ext.ux.color.Color.prototype.validateHex(g.replace(/^#/,"")));return true}});l=document.createElement("div");l.innerHTML="Hex: ";label=new Ext.Element(l);label.addClass("x-hex-label");f.first(".hex").appendChild(label);this.okButton=new Ext.Button({renderTo:f.first(".okButton"),text:"Ok"})},initMap:function(){var a=this;var b=this.body.first(".x-map");b.dom.id=Ext.id();var c=b.first(".x-pointer");c.dom.id=Ext.id();this.map=new Ext.dd.DragDrop({id:b.dom.id});Ext.apply(this.map,{onMouseDown:function(d){this.onDrag(d)},onDrag:function(h,i){var g=c.getWidth()-2,f=c.getHeight()-2,k=(g/2),e=(f/2),d=h.xy[0]-b.getLeft()-k,j=h.xy[1]-b.getTop()-e;d=d.constrain(0-k,b.getWidth()-k);c.setLeft(d-1);j=j.constrain(0-e,b.getHeight()-e);c.setTop(j-1);if(!i){a.setFromMap(h.xy[0]-b.getLeft(),h.xy[1]-b.getTop())}},endDrag:function(){document.documentElement.style.cursor="default"}})},initSlider:function(){var c=this;var a=this.body.first(".x-track");a.dom.id=Ext.id();var b=a.first(".x-slider");b.dom.id=Ext.id();this.track=new Ext.dd.DragDrop({id:a.dom.id});Ext.apply(this.track,{onMouseDown:function(d){this.onDrag(d)},onDrag:function(f,g){var e=b.getHeight()-2,d=e/2,h=f.xy[1]-a.getTop()-d;h=h.constrain(0-d,a.getHeight()-d);b.setTop(h-1);if(!g){c.setFromTrack(f.xy[1]-a.getTop())}},endDrag:function(){document.documentElement.style.cursor="default"}})},setAlpha:function(a,b){Ext.fly(a).setOpacity(b/100)},setClass:function(b,a){b.className="x-layer "+a},setBackground:function(a,b){Ext.fly(a).setStyle({backgroundColor:(b==null?"transparent":"#"+b)})},initLayers:function(){this.layers={track:this.body.query(".x-track > .x-layer"),map:this.body.query(".x-map > .x-layer")}},preloadImages:function(){var a;Ext.each(this.images,function(b){a=new Image();a.src=this.imagePath+b+".png";this.preloads.push(a)},this)},paint:function(){this.paintMap();this.paintTrack();this.paintPreview()},paintMap:function(){switch(this.mode){case"hue":var a=new Ext.ux.color.Color();a.setHsv({hue:this.color.hue,saturation:100,brightness:100});this.setBackground(this.layers.map[0],a.hex);break;case"saturation":this.setAlpha(this.layers.map[1],100-this.color.saturation);break;case"brightness":this.setAlpha(this.layers.map[1],this.color.brightness);break;case"red":this.setAlpha(this.layers.map[1],(this.color.red/255)*100);break;case"green":this.setAlpha(this.layers.map[1],(this.color.green/255)*100);break;case"blue":this.setAlpha(this.layers.map[1],(this.color.blue/255)*100);break}},paintTrack:function(){switch(this.mode){case"hue":break;case"saturation":var a=new Ext.ux.color.Color();a.setHsv({hue:this.color.hue,saturation:100,brightness:this.color.brightness});this.setBackground(this.layers.track[2],a.hex);break;case"brightness":var d=new Ext.ux.color.Color();d.setHsv({hue:this.color.hue,saturation:this.color.saturation,brightness:100});this.setBackground(this.layers.track[2],d.hex);break;case"red":case"green":case"blue":var h=0;var c=0;switch(this.mode){case"red":h=this.modeFields.blue.getValue();c=this.modeFields.green.getValue();break;case"green":h=this.modeFields.blue.getValue();c=this.modeFields.red.getValue();break;case"blue":h=this.modeFields.red.getValue();c=this.modeFields.green.getValue()}var b=(h/255)*100;var e=(c/255)*100;var g=((255-h)/255)*100;var f=((255-c)/255)*100;this.setAlpha(this.layers.track[3],(e>g)?g:e);this.setAlpha(this.layers.track[2],(e>b)?b:e);this.setAlpha(this.layers.track[1],(f>b)?b:f);this.setAlpha(this.layers.track[0],(f>g)?g:f);break}},paintPreview:function(){this.setBackground(this.preview,this.color.hex)},paintSliders:function(){var d=0,b={hue:360,saturation:100,brightness:100,red:255,green:255,blue:255},c=b[this.mode];d=c-this.color[this.mode];this.track.onDrag({xy:[0,(255*(d/c))+Ext.fly(this.track.getEl()).getTop()]},true);var a=0,e=0;switch(this.mode){case"hue":e=this.color.saturation/100*255;a=(100-this.color.brightness)/100*255;break;case"saturation":e=this.color.hue/360*255;a=(100-this.color.brightness)/100*255;break;case"brightness":e=this.color.hue/360*255;a=(100-this.color.saturation)/100*255;break;case"red":e=this.color.blue;a=255-this.color.green;break;case"green":e=this.color.blue;a=255-this.color.red;break;case"blue":e=this.color.red;a=255-this.color.green;break}this.map.onDrag({xy:[e+Ext.fly(this.map.getEl()).getLeft(),a+Ext.fly(this.map.getEl()).getTop()]},true)}});