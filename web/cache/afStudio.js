Ext.BLANK_IMAGE_URL="/appFlowerPlugin/extjs-3/resources/images/default/s.gif";Ext.state.Manager.setProvider(new Ext.state.CookieProvider());Ext.ns("afStudio");var afStudio=function(){return{initAjaxRedirect:function(){Ext.Ajax.on("requestcomplete",function(c,d,b){var a=Ext.decode(d.responseText);if(!Ext.isEmpty(a)&&!Ext.isEmpty(a.redirect)){location.href=a.redirect}})},setConsole:function(a){afStudio.cli.CommandLineMgr.setConsole(a)},updateConsole:function(a){afStudio.cli.CommandLineMgr.updateConsole(a)},log:function(b,a){a=a||false;Ext.Ajax.request({url:afStudioWSUrls.getNotificationsUrl(),method:"POST",params:{cmd:"set",message:b,messageType:a},callback:function(d,e,c){c=Ext.decode(c.responseText);if(!e){afStudio.Msg.error("Failure","Server-side failure with status code: "+c.status)}}})},getViewport:function(){return this.vp},getRecentProjects:function(){var a=Ext.decode(Ext.util.Cookies.get("appFlowerStudioRecentProjects"))||[];recentProject=a.reverse();return a},addCurrentProject:function(){var a=Ext.decode(Ext.util.Cookies.get("appFlowerStudioRecentProjects"))||[];Ext.Ajax.request({url:window.afStudioWSUrls.getConfigureProjectUrl(),success:function(b,d){var b=Ext.decode(b.responseText);var e={};e.text=b.data.name;e.url=b.data.url+"/studio";Ext.each(a,function(g,f){if(g.url==e.url){delete a[f]}});a[a.length]=e;var c=new Date();c.setDate(c.getDate()+30);Ext.util.Cookies.set("appFlowerStudioRecentProjects",Ext.encode(a),c,"/","")}})},init:function(){Ext.QuickTips.init();Ext.apply(Ext.QuickTips.getQuickTip(),{trackMouse:true});Ext.form.Field.prototype.msgTarget="side";this.initAjaxRedirect();Ext.Ajax.timeout=300000;this.tb=new afStudio.viewport.StudioToolbar();this.vp=new afStudio.viewport.StudioViewport();afStudio.Cli.init();afApp.urlPrefix="";GLOBAL_JS_VAR=GLOBAL_CSS_VAR=new Array();this.addCurrentProject();if(Ext.util.Cookies.get("appFlowerStudioDontShowWelcomePopup")!="true"){new afStudio.Welcome().show()}},createSlug:function(d){d=d.toLowerCase();var b={a:/\u00e1/g,e:/u00e9/g,i:/\u00ed/g,o:/\u00f3/g,u:/\u00fa/g,n:/\u00f1/g};for(var c in b){d=d.replace(b[c],c)}var e=d.replace(/\s/g,"-");var a=e.replace(/[^a-zA-Z0-9\-\_]/g,"");a=a.toLowerCase();a=a.replace(/-+/g,"-");a=a.replace(/(^-)|(-$)/g,"");return a}}}();Ext.applyIf(Array.prototype,{dragUp:function(f,e){if(f<e){throw new RangeError('"dragUp": "from" index should be greater than "to"')}var d=this[f];for(var b=0,c=f-e,a=f;b<c;b++,a--){this[a]=this[a-1]}this[e]=d},dragDown:function(f,e){if(f>e){throw new RangeError('"dragDown": "from" index should be less than "to"')}var d=this[f];for(var b=0,c=e-f,a=f;b<c;b++,a++){this[a]=this[a+1]}this[e]=d}});Ext.applyIf(String.prototype,{ucfirst:function(){return this.substr(0,1).toUpperCase()+this.substr(1)},bool:function(){return(/^true$/i).test(this)}});Ext.ns("afStudio");afStudio.WSUrlsClass=function(){};afStudio.WSUrlsClass=Ext.extend(afStudio.WSUrlsClass,{getModelsUrl:function(){return this.buildUrlFor("/appFlowerStudio/models")},getFiletreeUrl:function(){return this.buildUrlFor("/appFlowerStudio/filetree")},getCssFilestreeUrl:function(){return this.buildUrlFor("/appFlowerStudio/cssfilestree")},getCssFilesSaveUrl:function(){return this.buildUrlFor("/appFlowerStudio/cssfilesSave")},getModulesUrl:function(){return this.buildUrlFor("/appFlowerStudio/modules")},getModuleWidgetsUrl:function(){return this.buildUrlFor("/appFlowerStudio/moduleWidgets")},getPluginsUrl:function(){return this.buildUrlFor("/appFlowerStudio/plugins")},getCodepressUrl:function(){return this.buildUrlFor("/appFlowerStudio/codepress")},getFilecontentUrl:function(){return this.buildUrlFor("/appFlowerStudio/filecontent")},getDebugUrl:function(){return this.buildUrlFor("/appFlowerStudio/debug")},getNotificationsUrl:function(){return this.buildUrlFor("/appFlowerStudio/notifications")},getConsoleUrl:function(){return this.buildUrlFor("/appFlowerStudio/console")},getConfigureProjectUrl:function(){return this.buildUrlFor("/appFlowerStudio/configureProject")},getConfigureDatabaseUrl:function(){return this.buildUrlFor("/appFlowerStudio/configureDatabase")},getLoadDatabaseConnectionSettingsUrl:function(){return this.buildUrlFor("/appFlowerStudio/loadDatabaseConnectionSettings")},getGetWidgetUrl:function(a){return this.buildUrlFor("/afsWidgetBuilder/getWidget?uri="+a)},getSaveWidgetUrl:function(a){return this.buildUrlFor("/afsWidgetBuilder/saveWidget?uri="+a)},getDBQueryDatabaseListUrl:function(){return this.buildUrlFor("/afsDatabaseQuery/databaseList")},getDBQueryQueryUrl:function(){return this.buildUrlFor("/afsDatabaseQuery/query")},getModelGridDataReadUrl:function(a){return this.buildUrlFor("/afsModelGridData/read?model="+a)},getModelGridDataCreateUrl:function(a){return this.buildUrlFor("/afsModelGridData/create?model="+a)},getModelGridDataUpdateUrl:function(a){return this.buildUrlFor("/afsModelGridData/update?model="+a)},getModelGridDataDeleteUrl:function(a){return this.buildUrlFor("/afsModelGridData/delete?model="+a)},getProjectLoadTreeUrl:function(){return this.buildUrlFor("/appFlowerStudio/loadProjectTree")},getProjectCreateUrl:function(){return this.buildUrlFor("/appFlowerStudio/createProject")},getProjectRunUrl:function(){return this.buildUrlFor("/appFlowerStudio/run")},getTemplateSelectorUrl:function(){return this.buildUrlFor("/appFlowerStudio/templateSelector")},getHelperFileSaveUrl:function(){return this.buildUrlFor("/appFlowerStudio/helperFileSave")},getCheckHelperFileExistUrl:function(){return this.buildUrlFor("/appFlowerStudio/checkHelperFileExist")},getProjectCreateWizardUrl:function(){return this.buildUrlFor("/appFlowerStudio/createProjectWizard")},getCheckUserExistUrl:function(){return this.buildUrlFor("/afsUserManager/checkUserExist")},buildUrlFor:function(a){return a},});afStudioWSUrls=new afStudio.WSUrlsClass();Ext.grid.CheckColumn=function(a){Ext.apply(this,a);if(!this.id){this.id=Ext.id()}this.renderer=this.renderer.createDelegate(this)};Ext.grid.CheckColumn.prototype={init:function(a){this.grid=a;this.grid.on("render",function(){var b=this.grid.getView();b.mainBody.on("mousedown",this.onMouseDown,this)},this)},onMouseDown:function(d,c){if(c.className&&c.className.indexOf("x-grid3-cc-"+this.id)!=-1){d.stopEvent();var b=this.grid.getView().findRowIndex(c);var a=this.grid.store.getAt(b);a.set(this.dataIndex,!a.data[this.dataIndex])}},renderer:function(b,c,a){c.css+=" x-grid3-check-col-td";return'<div class="x-grid3-check-col'+(b?"-on":"")+" x-grid3-cc-"+this.id+'">&#160;</div>'}};Ext.ux.WidgetFieldDropZone=Ext.extend(Ext.dd.DropZone,{constructor:function(){},scroller:"div.greenborder",init:function(a){if(a.rendered){this.panel=a;Ext.ux.WidgetFieldDropZone.superclass.constructor.call(this,this.panel.body)}else{a.on("render",this.init,this)}},getTargetFromEvent:function(b){var a=b.getTarget(this.scroller);if(a){return{node:a}}},onNodeEnter:function(j,a,h,g){delete this.dropOK;if(!j){return}var d=g.field;if(!d){return}var c=j;this.dropOK=true;var b=Ext.fly(c);b.addClass("x-drop-target-active")},onNodeOver:function(d,a,c,b){return this.dropOK?this.dropAllowed:this.dropNotAllowed},onNodeOut:function(d,a,c,b){Ext.fly(d.node).removeClass("x-drop-target-active")},onNodeDrop:function(j,p,l,d){if(this.dropOK){var h=d.field;if(!h){return false}var o=Ext.getCmp(h.id);var a=o.ownerCt;var n=a.ownerCt;var c=j.node;var g=Ext.fly(c);var m=g.findParent('DIV[class*="x-box-item"]',5);n.remove(a,false);var b=Ext.getCmp(m.id);b.add(a);b.doLayout();return true}}});Ext.ux.WidgetFieldDragZone=Ext.extend(Ext.dd.DragZone,{constructor:function(){},init:function(a){if(a.nodeType){Ext.ux.WidgetFieldDragZone.superclass.init.apply(this,arguments)}else{if(a.rendered){Ext.ux.WidgetFieldDragZone.superclass.constructor.call(this,a.getEl());var b=Ext.fly(a.getEl()).select("input");b.unselectable()}else{a.on("afterlayout",this.init,this,{single:true})}}},scroll:false,getDragData:function(c){var a=c.getTarget("input");if(a){c.stopEvent();if(Ext.isOpera){Ext.fly(a).on("mousemove",function(d){a.style.visibility="hidden";(function(){a.style.visibility=""}).defer(1)},null,{single:true})}var b=Ext.getCmp(a.id);var g=document.createElement("div");g.className="x-form-text";g.appendChild(document.createTextNode(a.value));Ext.fly(g).setWidth(b.getEl().getWidth());return{field:b,ddel:g}}},getRepairXY:function(){return this.dragData.field.getEl().getXY()}});Ext.override(Ext.BoxComponent,{initComponent:function(){Ext.BoxComponent.superclass.initComponent.apply(this,arguments);this.addEvents("resize","move","logmessage");this.on("logmessage",this.onLogMessage,this)},onLogMessage:function(b,a){afStudio.log(a,"text")}});Ext.ns("Ext.ux");Ext.ux.TabMenu=function(){var a,c,e,b;this.init=function(f){a=f;a.on("contextmenu",d)};function d(h,g,j){if(!c){c=new Ext.menu.Menu([{id:a.id+"-save",text:"Save",iconCls:"icon-file-save",handler:function(){Ext.Ajax.request({url:b.fileContentUrl,method:"post",params:{"file":b.file,"code":b.getCode()},success:function(m,n){Ext.Msg.alert("Success","The file was saved !")},failure:function(){Ext.Msg.alert("Failure","The server can't save the file !")}})}},{id:a.id+"-close",text:"Close Tab",iconCls:"icon-file-close",handler:function(){a.remove(e)}},{id:a.id+"-close-others",text:"Close Other Tabs",iconCls:"icon-file-close-others",handler:function(){a.items.each(function(m){if(m.closable&&m!=e){a.remove(m)}})}}])}e=g;if(e.items&&e.items.items[0]&&e.items.items[0].code){b=e.items.items[0]}else{b=e}var f=c.items;f.get(a.id+"-close").setDisabled(!g.closable);var l=true;a.items.each(function(){if(this!=g&&this.closable){l=false;return false}});if(g.itemId=="security"||g.itemId=="designer"){f.get(a.id+"-save").setDisabled(true)}else{f.get(a.id+"-save").setDisabled(false)}f.get(a.id+"-close-others").setDisabled(l);c.showAt(j.getPoint())}};Ext.override(Ext.Element,(function(){var f=document,c="scrollLeft",e="scrollTop",d=/^(scroll|resize|load|unload|abort|error)$/,b=/^(click|dblclick|mousedown|mouseup|mouseover|mouseout|contextmenu|mousenter|mouseleave)$/,a=/^(focus|blur|select|change|reset|keypress|keydown|keyup)$/,h=/^on/;function g(){var j=f.documentElement,l=f.body;if(j&&(j[e]||j[c])){return[j[c],j[e]]}else{if(l){return[l[c],l[e]]}else{return[0,0]}}}return{fireEvent:Ext.isIE?function(m,l){var j;m=m.toLowerCase();if(!h.test(m)){m="on"+m}if(Ext.isFunction(l)){j=document.createEventObject();l(j)}else{j=l}this.dom.fireEvent(m,j)}:function(o,n){var m;o=o.toLowerCase();o.replace(h,"");if(b.test(o)){var l={};if(this.getBox){l=this.getBox()}else{l.width=this.getWidth();l.height=this.getHeight();l.x=this.getX();l.y=this.getY()}var j=l.x+l.width/2,p=l.y+l.height/2;m=document.createEvent("MouseEvents");m.initMouseEvent(o,true,true,window,(o=="dblclick")?2:1,j,p,j,p,false,false,false,false,0,null)}else{if(a.test(o)){m=document.createEvent("UIEvents");m.initUIEvent(o,true,true,window,0)}else{if(d.test(o)){m=document.createEvent("HTMLEvents");m.initEvent(o,true,true)}}}if(m){if(Ext.isFunction(n)){n(m)}this.dom.dispatchEvent(m)}},forwardMouseEvents:function(o){var r=this,s,q,j,n=["mousemove","mousedown","mouseup","dblclick","mousewheel"];r.on("mouseout",function(){if(j){Ext.fly(j).fireEvent("mouseout");j=null}});for(var p=0,m=n.length;p<m;p++){this.on(n[p],function(A){var v=(Ext.isGecko)?g():[0,0],w=A.browserEvent,l=Ext.num(w.pageX,w.clientX)-v[0],B=Ext.num(w.pageY,w.clientY)-v[1],z=w.type,u;if(!r.forwardingSuspended&&r.isVisible()){A.stopPropagation();r.forwardingSuspended=true;r.hide();u=Ext.get(document.elementFromPoint(l,B));r.show();if(!u){j.fireEvent("mouseout");j=u;delete r.forwardingSuspended;return}if(u===j){if(z=="mouseup"){u.fireEvent("click")}}else{if(j){j.fireEvent("mouseout")}u.fireEvent("mouseover")}if(z!=="mousemove"){if(u.dom.fireEvent){u.fireEvent(z,w)}else{A=document.createEvent("MouseEvents");A.initMouseEvent(z,true,true,window,w.detail,w.screenX,w.screenY,w.clientX,w.clientY,w.ctrlKey,w.altKey,w.shiftKey,w.metaKey,w.button,null);u.dom.dispatchEvent(A)}}j=u;delete r.forwardingSuspended}})}}}})());Ext.ns("Ext.ux.grid");Ext.ux.grid.DataDrop=(function(){var e=/\r\n|\r|\n/,c=/\s*\t\s*/;function b(){var f=this.view;if(f.mainBody){this.textEl=Ext.DomHelper.insertAfter(f.scroller,{tag:"textarea",id:Ext.id(),value:"",style:{"font-size":"1px",border:"0px none",overflow:"hidden",color:"#fff",position:"absolute",top:f.mainHd.getHeight()+"px",left:"0px","background-color":"#fff",margin:0,cursor:"default"}},true);this.textEl.setOpacity(0.1);this.textEl.forwardMouseEvents();this.textEl.on({mouseover:function(){Ext.TaskMgr.start(this.changeValueTask)},mouseout:function(){Ext.TaskMgr.stop(this.changeValueTask)},scope:this});a.call(this)}}function a(){if(this.textEl){var f=this.view,j=f.scroller,h=j.getSize,g={width:j.dom.clientWidth||(h.width-f.getScrollOffset()+2),height:j.dom.clientHeight||h.height};this.textEl.setSize(g)}}function d(p,g){var q=g.value;g.blur();if(q!==""){var v=this.getStore(),t=v.recordType;g.value="";var w=q.split(e),s=this.getColumnModel().getColumnsBy(function(x){return !x.hidden}),o=t.prototype.fields;if(s.length&&w.length){for(var n=0;n<w.length;n++){var r=w[n].split(c),m={};if(r.join("").replace(" ","")!==""){for(var l=0;l<r.length;l++){var f=s[l].dataIndex;var h=o.item(f);m[f]=h?h.convert(r[l]):r[l]}var j=new t(m);v.add(j);var u=v.indexOf(j);this.view.focusRow(u);Ext.get(this.view.getRow(u)).highlight()}}a.call(this)}}}return{init:function(f){Ext.apply(f,{changeValueTask:{run:function(){d.call(this,null,this.textEl.dom)},interval:100,scope:f},onResize:f.onResize.createSequence(a)});f.getView().afterRender=f.getView().afterRender.createSequence(b,f)}}})();Ext.ns("Ext.ux.form");Ext.ux.form.GroupingComboBox=Ext.extend(Ext.form.ComboBox,{initComponent:function(){if(this.transform){this.allowDomMove=false;var l=Ext.getDom(this.transform);if(!this.hiddenName){this.hiddenName=l.name}if(!this.store){this.mode="local";var f=[],a=l.options;for(var c=0,e=a.length;c<e;c++){var b=a[c];var g=(Ext.isIE?b.getAttributeNode("value").specified:b.hasAttribute("value"))?b.value:b.text;if(b.selected){this.value=g}var j=b.parentNode,h=j.tagName.toLowerCase()=="optgroup"?j.label:false;f.push([g,b.text,h])}this.store=new Ext.data.SimpleStore({"id":0,fields:["value","text","group"],data:f});this.valueField="value";this.displayField="text";this.groupField="group"}l.name=Ext.id();if(!this.lazyRender){this.target=true;this.el=Ext.DomHelper.insertBefore(l,this.autoCreate||this.defaultAutoCreate);Ext.removeNode(l);this.render(this.el.parentNode)}else{Ext.removeNode(l)}}delete this.transform;Ext.ux.form.GroupingComboBox.superclass.initComponent.call(this)},initList:function(){if(!this.list&&!this.tpl){this.tpl=['<tpl for=".">','<tpl if="values.'+this.groupField+" && (xindex == 1 || parent[xindex - 2]."+this.groupField+" != values."+this.groupField+')">','<div class="x-combo-list-group">{'+this.groupField+"}</div>","</tpl>",'<div class="x-combo-list-item">','<tpl if="values.'+this.groupField+'">&nbsp;</tpl>',"{"+this.displayField+"}","</div>","</tpl>"].join("")}Ext.ux.form.GroupingComboBox.superclass.initList.call(this)}});Ext.ns("Ext.ux.grid");Ext.ux.grid.PagingRowNumberer=Ext.extend(Ext.grid.RowNumberer,{renderer:function(d,g,b,h,e,c){if(this.rowspan){g.cellAttr='rowspan="'+this.rowspan+'"'}var f=c.lastOptions;var a=f?f.params:null;return((a&&a.start)?a.start:0)+h+1}});
/*
 * Ext JS Library 3.3.1
 * Copyright(c) 2006-2010 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.ux.TabCloseMenu=Ext.extend(Object,{closeTabText:"Close Tab",closeOtherTabsText:"Close Other Tabs",showCloseAll:true,closeAllTabsText:"Close All Tabs",constructor:function(a){Ext.apply(this,a||{})},init:function(a){this.tabs=a;a.on({scope:this,contextmenu:this.onContextMenu,destroy:this.destroy})},destroy:function(){Ext.destroy(this.menu);delete this.menu;delete this.tabs;delete this.active},onContextMenu:function(b,c,g){this.active=c;var a=this.createMenu(),d=true,h=true,f=a.getComponent("closeall");a.getComponent("close").setDisabled(!c.closable);b.items.each(function(){if(this.closable){d=false;if(this!=c){h=false;return false}}});a.getComponent("closeothers").setDisabled(h);if(f){f.setDisabled(d)}g.stopEvent();a.showAt(g.getPoint())},createMenu:function(){if(!this.menu){var a=[{itemId:"close",text:this.closeTabText,scope:this,handler:this.onClose}];if(this.showCloseAll){a.push("-")}a.push({itemId:"closeothers",text:this.closeOtherTabsText,scope:this,handler:this.onCloseOthers});if(this.showCloseAll){a.push({itemId:"closeall",text:this.closeAllTabsText,scope:this,handler:this.onCloseAll})}this.menu=new Ext.menu.Menu({items:a})}return this.menu},onClose:function(){var a=this.active;if(a.fireEvent("beforeclose",a)!==false){a.fireEvent("close",a);this.tabs.remove(a)}},onCloseOthers:function(){this.doClose(true)},onCloseAll:function(){this.doClose(false)},doClose:function(c){var b=[];this.tabs.items.each(function(d){if(d.closable){if(!c||d!=this.active){b.push(d)}}},this);var a=this.active;if(a.fireEvent("beforeclose",a,true,b)!==false){Ext.each(b,function(d){d.fireEvent("close",d);this.tabs.remove(d)},this)}}});Ext.preg("tabclosemenu",Ext.ux.TabCloseMenu);Ext.namespace("Ext.ux");Ext.ux.CodePress=Ext.extend(Ext.form.Field,{engineUrl:window.afStudioWSUrls.getCodepressUrl(),fileContentUrl:window.afStudioWSUrls.getFilecontentUrl(),delayedStart:false,file:false,sourceEl:false,code:false,language:false,height:false,width:false,autoResize:false,trim:true,autoComplete:true,readOnly:false,lineNumbers:true,initialized:false,initComponent:function(){Ext.ux.CodePress.superclass.initComponent.call(this);if(this.sourceEl){Ext.get(this.sourceEl).hide()}this.addEvents({initialize:true,activate:true})},adjustSize:Ext.BoxComponent.prototype.adjustSize,listeners:{resize:{fn:function(){this.resize()}}},resize:function(){if(this.initialized){var b=(this.height||this.ownerCt.body.dom.clientHeight)+"px";var a=(this.ownerCt.body.dom.clientWidth||this.width)+"px";this.editor.body.style.width=a;this.iframe.setStyle("height",b);this.iframe.setStyle("width",a);this.textarea.setStyle("height",b);this.textarea.setStyle("width",a)}},onRender:function(b,a){Ext.ux.CodePress.superclass.onRender.call(this,b,a);this.el.dom.style.border="0 none";this.el.dom.setAttribute("tabIndex",-1);this.el.addClass("x-hidden");if(Ext.isIE){this.el.applyStyles("margin-top:-1px;margin-bottom:-1px;")}this.wrap=this.el.wrap({});this.iframe=Ext.get(document.createElement("iframe"));this.iframe.src=(Ext.SSL_SECURE_URL||"javascript:false");if(!this.sourceEl){this.textarea=Ext.get(document.createElement("textarea"))}else{this.textarea=Ext.get(this.sourceEl)}this.textarea.dom.disabled=true;this.textarea.dom.style.overflow="hidden";this.textarea.dom.style.display="none";this.textarea.dom.style.overflow="auto";this.iframe.dom.frameBorder=0;this.iframe.setStyle("visibility","hidden");this.iframe.setStyle("position","absolute");this.options=this.textarea.dom.className;this.wrap.dom.appendChild(this.textarea.dom);this.textarea.dom.parentNode.insertBefore(this.iframe.dom,this.textarea.dom);this.setLanguage();this.edit();this.height=(this.height||this.ownerCt.body.dom.clientHeight);this.width=(this.width||this.ownerCt.body.dom.clientWidth)},focus:function(){},showMask:function(){if(!this.tabId){try{this.tabId=this.ownerCt.activeTab.id}catch(a){this.tabId=this.ownerCt.id}}Ext.get(this.tabId).mask("Loading...")},hideMask:function(){if(!this.tabId){try{this.tabId=this.ownerCt.activeTab.id}catch(a){this.tabId=this.ownerCt.id}}Ext.get(this.tabId).unmask()},initialize:function(){if(Ext.isIE){this.doc=this.iframe.dom.contentWindow.document;this.win=this.iframe.dom.contentWindow}else{this.doc=this.iframe.dom.contentDocument;this.win=this.iframe.dom.contentWindow}this.editor=this.win.CodePress;this.editor.body=this.doc.getElementsByTagName("body")[0];if(this.fileContentUrl&&!this.delayedStart){this.showMask();Ext.Ajax.request({url:this.fileContentUrl+"/?file="+this.file,method:"get",success:function(a,b){this.hideMask();var d=Ext.decode(a.responseText);var c=d.response;this.code=c;this.editor.setCode(this.code);this.editor.syntaxHighlight("init")}.createDelegate(this),failure:function(){this.hideMask();Ext.Msg.alert("","The server can't read '"+this.file+"' !");this.tabPanel.remove(this)}.createDelegate(this)})}else{this.editor.setCode(this.code||this.textarea.dom.value)}this.setOptions();this.editor.syntaxHighlight("init");this.textarea.dom.style.display="none";this.iframe.dom.style.position="static";this.iframe.dom.style.visibility="visible";this.iframe.dom.style.display="inline";this.initialized=true;this.fireEvent("initialize",this);this.resize()},loadFile:function(a){this.file=a;this.setLanguage();this.edit();this.showMask();Ext.Ajax.request({url:this.fileContentUrl+"/?file="+this.file,method:"get",success:function(b,c){this.hideMask();var e=Ext.decode(b.responseText);var d=e.response;this.code=d;this.editor.setCode(this.code);this.editor.syntaxHighlight("init")}.createDelegate(this),failure:function(){this.hideMask();Ext.Msg.alert("","The server can't read '"+this.file+"' !");this.tabPanel.remove(this)}.createDelegate(this)})},edit:function(a,b){if(a){this.textarea.dom.value=document.getElementById(a)?document.getElementById(a).value:a}if(!this.textarea.dom.disabled){return}this.language=b?b:this.getLanguage();this.iframe.dom.src=this.engineUrl+"/language/"+this.language+"/ts/"+(new Date).getTime();this.iframe.removeListener("load",this.initialize);this.iframe.on("load",this.initialize,this)},setLanguage:function(){if(this.file){var b=this.file.split(".");var a="";if(b[b.length-1]){a=b[b.length-1]}switch(a){case"php":case"inc":case"phtml":this.language="php";break;case"js":this.language="javascript";break;case"css":this.language="css";break;case"sql":this.language="sql";break;case"html":case"htm":this.language="html";break;default:this.language="generic";break}}},getLanguage:function(){if(this.language){return this.language}for(language in Ext.ux.CodePress.languages){if(this.options.match("\\b"+language+"\\b")){return Ext.ux.CodePress.languages[language]?language:"generic"}}},setOptions:function(){if(this.autoComplete===false||this.options.match("autocomplete-off")){this.toggleAutoComplete()}if(this.readOnly===true||this.options.match("readonly-on")){this.toggleReadOnly()}if(this.lineNumbers===false||this.options.match("linenumbers-off")){this.toggleLineNumbers()}},getCode:function(){var a;if(this.textarea&&this.editor){a=this.textarea.dom.disabled?this.editor.getCode():this.textarea.dom.value}else{a=this.code||""}a=this.trim?a.replace(/^s+|(s+$|n$|r$)/g,""):a;return a},setCode:function(a){if(this.textarea&&this.editor){this.textarea.dom.disabled?this.editor.setCode(a):this.textarea.dom.value=a;this.editor.syntaxHighlight("init")}else{this.code=a}},setValue:function(a){this.setCode(a)},getValue:function(){return this.getCode()},toggleAutoComplete:function(){if(this.editor){this.editor.autocomplete=(this.editor.autocomplete)?false:true}},toggleReadOnly:function(){this.textarea.dom.readOnly=(this.textarea.dom.readOnly)?false:true;if(this.iframe.dom.style.display!="none"&&this.editor){this.editor.readOnly(this.textarea.dom.readOnly?true:false)}},toggleLineNumbers:function(){if(!this.editor){return}var a=this.editor.body.className;this.editor.body.className=(a==""||a=="show-line-numbers")?"hide-line-numbers":"show-line-numbers"},toggleEditor:function(){if(this.textarea.dom.disabled){this.textarea.dom.value=this.getCode();this.textarea.dom.disabled=false;this.iframe.dom.style.display="none";this.textarea.dom.style.display="inline"}else{this.textarea.dom.disabled=true;this.setCode(this.textarea.dom.value);if(this.editor){this.editor.syntaxHighlight("init")}this.iframe.dom.style.display="inline";this.textarea.dom.style.display="none"}},toggleIframe:function(){if(this.iframe.dom.style.visibility=="hidden"){this.iframe.dom.style.visibility="visible";this.iframe.dom.style.position="static";this.iframe.dom.style.display="inline";this.resize();this.iframe.dom.style.width=this.width+"px";this.iframe.dom.style.height=this.height+"px"}else{this.iframe.dom.style.visibility="hidden";this.iframe.dom.style.width="0px";this.iframe.dom.style.height="0px"}}});Ext.reg("codepress",Ext.ux.CodePress);Ext.ux.CodePress.languages={csharp:"C#",css:"CSS",generic:"Generic",html:"HTML",java:"Java",javascript:"JavaScript",perl:"Perl",ruby:"Ruby",php:"PHP",text:"Text",sql:"SQL",vbscript:"VBScript"};Ext.ns("afStudio.models");afStudio.models.TypeComboBox=Ext.extend(Ext.ux.form.GroupingComboBox,{_beforeInitComponent:function(){var b=this;var a=new Ext.data.SimpleStore({fields:["group","value","text"],data:[["TEXT","char","char"],["TEXT","varchar","varchar"],["TEXT","longvarchar","longvarchar"],["TEXT","clob","clob"],["NUMBERS","numeric","numeric"],["NUMBERS","decimal","decimal"],["NUMBERS","tinyint","tinyint"],["NUMBERS","smallint","smallint"],["NUMBERS","integer","integer"],["NUMBERS","bigint","bigint"],["NUMBERS","real","real"],["NUMBERS","float","float"],["NUMBERS","double","double"],["NUMBERS","boolean","boolean"],["BINRAY","binary","binary"],["BINRAY","varbinary","varbinary"],["BINRAY","longvarbinary","longvarbinary"],["BINRAY","blob","blob"],["TEMPORA DATE/TIME","date","date"],["TEMPORA DATE/TIME","time","time"],["TEMPORA DATE/TIME","timestamp","timestamp"],["TEMPORA DATE/TIME","integer","integer"]]});return{triggerAction:"all",forceSelection:true,groupField:"group",valueField:"value",displayField:"text",mode:"local",store:a}},initComponent:function(){Ext.apply(this,Ext.applyIf(this.initialConfig,this._beforeInitComponent()));afStudio.models.TypeComboBox.superclass.initComponent.apply(this,arguments)}});Ext.reg("afStudio.models.typeCombo",afStudio.models.TypeComboBox);afStudio.CreateProject=Ext.extend(Ext.Window,{initComponent:function(){_self=this;this.tree=new Ext.ux.FileTreePanel({url:window.afStudioWSUrls.getProjectLoadTreeUrl(),rootPath:"root",rootVisible:true,rootText:afStudioHost.user+"@"+afStudioHost.name,topMenu:false,autoScroll:true,enableProgress:false,singleUpload:true,onDblClick:Ext.emptyFn,onContextMenu:Ext.emptyFn,listeners:{click:function(g){var d=currentPath=this.getPath(g).slice(4);var c=_self.form.form.items.items[0];var e=_self.form.form.items.items[1];var f=_self.form.form.items.items[2];var b=afStudio.createSlug(c.getValue());if(b!=""){var d=currentPath+"/"+b}e.setValue("<small>"+d+"</small>");f.setValue(d)},expandnode:function(c){if(c.childNodes){for(var b=0;b<c.childNodes.length;b++){if(afProjectInPath.indexOf(this.getPath(c.childNodes[b]).slice(4))>-1){this.expandPath(c.childNodes[b].getPath());c.childNodes[b].select();c.childNodes[b].ensureVisible();this.fireEvent("click",c.childNodes[b])}}}}},height:200});this.form=new Ext.FormPanel({url:window.afStudioWSUrls.getProjectCreateUrl()+"?cmd=save",bodyStyle:"padding: 5px;",labelWidth:140,border:false,bodyBorder:false,items:[{xtype:"textfield",enableKeyEvents:true,fieldLabel:"Project name",anchor:"96%",name:"name",allowBlank:false,vtype:"uniqueNode",listeners:{keyup:function(h,g){var c=afStudio.createSlug(h.getValue());var d=_self.form.form.items.items[1];var f=_self.form.form.items.items[2];var b=currentPath=_self.getSelectedNodePath().slice(4);if(c!=""){b=currentPath+"/"+c}d.setValue("<small>"+b+"</small>");f.setValue(b)}}},{xtype:"label",html:"Path to Project:",style:"font: 12px tahoma,arial,helvetica,sans-serif;"},{xtype:"displayfield",name:"display_path",hideLabel:true,anchor:"100%",style:"font-weight:bold;",value:"<small>select path below...</small>"},_self.tree,{xtype:"hidden",name:"path"},{xtype:"label",html:"Project Description:",style:"font: 12px tahoma,arial,helvetica,sans-serif;"},{xtype:"textarea",hideLabel:true,anchor:"100%",name:"description",height:57,style:"margin-top: 5px;"},{xtype:"checkbox",hideLabel:true,boxLabel:"Use latest playground version (will be downloaded from appflower.com)",name:"latest"},{xtype:"checkbox",hideLabel:true,boxLabel:"Auto-Deploy on Save",name:"autodeploy"}]});var a={title:"Create new project",width:450,height:450,closable:true,draggable:true,modal:true,resizable:false,bodyBorder:false,border:false,layout:"fit",items:[this.form],buttons:[{text:"Create",handler:this.create,scope:this},{text:"Cancel",handler:this.cancel,scope:this}],buttonAlign:"center"};Ext.apply(this,Ext.apply(this.initialConfig,a));afStudio.CreateProject.superclass.initComponent.apply(this,arguments);this._initEvents()},_initEvents:function(){},cancel:function(){this.close()},create:function(){var a=this.form.getForm();if(a.isValid()){a.submit({failure:function(b,c){if(c.result){afStudio.updateConsole(c.result.console);if(c.result.message){Ext.Msg.alert("Failure",c.result.message,function(){if(c.result.redirect){window.location.href=c.result.redirect}})}}},success:function(b,c){if(c.result){afStudio.updateConsole(c.result.console);if(c.result.message){Ext.Msg.alert("Success",c.result.message,function(){if(c.result.redirect){window.location.href=c.result.redirect}})}}}})}},getSelectedNodePath:function(){var a=this.tree.getSelectionModel().getSelectedNode(),b=false;if(a){b=this.tree.getPath(a)}return b}});Ext.apply(Ext.form.VTypes,{uniqueNode:function(e,f){var a=f.ownerCt.ownerCt.tree;var d=a.getSelectionModel().getSelectedNode();var b=afStudio.createSlug(e);if(d.childNodes){for(var c=0;c<d.childNodes.length;c++){if(!d.childNodes[c].isLeaf()&&d.childNodes[c].text==b){return false}}}return true},uniqueNodeText:"Path to Project already exist! Please choose another Project Name!"});afStudio.CreateProjectWizard=Ext.extend(Ext.Window,{initComponent:function(){this.initForm1();this.initForm2();this.initForm3();this.initForm4();var a={title:"Your new Project",width:493,closable:true,draggable:true,plain:true,modal:true,resizable:false,bodyBorder:false,border:false,items:[this.form1,this.form2,this.form3,this.form4],buttons:[{text:"Previous",handler:this.previous,scope:this,hidden:true},{text:"Next",handler:this.next,scope:this},{text:"Save Project",handler:this.save,scope:this,hidden:true},],buttonAlign:"right",listeners:{show:function(){for(var b in this.dataview.store.data.items){if(this.dataview.store.data.items[b].json&&afTemplateConfig.template.current==this.dataview.store.data.items[b].json[1].toLowerCase()){this.dataview.selectRange(b,b)}}}}};Ext.apply(this,Ext.apply(this.initialConfig,a));afStudio.CreateProjectWizard.superclass.initComponent.apply(this,arguments)},initForm1:function(){_self=this;this.tree=new Ext.ux.FileTreePanel({url:window.afStudioWSUrls.getProjectLoadTreeUrl(),rootPath:"root",rootVisible:true,rootText:afStudioHost.user+"@"+afStudioHost.name,topMenu:false,autoScroll:true,enableProgress:false,singleUpload:true,onDblClick:Ext.emptyFn,onContextMenu:Ext.emptyFn,listeners:{click:function(g){var d=currentPath=this.getPath(g).slice(4);var c=_self.form1.items.items[1];var e=_self.form1.items.items[3];var f=_self.form1.items.items[5];var b=afStudio.createSlug(c.getValue());if(b!=""){var d=currentPath+"/"+b}e.setValue("<small>"+d+"</small>");f.setValue(d)},expandnode:function(c){if(c.childNodes){for(var b=0;b<c.childNodes.length;b++){if(afProjectInPath.indexOf(this.getPath(c.childNodes[b]).slice(4))>-1){this.expandPath(c.childNodes[b].getPath());c.childNodes[b].select();c.childNodes[b].ensureVisible();this.fireEvent("click",c.childNodes[b])}}}}},height:200});this.initDataview();var a=[{xtype:"displayfield",name:"infor",hideLabel:true,anchor:"100%",value:"This wizard will help guide your through a few steps to setup your new AppFlower Project.",style:"margin-bottom: 15px;",},{xtype:"textfield",enableKeyEvents:true,fieldLabel:"Project name",anchor:"96%",name:"name",allowBlank:false,vtype:"uniqueNode",listeners:{keyup:function(h,g){var c=afStudio.createSlug(h.getValue());var d=_self.form1.items.items[3];var f=_self.form1.items.items[5];var b=currentPath=_self.getSelectedNodePath().slice(4);if(c!=""){b=currentPath+"/"+c}d.setValue("<small>"+b+"</small>");f.setValue(b)}}},{xtype:"label",html:"Path to Project:",style:"font: 12px tahoma,arial,helvetica,sans-serif;"},{xtype:"displayfield",name:"display_path",hideLabel:true,anchor:"100%",style:"font-weight:bold;",value:"<small>select path below...</small>"},this.tree,{xtype:"hidden",name:"path"},{xtype:"label",html:" Select application template:",style:"font: 12px tahoma,arial,helvetica,sans-serif;"},this.dataview,];this.form1=new Ext.FormPanel({url:"",defaultType:"textfield",width:480,labelWidth:70,frame:true,title:false,defaults:{allowBlank:false,anchor:"95%"},items:a})},initDataview:function(){var b=[["desktoptemplate","Desktop","template_desktop.png"],["viewporttemplate","Viewport","template_viewport.png"]];var a=new Ext.data.SimpleStore({fields:[{name:"id"},{name:"name"},{name:"img"}],sortInfo:{field:"name",direction:"ASC"}});a.loadData(b);this.dataview=new Ext.DataView({itemSelector:"div.thumb-wrap",style:"overflow:auto",multiSelect:true,store:a,tpl:new Ext.XTemplate('<tpl for=".">','<div class="thumb-wrap" id="{id}">','<div class="thumb"><img src="appFlowerStudioPlugin/images/{img}"></div>',"<span>{name}</span></div>","</tpl>")})},getSelectedNodePath:function(){var a=this.tree.getSelectionModel().getSelectedNode(),b=false;if(a){b=this.tree.getPath(a)}return b},initForm2:function(){var a=[{name:"first_name",fieldLabel:"First Name"},{name:"last_name",fieldLabel:"Last Name"},{name:"username",fieldLabel:"Username"},{name:"password",inputType:"password",fieldLabel:"Password"},{name:"email",fieldLabel:"Email",vtype:"email"},{name:"role",inputType:"hidden",value:"admin"},];this.form2=new Ext.FormPanel({url:"",defaultType:"textfield",width:480,labelWidth:70,frame:true,title:false,hidden:true,defaults:{allowBlank:false,anchor:"95%"},items:a})},initForm3:function(){var a=[{xtype:"textfield",fieldLabel:"Database",anchor:"96%",name:"database",allowBlank:false},{xtype:"panel",layout:"column",border:false,bodyBorder:false,defaults:{border:false,bodyBorder:false},items:[{xtype:"panel",columnWidth:0.8,layout:"form",style:"margin-right: 5px;",items:[{xtype:"textfield",fieldLabel:"Host",name:"host",anchor:"92%",allowBlank:false}]},{xtype:"panel",width:100,layout:"form",labelWidth:35,columnWidth:0.2,items:[{xtype:"textfield",fieldLabel:"Port",name:"port",anchor:"100%",allowBlank:true}]}]},{xtype:"textfield",fieldLabel:"Username",anchor:"96%",name:"username",allowBlank:false},{xtype:"textfield",fieldLabel:"Password",anchor:"96%",name:"password",allowBlank:false,inputType:"password"},];this.form3=new Ext.FormPanel({url:"",defaultType:"textfield",width:480,labelWidth:70,frame:true,title:false,hidden:true,defaults:{allowBlank:false,anchor:"95%"},items:a})},initForm4:function(){var a=[{xtype:"displayfield",name:"infor",hideLabel:true,anchor:"100%",style:"margin-bottom: 15px;",},];this.form4=new Ext.FormPanel({url:"",defaultType:"textfield",width:480,labelWidth:70,frame:true,title:false,hidden:true,defaults:{allowBlank:false,anchor:"95%"},items:a})},currentItem:0,next:function(){if(this.items.get(this.currentItem).getForm().isValid()){if(this.currentItem==1){var a=this;Ext.Ajax.request({url:window.afStudioWSUrls.getCheckUserExistUrl(),params:{username:this.form2.getForm().findField("username").getValue(),user:Ext.encode(this.form2.getForm().getValues()),},success:function(b,c){var d=Ext.decode(b.responseText);if(!d.success){a.form2.getForm().findField(d.field).markInvalid(d.message);return""}a.nextForm()}});return""}this.nextForm()}},nextForm:function(){if(this.currentItem==2){var a=this.form1.getForm().findField("name").getValue();var c=this.form1.getForm().findField("path").getValue();var b='<div><font face="tahoma, arial, helvetica, sans-serif"><span style="font-size: 12px;">Now please create a Virtual Host inside your Apache configuration file (httpd.conf, apache.conf ), that will read the path to the newly create project. This way, you\'ll have direct access to your new project, by accessing "'+a+'.local" in your browser.</span></font></div><div><font face="tahoma, arial, helvetica, sans-serif"><span style="font-size: 12px;"><br></span></font></div><div><font face="tahoma, arial, helvetica, sans-serif"><span style="font-size: 12px;">Here is an example:</span></font></div><div><font face="tahoma, arial, helvetica, sans-serif"><span style="font-size: 12px;">&lt;VirtualHost *:80&gt;</span></font></div><div><font face="tahoma, arial, helvetica, sans-serif"><span style="font-size: 12px;">ServerName '+a+'.local</span></font></div><div><font face="tahoma, arial, helvetica, sans-serif"><span style="font-size: 12px;">DocumentRoot '+c+'/web</span></font></div><div><font face="tahoma, arial, helvetica, sans-serif"><span style="font-size: 12px;"><br></span></font></div><div><font face="tahoma, arial, helvetica, sans-serif"><span style="font-size: 12px;">DirectoryIndex index.php</span></font></div><div><font face="tahoma, arial, helvetica, sans-serif"><span style="font-size: 12px;">Alias /sf "'+c+'/lib/vendor/symfony/data/web/sf"</span></font></div><div><font face="tahoma, arial, helvetica, sans-serif"><span style="font-size: 12px;"><br></span></font></div><div><font face="tahoma, arial, helvetica, sans-serif"><span style="font-size: 12px;">&lt;Directory "'+c+'/web"&gt;</span></font></div><div><font face="tahoma, arial, helvetica, sans-serif"><span style="font-size: 12px;">&nbsp;AllowOverride All</span></font></div><div><font face="tahoma, arial, helvetica, sans-serif"><span style="font-size: 12px;">&nbsp;Allow from All</span></font></div><div><font face="tahoma, arial, helvetica, sans-serif"><span style="font-size: 12px;">&lt;/Directory&gt;</span></font></div><div><font face="tahoma, arial, helvetica, sans-serif"><span style="font-size: 12px;">&lt;/VirtualHost&gt;</span></font></div>';this.form4.getForm().findField("infor").update(b)}this.items.get(this.currentItem).hide();this.currentItem++;this.items.get(this.currentItem).show();this.setWindowTitle()},previous:function(){this.items.get(this.currentItem).hide();this.currentItem--;this.items.get(this.currentItem).show();this.setWindowTitle()},save:function(){var a=this;Ext.Ajax.request({url:window.afStudioWSUrls.getProjectCreateWizardUrl(),params:{name:this.form1.getForm().findField("name").getValue(),path:this.form1.getForm().findField("path").getValue(),template:this.dataview.getSelectedRecords()[0].get("name"),username:this.form2.getForm().findField("username").getValue(),user:Ext.encode(this.form2.getForm().getValues()),database:this.form3.getForm().findField("database").getValue(),host:this.form3.getForm().findField("host").getValue(),port:this.form3.getForm().findField("port").getValue(),db_user:this.form3.getForm().findField("username").getValue(),db_pass:this.form3.getForm().findField("password").getValue(),},success:function(b,c){var d=Ext.decode(b.responseText);if(d.success){Ext.Msg.alert("Success",d.message)}else{Ext.Msg.alert("Failure",d.message)}a.close()},})},setWindowTitle:function(){switch(this.currentItem){case 0:this.setTitle("Your new Project");this.buttons[0].hide();break;case 1:this.setTitle("Create new Admin user");this.buttons[0].show();break;case 2:this.setTitle("Setup your Database Configuration");this.buttons[2].hide();this.buttons[1].show();break;case 3:this.setTitle("Setup a Virtual Host");this.buttons[1].hide();this.buttons[2].show();break}this.center()},});Ext.apply(Ext.form.VTypes,{uniqueNode:function(e,f){var a=f.ownerCt.ownerCt.tree;var d=a.getSelectionModel().getSelectedNode();var b=afStudio.createSlug(e);if(d.childNodes){for(var c=0;c<d.childNodes.length;c++){if(!d.childNodes[c].isLeaf()&&d.childNodes[c].text==b){return false}}}return true},uniqueNodeText:"Path to Project already exist! Please choose another Project Name!"});afStudio.databaseConnectionSettings=Ext.extend(Ext.Window,{form:null,initComponent:function(){this.createForm();var a={title:"Database Connection Settings",width:463,autoHeight:true,closable:true,draggable:true,plain:true,modal:true,resizable:false,bodyBorder:false,border:false,items:this.form,buttons:[{text:"Save",handler:this.saveDatabaseSettings,scope:this},{text:"Cancel",handler:this.cancel,scope:this}],buttonAlign:"center"};Ext.apply(this,Ext.apply(this.initialConfig,a));afStudio.databaseConnectionSettings.superclass.initComponent.apply(this,arguments);this.show()},createForm:function(){this.form=new Ext.FormPanel({url:window.afStudioWSUrls.getConfigureDatabaseUrl(),defaultType:"textfield",width:450,frame:true,labelWidth:100,title:false,items:[{xtype:"textfield",fieldLabel:"Database",anchor:"96%",name:"database",allowBlank:false},{xtype:"panel",layout:"column",items:[{xtype:"panel",columnWidth:1,layout:"form",style:"margin-right: 5px;",items:[{xtype:"textfield",fieldLabel:"Host",name:"host",anchor:"92%",allowBlank:false}]},{xtype:"panel",width:100,layout:"form",labelWidth:35,items:[{xtype:"textfield",fieldLabel:"Port",name:"port",anchor:"82%",allowBlank:false}]}]},{xtype:"textfield",fieldLabel:"Username",anchor:"96%",name:"username",allowBlank:false},{xtype:"textfield",fieldLabel:"Password",anchor:"96%",name:"password",allowBlank:false},{xtype:"checkbox",hideLabel:true,boxLabel:"Persistent",name:"persistent"},{xtype:"checkbox",hideLabel:true,boxLabel:"Pooling",name:"pooling"}]});this.form.getForm().load({url:window.afStudioWSUrls.getLoadDatabaseConnectionSettingsUrl(),failure:function(a,b){Ext.Msg.alert("Load failed","Error while getting data")}})},saveDatabaseSettings:function(){var a=this.form.getForm();if(a.isValid()){a.submit({failure:function(b,c){if(c.result){if(c.result.message){Ext.Msg.alert("Failure",c.result.message,function(){if(c.result.redirect){window.location.href=c.result.redirect}})}}},success:function(b,c){if(c.result){if(c.result.message){Ext.Msg.alert("Success",c.result.message,function(){if(c.result.redirect){window.location.href=c.result.redirect}})}}}})}},cancel:function(){this.close()}});afStudio.LoadProject=Ext.extend(Ext.Window,{initComponent:function(){this.tree=new Ext.ux.FileTreePanel({url:window.afStudioWSUrls.getProjectLoadTreeUrl(),rootPath:"root",rootVisible:true,rootText:afStudioHost.user+"@"+afStudioHost.name,topMenu:false,autoScroll:true,enableProgress:false,singleUpload:true,onDblClick:Ext.emptyFn,onContextMenu:Ext.emptyFn,listeners:{expandnode:function(c){if(c.childNodes){for(var b=0;b<c.childNodes.length;b++){if(afProjectInPath.indexOf(this.getPath(c.childNodes[b]).slice(4))>-1){this.expandPath(c.childNodes[b].getPath());c.childNodes[b].select();c.childNodes[b].ensureVisible()}}}}}});var a={title:"Load Project",width:348,height:400,closable:true,draggable:true,modal:true,resizable:false,bodyBorder:false,border:false,layout:"fit",items:[this.tree],buttons:[{text:"Load",handler:this.load,scope:this},{text:"Cancel",handler:this.cancel,scope:this}],buttonAlign:"center"};Ext.apply(this,Ext.apply(this.initialConfig,a));afStudio.LoadProject.superclass.initComponent.apply(this,arguments);this._initEvents()},_initEvents:function(){},cancel:function(){this.close()},load:function(){var a=this.tree.getSelectionModel().getSelectedNode();if(a){var b=this.tree.getPath(a);Ext.Ajax.request({url:window.afStudioWSUrls.getProjectLoadTreeUrl(),method:"post",params:{cmd:"isPathValid",path:b},callback:function(d,e,c){c=Ext.decode(c.responseText);if(c.title&&c.message){Ext.Msg.show({title:c.title,msg:c.message,buttons:Ext.Msg.OKCANCEL,modal:true,fn:function(f){if(f=="ok"&&c.project){window.location.href=c.project.url+"/studio"}else{this.close()}}})}}})}else{Ext.Msg.alert("","Please select a directory !")}}});afStudio.Logs=Ext.extend(Ext.Window,{form:null,initComponent:function(){var a={title:"Logs",width:463,autoHeight:true,closable:true,draggable:true,plain:true,modal:true,resizable:false,bodyBorder:false,border:false,buttons:[{text:"Save",scope:this},{text:"Cancel",handler:this.cancel,scope:this}],buttonAlign:"center"};Ext.apply(this,Ext.apply(this.initialConfig,a));afStudio.Logs.superclass.initComponent.apply(this,arguments)},cancel:function(){this.close()}});afStudio.Help=Ext.extend(Ext.Window,{form:null,initComponent:function(){var a={title:"Help",width:720,height:600,closable:true,draggable:true,plain:true,modal:true,resizable:false,bodyBorder:false,border:false,html:'<iframe style="height:100%;width:100%;" frameborder=0 src="http://www.appflower.com/docs/index.html" id="help-iframe"></iframe>',buttons:[{text:"Cancel",handler:this.cancel,scope:this}],buttonAlign:"center"};Ext.apply(this,Ext.apply(this.initialConfig,a));afStudio.Help.superclass.initComponent.apply(this,arguments);this._initEvents()},_initEvents:function(){this.on("show",function(a){Ext.get("help-iframe").on("load",function(){a.body.unmask()});(function(){a.body.mask("Loading, please Wait...","x-mask-loading")}).defer(100)})},cancel:function(){this.close()}});afStudio.Welcome=Ext.extend(Ext.Window,{form:null,initComponent:function(){var a={title:"Welcome to AppFlower Studio",width:810,height:520,closable:true,draggable:true,plain:true,modal:true,resizable:false,bodyBorder:false,border:false,html:'<div id="welcome-box"> </div>',buttonAlign:"left",buttons:[{xtype:"checkbox",boxLabel:"Show this window when Studio opens",checked:true,handler:function(b,d){if(d){Ext.util.Cookies.set("appFlowerStudioDontShowWelcomePopup","")}else{Ext.util.Cookies.set("appFlowerStudioDontShowWelcomePopup","true",new Date("12/22/2099"))}}}]};Ext.apply(this,Ext.apply(this.initialConfig,a));afStudio.Welcome.superclass.initComponent.apply(this,arguments);this.getHtmlData()},getHtmlData:function(){var a=this;Ext.Ajax.request({url:afStudioWSUrls.buildUrlFor("/appFlowerStudio/Welcome"),failure:function(d,c){var b=String.format("Status code: {0}, message: {1}",d.status,d.statusText);afStudio.Msg.error("Server side error",b)},success:function(b,c){var d=Ext.decode(b.responseText);Ext.get("welcome-box").update(d.message);jQuery("a[rel^='prettyPhoto']").prettyPhoto();setTimeout(function(){jQuery("#studio_video_tours ul").jScrollPane()},500);Ext.get("create-project").on("click",function(){a.close();(new afStudio.CreateProjectWizard).show()},this);Ext.get("open-project").on("click",function(){a.close();(new afStudio.LoadProject()).show()},this)}})}});afStudio.Settings=Ext.extend(Ext.Window,{dbForm:null,tabPanel:null,projectForm:null,initComponent:function(){this.initTabPanel();var a={title:"Settings",width:463,height:250,closable:true,draggable:true,plain:true,modal:true,resizable:false,bodyBorder:false,border:false,layout:"fit",items:this.tabPanel,buttons:[{text:"Save",handler:this.save,scope:this},{text:"Cancel",handler:this.cancel,scope:this}],buttonAlign:"center"};Ext.apply(this,Ext.apply(this.initialConfig,a));afStudio.Settings.superclass.initComponent.apply(this,arguments)},initTabPanel:function(){this.createTabsUI();this.tabPanel=new Ext.TabPanel({activeTab:0,items:[{xtype:"panel",title:"Project",formName:"projectForm",items:this.projectForm},{xtype:"panel",title:"Database",formName:"dbForm",items:this.dbForm}]})},createTabsUI:function(){this.projectForm=new Ext.FormPanel({url:window.afStudioWSUrls.getConfigureProjectUrl()+"?type=save",bodyStyle:"padding: 5px;",labelWidth:140,border:false,bodyBorder:false,listeners:{"render":function(a){a.getForm().load({url:window.afStudioWSUrls.getConfigureProjectUrl(),failure:function(b,c){Ext.Msg.alert("Load failed","Error while getting data")}})},scope:this},items:[{xtype:"textfield",name:"name",fieldLabel:"Project Name",anchor:"95%",allowBlank:false},{xtype:"displayfield",name:"display_url",fieldLabel:"Url",anchor:"95%",style:"font-weight:bold;"},{xtype:"displayfield",name:"path",fieldLabel:"Path to Project",anchor:"95%",style:"font-weight:bold;"},{xtype:"label",html:"Description:",style:"font: 12px tahoma,arial,helvetica,sans-serif;"},{xtype:"textarea",hideLabel:true,anchor:"100%",name:"description",height:57,style:"margin-top: 5px;"},{xtype:"checkbox",hideLabel:true,boxLabel:"Auto-Deploy on Save",name:"autodeploy"}]});this.dbForm=new Ext.FormPanel({url:window.afStudioWSUrls.getConfigureDatabaseUrl(),defaultType:"textfield",width:450,bodyStyle:"padding: 5px;",border:false,bodyBorder:false,labelWidth:100,title:false,listeners:{"render":function(a){a.getForm().load({url:window.afStudioWSUrls.getLoadDatabaseConnectionSettingsUrl(),failure:function(b,c){Ext.Msg.alert("Load failed","Error while getting data")}})},scope:this},items:[{xtype:"textfield",fieldLabel:"Database",anchor:"96%",name:"database",allowBlank:false},{xtype:"panel",layout:"column",border:false,bodyBorder:false,defaults:{border:false,bodyBorder:false},items:[{xtype:"panel",columnWidth:1,layout:"form",style:"margin-right: 5px;",items:[{xtype:"textfield",fieldLabel:"Host",name:"host",anchor:"92%",allowBlank:false}]},{xtype:"panel",width:100,layout:"form",labelWidth:35,items:[{xtype:"textfield",fieldLabel:"Port",name:"port",anchor:"82%",allowBlank:true}]}]},{xtype:"textfield",fieldLabel:"Username",anchor:"96%",name:"username",allowBlank:false},{xtype:"textfield",fieldLabel:"Password",anchor:"96%",name:"password",allowBlank:false},{xtype:"checkbox",hideLabel:true,boxLabel:"Persistent",name:"persistent"},{xtype:"checkbox",hideLabel:true,boxLabel:"Pooling",name:"pooling"}]})},save:function(){var a=this.tabPanel.getActiveTab();switch(a.formName){case"projectForm":var b=this.projectForm.getForm();break;case"dbForm":var b=this.dbForm.getForm();break}if(b.isValid()){b.submit({failure:function(c,d){if(d.result){if(d.result.message){Ext.Msg.alert("Failure",d.result.message,function(){if(d.result.redirect){window.location.href=d.result.redirect}})}}},success:function(c,d){if(d.result){if(d.result.message){Ext.Msg.alert("Success",d.result.message,function(){if(d.result.redirect){window.location.href=d.result.redirect}})}}}})}},cancel:function(){this.close()}});Ext.override(Ext.tree.TreeEditor,{onSpecialKey:function(c,b){var a=b?b.getKey():Ext.EventObject.getKey();if(a==Ext.EventObject.ESC){if(b){b.stopEvent()}this.cancelEdit()}else{if(a==Ext.EventObject.ENTER&&!Ext.EventObject.hasModifier()){if(b){b.stopEvent()}this.completeEdit()}}}});Ext.namespace("afStudio.error");afStudio.error.ApsError=Ext.extend(Ext.Error,{name:"afStudio.error.ApsError"});Ext.namespace("afStudio.notification");afStudio.notification.NotificationMgr={positions:[],heights:[]};afStudio.notification.NotificationWindow=Ext.extend(Ext.Window,{initComponent:function(){Ext.apply(this,Ext.apply(this.initialConfig,{closeAction:"close",autoHeight:true,plain:false,shadow:false,draggable:false,bodyStyle:"text-align: left; padding: 10px;",resizable:false}));if(this.autoDestroy){this.task=new Ext.util.DelayedTask(this.close,this)}else{this.closable=true}afStudio.notification.NotificationWindow.superclass.initComponent.call(this)},setMessage:function(a){this.body.update(a)},afterShow:function(){afStudio.notification.NotificationWindow.superclass.afterShow.call(this);this.on("move",function(){afStudio.notification.NotificationMgr.positions.remove(this.pos);if(this.autoDestroy){this.task.cancel()}},this);if(this.autoDestroy){this.task.delay(this.hideDelay||5000)}},animShow:function(){this.pos=0;var a=0;while(afStudio.notification.NotificationMgr.positions.indexOf(this.pos)>-1){a+=afStudio.notification.NotificationMgr.heights[this.pos];this.pos++}afStudio.notification.NotificationMgr.positions.push(this.pos);afStudio.notification.NotificationMgr.heights[this.pos]=this.getSize().height+10;this.el.alignTo(this.animateTarget||document,"br-br",[-5,-5-(a)]);this.el.slideIn("b",{duration:0.7,callback:this.afterShow,scope:this})},animHide:function(){afStudio.notification.NotificationMgr.positions.remove(this.pos);if(this.el){this.el.ghost("b",{duration:1,remove:false})}},onDestroy:function(){afStudio.notification.NotificationMgr.positions.remove(this.pos);afStudio.notification.NotificationWindow.superclass.onDestroy.call(this)}});afStudio.notification.MessageBox=function(){var a=function(b){var c=new afStudio.notification.NotificationWindow(Ext.apply({width:300,animateTarget:Ext.getBody(),autoDestroy:false,notificationType:"INFO"},b));switch(c.notificationType){case"ERROR":c.iconCls="icon-notification-error";c.bodyStyle+="background-color: #fddcdc;";break;case"WARNING":c.iconCls="icon-notification-warning";c.bodyStyle+="background-color: #fefcc7;";break;case"INFO":c.iconCls="icon-notification-info";c.bodyStyle+="background-color: #fff;";break}c.bodyStyle+="padding-bottom:20px;";c.show();return c};return{DURATION:10000,INFO:"INFO",WARNING:"WARNING",ERROR:"ERROR",notify:function(d,f,e,c){c=c||{};var b=a(Ext.apply(c,{notificationType:d,title:f,html:e}));if(d!=this.ERROR){b.close.defer(this.DURATION,b)}},info:function(){var c,b;if(arguments.length==1){c="Notification";b=arguments[0]}else{c=arguments[0];b=arguments[1]}this.notify(this.INFO,c,b)},warning:function(){var c,b;if(arguments.length==1){c="Warning";b=arguments[0]}else{c=arguments[0];b=arguments[1]}this.notify(this.WARNING,c,b)},error:function(){var c,b;if(arguments.length==1){c="Error";b=arguments[0]}else{c=arguments[0];b=arguments[1]}this.notify(this.ERROR,c,b)}}}();afStudio.Msg=afStudio.notification.MessageBox;Ext.namespace("afStudio.cli");afStudio.cli.CommandLine=Ext.extend(Ext.Panel,{autoScroll:true,bodyStyle:"background-color: black; font-family: monospace; font-size: 11px; color: #88ff88;",constructor:function(a){Ext.apply(this,a);afStudio.cli.CommandLine.superclass.constructor.call(this,a)},afterRender:function(){afStudio.cli.CommandLine.superclass.afterRender.call(this);this.cliWrapper=this.ownerCt;this.on({scope:this,afterrender:this.onCliAfterRender})},maskCli:function(a){this.el.mask(a?a:"loading...")},unmaskCli:function(){this.el.unmask()},scrollCliDown:function(a){a=a?a:1000000;this.body.scroll("bottom",a,true)},onCliAfterRender:Ext.emptyFn,loadCli:Ext.emptyFn,refreshCli:function(){this.loadCli()},setCli:Ext.emptyFn,updateCli:Ext.emptyFn,clearCli:Ext.emptyFn,executeAction:function(a){var b=this;this.maskCli(a.loadingMessage?a.loadingMessage:false);Ext.Ajax.request({url:a.url,params:a.params,scope:a.scope?a.scope:b,success:function(g,e){this.unmaskCli();var d=Ext.decode(g.responseText);if(d.success){Ext.util.Functions.createDelegate(a.run,this,[d],false)()}else{if(Ext.isFunction(a.error)){Ext.util.Functions.createDelegate(a.error,this,[d],false)()}var f=d.content||d.message||"Operation was successfully processed!",c=this.cliWrapper.title||"";afStudio.Msg.error(c,f)}},failure:function(f,d){this.unmaskCli();if(Ext.isFunction(a.error)){Ext.util.Functions.createDelegate(a.error,this,[f],false)()}var e=String.format("Status code: {0}, message: {1}",f.status,f.statusText),c=String.format("Server Error {0}",this.cliWrapper.title||"");afStudio.Msg.error(c,e)}})}});Ext.namespace("afStudio.cli");afStudio.cli.AuditLog=Ext.extend(afStudio.cli.CommandLine,{baseUrl:afStudioWSUrls.getNotificationsUrl(),notificationOffset:0,_beforeInitComponent:function(){var a=this;return{html:""}},initComponent:function(){Ext.apply(this,Ext.apply(this.initialConfig,this._beforeInitComponent()));afStudio.cli.AuditLog.superclass.initComponent.apply(this,arguments)},loadCli:function(){this.executeAction({url:this.baseUrl,params:{cmd:"get",offset:this.notificationOffset},run:function(a){this.notificationOffset=a.offset;this.updateCli(a.notifications)}})},updateCli:function(a){if(Ext.isString(a)&&a){this.body.dom.innerHTML+=a;this.scrollCliDown()}}});Ext.reg("afStudio.cli.auditLog",afStudio.cli.AuditLog);Ext.namespace("afStudio.cli");afStudio.cli.Console=Ext.extend(afStudio.cli.CommandLine,{baseUrl:afStudioWSUrls.getConsoleUrl(),consoleCommands:afStudioConsoleCommands,_beforeInitComponent:function(){var b=this;var a=new Ext.Toolbar({items:["Enter command:",{xtype:"tbspacer",width:5},{xtype:"textfield",itemId:"cml",width:300,enableKeyEvents:true},{xtype:"tbspacer",width:10},{xtype:"tbtext",text:"<b>cmds:</b> "+b.consoleCommands}]});this.consoleCmdLine=a.getComponent("cml");return{tbar:a,html:""}},initComponent:function(){Ext.apply(this,Ext.apply(this.initialConfig,this._beforeInitComponent()));afStudio.cli.Console.superclass.initComponent.apply(this,arguments);this._afterInitComponent()},_afterInitComponent:function(){this.consoleCmdLine.on("keyup",this.onConsoleCmdLineKeyUp,this)},onCliAfterRender:function(){this.loadCli()},loadCli:function(){var a=this;this.executeAction({url:a.baseUrl,params:{command:"start"},run:function(b){this.updateCli(b.console)}})},refreshCli:function(){this.scrollCliDown()},setCli:function(a){this.body.dom.innerHTML=a;this.scrollCliDown()},updateCli:function(a){if(Ext.isString(a)&&a){this.body.dom.innerHTML+=a;this.scrollCliDown()}},clearCli:function(){this.setCli("")},onConsoleCmdLineKeyUp:function(f,c){var d=this,b=f.getValue(),a=c?c.getKey():Ext.EventObject.getKey();if(a==Ext.EventObject.ENTER){f.setValue("");if(b=="clear"){this.clearCli()}else{this.executeAction({url:d.baseUrl,params:{command:b},loadingMessage:String.format('Executing command "{0}"...',b),run:function(e){this.updateCli(e.console)}})}}}});Ext.reg("afStudio.cli.console",afStudio.cli.Console);Ext.namespace("afStudio.cli");afStudio.cli.Debug=Ext.extend(afStudio.cli.CommandLine,{baseUrl:afStudioWSUrls.getDebugUrl(),_beforeInitComponent:function(){var d=this;var b=new Ext.data.JsonStore({autoLoad:false,url:d.baseUrl,storeId:"cli-debug",root:"data",totalProperty:"total",fields:["text"]});var a=new Ext.XTemplate('<tpl for=".">','<div class="thumb-wrap">',"{text}",'<div class="x-clear"></div>',"</div>","</tpl>");this.debugDataView=new Ext.DataView({store:b,tpl:a,autoHeight:true,forceFit:true});var c=new Ext.PagingToolbar({store:b,pageSize:1,displayInfo:true});return{tbar:{id:"debug-toolbar",items:[]},bbar:c,items:[this.debugDataView]}},initComponent:function(){Ext.apply(this,Ext.apply(this.initialConfig,this._beforeInitComponent()));afStudio.cli.Debug.superclass.initComponent.apply(this,arguments)},loadCli:function(){var d=this,a=this.debugDataView.getStore(),c=this.getTopToolbar(),b=this.getBottomToolbar();this.executeAction({url:d.baseUrl,params:{command:"main"},run:function(f){a.loadData(f);a.setBaseParam("file_name",null);a.setBaseParam("command",null);b.moveLast();this.scrollCliDown();c.removeAll();var e=f.files.length;if(e>0){Ext.each(f.files,function(h,g){c.addButton({itemId:h,text:h});c.getComponent(h).on({click:d.onFileClick.createDelegate(d)});if(g!=e-1){c.add("-")}})}c.doLayout()}})},onFileClick:function(c,a){var d=this,b=this.debugDataView.getStore();this.maskCli();b.baseParams.file_name=c.itemId;b.baseParams.command="file";b.load({params:{start:0,limit:1}});this.unmaskCli()}});Ext.reg("afStudio.cli.debug",afStudio.cli.Debug);Ext.namespace("afStudio.cli");afStudio.cli.WindowWrapper=Ext.extend(Ext.Window,{width:1007,height:600,closable:true,closeAction:"hide",draggable:true,plain:true,modal:true,maximizable:true,border:false,bodyBorder:false,layout:"fit",closeWindow:function(){if(this.closeAction=="hide"){this.hide()}else{this.close()}},constructor:function(a){Ext.apply(this,a);afStudio.cli.WindowWrapper.superclass.constructor.call(this,a)},initComponent:function(){afStudio.cli.WindowWrapper.superclass.initComponent.apply(this,arguments);var a=this;this.on({beforeshow:function(){var b=this.items.itemAt(0);b.refreshCli()}})}});Ext.ns("afStudio.cli");afStudio.cli.CommandLineMgr=function(){var c=new afStudio.cli.Console();var a=new afStudio.cli.WindowWrapper({title:"Console",iconCls:"icon-console",items:c});var d=new afStudio.cli.WindowWrapper({title:"Debug",iconCls:"icon-debug",items:new afStudio.cli.Debug()});var b=new afStudio.cli.WindowWrapper({title:"Notifications",iconCls:"icon-notifications",items:new afStudio.cli.AuditLog()});return{init:function(){a.show().closeWindow()},showConsole:function(){a.show()},showAuditLog:function(){b.show()},showDebug:function(){d.show()},updateConsole:function(e){c.updateCli(e)},setConsole:function(e){c.setCli(e)}}}();afStudio.Cli=afStudio.cli.CommandLineMgr;Ext.ns("afStudio.navigation");afStudio.navigation.BaseTreeEditor=Ext.extend(Ext.tree.TreeEditor,{beforeNodeClick:Ext.emptyFn});afStudio.navigation.BaseItemTreePanel=Ext.extend(Ext.tree.TreePanel,{animate:true,autoScroll:true,editorFieldInvalid:'The value in this node is invalid! <br /> accepts only alphanumeric symbols and "_", begins from "_" or alpha.',leafNodeCfg:{},branchNodeCfg:{},constructor:function(b){var c=this;var a=new Ext.tree.TreeNode({path:"root",text:c.title||"",draggable:false});Ext.applyIf(b,{root:a,rootVisible:false,tools:[{id:"refresh",handler:c.loadRootNode,scope:this}]});afStudio.navigation.BaseItemTreePanel.superclass.constructor.call(this,b)},initComponent:function(){var a=this;this.treeSorter=new Ext.tree.TreeSorter(this,{folderSort:true,dir:"asc"});this.treeEditor=new afStudio.navigation.BaseTreeEditor(this,{cancelOnEsc:true,completeOnEnter:true,ignoreNoChange:true});afStudio.navigation.BaseItemTreePanel.superclass.initComponent.apply(this,arguments)},initEvents:function(){afStudio.navigation.BaseItemTreePanel.superclass.initEvents.apply(this,arguments);var a=this;a.loader.on({scope:a,beforeload:a.onLoaderBeforeLoad,load:a.onLoaderLoad,loadexception:a.onLoaderLoadException});a.treeEditor.on({scope:a,beforecomplete:a.onEditorBeforeComplete,complete:a.onEditorComplete,canceledit:a.onEditorCancelEdit});a.on({scope:a,contextmenu:a.onNodeContextMenu,click:a.onNodeClick,dblclick:a.onNodeDblClick,activate:{fn:a.onItemActivate,single:true}});a.treeKeyMap=new Ext.KeyMap(this.el,[{key:Ext.EventObject.ENTER,fn:function(){var c=this.getSelectionModel(),b=c.getSelectedNode();if(b.isLeaf()){this.runNode(b)}else{if(b.isExpandable()){b.isExpanded()?b.collapse():b.expand()}}},scope:this}])},maskItemTree:function(){this.body.mask("Loading, please Wait...")},unmaskItemTree:function(){this.body.unmask()},getNodeAttribute:function(c,b,a){return c.attributes[b]?c.attributes[b]:(a?a:null)},getParentNodeAttribute:function(c,b,a){return this.getNodeAttribute(c.parentNode,b,a)},expandParentNodes:function(a){if(!Ext.isEmpty(a.parentNode)){this.expandParentNodes(a.parentNode)}a.expand()},selectNode:function(a){this.selectPath(a.getPath())},selectChildNodeByText:function(b,c){var e=this,d=this.getSelectionModel();this.expandParentNodes(b);var a;if(b&&!b.isLeaf()){a=b.findChild("text",c,false);a?d.select(a):null}return a},loadRootNode:function(c){var b=this,a=this.loader;Ext.isFunction(c)?a.load(this.root,c,b):a.load(this.root)},initialItemState:function(){var b=this.getRootNode(),d=this.getSelectionModel();if(!b.isExpanded()){b.expand()}if(b.firstChild&&!b.firstChild.isLeaf()){b.firstChild.expand(false,true,function(f){d.select(f);f.ui.getEl().focus()});var e=b.childNodes,c,a=e.length;for(c=1;c<a;c++){e[c].expand()}}},onItemActivate:function(){this.loadRootNode(this.initialItemState)},refreshNode:function(b,a,d){var c=this;this.loadRootNode(function(){var f=this.getRootNode(),e=Ext.isString(b)?f.findChild("text",b,true):f,g;if(e){g=this.selectChildNodeByText(e,a)}if(Ext.isFunction(d)){Ext.util.Functions.createDelegate(d,c,[g])()}})},onLoaderBeforeLoad:function(a,b,c){this.maskItemTree()},onLoaderLoad:function(a,b,c){this.unmaskItemTree()},onLoaderLoadException:function(a,b,c){this.unmaskItemTree()},onNodeClick:Ext.emptyFn,onNodeDblClick:Ext.emptyFn,onNodeContextMenu:Ext.emptyFn,isValidNodeName:function(b,a){return/^[^\d]\w*$/im.test(a)?true:false},onEditorBeforeComplete:function(b,d,a){var c=b.editNode;if(!this.isValidNodeName(c,d)){b.field.markInvalid(this.editorFieldInvalid);return false}},onEditorComplete:function(b,d,a){var c=b.editNode;if(this.getNodeAttribute(c,"NEW_NODE")){c.setText(d);this.addNodeController(c)}else{if(d!=a){this.renameNodeController(c,d,a)}}},onEditorCancelEdit:function(b,d,a){var c=b.editNode;if(this.getNodeAttribute(c,"NEW_NODE")){c.remove()}},addNodeController:Ext.emptyFn,renameNodeController:Ext.emptyFn,runNode:Ext.emptyFn,addLeafNode:function(b){var a=this.leafNodeCfg;a.NEW_NODE=true;this.addNode(b,a)},addBranchNode:function(b,c){var a=this.branchNodeCfg;a.NEW_NODE=true;if(c&&Ext.isObject(c)){Ext.apply(a,c)}this.addNode(b,a)},addNode:function(b,a){var d=this.treeEditor,c;b.expand();c=b.appendChild(new Ext.tree.TreeNode(Ext.apply({},a)));this.selectNode(c);d.triggerEdit(c)},executeAction:function(b){var c=this,a=true;afStudio.vp.mask({msg:b.loadingMessage?b.loadingMessage:"Loading...",region:"center"});Ext.Ajax.request({url:b.url,params:b.params,scope:b.scope?b.scope:c,success:function(h,f){afStudio.vp.unmask("center");var e=Ext.decode(h.responseText);var g=e.content||e.message||"Operation was successfully processed!",d=this.title||"";if(e.success){Ext.util.Functions.createDelegate(b.run,this,[e],false)();if(e.console){afStudio.updateConsole(e.console)}if(b.logMessage){this.fireEvent("logmessage",this,b.logMessage)}if(!Ext.isDefined(b.showNoteOnSuccess)&&a===true){afStudio.Msg.info(d,g)}else{if(b.showNoteOnSuccess===true){afStudio.Msg.info(d,g)}}}else{if(Ext.isFunction(b.error)){Ext.util.Functions.createDelegate(b.error,this,[e],false)()}afStudio.Msg.error(d,g)}},failure:function(g,e){afStudio.vp.unmask("center");if(Ext.isFunction(b.error)){Ext.util.Functions.createDelegate(b.error,this,[g],false)()}var f=String.format("Status code: {0}, message: {1}",g.status,g.statusText),d=String.format("Server Error {0}",this.title||"");afStudio.Msg.error(d,f)}})}});afStudio.navigation.ModelItem=Ext.extend(afStudio.navigation.BaseItemTreePanel,{baseUrl:afStudioWSUrls.getModelsUrl(),leafNodeCfg:{text:"NewModel",iconCls:"icon-model",leaf:true},modelContextMenu:new Ext.menu.Menu({items:[{itemId:"edit-model",text:"Edit model",iconCls:"icon-models-edit"},{itemId:"rename-model",text:"Rename model",iconCls:"icon-edit"},{itemId:"delete-model",text:"Delete model",iconCls:"icon-models-delete"}],listeners:{itemclick:function(c){var b=c.parentMenu.contextNode,a=b.getOwnerTree();switch(c.itemId){case"delete-model":a.deleteNodeModel(b);break;case"edit-model":a.runNode(b);break;case"rename-model":a.treeEditor.triggerEdit(b);break}}}}),_beforeInitComponent:function(){var b=this;var a=new Ext.tree.TreeLoader({url:this.baseUrl,baseParams:{cmd:"get"}});return{title:"Models",loader:a,iconCls:"icon-databases",bbar:{items:["->",{text:"Add Model",iconCls:"icon-models-add",handler:b.onAddModelClick,scope:b}]}}},initComponent:function(){Ext.apply(this,Ext.apply(this.initialConfig,this._beforeInitComponent()));afStudio.navigation.ModelItem.superclass.initComponent.apply(this,arguments)},onAddModelClick:function(){var b=this,a=this.getRootNode();this.addLeafNode(a)},runNode:function(c){var d=this,a=this.getNodeAttribute(c,"text"),b=this.getNodeAttribute(c,"schema");this.executeAction({url:d.baseUrl,params:{xaction:"read",model:a,schema:b},showNoteOnSuccess:false,loadingMessage:String.format('Loading model "{0}"...',a),run:function(e){var f=new afStudio.models.ModelTab({_node:c,fieldsStructure:e,modelName:a,schemaName:b});afStudio.vp.addToWorkspace(f,true)}})},onNodeDblClick:function(a,b){this.runNode(a)},onNodeContextMenu:function(a,b){a.select();this.modelContextMenu.contextNode=a;this.modelContextMenu.showAt(b.getXY())},addNodeController:function(c){var d=this,a=this.getNodeAttribute(c,"text"),b=this.getNodeAttribute(c,"schema");this.executeAction({url:d.baseUrl,params:{cmd:"add",model:a,schema:b},loadingMessage:String.format('"{0}" model creation...',a),logMessage:String.format('Models: model "{0}" was created',a),run:function(e){this.refreshNode(this.root,a,this.runNode)},error:function(e){c.remove()}})},renameNodeController:function(d,e,b){var f=this,a=this.getRootNode(),c=this.getNodeAttribute(d,"schema");this.executeAction({url:f.baseUrl,params:{cmd:"rename",model:b,renamedModel:e,schema:c},loadingMessage:String.format('Renaming model from "{0}" to {1} ...',b,e),logMessage:String.format('Models: model "{0}" was renamed to "{1}"',b,e),run:function(g){this.refreshNode(a,e,this.runNode)},error:function(g){d.setText(b)}})},deleteNodeModel:function(d){var f=this,a=this.getRootNode(),b=this.getNodeAttribute(d,"text"),c=this.getNodeAttribute(d,"schema"),e=String.format('Are you sure you want to delete model "{0}" ?',b);Ext.Msg.confirm("Models",e,function(g){if(g=="yes"){f.executeAction({url:f.baseUrl,params:{cmd:"delete",model:b,schema:c},loadingMessage:String.format('Model "{0}" deleting ...',b),logMessage:String.format('Models: model "{0}" was deleted',b),run:function(h){this.loadRootNode(function(){afStudio.vp.clearWorkspace()})}})}})}});Ext.reg("afStudio.navigation.modelItem",afStudio.navigation.ModelItem);afStudio.navigation.LayoutItem=Ext.extend(afStudio.navigation.BaseItemTreePanel,{baseUrl:"/appFlowerStudio/layout",layoutMetaUrl:"/afsLayoutBuilder/get",addNewPageUrl:"/afsLayoutBuilder/new",renamePageUrl:"/afsLayoutBuilder/rename",deletePageUrl:"/afsLayoutBuilder/delete",editorFieldInvalid:'Page name is invalid! <br /> accepts only alphanumeric symbols and "_", begins from "_" or alpha and ends with <b>.xml</b>.',leafNodeCfg:{text:"newPage.xml",iconCls:"icon-layout",type:"page",leaf:true},appContextMenu:new Ext.menu.Menu({items:[{itemId:"app-add-page",text:"Add Page",iconCls:"icon-models-add"}],listeners:{itemclick:function(c){var b=c.parentMenu.contextNode,a=b.getOwnerTree();a.addLeafNode(b)}}}),pageContextMenu:new Ext.menu.Menu({items:[{itemId:"edit-page",text:"Edit Page",iconCls:"icon-models-edit"},{itemId:"rename-page",text:"Rename Page",iconCls:"icon-edit"},{itemId:"delete-page",text:"Delete Page",iconCls:"icon-models-delete"}],listeners:{itemclick:function(c){var b=c.parentMenu.contextNode,a=b.getOwnerTree();switch(c.itemId){case"edit-page":a.runNode(b);break;case"rename-page":a.treeEditor.triggerEdit(b);break;case"delete-page":a.deletePage(b);break}}}}),_beforeInitComponent:function(){var b=this;var a=new Ext.tree.TreeLoader({url:this.baseUrl,baseParams:{cmd:"getList"}});return{title:"Layout",loader:a,iconCls:"icon-layout_content",bbar:{items:["->",{text:"Add Page",iconCls:"icon-pages-add",handler:b.onAddPageClick,scope:b}]}}},initComponent:function(){Ext.apply(this,Ext.apply(this.initialConfig,this._beforeInitComponent()));afStudio.navigation.LayoutItem.superclass.initComponent.apply(this,arguments)},onAddPageClick:function(){var c=this,a=this.getRootNode(),b=this.getSelectionModel().getSelectedNode();if(a.hasChildNodes()){if(!Ext.isEmpty(b)){if(b.isLeaf()){this.addLeafNode(b.parentNode)}else{this.addLeafNode(b)}}else{this.addLeafNode(a.firstChild)}}},runNode:function(a){var d=this,b=d.getNodeAttribute(a,"text"),c=d.getParentNodeAttribute(a,"text");afStudio.vp.mask(String.format("Loading {0} page metadata...",b));Ext.Ajax.request({url:d.layoutMetaUrl,params:{app:c,page:b},success:function(g,f){afStudio.vp.unmask();var e=Ext.decode(g.responseText);if(e.success){afStudio.vp.addToWorkspace(new afStudio.layoutDesigner.DesignerPanel({layoutMeta:e.content,layoutApp:c,layoutPage:b}),true)}else{Ext.Msg.alert("Error",e.content)}},failure:function(f,e){afStudio.vp.unmask();Ext.Msg.alert("Error",String.format("Status code {0}, message {1}",f.status,f.statusText))}})},onNodeDblClick:function(a,b){if(this.getNodeAttribute(a,"type")=="page"){this.runNode(a)}},onNodeContextMenu:function(a,b){var d=this,c;a.select();switch(a.attributes.type){case"app":c=d.appContextMenu;break;case"page":c=d.pageContextMenu;break}if(c){c.contextNode=a;c.showAt(b.getXY())}},isValidNodeName:function(b,a){return/^[^\d]\w*\.xml$/im.test(a)?true:false},addNodeController:function(c){var e=this,a=this.getParentNodeAttribute(c,"text"),d=this.getNodeAttribute(c,"text"),b=d.substring(0,d.lastIndexOf(".xml"));this.executeAction({url:e.addNewPageUrl,params:{app:a,page:d,title:b},loadingMessage:String.format('"{0}" page creation...',d),logMessage:String.format('Layout Designer: page "{0}" was created',d),run:function(f){this.refreshNode(a,d,this.runNode)},error:function(f){c.remove()}})},renameNodeController:function(c,d,b){var e=this,a=this.getParentNodeAttribute(c,"text");this.executeAction({url:e.renamePageUrl,params:{app:a,page:b,name:d},loadingMessage:String.format('Renaming page from "{0}" to {1} ...',b,d),logMessage:String.format('Layout Designer: page "{0}" was renamed to "{1}"',b,d),run:function(f){this.refreshNode(a,d,this.runNode)},error:function(f){c.setText(b)}})},deletePage:function(d){var f=this,c=this.getRootNode(),b=this.getParentNodeAttribute(d,"text"),a=this.getNodeAttribute(d,"text"),e=String.format('Are you sure you want to delete page "{0}"?',a);Ext.Msg.confirm("Layout Designer",e,function(g){if(g=="yes"){f.executeAction({url:f.deletePageUrl,params:{app:b,page:a},loadingMessage:String.format('"{0}" page deleting ...',a),logMessage:String.format('Layout Designer: page "{0}" was deleted',a),run:function(h){this.loadRootNode(function(){this.selectChildNodeByText(c,b).expand();afStudio.vp.clearWorkspace()})}})}})}});Ext.reg("afStudio.navigation.layoutItem",afStudio.navigation.LayoutItem);afStudio.navigation.WidgetItem=Ext.extend(afStudio.navigation.BaseItemTreePanel,{baseUrl:afStudioWSUrls.getModulesUrl(),branchNodeCfg:{text:"NewModule",type:"module",allowChildren:true,iconCls:"icon-folder",children:[]},appContextMenu:new Ext.menu.Menu({items:[{itemId:"add-module",text:"Add module",iconCls:"icon-models-add"}],listeners:{itemclick:function(c){var b=c.parentMenu.contextNode,a=b.getOwnerTree();switch(c.itemId){case"add-module":a.onAddModule(b);break}}}}),moduleContextMenu:new Ext.menu.Menu({items:[{itemId:"rename-module",text:"Rename module",iconCls:"icon-edit"},{itemId:"delete-module",text:"Delete module",iconCls:"icon-models-delete"}],listeners:{itemclick:function(c){var b=c.parentMenu.contextNode,a=b.getOwnerTree();switch(c.itemId){case"rename-module":a.treeEditor.triggerEdit(b);break;case"delete-module":a.deleteNodeModule(b);break}}}}),xmlContextMenu:new Ext.menu.Menu({items:[{itemId:"edit-xml",text:"Edit Widget",iconCls:"icon-models-edit"},{itemId:"rename-xml",text:"Rename Widget",iconCls:"icon-edit"},{itemId:"delete-xml",text:"Delete Widget",iconCls:"icon-models-delete"}],listeners:{itemclick:function(c){var b=c.parentMenu.contextNode,a=b.getOwnerTree();switch(c.itemId){case"delete-xml":a.deleteNodeXml(b);break;case"edit-xml":a.runNode(b);break;case"rename-xml":a.treeEditor.triggerEdit(b);break}}}}),_beforeInitComponent:function(){var b=this;var a=new Ext.tree.TreeLoader({url:this.baseUrl,baseParams:{cmd:"get"}});return{title:"Widgets",loader:a,iconCls:"icon-models",bbar:{items:["->",{text:"Add Widget",iconCls:"icon-widgets-add",handler:b.onAddWidget,scope:b},"-",{text:"Add Module",iconCls:"icon-models-add",handler:b.onAddModule,scope:b}]}}},initComponent:function(){Ext.apply(this,Ext.apply(this.initialConfig,this._beforeInitComponent()));afStudio.navigation.WidgetItem.superclass.initComponent.apply(this,arguments)},getNodeModule:function(b){var a;switch(b.attributes.type){case"app":a=false;break;case"module":a=b.text;break;case"xml":a=b.attributes.module;break}return a},getNodeApp:function(b){var a=this.getNodeAttribute(b,"type"),c;switch(a){case"app":c=this.getNodeAttribute(b,"text");break;case"module":case"xml":c=this.getNodeAttribute(b,"app");break}return c},getNodeActionPath:function(a){return this.getNodeAttribute(a,"actionPath")},getNodeSecurityPath:function(a){return this.getNodeAttribute(a,"securityPath")},onAddModule:function(b){this.appContextMenu;var a=this.getRootNode();if(!b.ownerTree){b=this.getSelectionModel().getSelectedNode();if(!b){b=a.firstChild}else{if(b.attributes.type!="app"){b=a.findChild("text",b.attributes.app)}}}this.addBranchNode(b,{app:this.getNodeApp(b)})},isValidNodeType:function(a){return["app","module","xml"].indexOf(a)!=-1},isValidNodeName:function(c,a){var b=this.getNodeAttribute(c,"type");if(["app","module"].indexOf(b)!=-1){return this.constructor.superclass.isValidNodeName.call(this,c,a)}else{return/^[^\d]\w*\.xml$/im.test(a)?true:false}},runNode:function(a){this.showWidgetDesignerForNode(a)},onNodeDblClick:function(a,b){if(this.getNodeAttribute(a,"type")=="xml"){this.runNode(a)}},onNodeContextMenu:function(b,c){var f=this,a=this.getNodeAttribute(b,"type");b.select();if(f.isValidNodeType(a)){var d=f[a+"ContextMenu"];d.contextNode=b;d.showAt(c.getXY())}},addNodeController:function(b){var c=this,a=this.getNodeAttribute(b,"type");if(c.isValidNodeType(a)){c["addNode"+a.ucfirst()](b)}},renameNodeController:function(c,d,a){var e=this,b=this.getNodeAttribute(c,"type");if(e.isValidNodeType(b)){e["renameNode"+b.ucfirst()](c,d,a)}},onAddWidget:function(){var b=this;var a=new afStudio.wd.WidgetsBuilder({modelsUrl:afStudioWSUrls.getModelsUrl(),fieldsUrl:afStudioWSUrls.getModelsUrl(),listeners:{widgetcreated:function(c,d){b.onItemActivate();afStudio.wd.WidgetFactory.showWidgetDesigner(c)}}});a.show()},addNodeModule:function(b){var d=this,a=this.getNodeModule(b),c=this.getNodeApp(b);this.executeAction({url:d.baseUrl,params:{cmd:"addModule",moduleName:a,app:c},loadingMessage:String.format('"{0}" module creation...',a),logMessage:String.format('Widgets: module "{0}" was created',a),run:function(e){this.refreshNode(c,a)},error:function(e){b.remove()}})},renameNodeModule:function(c,d,b){var a={params:{cmd:"renameModule",moduleName:b,renamedModule:d,app:this.getNodeApp(c)},refreshNode:this.getNodeApp(c),msg:"module"};this.renameNode(a,d,b)},renameNodeXml:function(b,c,a){afStudio.Msg.info('Renaming "xml" node',"back-end is not implemented")},renameNode:function(a,c,e){var d=this,b=a.refreshNode?a.refreshNode:this.getRootNode();this.executeAction({url:d.baseUrl,params:a.params,loadingMessage:String.format('Renaming {0} from "{1}" to {2} ...',a.msg,e,c),logMessage:String.format('Widgets: {0} "{1}" was renamed to "{2}"',a.msg,e,c),run:function(f){this.refreshNode(b,c)},error:function(f){node.setText(e)}})},deleteNodeModule:function(b){var a={params:{cmd:"deleteModule",moduleName:this.getNodeModule(b),app:this.getNodeApp(b)},item:b.text,msg:"module"};this.deleteNode(a)},deleteNodeXml:function(a){afStudio.Msg.info('Delete "xml" node',"back-end is not implemented")},deleteNode:function(a){var c=this,b=String.format('Are you sure you want to delete {0} "{1}"?',a.msg,a.item);Ext.Msg.confirm("Plugins",b,function(d){if(d=="yes"){c.executeAction({url:c.baseUrl,params:a.params,loadingMessage:String.format('{0} "{1}" deleting ...',a.msg,a.item),logMessage:String.format('Widgets: {0} "{1}" was deleted',a.msg,a.item),run:function(e){this.loadRootNode(function(){afStudio.vp.clearWorkspace()})}})}})},showWidgetDesignerForNode:function(c){var b=this.getNodeActionPath(c),d=this.getNodeSecurityPath(c),a=c.attributes.widgetUri;afStudio.wd.WidgetFactory.showWidgetDesigner(a,b,d)}});Ext.reg("afStudio.navigation.widgetItem",afStudio.navigation.WidgetItem);afStudio.navigation.PluginItem=Ext.extend(afStudio.navigation.BaseItemTreePanel,{baseUrl:afStudioWSUrls.getPluginsUrl(),branchNodeCfg:{text:"NewPlugin",type:"plugin",allowChildren:true,iconCls:"icon-folder",children:[]},pluginContextMenu:new Ext.menu.Menu({items:[{itemId:"rename-plugin",text:"Rename Plugin",iconCls:"icon-edit"},{itemId:"delete-plugin",text:"Delete Plugin",iconCls:"icon-models-delete"}],listeners:{itemclick:function(c){var b=c.parentMenu.contextNode,a=b.getOwnerTree();switch(c.itemId){case"delete-plugin":a.deleteNodePlugin(b);break;case"rename-plugin":a.treeEditor.triggerEdit(b);break}}}}),moduleContextMenu:new Ext.menu.Menu({items:[{itemId:"rename-module",text:"Rename Module",iconCls:"icon-edit"},{itemId:"delete-module",text:"Delete Module",iconCls:"icon-models-delete"}],listeners:{itemclick:function(c){var b=c.parentMenu.contextNode,a=b.getOwnerTree();switch(c.itemId){case"delete-module":a.deleteNodeModule(b);break;case"rename-module":a.treeEditor.triggerEdit(b);break}}}}),xmlContextMenu:new Ext.menu.Menu({items:[{itemId:"edit-plugin-xml",text:"Edit Page",iconCls:"icon-models-edit"},{itemId:"rename-plugin-xml",text:"Rename Page",iconCls:"icon-edit"},{itemId:"delete-plugin-xml",text:"Delete Page",iconCls:"icon-models-delete"}],listeners:{itemclick:function(c){var b=c.parentMenu.contextNode,a=b.getOwnerTree();switch(c.itemId){case"delete-plugin-xml":a.deleteNodeXml(b);break;case"edit-plugin-xml":a.runNode(b);break;case"rename-plugin-xml":a.treeEditor.triggerEdit(b);break}}}}),_beforeInitComponent:function(){var b=this;var a=new Ext.tree.TreeLoader({url:this.baseUrl,baseParams:{cmd:"get"}});return{title:"Plugins",loader:a,iconCls:"icon-bricks",bbar:{items:["->",{text:"Add plugin",iconCls:"icon-models-add",handler:b.onAddPluginClick,scope:b}]}}},initComponent:function(){Ext.apply(this,Ext.apply(this.initialConfig,this._beforeInitComponent()));afStudio.navigation.PluginItem.superclass.initComponent.apply(this,arguments)},onAddPluginClick:function(){var b=this,a=this.getRootNode();this.addBranchNode(a)},isValidNodeType:function(a){return["plugin","module","xml"].indexOf(a)!=-1},isValidNodeName:function(c,a){var b=this.getNodeAttribute(c,"type");if(["plugin","module"].indexOf(b)!=-1){return this.constructor.superclass.isValidNodeName.call(this,c,a)}else{return/^[^\d]\w*\.xml$/im.test(a)?true:false}},runNode:function(a){this.showWidgetDesignerForNode(a)},onNodeDblClick:function(a,b){if(this.getNodeAttribute(a,"type")=="xml"){this.runNode(a)}},onNodeContextMenu:function(b,c){var f=this,a=this.getNodeAttribute(b,"type");b.select();if(f.isValidNodeType(a)){var d=f[a+"ContextMenu"];d.contextNode=b;d.showAt(c.getXY())}},addNodeController:function(b){var c=this,a=this.getNodeAttribute(b,"type");if(c.isValidNodeType(a)){c["addNode"+a.ucfirst()](b)}},renameNodeController:function(c,d,a){var e=this,b=this.getNodeAttribute(c,"type");if(e.isValidNodeType(b)){e["renameNode"+b.ucfirst()](c,d,a)}},addNodePlugin:function(d){var e=this,a=e.getRootNode(),c=this.getNodeAttribute(d,"text",""),b=this.getNodeAttribute(d,"schema","");this.executeAction({url:e.baseUrl,params:{cmd:"add",plugin:c,schema:b},loadingMessage:String.format('"{0}" plugin creation...',c),logMessage:String.format('Plugins: plugin "{0}" was created',c),run:function(f){this.refreshNode(a,c)}})},addNodeModule:function(a){},addNodeXml:function(a){},renameNodePlugin:function(c,d,b){var a={params:{cmd:"renamePlugin",newValue:d,oldValue:b},msg:"plugin"};this.renameNode(a,d,b)},renameNodeModule:function(c,d,b){var a={params:{cmd:"renameModule",newValue:d,oldValue:b,pluginName:this.getParentNodeAttribute(c,"text")},refreshNode:this.getParentNodeAttribute(c,"text"),msg:"module"};this.renameNode(a,d,b)},renameNodeXml:function(c,d,b){var a={params:{cmd:"renameXml",newValue:d,oldValue:b,pluginName:this.getParentNodeAttribute(c.parentNode,"text"),moduleName:this.getParentNodeAttribute(c,"text")},refreshNode:this.getParentNodeAttribute(c,"text"),msg:"widget"};this.renameNode(a,d,b)},renameNode:function(a,c,e){var d=this,b=a.refreshNode?a.refreshNode:d.getRootNode();this.executeAction({url:d.baseUrl,params:a.params,loadingMessage:String.format('Renaming {0} from "{1}" to {2} ...',a.msg,e,c),logMessage:String.format('Plugins: {0} "{1}" was renamed to "{2}"',a.msg,e,c),run:function(f){this.refreshNode(b,c)},error:function(f){node.setText(e)}})},deleteNodePlugin:function(b){var a={params:{cmd:"deletePlugin",pluginName:b.text},item:b.text,msg:"plugin"};this.deleteNode(a)},deleteNodeModule:function(b){var a={params:{cmd:"deleteModule",pluginName:b.parentNode.text,moduleName:b.text},item:b.text,msg:"module"};this.deleteNode(a)},deleteNodeXml:function(b){var a={params:{cmd:"deleteXml",pluginName:b.parentNode.parentNode.text,moduleName:b.parentNode.text,xmlName:b.text},item:b.text,msg:"widget"};this.deleteNode(a)},deleteNode:function(a){var c=this;var b=String.format('Are you sure you want to delete {0} "{1}"?',a.msg,a.item);Ext.Msg.confirm("Plugins",b,function(d){if(d=="yes"){c.executeAction({url:c.baseUrl,params:a.params,loadingMessage:String.format('{0} "{1}" deleting ...',a.msg,a.item),logMessage:String.format('Plugins: {0} "{1}" was deleted',a.msg,a.item),run:function(e){this.loadRootNode(function(){afStudio.vp.clearWorkspace()})}})}})},showWidgetDesignerForNode:function(c){var b=this.getNodeAttribute(c,"actionPath"),d=this.getNodeAttribute(c,"securityPath"),a=this.getNodeAttribute(c,"widgetUri");afStudio.wd.WidgetFactory.showWidgetDesigner(a,b,d)}});Ext.reg("afStudio.navigation.pluginItem",afStudio.navigation.PluginItem);Ext.namespace("afStudio.viewport");afStudio.viewport.StudioToolbar=Ext.extend(Ext.Toolbar,{initComponent:function(){_self=this;var a={items:[{id:"mstudio",text:"Studio BETA",iconCls:"icon-studio",menu:{ignoreParentClicks:true,items:[{text:"Project",iconCls:"icon-studio-project",listeners:{added:function(b){_self.setProjectMenu(b)},activate:function(b){_self.setProjectMenu(b)}}},{text:"Users",iconCls:"icon-users",hidden:(is_visible_users)?false:true,handler:function(){(new afStudio.UsersList).show()}},{text:"Settings",iconCls:"icon-studio-settings",handler:function(){(new afStudio.Settings()).show()}},"-",{text:"Help",iconCls:"icon-studio-help",handler:function(c,d){(new afStudio.Help()).show()}}]}},{text:"Theme",iconCls:"icon-theme",ignoreParentClicks:true,menu:{items:[{text:"Template Selector",handler:function(){(new afStudio.TemplateSelector()).show()}},{text:"Template Designer",handler:function(c,d){(new afStudio.TemplateDesigner()).show()}}]}},{text:"Tools",iconCls:"icon-tools",menu:{items:[{text:"Console",iconCls:"icon-tools-console",handler:function(){afStudio.Cli.showConsole()}},{text:"DB Query",iconCls:"icon-data",handler:function(c,d){(new afStudio.dbQuery.QueryWindow()).show()}},{text:"Git",iconCls:"icon-tools-git"},{text:"Snapshots",iconCls:"icon-tools-snapshot"}]}},{text:"Debug",iconCls:"icon-debug",menu:{items:[{text:"AuditLog",iconCls:"icon-debug-auditlog",handler:function(){afStudio.Cli.showAuditLog()}},{text:"Debug",iconCls:"icon-debug-run",handler:function(){afStudio.Cli.showDebug()}}]}},{text:"Run",iconCls:"icon-runs",menu:{items:[{text:"Run",iconCls:"icon-run-run",scope:_self,handler:_self.runProject},{text:"Re-build",iconCls:"icon-run-rebuild",handler:function(){afStudio.Msg.info("Re-build button pressed")}}]}},{xtype:"tbfill"},{text:'<img src="/images/famfamfam/user_go.png" border="0">',handler:function(){window.location.href="/afsAuthorize/signout"},tooltip:{text:"Click to log out",title:"admin"}}]};Ext.apply(this,Ext.apply(this.initialConfig,a));afStudio.viewport.StudioToolbar.superclass.initComponent.apply(this,arguments)},setProjectMenu:function(a){var b=afStudio.getRecentProjects();_self=this;if(a.menu){a.menu.removeAll()}else{a.menu=new Ext.menu.Menu({ignoreParentClicks:true})}a.menu.addMenuItem({text:"Create new project",iconCls:"icon-studio-create-project",handler:function(c,d){(new afStudio.CreateProject()).show()}});a.menu.addMenuItem({text:"Load project",iconCls:"icon-studio-load-project",handler:function(c,d){(new afStudio.LoadProject()).show()}});if(b.length>0){a.menu.addSeparator();a.menu.addMenuItem({text:"Recent projects",iconCls:"icon-studio-recent-projects",menu:_self.getRecentProjectsMenu(b)})}a.menu.doLayout()},getRecentProjectsMenu:function(a){recentProjectsMenu=new Ext.menu.Menu();for(key in a){if(a[key].url){recentProjectsMenu.add({text:a[key].text,href:a[key].url})}}return recentProjectsMenu},runProject:function(){var a=window.afStudioWSUrls.getProjectRunUrl();afStudio.vp.mask({msg:"Run command..."});Ext.Ajax.request({url:a,success:function(d,c){afStudio.vp.unmask();var b=Ext.decode(d.responseText);if(b.success){afStudio.updateConsole(b.content);window.open(b.homepage,"runProject")}else{Ext.Msg.alert("Failure",b.content)}},failure:function(c,b){afStudio.vp.unmask();Ext.Msg.alert("Error",String.format("Status code: {0}, message: {1}",c.status,c.statusText))}})}});Ext.reg("afStudio.viewport.studioToolbar",afStudio.viewport.StudioToolbar);Ext.namespace("afStudio.viewport");afStudio.viewport.StudioViewport=Ext.extend(Ext.Viewport,{_beforeInitComponent:function(){var b=new Ext.Panel({id:"north_panel",region:"north",height:32,border:false,bodyStyle:"background-color:#dfe8f6;",items:afStudio.tb});var a=new Ext.Panel({id:"center_panel",region:"center",layout:"fit",margins:{right:5},bodyStyle:"padding: 8px; background-image: url(/appFlowerStudioPlugin/images/bg/backgrond_3.6.2.jpg); background-position: 50% 50%; background-repeat: no-repeat;"});var c=new afStudio.viewport.WestPanel();this.viewRegions={north:b,center:a,west:c};return{id:"studio-viewport",layout:"border",items:[b,c,a]}},initComponent:function(){Ext.apply(this,Ext.apply(this.initialConfig,this._beforeInitComponent()));afStudio.viewport.StudioViewport.superclass.initComponent.apply(this,arguments)},mask:function(a){var c=Ext.isString(a)?a:"Loading, please Wait...",b;if(Ext.isObject(a)){c=a.msg?a.msg:c;b=a.region?a.region:undefined}if(["center","west","north","south"].indexOf(b)!=-1){this.viewRegions[b].body.mask(c,"x-mask-loading")}else{this.el.mask(c,"x-mask-loading")}},unmask:function(a){if(["center","west","north","south"].indexOf(a)!=-1){this.viewRegions[a].body.unmask()}this.el.unmask()},addToWorkspace:function(a,b){var c=this.viewRegions.center;if(b===true){c.removeAll(true)}c.add(a);c.doLayout()},clearWorkspace:function(){var a=this.viewRegions.center;a.removeAll(true)}});afStudio.viewport.WestPanel=Ext.extend(Ext.Panel,{initComponent:function(){var b=userinfo.name||"user";var c=userinfo.username||"user";var a={id:"west_panel",title:"Navigation",region:"west",split:true,layout:"accordion",layoutConfig:{animate:true},width:220,minWidth:220,collapsible:true,activeItem:"models",listeners:{afterlayout:{fn:function(){var d=this.layout.activeItem;d.fireEvent("activate",d)},single:true}},defaults:{border:false},items:[{id:"models",xtype:"afStudio.navigation.modelItem"},{id:"layoutdesigner",xtype:"afStudio.navigation.layoutItem"},{id:"widgets",xtype:"afStudio.navigation.widgetItem"},{id:"plugins",xtype:"afStudio.navigation.pluginItem"},{id:"profile",title:"My Profile",autoScroll:true,iconCls:"user",html:"<div id='westpanel_link'>"+"<div style='background-color:#f8f8f8; border:1px solid #ddd;font-size:11px;'>"+"<b>Welcome, "+b+"</b><br>"+"Username: "+c+"<br>"+"<a href='#'>[Edit My Profile]</a>"+"</div>"+"</div>"}]};Ext.apply(this,Ext.apply(this.initialConfig,a));afStudio.viewport.WestPanel.superclass.initComponent.apply(this,arguments);this._initEvents()},onEditProfileLinkClick:function(){(new afStudio.UserWindow({mode:"edit",username:userinfo.username})).show()},onProfilePanelShow:function(a){a.body.child("A").on("click",this.onEditProfileLinkClick,this)},_initEvents:function(){Ext.getCmp("profile").on("afterrender",this.onProfilePanelShow,this)}});afStudio.viewport.SouthPanel=Ext.extend(Ext.Panel,{_beforeInitComponent:function(){return{region:"south",layout:"fit",height:215,split:true,collapseMode:"mini",items:[]}},initComponent:function(){Ext.apply(this,Ext.apply(this.initialConfig,this._beforeInitComponent()));afStudio.viewport.SouthPanel.superclass.initComponent.apply(this,arguments)}});
/*
 * Ext JS Library 3.3.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.Portal=Ext.extend(Ext.Panel,{layout:"column",autoScroll:true,cls:"x-portal",defaultType:"portalcolumn",initComponent:function(){Ext.ux.Portal.superclass.initComponent.call(this);this.addEvents({validatedrop:true,beforedragover:true,dragover:true,beforedrop:true,drop:true})},initEvents:function(){Ext.ux.Portal.superclass.initEvents.call(this);this.dd=new Ext.ux.Portal.DropZone(this,this.dropConfig)},beforeDestroy:function(){if(this.dd){this.dd.unreg()}Ext.ux.Portal.superclass.beforeDestroy.call(this)}});Ext.reg("portal",Ext.ux.Portal);Ext.ux.Portal.DropZone=Ext.extend(Ext.dd.DropTarget,{constructor:function(a,b){this.portal=a;Ext.dd.ScrollManager.register(a.body);Ext.ux.Portal.DropZone.superclass.constructor.call(this,a.bwrap.dom,b);a.body.ddScrollConfig=this.ddScrollConfig},ddScrollConfig:{vthresh:50,hthresh:-1,animate:true,increment:200},createEvent:function(a,f,d,b,h,g){return{portal:this.portal,panel:d.panel,columnIndex:b,column:h,position:g,data:d,source:a,rawEvent:f,status:this.dropAllowed}},notifyOver:function(x,v,y){var f=v.getXY(),a=this.portal,q=x.proxy;if(!this.grid){this.grid=this.getGrid()}var b=a.body.dom.clientWidth;if(!this.lastCW){this.lastCW=b}else{if(this.lastCW!=b){this.lastCW=b;a.doLayout();this.grid=this.getGrid()}}var d=0,n=this.grid.columnX,o=false;for(var u=n.length;d<u;d++){if(f[0]<(n[d].x+n[d].w)){o=true;break}}if(!o){d--}var s,m=false,j=0,w=a.items.itemAt(d),r=w.items.items,l=false;for(var u=r.length;j<u;j++){s=r[j];var t=s.el.getHeight();if(t===0){l=true}else{if((s.el.getY()+(t/2))>f[1]){m=true;break}}}j=(m&&s?j:w.items.getCount())+(l?-1:0);var g=this.createEvent(x,v,y,d,w,j);if(a.fireEvent("validatedrop",g)!==false&&a.fireEvent("beforedragover",g)!==false){q.getProxy().setWidth("auto");if(s){q.moveProxy(s.el.dom.parentNode,m?s.el.dom:null)}else{q.moveProxy(w.el.dom,null)}this.lastPos={c:w,col:d,p:l||(m&&s)?j:false};this.scrollPos=a.body.getScroll();a.fireEvent("dragover",g);return g.status}else{return g.status}},notifyOut:function(){delete this.grid},notifyDrop:function(n,h,g){delete this.grid;if(!this.lastPos){return}var l=this.lastPos.c,f=this.lastPos.col,m=this.lastPos.p,a=n.panel,b=this.createEvent(n,h,g,f,l,m!==false?m:l.items.getCount());if(this.portal.fireEvent("validatedrop",b)!==false&&this.portal.fireEvent("beforedrop",b)!==false){n.proxy.getProxy().remove();a.el.dom.parentNode.removeChild(n.panel.el.dom);if(m!==false){l.insert(m,a)}else{l.add(a)}l.doLayout();this.portal.fireEvent("drop",b);var o=this.scrollPos.top;if(o){var j=this.portal.body.dom;setTimeout(function(){j.scrollTop=o},10)}}delete this.lastPos},getGrid:function(){var a=this.portal.bwrap.getBox();a.columnX=[];this.portal.items.each(function(b){a.columnX.push({x:b.el.getX(),w:b.el.getWidth()})});return a},unreg:function(){Ext.dd.ScrollManager.unregister(this.portal.body);Ext.ux.Portal.DropZone.superclass.unreg.call(this)}});
/*
 * Ext JS Library 3.3.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.PortalColumn=Ext.extend(Ext.Container,{layout:"anchor",defaultType:"portlet",cls:"x-portal-column"});Ext.reg("portalcolumn",Ext.ux.PortalColumn);
/*
 * Ext JS Library 3.3.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.Portlet=Ext.extend(Ext.Panel,{anchor:"100%",frame:true,collapsible:true,draggable:true,cls:"x-portlet"});Ext.reg("portlet",Ext.ux.Portlet);Ext.ns("afStudio.models");afStudio.models.TypeBuilder=(function(){return{invalidFieldName:'Field name must contain only characters, digits or "_" and start from character or "_"',createEditor:function(b,c,a){var e=null;if(b){var d=b.indexOf("(");if(d!=-1){b=b.substring(0,d)}}switch(b){case"boolean":e=new Ext.grid.GridEditor(new Ext.form.ComboBox({typeAhead:true,triggerAction:"all",lazyRender:true,editable:false,mode:"local",valueField:"field",displayField:"field",store:[[true,"true"],[false,"false"]]}));break;case"char":case"varchar":case"longvarchar":case"timestamp":e=new Ext.grid.GridEditor(new Ext.form.TextField({maxLength:c?c:Number.MAX_VALUE}));break;case"bigint":case"numeric":case"decimal":case"integer":case"smallint":e=new Ext.grid.GridEditor(new Ext.form.NumberField({allowDecimals:false,maxLength:c?c:Number.MAX_VALUE}));break;case"tinyint":e=new Ext.grid.GridEditor(new Ext.form.NumberField({autoCreate:{tag:"input",type:"text",size:"20",autocomplete:"off",maxlength:3},maxValue:255,allowDecimals:false,maxLength:c?c:3}));break;case"real":case"float":case"double":e=new Ext.grid.GridEditor(new Ext.form.NumberField({decimalPrecision:6,maxLength:c?c:Number.MAX_VALUE}));break;case"date":e=new Ext.grid.GridEditor(new Ext.form.DateField());break;case"time":e=new Ext.grid.GridEditor(new Ext.form.TimeField());break;case"binary":case"varbinary":case"longvarbinary":case"blob":case"clob":e=new Ext.grid.GridEditor(new Ext.form.DisplayField());break}if(e){e.on("beforecomplete",function(h,g,f){if(b=="boolean"){a=a?true:false}g=g?g:a;h.setValue(g)})}return e?e:null},createRenderer:function(a){var b=null;switch(a){case"bigint":case"numeric":case"decimal":case"integer":case"smallint":b=function(c,d){d.attr='style="text-align:right;"';return Ext.util.Format.number(c,"0.0,/i")};break;default:b=function(c){return c};break}return b}}})();Ext.ns("afStudio.models");afStudio.models.RelationPicker=Ext.extend(Ext.Window,{closePicker:function(){if(this.closeAction=="hide"){this.hide()}else{this.close()}},pickRelation:function(){var e=this,d=this.modelsTree.getSelectionModel().getSelectedNode(),b=this.fieldsGrid.getSelectionModel().getSelected(),a=this.modelsTree.getModel(d),c=b.get("name");this.closePicker();this.fireEvent("relationpicked",a+"."+c)},initialRelationPick:function(b){var c=this,a=b.split(".");(function(){var d=c.modelsTree.findModelByName(a[0]);if(d){c.modelsTree.selectModel(d);c.fieldsGrid.show();c.loadModelFields(d,function(f){if(a[1]){for(var g=0,e=f.length;g<e;g++){if(f[g].get("name")==a[1]){c.fieldsGrid.getSelectionModel().selectRecords([f[g]],false);break}}}})}else{c.fieldsGrid.getStore().removeAll();c.modelsTree.getSelectionModel().clearSelections()}}).defer(300)},loadModelFields:function(b,d){var c=this.modelsTree.getSchema(b),a=this.modelsTree.getModel(b);this.fieldsGrid.getStore().load({params:{schema:c,model:a},callback:d||Ext.emptyFn})},onModelClick:function(a,b){this.fieldsGrid.show();this.loadModelFields(a)},onModelsLoad:function(a,b){this.fieldsGrid.getStore().removeAll();this.fieldsGrid.hide()},onFieldsSelectionChange:function(b){var a=this.getFooterToolbar().getComponent("pick-relation");b.hasSelection()?a.enable():a.disable()},initComponent:function(){Ext.apply(this,Ext.apply(this.initialConfig,this._initCmp()));afStudio.models.RelationPicker.superclass.initComponent.apply(this,arguments);this._initEvents()},_initCmp:function(){var b=this;var a=new Ext.grid.GridPanel({store:new Ext.data.JsonStore({autoLoad:false,url:b.fieldsUrl,baseParams:{xaction:"read"},root:"rows",idProperty:"id",fields:["id","name","type","size","required"]}),sm:new Ext.grid.RowSelectionModel({singleSelect:true}),columns:[{header:"Name",sortable:true,width:150,dataIndex:"name"},{header:"Type",sortable:true,width:110,dataIndex:"type"},{header:"Size",sortable:true,width:60,dataIndex:"size"}],loadMask:true,border:false,autoScroll:true,hidden:true,ref:"../fieldsGrid"});return{title:"Relation Picker",iconCls:"icon-table-relationship",modal:true,width:600,height:400,maximizable:true,plain:true,layout:"border",items:[{region:"west",layout:"fit",width:220,items:[{id:"models-picker",xtype:"afStudio.models.modelTree",url:b.modelsUrl,border:false,ref:"../modelsTree"}]},{region:"center",layout:"fit",items:[a]}],buttons:[{itemId:"pick-relation",text:"ok",disabled:true,iconCls:"icon-accept",handler:Ext.util.Functions.createDelegate(b.pickRelation,b)}]}},_initEvents:function(){var d=this,c=this.modelsTree,a=this.fieldsGrid,b=a.getSelectionModel();d.addEvents("relationpicked");c.on({click:Ext.util.Functions.createDelegate(d.onModelClick,d),modelsload:Ext.util.Functions.createDelegate(d.onModelsLoad,d)});b.on({selectionchange:Ext.util.Functions.createDelegate(d.onFieldsSelectionChange,d)})}});Ext.ns("afStudio.models");N=afStudio.models;N.RelationCombo=Ext.extend(Ext.form.ComboBox,{_beforeInitComponent:function(){var b=this;var a=new Ext.data.JsonStore({url:b.relationUrl,baseParams:{xaction:"readrelation"},root:"data",fields:["id","value"]});return{maskRe:/[\w\.]/,triggerClass:"x-form-relation-trigger",typeAhead:true,lazyRender:true,queryParam:"query",mode:"remote",minChars:1,editable:true,forceSelection:true,store:a,valueField:"id",displayField:"value",hiddenName:"relation",name:"relation"}},initComponent:function(){Ext.apply(this,Ext.applyIf(this.initialConfig,this._beforeInitComponent()));afStudio.models.RelationCombo.superclass.initComponent.apply(this,arguments)},initEvents:function(){afStudio.models.RelationCombo.superclass.initEvents.apply(this,arguments);this.keyNav.down=function(a){if(!this.isExpanded()){}else{this.inKeyMode=true;this.selectNext()}return false};this.keyNav.enter=function(f){var d=this.getRawValue(),a=this.view.getSelectedIndexes()[0],b=this.store,c=b.getAt(a);if(d.indexOf(".")==-1){if(c){this.setRawValue(c.get(this.initialConfig.displayField)+".");this.doQuery(c.get(this.initialConfig.displayField)+".")}}else{this.onViewClick()}}},createRelationPicker:function(){var a=this;a.relationPicker=new afStudio.models.RelationPicker({modelsUrl:window.afStudioWSUrls.getModelsUrl(),fieldsUrl:window.afStudioWSUrls.getModelsUrl(),closable:true,closeAction:"hide",listeners:{relationpicked:function(c){if(a.fieldsGrid){var b=a.fieldsGrid.getSelectionModel().getSelectedCell();a.fieldsGrid.startEditing(b[0],b[1]);if(c){a.setValue(c)}a.fieldsGrid.stopEditing()}else{a.setValue(c)}}}})},onTriggerClick:function(a){if(this.readOnly||this.disabled){return}if(this.isExpanded()){this.collapse();this.el.focus()}if(!this.relationPicker){this.createRelationPicker()}if(this.fieldsGrid){this.fieldsGrid.stopEditing()}var b=this;this.relationPicker.show(null,function(){this.initialRelationPick(b.getRawValue()||b.getValue())})}});Ext.reg("relationcombo",N.RelationCombo);delete N;Ext.ns("afStudio.models");afStudio.models.TreeEditor=Ext.extend(Ext.tree.TreeEditor,{beforeNodeClick:function(a,b){}});afStudio.models.ModelTree=Ext.extend(Ext.tree.TreePanel,{url:window.afStudioWSUrls.getModelsUrl(),maskModelTree:function(a){this.body.mask(a?a:"Loading, please Wait...","x-mask-loading")},unmaskModelTree:function(){this.body.unmask()},selectModel:function(a){this.selectPath(a.getPath())},findModelByName:function(a){return this.getRootNode().findChild("text",a)},reloadModels:function(a){if(Ext.isFunction(a)){this.getRootNode().reload(a)}else{this.getRootNode().reload()}},refreshModels:function(d,b,c,a){this.reloadModels()},getSchema:function(a){return a.attributes.schema||undefined},getModel:function(a){return a.text},onModelClick:function(a,b){},onModelDbClick:Ext.emptyFn,onLoaderBeforeLoad:function(a,b,c){this.maskModelTree()},onLoaderLoad:function(a,c,b){this.unmaskModelTree();this.fireEvent("modelsload",a,b)},onLoaderLoadException:function(a,c,b){this.unmaskModelTree()},_beforeInitComponent:function(){var d=this;var b=new Ext.tree.AsyncTreeNode({path:"root",text:"ModelRoot",draggable:false});var c=[{id:"refresh",handler:Ext.util.Functions.createDelegate(d.refreshModels,d)}];var a=new Ext.tree.TreeLoader({url:this.modelsUrl||this.url,baseParams:{cmd:"get"}});return{title:"Models",loader:a,iconCls:"icon-models",autoScroll:true,method:"post",root:b,rootVisible:false,tools:c}},initComponent:function(){Ext.apply(this,Ext.apply(this.initialConfig,this._beforeInitComponent()));afStudio.models.ModelTree.superclass.initComponent.apply(this,arguments);this._initEvents()},_initEvents:function(){var a=this;a.addEvents("modelsload");a.on({dblclick:Ext.util.Functions.createDelegate(a.onModelDbClick,a),afterrender:function(){a.loader.on({beforeload:Ext.util.Functions.createDelegate(a.onLoaderBeforeLoad,a),load:Ext.util.Functions.createDelegate(a.onLoaderLoad,a),loadexception:Ext.util.Functions.createDelegate(a.onLoaderLoadException,a)})}});a.root.expand()}});Ext.reg("afStudio.models.modelTree",afStudio.models.ModelTree);Ext.ns("afStudio.models");afStudio.models.FieldsGrid=Ext.extend(Ext.grid.EditorGridPanel,{saveModel:function(){var e=this,c=e.getStore(),b=c.proxy.url,a=c.getRange(),d=[];Ext.each(a,function(g,f){d.push(g.data)});afStudio.vp.mask({region:"center",msg:"Altering "+e.model+" model..."});Ext.Ajax.request({url:b,params:{xaction:"alterModel",model:e.model,schema:e.schema,fields:Ext.encode(d)},success:function(j,g){if(e.ownerCt&&e.ownerCt._node){var h="model "+e.ownerCt._node.text+" Config Saved"}else{var h="model Config Saved"}e.fireEvent("logmessage",e,h);var f=Ext.decode(j.responseText);afStudio.vp.unmask("center");if(f.success){c.commitChanges();e.fireEvent("altermodel")}else{e.fireEvent("altermodelexception",j);Ext.Msg.alert("Warning",f.message)}},failure:function(g,f){afStudio.vp.unmask("center");e.fireEvent("altermodelfailure",g);Ext.Msg.alert("Failure","Status: "+g.status)}})},insertAfterField:function(){var d=this,a=d.getSelectionModel().getSelectedCell(),c=a?a[0]+1:0;var b=new d.store.recordType({name:"",type:"INT",size:"11",required:false});d.stopEditing();d.store.insert(c,b);d.startEditing(c,a?a[1]:0)},insertBeforeField:function(){var d=this,a=d.getSelectionModel().getSelectedCell(),c=a?a[0]:0;var b=new d.store.recordType({name:"",type:"INT",size:"11",required:false});d.stopEditing();d.store.insert(c,b);d.startEditing(c,a?a[1]:0)},deleteField:function(){var c=this,a=c.getSelectionModel().getSelectedCell();if(a){var b=c.store.getAt(a[0]);c.store.remove(b)}},booleanEditorBuilder:function(){return{editor:new Ext.form.ComboBox({typeAhead:true,triggerAction:"all",lazyRender:true,editable:false,mode:"local",valueField:"field",displayField:"field",store:[[true,"true"],[false,"false"]]}),renderer:function(b,c,a){c.css+=" x-grid3-check-col-td";return'<div class="x-grid3-check-col'+(b?"-on":"")+'"> </div>'}}},typeEditorBuilder:function(){return{editor:new afStudio.models.TypeComboBox({lazyRender:true})}},nameEditorBuilder:function(){var b=this,a=[];return{editor:new Ext.form.TextField({allowBlank:false,maskRe:/[\w]/,validator:function(c){return/^[^\d]\w*$/im.test(c)?true:afStudio.models.TypeBuilder.invalidFieldName}})}},loadModelData:function(a){this.getStore().loadData(a)},_beforeInitComponent:function(){var f=this;function a(g,h){return h.primaryKey?"primary":(h.index=="unique"?"unique":(h.index?"index":null))}function d(g,h){return(h.foreignModel&&h.foreignReference)?h.foreignModel+"."+h.foreignReference:null}var e=new Ext.data.JsonStore({url:window.afStudioWSUrls.getModelsUrl(),autoLoad:false,baseParams:{xaction:"read",model:f.model,schema:f.schema},storeId:"model-fields-st",root:"rows",idProperty:"id",fields:[{name:"id"},{name:"key",mapping:"id",convert:a},{name:"relation",mapping:"id",convert:d},{name:"autoIncrement"},{name:"primaryKey"},{name:"index"},{name:"name"},{name:"type"},{name:"size"},{name:"required"},{name:"default"},{name:"foreignTable"},{name:"foreignModel"},{name:"foreignReference"},{name:"onDelete"}]});var c=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:'<div class="model-pk-hd">&#160;</div>',width:25,dataIndex:"key",editor:new Ext.form.ComboBox({typeAhead:true,triggerAction:"all",lazyRender:true,editable:false,mode:"local",valueField:"field",displayField:"field",store:[["","None"],["primary","Primary"],["index","Index"],["unique","Unique"]]}),renderer:function(n,h,g,o,l,j){var m="";switch(n){case"primary":m='<div class="pk-cell">&#160;</div>';break;case"index":m='<div class="index-cell">&#160;</div>';break;case"unique":m='<div class="unique-cell">&#160;</div>';break}return m}},{header:"Name",width:100,dataIndex:"name",editor:f.nameEditorBuilder().editor},{header:"Type",width:100,dataIndex:"type",editor:f.typeEditorBuilder().editor},{header:"Size",width:50,dataIndex:"size",editor:new Ext.form.NumberField({allowDecimals:false,allowNegative:false})},{header:"Autoincrement",width:55,dataIndex:"autoIncrement",editor:f.booleanEditorBuilder().editor,renderer:f.booleanEditorBuilder().renderer},{header:"Default value",width:100,dataIndex:"default",editor:new Ext.form.TextField()},{header:"Relation",width:150,sortable:true,dataIndex:"relation",editor:new afStudio.models.RelationCombo({relationUrl:window.afStudioWSUrls.getModelsUrl(),fieldsGrid:f})},{header:"Required",width:50,sortable:true,dataIndex:"required",align:"center",editor:f.booleanEditorBuilder().editor,renderer:f.booleanEditorBuilder().renderer},{header:"On Delete",width:50,sortable:true,dataIndex:"onDelete",align:"center",editor:new Ext.form.ComboBox({typeAhead:true,triggerAction:"all",lazyRender:true,editable:false,mode:"local",valueField:"field",displayField:"field",value:"none",store:[["cascade","cascade"],["setnull","setnull"],["restrict","restrict"],["none","none"]]})}]});var b=new Ext.Toolbar({items:[{text:"Save",iconCls:"icon-save",handler:Ext.util.Functions.createDelegate(f.saveModel,f)},"-",{text:"Insert",iconCls:"icon-add",menu:{items:[{text:"Insert after",handler:Ext.util.Functions.createDelegate(f.insertAfterField,f)},{text:"Insert before",handler:Ext.util.Functions.createDelegate(f.insertBeforeField,f)}]}},"-",{text:"Delete",iconCls:"afs-icon-delete",handler:Ext.util.Functions.createDelegate(f.deleteField,f)}]});return{title:"Model Config",iconCls:"icon-table-gear",clicksToEdit:1,store:e,colModel:c,columnLines:true,loadMask:true,autoScroll:true,tbar:b,viewConfig:{forceFit:true},plugins:["cellEditorBuilder"]}},initComponent:function(){Ext.apply(this,Ext.apply(this.initialConfig,this._beforeInitComponent()));afStudio.models.FieldsGrid.superclass.initComponent.apply(this,arguments);this._afterInitComponent()},_afterInitComponent:function(){var c=this,b=c.getStore(),a=c.getColumnModel();c.addEvents("altermodel","altermodelexception","altermodelfailure");c.loadModelData(c._data)}});Ext.reg("afStudio.models.fieldsGrid",afStudio.models.FieldsGrid);Ext.ns("afStudio.models");Ext.override(Ext.form.Field,{initEvents:function(){this.mon(this.el,Ext.EventManager.getKeyEvent(),this.fireKey,this);this.mon(this.el,"focus",this.onFocus,this);this.mon(this.el,"blur",this.onBlur,this,this.inEditor?{buffer:10}:null)}});afStudio.models.modelGridView=Ext.extend(Ext.grid.GridView,{beforeColMenuShow:function(){var a=this.cm,c=a.getColumnCount();this.colMenu.removeAll();for(var b=0;b<c;b++){if(a.config[b].fixed!==true&&a.config[b].hideable!==false&&!a.config[b].uninit){this.colMenu.add(new Ext.menu.CheckItem({itemId:"col-"+a.getColumnId(b),text:a.getColumnHeader(b),checked:!a.isHidden(b),hideOnClick:false,disabled:a.config[b].hideable===false}))}}},afterRenderUI:function(){var a=this.grid;this.initElements();Ext.fly(this.innerHd).on("click",this.handleHdDown,this);this.mainHd.on({scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut,mousemove:this.handleHdMove});this.scroller.on("scroll",this.syncScroll,this);if(a.enableColumnResize!==false){this.splitZone=new Ext.grid.GridView.SplitDragZone(a,this.mainHd.dom)}if(a.enableColumnMove){this.columnDrag=new Ext.grid.GridView.ColumnDragZone(a,this.innerHd);this.columnDrop=new Ext.grid.HeaderDropZone(a,this.mainHd.dom)}var b=a;if(b.enableHdMenu!==false){this.hmenu=new Ext.menu.Menu({id:b.id+"-hctx",show:function(d,e,c){this.parentMenu=c;if(!this.el){this.render()}this.fireEvent("beforeshow",this);this._el=d;this.showAt(this.el.getAlignToXY(d,e||this.defaultAlign),c,false)}});this.colMenu=new Ext.menu.Menu({id:b.id+"-hcols-menu"});this.colMenu.on("beforeshow",this.beforeColMenuShow,this);this.colMenu.on("itemclick",this.columnMenuClick,this);this.hmenu.add({itemId:"asc",text:this.sortAscText,cls:"xg-hmenu-sort-asc"},{itemId:"desc",text:this.sortDescText,cls:"xg-hmenu-sort-desc"},"-",{itemId:"addfb",text:"Add Field Before"},{itemId:"addfa",text:"Add Field After"},"-",{itemId:"dupb",text:"Duplicate Field"},{itemId:"editb",text:"Edit Field ..."},{itemId:"renameb",text:"Rename Field"},{itemId:"deletef",text:"Delete Field"},"-",{itemId:"columns",hideOnClick:false,text:this.columnsText,menu:this.colMenu,iconCls:"x-cols-icon"});this.hmenu.on("itemclick",this.handleHdMenuClick,this)}if(a.trackMouseOver){this.mainBody.on({scope:this,mouseover:this.onRowOver,mouseout:this.onRowOut})}if(a.enableDragDrop||a.enableDrag){this.dragZone=new Ext.grid.GridDragZone(a,{ddGroup:a.ddGroup||"GridDD"})}this.updateHeaderSortState()},columnMenuClick:function(c){var b=this.hdCtxIndex,a=this.cm,d=this.ds;b=a.getIndexById(c.itemId.substr(4));if(b!=-1){if(c.checked&&a.getColumnsBy(this.isHideableColumn,this).length<=2){this.onDenyColumnHide();return false}a.setHidden(b,c.checked)}return true},getUninitColumn:function(){for(var a=0;a<this.cm.config.length;a++){var b=this.cm.config[a];if(b.uninit){return a}}return 0},createDupheader:function(e){for(var c=1;c<=this.cm.config.length;c++){var d=e+c;var a=true;for(var b=0;b<this.cm.config.length;b++){if(d==this.cm.getColumnHeader(b)){a=false;break}}if(a){return d}}return e+(this.cm.config+1)},handleHdMenuClick:function(l){var f=this.hdCtxIndex,h=this.cm,b=this.ds;switch(l.itemId){case"asc":b.sort(h.getDataIndex(f),"ASC");break;case"desc":b.sort(h.getDataIndex(f),"DESC");break;case"addfa":var g=this.getUninitColumn();this.cm.config[g].uninit=false;this.cm.moveColumn(g,f+1);this.cm.setHidden(f+1,false);break;case"addfb":var g=this.getUninitColumn();this.cm.config[g].uninit=false;this.cm.moveColumn(g,f);this.cm.setHidden(f,false);break;case"dupb":var g=this.getUninitColumn();this.cm.config[g].uninit=false;this.cm.moveColumn(g,f+1);var c=this.cm.getColumnHeader(f);this.cm.setColumnHeader(f+1,this.createDupheader(c));this.cm.setHidden(f+1,false);break;case"renameb":var d=this.findHeaderCell(l.parentMenu._el);this.editHeadColumn(d.firstChild,f);break;case"editb":var a=h.config[f].fieldDefinition||{};if(!l.renameWindow){l.renameWindow=new afStudio.models.EditFieldWindow({gridView:this})}l.renameWindow.fieldDefinition=a;l.renameWindow.fieldIndex=f;l.renameWindow.show(l.el);break;case"deletef":var j=h.getColumnCount(true);if(j>2){h.setHidden(f,true);h.config[f].uninit=true;h.config[f].header=this.grid.defautHeaderTitle}break;case"ctext":var e=this.grid.createEditer();h.config[f].editor=e;break;case"ccheckbox":var e=this.grid.createEditer(new Ext.form.Checkbox());h.config[f].editor=e;break;case"cchoice":var e=this.grid.createEditer(new Ext.form.ComboBox({typeAhead:true,triggerAction:"all",lazyRender:true,mode:"local",valueField:"field",displayField:"field",store:new Ext.data.ArrayStore({fields:["field"],data:[]})}));e.on("beforestartedit",function(s,m,u){var n=s.field.store;var v=this.grid.store;n.removeAll();var o=[];for(var q=0;q<v.getCount();q++){var r=v.getAt(q);var u=r.get(h.getDataIndex(f));if(u==""||u==null){continue}var t=true;for(var p=0;p<o.length;p++){if(o[p][0]==u){t=false;break}}if(t){o.push([u])}}n.loadData(o);return true},this);h.config[f].editor=e;break;case"cdate":var e=this.grid.createEditer(new Ext.form.DateField());e.getValue=function(){var m=this.field.getValue();return m.format("m/d/Y")};h.config[f].editor=e;break;case"cpassword":var e=this.grid.createEditer(new Ext.form.TextField({inputType:"password"}));h.config[f].editor=e;h.config[f].renderer=function(m){return"XXXX"};break;case"cnumber":var e=this.grid.createEditer(new Ext.form.NumberField());h.config[f].align="right";h.config[f].editor=e;break;case"ccurrency":var e=this.grid.createEditer(new Ext.form.NumberField());h.config[f].editor=e;h.config[f].align="right";h.config[f].renderer=Ext.util.Format["usMoney"];break;case"ctime":var e=this.grid.createEditer(new Ext.form.TimeField());h.config[f].editor=e;break;case"cemail":var e=this.grid.createEditer(new Ext.form.TextField({vtype:"email"}));h.config[f].editor=e;break;case"cphonenumber":var e=this.grid.createEditer(new Ext.form.NumberField({maxLength:12}));h.config[f].editor=e;break;case"crate":var e=this.grid.createEditer(new Ext.form.SliderField({minValue:0,maxValue:5}));h.config[f].editor=e;break;default:}return true},showNextColumn:function(b){var a=this.cm;if(b<=this.grid.maxColumns){a.setHidden(b+1,false);a.config[b+1].uninit=false}},headEditComplete:function(d,c,b){var e=d._index,a=this.cm;a.setColumnHeader(e,c);if(a.config[e].fieldDefinition){a.config[e].fieldDefinition.name=c}},editHeadColumn:function(d,b){var a=new Ext.grid.GridEditor(new Ext.form.TextField({allowBlank:false,maskRe:/[\w]/,validator:function(f){return/^[^\d]\w*$/im.test(f)?true:afStudio.models.TypeBuilder.invalidFieldName}}));a._index=b;a.on({scope:this,complete:this.headEditComplete});a.startEdit(d,this.cm.getColumnHeader(b));var e=true;for(var c=b+1;c<this.grid.maxColumns;c++){if(!this.cm.isHidden(c)){e=false;break}}if(e){this.showNextColumn(b)}},handleHdDown:function(g,d){var f=this.findHeaderCell(d);if(!f){return}var c=this.getCellIndex(f);if(Ext.fly(d).hasClass("x-grid3-hd-btn")){g.stopEvent();Ext.fly(f).addClass("x-grid3-hd-menu-open");this.hdCtxIndex=c;var b=this.hmenu.items,a=this.cm;this.hmenu.on("hide",function(){Ext.fly(f).removeClass("x-grid3-hd-menu-open")},this,{single:true});this.hmenu.show(d,"tl-bl?")}else{this.editHeadColumn(f.firstChild,c)}}});var _modelEditerEnterFlag=0;afStudio.models.ExcelGridPanel=Ext.extend(Ext.grid.EditorGridPanel,{maxColumns:20,defautHeaderTitle:"new field",createEditer:function(b){var a=b?b:new Ext.form.TextField();return new Ext.grid.GridEditor(a,{completeOnEnter:false,listeners:{specialkey:function(d,c){if(c.getKey()==c.ENTER){_modelEditerEnterFlag=1;this.completeEdit()}}}})},beforeInit:function(){var f=[new Ext.grid.RowNumberer()];var b=[];for(var e=0;e<this.maxColumns;e++){var g=true;if(e==0){g=false}f.push({header:this.defautHeaderTitle,dataIndex:"c"+e,width:80,hidden:g,uninit:g,editor:new Ext.grid.GridEditor(new Ext.form.TextField(),{completeOnEnter:false,listeners:{specialkey:function(l,j){if(j.getKey()==j.ENTER){_modelEditerEnterFlag=1;this.completeEdit()}}}})});b.push({name:"c"+e})}if(this.columns){var a=new Ext.grid.ColumnModel(this.columns)}else{var a=new Ext.grid.ColumnModel(f)}if(this.store){var c=this.store;if(this.store.getCount()==0){var h=this.store.recordType;this.store.add([new h()])}}else{var c=new Ext.data.SimpleStore({fields:b,data:[[""]]})}var d={autoScroll:true,store:c,cm:a,columnLines:true,clicksToEdit:1,view:new afStudio.models.modelGridView(),listeners:{afteredit:function(n){var p=n.row+1;var m=this.store.getCount();if(m==p){var o=c.recordType;c.add([new o()])}var l=n.column;if(this.getColumnModel().getColumnCount(true)==(l+1)&&l<this.maxColumns){this.getView().showNextColumn(l)}if(_modelEditerEnterFlag){var j=new Ext.util.DelayedTask(function(r,q){this.startEditing(r,q);_modelEditerEnterFlag=0},this,[p,l]);j.delay(100)}}}};Ext.apply(this,Ext.apply(this.initialConfig,d))},afterInit:Ext.emptyFn,initComponent:function(){this.beforeInit();afStudio.models.ExcelGridPanel.superclass.initComponent.apply(this,arguments);this.afterInit()}});afStudio.models.ModelGrid=Ext.extend(afStudio.models.ExcelGridPanel,{recordsPerPage:25,beforeInit:function(){var g=this,e=g._data.rows,a=["id"];if(e.length>0){var d=[new Ext.grid.RowNumberer()];for(var c=0;c<e.length;c++){d.push({header:e[c].name,dataIndex:"c"+c,width:80,hidden:false,editor:afStudio.models.TypeBuilder.createEditor(e[c].type,e[c].size,e[c]["default"]),renderer:afStudio.models.TypeBuilder.createRenderer(e[c].type),fieldDefinition:Ext.apply(e[c],{exists:true})});a.push({name:"c"+c})}for(var c=d.length-1;c<=this.maxColumns;c++){d.push({header:this.defautHeaderTitle,dataIndex:"c"+c,uninit:true,width:80,hidden:true,editor:afStudio.models.TypeBuilder.createEditor(),fieldDefinition:{name:g.defautHeaderTitle,exists:false}});a.push({name:"c"+c})}}g.store=new Ext.data.Store({reader:new afStudio.models.modelGridPanelReader({root:"rows",idProperty:"id"},a),proxy:g.storeProxy,writer:new Ext.data.JsonWriter({encode:false,listful:true}),autoSave:false,listeners:{load:function(j,h){var l=j.recordType;j.add([new l()])}}});g.store.load({params:{start:0,limit:g.recordsPerPage}});g.columns=d;afStudio.models.ModelGrid.superclass.beforeInit.apply(this,arguments);var f=new Ext.PagingToolbar({store:g.store,displayInfo:true,displayMsg:"Displaying records {0} - {1} of {2}",pageSize:g.recordsPerPage});var b={iconCls:"icon-database-table",loadMask:true,clicksToEdit:1,columnLines:true,viewConfig:{forceFit:true},tbar:[{text:"Save",iconCls:"icon-save",handler:function(h,l){this.getStore().save();if(this.ownerCt&&this.ownerCt._node){var j="model "+this.ownerCt._node.text+" Saved"}else{var j="model Saved"}this.fireEvent("logmessage",this,j)},scope:this},"-",{text:"Insert",iconCls:"icon-add",menu:{items:[{text:"Insert after",handler:Ext.util.Functions.createDelegate(g.insertAfterField,g)},{text:"Insert before",handler:Ext.util.Functions.createDelegate(g.insertBeforeField,g)}]}},"-",{text:"Delete",iconCls:"afs-icon-delete",handler:function(j,m){var h=this.getSelectionModel().getSelectedCell();if(h){var l=this.store.getAt(h[0]);this.store.remove(l)}},scope:this}],bbar:f};Ext.apply(this,Ext.apply(this.initialConfig,b))},afterInit:function(){afStudio.models.ModelGrid.superclass.afterInit.apply(this,arguments);this.addEvents("alterfield","alterfieldexception","alterfieldfailure","logmessage")},insertAfterField:function(c,g){var h=this,a=h.getSelectionModel().getSelectedCell(),f=a?a[0]+1:this.store.getCount();var d=new h.store.recordType({name:"",type:"INT",size:"11",required:false});h.stopEditing();h.store.insert(f,d);h.startEditing(f,a?a[1]:0)},insertBeforeField:function(){var d=this,a=d.getSelectionModel().getSelectedCell(),c=a?a[0]:0;var b=new d.store.recordType({name:"",type:"INT",size:"11",required:false});d.stopEditing();d.store.insert(c,b);d.startEditing(c,a?a[1]:0)},onEditComplete:function(b,d,a){this.editing=false;this.lastActiveEditor=this.activeEditor;this.activeEditor=null;var c=b.record,g=this.colModel.getDataIndex(b.col);d=this.postEditValue(d,a,c,g);if(this.forceValidation===true||String(d)!==String(a)){var f={grid:this,record:c,field:g,originalValue:a,value:d,row:b.row,column:b.col,cancel:false};if(this.fireEvent("validateedit",f)!==false&&!f.cancel&&String(d)!==String(a)){c.set(g,f.value);delete f.cancel;this.fireEvent("afteredit",f)}}this.view.focusCell(b.row,b.col)}});afStudio.models.modelGridPanelReader=Ext.extend(Ext.data.JsonReader,{realize:function(a,d){if(Ext.isArray(a)){var b=[];var c=[];for(i=0;i<a.length;i++){if(d[i]["id"]!=null){b.push(a[i]);c.push(d[i])}}return afStudio.models.modelGridPanelReader.superclass.realize.call(this,b,c)}else{return afStudio.models.modelGridPanelReader.superclass.realize.call(this,a,d)}}});Ext.reg("afStudio.models.modelGrid",afStudio.models.ModelGrid);Ext.ns("afStudio.models");afStudio.models.EditFieldWindow=Ext.extend(Ext.Window,{maskWindow:function(a){this.bwrap.mask(a?a:"loading...")},unmaskWindow:function(){this.bwrap.unmask()},updateFieldDefinition:function(c){var d=this,b=d.fieldIndex,a=d.gridView.cm;a.setColumnHeader(b,c.name);a.config[b].editor=afStudio.models.TypeBuilder.createEditor(c.type,Ext.util.Format.trim(c.size),c["default"]);a.config[b].renderer=afStudio.models.TypeBuilder.createRenderer(c.type);d.gridView.refresh();a.config[b].fieldDefinition.name=c["name"];a.config[b].fieldDefinition.type=c.type;a.config[b].fieldDefinition.size=Ext.util.Format.trim(c.size);a.config[b].fieldDefinition.required=c["required"];a.config[b].fieldDefinition["default"]=c["default"];a.config[b].fieldDefinition.autoIncrement=c["autoIncrement"];a.config[b].fieldDefinition.key=c["key"];a.config[b].fieldDefinition.relation=c["relation"];a.config[b].fieldDefinition.onDelete=c["onDelete"]},doFieldAction:function(f){var g=this,d=g.gridView.grid,b=d.model,e=d.schema,a,c;switch(f.action){case"update":a=window.afStudioWSUrls.getModelsUrl();c="alterModelUpdateField";break;case"create":a=window.afStudioWSUrls.getModelsUrl();c="alterModelCreateField";break}g.maskWindow();Ext.Ajax.request({url:a,params:{xaction:c,model:b,field:f.field,schema:e,fieldDef:Ext.encode(f.fieldData)},success:function(l,j){var h=Ext.decode(l.responseText);g.unmaskWindow();if(h.success){g.updateFieldDefinition(f.fieldData);Ext.isFunction(f.callback)?f.callback():null;d.fireEvent("alterfield")}else{d.fireEvent("alterfieldexception",l);Ext.Msg.alert("Warning",h.message)}},failure:function(j,h){g.unmaskWindow();d.fireEvent("alterfieldfailure",j);Ext.Msg.alert("Failure","Status: "+j.status)}})},updateModelField:function(b,a){var c=this;this.doFieldAction({action:"update",field:b,fieldData:a,callback:Ext.util.Functions.createDelegate((function(){this.closeEditFieldWindow()}),c)})},createModelField:function(d){var e=this,c=e.fieldDefinition,b=e.fieldIndex,a=e.gridView.cm;this.doFieldAction({action:"create",fieldData:d,callback:Ext.util.Functions.createDelegate((function(){a.config[b].fieldDefinition.exists=true;this.closeEditFieldWindow()}),e)})},closeEditFieldWindow:function(){if(this.closeAction=="hide"){this.hide()}else{this.close()}},saveUpdates:function(){var g=this,c=g.fieldDefinition,b=g.fieldIndex,a=g.gridView.cm,e=c.exists,d=g.fieldForm.getForm();if(d.isValid()){var f=d.getFieldValues();if(e){g.updateModelField(c.name,f)}else{g.createModelField(f)}}},cancelEditing:function(){this.closeEditFieldWindow()},loadFieldData:function(){var e=this,b=e.fieldDefinition,d=e.gridView,c=e.fieldForm.getForm();c.loadRecord(new Ext.data.Record(b));if(b.foreignModel){c.findField("relation").setValue(b.foreignModel+"."+b.foreignReference)}var a="";if(b.key){a=b.key}else{if(b.primaryKey||b.index||b.index){a=b.primaryKey?"primary":(b.index=="unique"?"unique":(b.index?"index":""))}}c.findField("key").setValue(a)},onShowEvent:function(){var b=this,a=this.fieldForm;a.getForm().reset();a.getComponent("fields-tab").setActiveTab(0);b.loadFieldData()},_beforeInitComponent:function(){var b=this;var a=new Ext.FormPanel({ref:"fieldForm",baseCls:"x-plain",style:"padding: 5px",border:false,labelWidth:100,defaults:{width:230,msgTarget:"qtip"},items:[{xtype:"textfield",fieldLabel:"Name",allowBlank:false,maskRe:/[\w]/,validator:function(c){return/^[^\d]\w*$/im.test(c)?true:afStudio.models.TypeBuilder.invalidFieldName},name:"name"},{xtype:"afStudio.models.typeCombo",fieldLabel:"Type",allowBlank:false,name:"type"},{xtype:"numberfield",allowDecimals:false,allowNegative:false,fieldLabel:"Size",name:"size"},{xtype:"tabpanel",itemId:"fields-tab",width:336,height:100,style:"margin-top: 10px;",activeTab:0,defaults:{layout:"form",frame:true},items:[{title:"Attributes",defaults:{width:215},items:[{xtype:"checkbox",fieldLabel:"Required",name:"required"},{xtype:"textfield",fieldLabel:"Default value",name:"default"}]},{title:"Key",defaults:{width:215},items:[{xtype:"checkbox",fieldLabel:"Autoincrement",name:"autoIncrement"},{xtype:"combo",fieldLabel:"Key",typeAhead:true,triggerAction:"all",editable:false,mode:"local",valueField:"field",displayField:"field",store:[["","None"],["primary","Primary"],["index","Index"],["unique","Unique"]],hiddenName:"key",name:"key"}]},{title:"Relation",defaults:{width:215},items:[{xtype:"relationcombo",relationUrl:window.afStudioWSUrls.getModelsUrl(),listWidth:250,fieldLabel:"Relation",name:"relation"},{xtype:"combo",fieldLabel:"On Delete",typeAhead:true,triggerAction:"all",editable:false,mode:"local",valueField:"field",displayField:"field",store:[["cascade","cascade"],["setnull","setnull"],["restrict","restrict"],["none","none"]],hiddenName:"onDelete",name:"onDelete"}]}]},{xtype:"spacer",height:10}],buttons:[{text:"Save",iconCls:"icon-accept",handler:Ext.util.Functions.createDelegate(b.saveUpdates,b)},{text:"Cancel",iconCls:"afs-icon-cancel",handler:Ext.util.Functions.createDelegate(b.cancelEditing,b)}]});return{title:"Edit Field",closeAction:"hide",modal:true,frame:true,width:360,autoHeight:true,resizable:false,closable:false,items:[a]}},initComponent:function(){Ext.apply(this,Ext.applyIf(this.initialConfig,this._beforeInitComponent()));afStudio.models.EditFieldWindow.superclass.initComponent.apply(this,arguments);this._afterInitComponent()},_afterInitComponent:function(){var a=this;a.on({"show":Ext.util.Functions.createDelegate(a.onShowEvent,a)})}});Ext.ns("afStudio.models");afStudio.models.DependencyCellEditorBuilder=Ext.extend(Ext.util.Observable,{grid:null,defaultEditor:null,mainDataIndex:"type",dependencyDataIndex:"default",sizeDataIndex:"size",onGridBeforeEdit:function(d){var c=this,f=d.column,a=d.grid.getStore().getAt(d.row),h=d.grid.getColumnModel(),j=h.getDataIndex(f),g=a.get(c.mainDataIndex),l=a.get(c.sizeDataIndex),b;if(j==c.dependencyDataIndex){if(this.defaultEditor){h.config[f].editor=this.defaultEditor}b=afStudio.models.TypeBuilder.createEditor(g,l);this.defaultEditor=h.config[f].editor;h.config[f].editor=b?b:this.defaultEditor}},init:function(a){this.grid=a;this.grid.on({beforeedit:Ext.util.Functions.createDelegate(this.onGridBeforeEdit,this)})}});Ext.preg("cellEditorBuilder",afStudio.models.DependencyCellEditorBuilder);Ext.ns("afStudio.models");afStudio.models.ModelTab=Ext.extend(Ext.TabPanel,{modelUrl:window.afStudioWSUrls.getModelsUrl(),alterModelAction:function(a){var b=this;afStudio.vp.mask({region:"center",msg:"Updating "+b.modelName+" model..."});Ext.Ajax.request({url:b.modelUrl,params:{xaction:"read",model:b.modelName,schema:b.schemaName},success:function(d,e){afStudio.vp.unmask("center");var c=Ext.decode(d.responseText);a(c)}})},onAlterModel:function(){var b=this,a=b._modelData;b.alterModelAction(function(c){b.remove(a,true);b._modelData=b.createModelDataGrid(c);b.insert(0,b._modelData);b.doLayout()})},onAlterField:function(){var b=this,a=b._modelConfig;b.alterModelAction(function(c){a.loadModelData(c)})},createModelConfigGrid:function(a){var b=this;return new afStudio.models.FieldsGrid({itemId:"model-fields",_data:a,model:b.modelName,schema:b.schemaName})},createModelDataGrid:function(a){var c=this,b=c.modelName;return new afStudio.models.ModelGrid({itemId:"model-data",title:b,_data:a,model:c.modelName,schema:c.schemaName,storeProxy:new Ext.data.HttpProxy({api:{read:window.afStudioWSUrls.getModelGridDataReadUrl(b),create:window.afStudioWSUrls.getModelGridDataCreateUrl(b),update:window.afStudioWSUrls.getModelGridDataUpdateUrl(b),destroy:window.afStudioWSUrls.getModelGridDataDeleteUrl(b)}})})},_beforeInitComponent:function(){var d=this,a=d.fieldsStructure,c=d.modelName,b=d.schemaName;this._modelConfig=d.createModelConfigGrid(a);this._modelData=d.createModelDataGrid(a);return{activeTab:0,items:[d._modelData,d._modelConfig]}},initComponent:function(){Ext.apply(this,Ext.apply(this.initialConfig,this._beforeInitComponent()));afStudio.models.ModelTab.superclass.initComponent.apply(this,arguments);this._afterInitComponent()},_afterInitComponent:function(){var c=this,b=c._modelConfig,a=c._modelData;this.relayEvents(b,["altermodel"]);this.relayEvents(a,["alterfield"]);c.on({"altermodel":Ext.util.Functions.createDelegate(c.onAlterModel,c),"alterfield":Ext.util.Functions.createDelegate(c.onAlterField,c)})}});Ext.reg("afStudio.models.modelTab",afStudio.models.ModelTab);Ext.ns("afStudio.dbQuery");afStudio.dbQuery.QueryResultsGrid=Ext.extend(Ext.grid.GridPanel,{recordsPerPage:50,queryUrl:window.afStudioWSUrls.getDBQueryQueryUrl(),loadResultsData:function(a){this.getStore().loadData(a)},_beforeInitComponent:function(){var g=this,a=g.queryResult.meta||[],b,c=[],e=[],f;if(a.length>0){e=[new Ext.ux.grid.PagingRowNumberer({header:"Rec #",width:50})];for(var d=0;d<a.length;d++){e.push({header:a[d],dataIndex:a[d],width:80});c.push({name:a[d]})}}b=new Ext.data.JsonStore({url:g.queryUrl,root:"data",totalProperty:"total",baseParams:g.queryParam,fields:c});f=new Ext.PagingToolbar({store:b,displayInfo:true,displayMsg:"Displaying records {0} - {1} of {2}",pageSize:g.recordsPerPage});return{title:"Query Result",iconCls:"icon-database-table",loadMask:true,store:b,columns:e,columnLines:true,viewConfig:{forceFit:true,emptyText:"Empty!"},bbar:f}},initComponent:function(){Ext.apply(this,Ext.apply(this.initialConfig,this._beforeInitComponent()));afStudio.dbQuery.DataGrid.superclass.initComponent.apply(this,arguments);this._afterInitComponent()},_afterInitComponent:function(){var a=this;a.on({afterrender:function(){a.loadResultsData(a.queryResult?a.queryResult:[])},scope:a})}});Ext.ns("afStudio.dbQuery");afStudio.dbQuery.TableModelTab=Ext.extend(Ext.TabPanel,{modelUrl:window.afStudioWSUrls.getModelsUrl(),createStructureGrid:function(a){return new afStudio.dbQuery.StructureGrid({itemId:"structure-grid",storeDataUrl:this.modelUrl,metaData:a,model:this.modelName,schema:this.schemaName})},createDataGrid:function(a){return new afStudio.dbQuery.DataGrid({itemId:"data-grid",storeDataUrl:window.afStudioWSUrls.getModelGridDataReadUrl(this.modelName),metaData:a,model:this.modelName,schema:this.schemaName})},_beforeInitComponent:function(){var a=this;this._structureGrid=a.createStructureGrid(a.metaData);this._dataGrid=a.createDataGrid(a.metaData);return{activeTab:0,items:[a._dataGrid,a._structureGrid]}},initComponent:function(){Ext.apply(this,Ext.apply(this.initialConfig,this._beforeInitComponent()));afStudio.dbQuery.TableModelTab.superclass.initComponent.apply(this,arguments);this._afterInitComponent()},_afterInitComponent:function(){var c=this,b=c._modelConfig,a=c._modelData}});Ext.reg("afStudio.dbQuery.tableModelTab",afStudio.dbQuery.TableModelTab);Ext.ns("afStudio.dbQuery");afStudio.dbQuery.DataGrid=Ext.extend(Ext.grid.GridPanel,{recordsPerPage:50,_beforeInitComponent:function(){var g=this,a=g.metaData,c=["id"],b,f,e=[];if(a.length>0){e=[new Ext.ux.grid.PagingRowNumberer({header:"Rec #",width:50})];for(var d=0;d<a.length;d++){e.push({header:a[d].name,dataIndex:"c"+d,width:80,renderer:afStudio.models.TypeBuilder.createRenderer(a[d].type)});c.push({name:"c"+d})}}b=new Ext.data.JsonStore({url:g.storeDataUrl,root:"rows",idProperty:"id",fields:c});f=new Ext.PagingToolbar({store:b,displayInfo:true,displayMsg:"Displaying records {0} - {1} of {2}",pageSize:g.recordsPerPage});return{title:"Data",iconCls:"icon-database-table",loadMask:true,store:b,columns:e,columnLines:true,viewConfig:{forceFit:true},bbar:f}},initComponent:function(){Ext.apply(this,Ext.apply(this.initialConfig,this._beforeInitComponent()));afStudio.dbQuery.DataGrid.superclass.initComponent.apply(this,arguments);this._afterInitComponent()},_afterInitComponent:function(){var a=this;this.on("afterrender",function(b){b.getStore().load({params:{start:0,limit:a.recordsPerPage}})})}});Ext.ns("afStudio.dbQuery");afStudio.dbQuery.StructureGrid=Ext.extend(Ext.grid.GridPanel,{loadModelData:function(a){this.getStore().loadData(a)},booleanRenderer:function(b,c,a){c.css+=" x-grid3-check-col-td";return'<div class="x-grid3-check-col'+(b?"-on":"")+'"> </div>'},_beforeInitComponent:function(){var e=this,b,c;function a(f,g){return g.primaryKey?"primary":(g.index=="unique"?"unique":(g.index?"index":null))}function d(f,g){return(g.foreignModel&&g.foreignReference)?g.foreignModel+"."+g.foreignReference:null}b=new Ext.data.JsonStore({url:e.storeDataUrl,autoLoad:false,baseParams:{xaction:"read",model:e.model,schema:e.schema},idProperty:"id",fields:[{name:"id"},{name:"key",mapping:"id",convert:a},{name:"relation",mapping:"id",convert:d},{name:"autoIncrement"},{name:"primaryKey"},{name:"index"},{name:"name"},{name:"type"},{name:"size"},{name:"required"},{name:"default"},{name:"foreignTable"},{name:"foreignModel"},{name:"foreignReference"},{name:"onDelete"}]});c=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:'<div class="model-pk-hd">&#160;</div>',width:25,dataIndex:"key",renderer:function(m,g,f,n,j,h){var l="";switch(m){case"primary":l='<div class="pk-cell">&#160;</div>';break;case"index":l='<div class="index-cell">&#160;</div>';break;case"unique":l='<div class="unique-cell">&#160;</div>';break}return l}},{header:"Name",width:100,dataIndex:"name"},{header:"Type",width:100,dataIndex:"type"},{header:"Size",width:50,dataIndex:"size"},{header:"Autoincrement",width:55,dataIndex:"autoIncrement",renderer:e.booleanRenderer},{header:"Default value",width:100,dataIndex:"default"},{header:"Relation",width:150,sortable:true,dataIndex:"relation"},{header:"Required",width:50,sortable:true,dataIndex:"required",align:"center",renderer:e.booleanRenderer},{header:"On Delete",width:50,sortable:true,dataIndex:"onDelete",align:"center"}]});return{title:"Structure",iconCls:"icon-table-gear",store:b,colModel:c,columnLines:true,loadMask:true,autoScroll:true,viewConfig:{forceFit:true}}},initComponent:function(){Ext.apply(this,Ext.apply(this.initialConfig,this._beforeInitComponent()));afStudio.dbQuery.StructureGrid.superclass.initComponent.apply(this,arguments);this._afterInitComponent()},_afterInitComponent:function(){var c=this,b=c.getStore(),a=c.getColumnModel();c.loadModelData(c.metaData)}});Ext.reg("afStudio.dbQuery.structureGrid",afStudio.dbQuery.StructureGrid);Ext.ns("afStudio.dbQuery");afStudio.dbQuery.QueryForm=Ext.extend(Ext.FormPanel,{queryUrl:window.afStudioWSUrls.getDBQueryQueryUrl(),executeQuery:function(){var e=this,c=e.getForm(),d=e.queryTypeCmp.getValue(),a=this.dbQueryWindow.westPanel.getCurrentConnection(),b=Ext.apply(c.getFieldValues(),a);if(d=="sql"&&!a){Ext.Msg.alert("Failure","Connection is not specified. <br /> Please select DataBase or DB's table.");return}e.dbQueryWindow.maskDbQuery();c.submit({clientValidation:true,url:e.queryUrl,params:{connection:a,start:0,limit:afStudio.dbQuery.QueryResultsGrid.prototype.recordsPerPage},success:function(f,g){e.dbQueryWindow.unmaskDbQuery();if(g.result.type=="success"){e.fireEvent("executequery",{result:g.result,queryParam:b})}else{Ext.Msg.alert("Query Response",g.result.content)}},failure:function(f,g){e.dbQueryWindow.unmaskDbQuery();switch(g.failureType){case Ext.form.Action.CLIENT_INVALID:Ext.Msg.alert("Failure","Query text is empty");break;case Ext.form.Action.CONNECT_FAILURE:Ext.Msg.alert("Failure","Ajax communication failed");break;case Ext.form.Action.SERVER_INVALID:Ext.Msg.alert("Failure",g.result.content)}}})},_beforeInitComponent:function(){var a=this;return{region:"north",height:140,layout:"form",frame:true,iconCls:"icon-sql",margins:"0 5 5 5",title:"SQL",items:[{layout:"column",border:false,defaults:{border:false},items:[{layout:"form",columnWidth:1,style:"margin-right: 5px;",items:{xtype:"combo",ref:"../../queryTypeCmp",fieldLabel:"Query type",anchor:"100%",triggerAction:"all",value:"sql",hiddenName:"type",name:"type",store:[["sql","sql"],["propel","propel"]]}},{items:{xtype:"button",text:"Query",iconCls:"icon-accept",handler:Ext.util.Functions.createDelegate(a.executeQuery,a)}}]},{xtype:"textarea",ref:"queryText",allowBlank:false,hideLabel:true,height:80,name:"query",anchor:"100% "}]}},initComponent:function(){Ext.apply(this,Ext.applyIf(this.initialConfig,this._beforeInitComponent()));afStudio.dbQuery.QueryForm.superclass.initComponent.apply(this,arguments);this._afterInitComponent()},_afterInitComponent:function(){var a=this;a.addEvents("executequery")}});Ext.reg("afStudio.dbQuery.queryForm",afStudio.dbQuery.QueryForm);Ext.ns("afStudio.dbQuery");afStudio.dbQuery.QueryWindow=Ext.extend(Ext.Window,{onExecuteQuery:function(a){this.centerPanel.showQueryResult(a)},onDBNodeClick:function(b,c,a){var d=this;switch(a){case"table":d.centerPanel.showTableData(b.attributes);break;case"database":d.centerPanel.showDatabaseTables(b.childNodes);break}},maskDbQuery:function(a){this.body.mask("Querying...")},unmaskDbQuery:function(){this.body.unmask()},cancelBtnPressed:function(){this.close()},_beforeInitComponent:function(){var a=this;a.westPanel=new afStudio.dbQuery.DBStructureTree({region:"west",split:true,width:250});a.northPanel=new afStudio.dbQuery.QueryForm({dbQueryWindow:a});a.centerPanel=new afStudio.dbQuery.ContentPanel();return{title:"Database Query",width:1007,height:600,closable:true,draggable:true,plain:true,modal:true,resizable:false,maximizable:true,bodyBorder:false,border:false,items:[a.northPanel,a.westPanel,a.centerPanel],layout:"border"}},initComponent:function(){Ext.apply(this,Ext.applyIf(this.initialConfig,this._beforeInitComponent()));afStudio.dbQuery.QueryWindow.superclass.initComponent.apply(this,arguments);this._afterInitComponent()},_afterInitComponent:function(){var a=this;a.relayEvents(a.westPanel,["dbnodeclick"]);a.relayEvents(a.northPanel,["executequery"]);a.on({"dbnodeclick":a.onDBNodeClick,"executequery":a.onExecuteQuery,scope:a})}});Ext.ns("afStudio.dbQuery");afStudio.dbQuery.DBStructureTree=Ext.extend(Ext.tree.TreePanel,{structureUrl:window.afStudioWSUrls.getDBQueryDatabaseListUrl(),getCurrentConnection:function(){var a=this.getSelectionModel().getSelectedNode();return a?(a.hasChildNodes()?a.attributes.connection:a.parentNode.attributes.connection):null},maskTree:function(a){this.body.mask(a?a:"loading...")},unmaskTree:function(){this.body.unmask()},onBeforeLoad:function(a,b,c){this.maskTree.defer(10,this,["loading..."])},onLoad:function(a,b,c){this.unmaskTree()},onNodeClick:function(a,b){this.fireEvent("dbnodeclick",a,b,a.isLeaf()?"table":"database")},_beforeInitComponent:function(){var b=this;var a=new Ext.tree.AsyncTreeNode({id:"database",text:"Databases",expanded:true});return{layout:"fit",margins:"0 0 0 5",boxMinWidth:150,animate:true,autoScroll:true,containerScroll:true,rootVisible:false,root:a,dataUrl:b.structureUrl}},initComponent:function(){Ext.apply(this,Ext.applyIf(this.initialConfig,this._beforeInitComponent()));afStudio.dbQuery.DBStructureTree.superclass.initComponent.apply(this,arguments);this._afterInitComponent()},_afterInitComponent:function(){var c=this,a=c.getLoader();c.addEvents("dbnodeclick");var b=new Ext.tree.TreeSorter(c,{folderSort:true});c.on({click:c.onNodeClick,buffer:500,scope:c});a.on({beforeload:c.onBeforeLoad,load:c.onLoad,scope:c})}});Ext.reg("afStudio.dbQuery.dbStructureTree",afStudio.dbQuery.DBStructureTree);Ext.ns("afStudio.dbQuery");afStudio.dbQuery.ContentPanel=Ext.extend(Ext.Panel,{maskContent:function(a){this.body.mask(a?a:"loading");return this},unmaskContent:function(){this.body.unmask();return this},clearPanel:function(){this.removeAll(true)},createTableListGrid:function(b){var a=new Ext.grid.GridPanel({title:"Tables",autoScroll:true,columns:[{header:"Name"}],store:new Ext.data.JsonStore({fields:[{name:"text"}],data:b}),viewConfig:{forceFit:true}});return a},showQueryResult:function(b){this.maskContent();var a=new afStudio.dbQuery.QueryResultsGrid({queryResult:b.result,queryParam:b.queryParam});this.unmaskContent().clearPanel();this.add(a);this.doLayout()},showTableData:function(c){var d=this,a=c.model,b=c.schema;d.maskContent("loading metadata...");Ext.Ajax.request({url:window.afStudioWSUrls.getModelsUrl(),params:{xaction:"read",model:a,schema:b},success:function(e,g){d.unmaskContent();var f=Ext.decode(e.responseText);if(f.success){var h=new afStudio.dbQuery.TableModelTab({metaData:f.rows,modelName:a,schemaName:b});d.clearPanel();d.add(h);d.doLayout()}}})},showDatabaseTables:function(b){this.maskContent();var a=this.createTableListGrid(b);this.unmaskContent();this.clearPanel();this.add(a);this.doLayout()},_beforeInitComponent:function(){return{region:"center",margins:"0 5 0 0",layout:"fit",border:true,bodyBorder:true,hideBorders:true}},initComponent:function(){Ext.apply(this,Ext.applyIf(this.initialConfig,this._beforeInitComponent()));afStudio.dbQuery.ContentPanel.superclass.initComponent.apply(this,arguments);this._afterInitComponent()},_afterInitComponent:function(){var a=this;a.on({"render":function(b){(function(){a.maskContent("Please select table...")}).defer(100)}})}});Ext.reg("afStudio.dbQuery.contentPanel",afStudio.dbQuery.ContentPanel);Ext.namespace("afStudio.layoutDesigner.view");afStudio.layoutDesigner.view.TabViewPanel=Ext.extend(Ext.TabPanel,{constructor:function(a){Ext.apply(a,{enableTabScroll:true,plugins:new afStudio.layoutDesigner.view.TabbedViewCloseMenuPlugin()});afStudio.layoutDesigner.view.TabViewPanel.superclass.constructor.call(this,a)},allTabsAreClosed:function(){if(this.items.getCount()==0){this.fireEvent("alltabswereclosed")}},onRender:function(b,a){afStudio.layoutDesigner.view.TabViewPanel.superclass.onRender.call(this,b,a);this.addEvents("alltabswereclosed")},initEvents:function(){afStudio.layoutDesigner.view.TabViewPanel.superclass.initEvents.call(this);this.strip.on("dblclick",this.onStripDblClick,this)},onStripMouseDown:function(b){if(b.button!==0){return}b.preventDefault();var a=this.findTargets(b);if(a.close){if(a.item.fireEvent("beforeclose",a.item)!==false){a.item.fireEvent("close",a.item);this.remove(a.item)}this.allTabsAreClosed();return}if(a.item&&a.item!=this.activeTab){this.setActiveTab(a.item)}},onStripDblClick:function(c){var b=this.plugins,a=this.findTargets(c);if(!Ext.isEmpty(a.item)){b.setActiveTabProperty(a.item);b.onRename()}}});Ext.namespace("afStudio.layoutDesigner.view");afStudio.layoutDesigner.view.TabbedViewCloseMenuPlugin=Ext.extend(Ext.ux.TabCloseMenu,{renameTabText:"Rename Tab",createMenu:function(){if(!this.menu){var a=[{itemId:"close",text:this.closeTabText,scope:this,handler:this.onClose},{itemId:"rename",text:this.renameTabText,scope:this,handler:this.onRename}];if(this.showCloseAll){a.push("-")}a.push({itemId:"closeothers",text:this.closeOtherTabsText,scope:this,handler:this.onCloseOthers});if(this.showCloseAll){a.push({itemId:"closeall",text:this.closeAllTabsText,scope:this,handler:this.onCloseAll})}this.menu=new Ext.menu.Menu({items:a})}return this.menu},setActiveTabProperty:function(a){this.active=a},allTabsAreClosed:function(){if(this.tabs.items.getCount()==0){this.tabs.fireEvent("alltabswereclosed")}},confirmTabClosingDialog:function(a,c){var b=this;Ext.Msg.confirm("Layout Designer",a,function(d){if(d=="yes"){c()}})},pickTabsToClose:function(b){var d=this;var a=[];var c=[];this.tabs.items.each(function(e){if(e.closable){if(!b||e!=this.active){a.push(e);c.push(e.viewMeta.attributes.title)}}},this);return{tabs:a,meta:c}},onRename:function(){var a=this.active;if(!this.pickerWin){this.pickerWin=new afStudio.layoutDesigner.TabNamePickerWindow();this.pickerWin.on("tabnamepicked",this.renameTab,this)}this.pickerWin.show(a,function(){var b=this.pickerForm.tabNameField;b.setValue(a.title);b.focus(true,200)})},renameTab:function(b){var a=this.active;a.setTitle(b);a.fireEvent("viewtitlechange",a,b)},onClose:function(){var d=this,c=this.active,b;b='Are you sure you want to delete tab view "'+c.viewMeta.attributes.title+'"';function a(){var e=this.active;if(e.fireEvent("beforeclose",e)!==false){e.fireEvent("close",e);this.tabs.remove(e);this.allTabsAreClosed()}}this.confirmTabClosingDialog(b,Ext.util.Functions.createDelegate(a,d))},onCloseOthers:function(){var d=this,c;var b=this.pickTabsToClose(true);c="Are you sure you want to delete tab views? <br />"+b.meta.join(", ");function a(e){this.doClose(e)}this.confirmTabClosingDialog(c,Ext.util.Functions.createDelegate(a,d,[b.tabs]))},onCloseAll:function(){var d=this,c;var b=this.pickTabsToClose(false);c="Are you sure you want to delete all tab views and their components?";function a(e){this.doClose(e)}this.confirmTabClosingDialog(c,Ext.util.Functions.createDelegate(a,d,[b.tabs]))},doClose:function(b){var a=this.active;if(a.fireEvent("beforeclose",a,true,b)!==false){Ext.each(b,function(c){c.fireEvent("close",c);this.tabs.remove(c)},this)}this.allTabsAreClosed()}});Ext.preg("afStudio.layoutDesigner.view.tabbedViewCloseMenuPlugin",afStudio.layoutDesigner.view.TabbedViewCloseMenuPlugin);Ext.namespace("afStudio.layoutDesigner.view");afStudio.layoutDesigner.view.Page=Ext.extend(Ext.Container,{layout:"border",_beforeInitComponent:function(){afStudio.vp.mask({msg:String.format('"{0}" view building...',this.pageMeta["i:title"]),region:"center"});var a=afStudio.layoutDesigner.view.ViewFactory.buildLayout(this.pageMeta);return{items:a}},initComponent:function(){Ext.apply(this,Ext.apply(this.initialConfig,this._beforeInitComponent()));afStudio.layoutDesigner.view.Page.superclass.initComponent.apply(this,arguments);this._afterInitComponent()},_afterInitComponent:function(){var a=this;afStudio.vp.unmask("center");a.on("afterrender",a.initPageView,a)},initPageView:function(){this.designPanel=this.ownerCt},refreshPageLayout:function(){var a=this.designPanel;a.updateLayoutView(new afStudio.layoutDesigner.view.Page({pageMeta:this.pageMeta}))},getPageMetaData:function(){return this.pageMeta},getContentView:function(){var a=this.find("region","center")[0];return Ext.isDefined(a)?a:null},getActiveContentView:function(){var c=this,a=c.getContentView(),b=afStudio.layoutDesigner.view.MetaDataProcessor;if(Ext.isEmpty(a)){throw new afStudio.error.ApsError("Content view is not defined!")}if(b.isViewTabbed(a.viewMeta)){a=a.getActiveTab()}return a},addWidgetComponentToContentView:function(a){var b=this.getActiveContentView();b.addViewComponent({attributes:{name:a.widget,module:a.module}},a.meta["i:title"]);this.doLayout()},setActiveContentViewLayout:function(b){var c=this,a=this.getActiveContentView();a.setLayoutMeta(b)},updateMetaData:function(b){var a=afStudio.layoutDesigner.view.MetaDataProcessor;if(Ext.isArray(this.pageMeta["i:area"])){this.pageMeta["i:area"][b.position]=b.meta}else{this.pageMeta["i:area"]=b.meta}if(Ext.isFunction(b.callback)){Ext.util.Functions.createDelegate(b.callback,this,[this.designPanel])()}}});Ext.reg("afStudio.layoutDesigner.view.page",afStudio.layoutDesigner.view.Page);Ext.namespace("afStudio.layoutDesigner.view");afStudio.layoutDesigner.view.NormalView=Ext.extend(Ext.ux.Portal,{widgetMetaUrl:"afsLayoutBuilder/getWidget",viewMetaPosition:0,emptyViewMessage:"View has no widgets added yet, add you first widget to get started.",viewLayout:1,emptyView:true,setViewMessageBox:function(a){if(!Ext.isDefined(this.viewMessageBox)){this.viewMessageBox=new afStudio.layoutDesigner.view.ViewMessageBox({viewContainer:this.ownerCt,viewMessage:a})}return this.viewMessageBox},showEmptyViewMessage:function(){this.setViewMessageBox(this.emptyViewMessage);this.add(this.viewMessageBox)},getViewLayout:function(){return this.viewMeta.attributes.layout},getViewComponentsMetaData:function(){return this.viewMeta["i:component"]},getPage:function(){return this.findParentByType("afStudio.layoutDesigner.view.page",true)},constructor:function(a){if(!Ext.isDefined(a.viewMeta.attributes.layout)){a.viewMeta.attributes.layout=this.viewLayout}afStudio.layoutDesigner.view.NormalView.superclass.constructor.call(this,a)},_beforeInitComponent:function(){var b=this;var a=this.initView();return{items:a}},initComponent:function(){Ext.apply(this,Ext.apply(this.initialConfig,this._beforeInitComponent()));afStudio.layoutDesigner.view.NormalView.superclass.initComponent.apply(this,arguments);this._afterInitComponent()},_afterInitComponent:function(){var a=this;a.addEvents("viewtitlechange");a.on({afterrender:a.initViewComponents,beforeclose:a.onBeforeCloseView,close:a.onCloseView,viewtitlechange:a.onViewTitleChange,beforedrop:a.beforeComponentDrop,drop:a.dropComponent,scope:a})},initView:function(){var e=this,b=afStudio.layoutDesigner.view.ViewFactory,d=this.getViewLayout(),a=b.getLayoutCfg(d),c=[];Ext.each(a,function(f,g,h){c.push(e.createViewColumn(g,f))});return c},initViewComponents:function(){var d=this,c=this.getViewComponentsMetaData();if(!Ext.isEmpty(c)){this.emptyView=false;if(Ext.isArray(c)){Ext.each(c,function(e,j,h){var g=e.attributes.column||0,f=d.createViewComponent(e,null);d.items.itemAt(g).add(f)})}else{var b=c.attributes.column||0,a=d.createViewComponent(c,null);d.items.itemAt(b).add(a)}d.doLayout()}else{this.emptyView=true;this.showEmptyViewMessage()}},getComponentMetaIndex:function(d,g){var b=g?g:this.getViewComponentsMetaData();var c;for(var e=0,a=b.length;e<a;e++){var f=true;Ext.iterate(d.attributes,function(h,j){if(b[e]["attributes"][h]!=j){return(f=false)}});if(f){c=e;break}}return c},updateViewMetaData:function(b){var a=this.ownerCt;a.updateMetaData({meta:this.viewMeta,position:this.viewMetaPosition,callback:b})},deleteViewMetaData:function(){var a=this.ownerCt;var b=Ext.apply({},this.viewMeta);delete this.viewMeta;a.deleteViewMetaData({meta:b,position:this.viewMetaPosition})},addViewComponentMetaData:function(a){var b=this.viewMeta["i:component"];if(Ext.isArray(b)){b.push(a)}else{if(Ext.isDefined(b)){this.viewMeta["i:component"]=[b,a]}else{this.viewMeta["i:component"]=a}}this.updateViewMetaData()},deleteViewComponentMetaData:function(c){var f=this.viewMeta["i:component"];if(Ext.isArray(f)){var e=this.getComponentMetaIndex(c);if(Ext.isDefined(e)){delete f[e]}var b=[];for(var d=0,a=f.length;d<a;d++){if(Ext.isDefined(f[d])){b.push(f[d])}}if(b.length>0){this.viewMeta["i:component"]=b}else{delete this.viewMeta["i:component"]}}else{delete this.viewMeta["i:component"]}this.updateViewMetaData()},setLayoutMeta:function(g){var h=this.viewMeta["i:component"],c=afStudio.layoutDesigner.view.MetaDataProcessor,e=afStudio.layoutDesigner.view.ViewFactory,b=this.ownerCt,a=e.getLayoutColumnMaxValue(g);this.viewMeta.attributes.layout=g;if(Ext.isDefined(h)){if(Ext.isArray(h)){for(var d=0,f=h.length;d<f;d++){if(h[d]["attributes"]["column"]>=a){h[d]["attributes"]["column"]=a}}}else{if(h["attributes"]["column"]>=a){h["attributes"]["column"]=a}}}var l;if(b.viewMeta&&c.isViewTabbed(b.viewMeta)){var j=b.getActiveTab();l=b.items.indexOf(j)}this.updateViewMetaData(function(m){this.refreshPageLayout();if(l){m.layoutView.getContentView().setActiveTab(l)}})},addViewComponent:function(b,d){var a=this.createViewComponent(b,d);var c=0;b.attributes.column=c;this.addViewComponentMetaData(b);if(this.emptyView){this.remove(this.viewMessageBox,true);this.emptyView=false}this.items.itemAt(c).add(a);this.doLayout()},createViewColumn:function(b,a){return{itemId:"portal-column-"+b,columnWidth:a,style:"padding: 5px",defaults:{bodyCssClass:"layout-designer-widget"}}},createViewComponent:function(e,f,c){var d=this,h=e.attributes.name,b=e.attributes.module,a=d.getPage(),j=a.pageMeta["i:title"];var g=new Ext.ux.Portlet({componentMeta:e,frame:true,title:String.format("{0} / {1}",b,h),html:String.format("<br /><center>Widget {0} </center><br />",f||j),tools:[{id:"close",handler:Ext.util.Functions.createDelegate(d.removeWidget,d)}],buttons:[{text:"Preview",handler:Ext.util.Functions.createDelegate(d.previewWidget,d,[h,b,e])},{text:"Edit",handler:Ext.util.Functions.createDelegate(d.editWidget,d,[h,b,e])}],buttonAlign:"center"});return g},previewWidget:function(c,d,b){var a=b.attributes.module+"/"+b.attributes.name;afApp.widgetPopup(a,a,null,null,afStudio)},editWidget:function(b,c,a){afStudio.vp.mask({region:"center"});Ext.Ajax.request({url:this.widgetMetaUrl,params:{module_name:c,action_name:b},success:function(h,f){afStudio.vp.unmask("center");var e=Ext.decode(h.responseText);if(e.success){var g=e.meta.actionPath,j=e.meta.securityPath,d=String.format("{0}/{1}",c,b);afStudio.vp.addToWorkspace({xtype:"afStudio.wd.widgetPanel",actionPath:g,securityPath:j,widgetUri:d},true)}else{afStudio.Msg.warning(e.content)}},failure:function(f,d){afStudio.vp.unmask("center");var e=String.format("Status code: {0}, message: {1}",f.status,f.statusText);afStudio.Msg.error("Server side error",e)}})},removeWidget:function(d,c,a){var b=a.componentMeta;this.deleteViewComponentMetaData(b);a.destroy()},onBeforeCloseView:Ext.emptyFn,onCloseView:function(a){this.deleteViewMetaData()},onViewTitleChange:function(a,b){this.viewMeta.attributes.title=b;this.updateViewMetaData()},beforeComponentDrop:Ext.emptyFn,getColumnMetaData:function(b){var c={component:[],index:[]},a=this.getViewComponentsMetaData();if(Ext.isArray(a)){Ext.iterate(a,function(f,d,e){if((f.attributes.column||0)==b){c.component.push(f);c.index.push(d)}})}else{if((a.attributes.column||0)==b){c.component.push(a);c.index.push(0)}}return c},dropComponent:function(d){var b=d.panel,h=b.componentMeta,g=d.position,c=d.columnIndex;var a=Ext.util.Functions.createDelegate(function(m){for(var l=0,j=m.index.length;l<j;l++){this.viewMeta["i:component"][m.index[l]]=m.component[l]}},this);h.attributes.column=d.columnIndex;var e=this.getColumnMetaData(c),f=this.getComponentMetaIndex(h,e.component);if(!Ext.isEmpty(e.component)){if(f>g){e.component.dragUp(f,g);a(e)}else{if(f<g){e.component.dragDown(f,g);a(e)}}}this.updateViewMetaData()}});Ext.reg("afStudio.layoutDesigner.view.normalView",afStudio.layoutDesigner.view.NormalView);Ext.namespace("afStudio.layoutDesigner.view");afStudio.layoutDesigner.view.MetaDataProcessor=function(){return{isViewTabbed:function(a){return Ext.isDefined(a["i:tab"])?true:false},getContentViewMeta:function(b){var a,c;if(Ext.isArray(b["i:area"])){Ext.each(b["i:area"],function(d,e){if(d.attributes.type=="content"){a=d;c=e;return false}})}else{a=b["i:area"]}return{contentView:a,contentIdx:c}},changeContentViewMetaData:function(e,d){var b=this.getContentViewMeta(d),g=this.isViewTabbed(b.contentView),a=g?this.getTabbedViewComponents(b.contentView["i:tab"]):this.getNormalViewComponents(b.contentView["i:component"]);var h={};if(e=="tabbed"){var c=Ext.apply({title:d["i:title"]},b.contentView.attributes);delete c.type;h={"attributes":b.contentView.attributes,"i:tab":{"attributes":c}};if(!Ext.isEmpty(Ext.flatten(a))){h["i:tab"]["i:component"]=Ext.flatten(a)}}else{var f=Ext.apply({},b.contentView.attributes);f.layout=(f.layout>a.maxLayout)?f.layout:a.maxLayout;h={"attributes":f,"i:component":Ext.flatten(a.components)}}if(!Ext.isEmpty(b.contentIdx)){d["i:area"][b.contentIdx]=h}else{d["i:area"]=h}return d},getTabbedViewComponents:function(b){var c,a;if(Ext.isDefined(b)){c=[];if(Ext.isArray(b)){a=1;Ext.each(b,function(e,d){if(e["i:component"]){if(e.attributes.layout>a){a=e.attributes.layout}c.push(this.getNormalViewComponents(e["i:component"]))}},this)}else{if(b["i:component"]){a=b.attributes.layout;c.push(this.getNormalViewComponents(b["i:component"]))}}}return{components:c,maxLayout:a}},getNormalViewComponents:function(a){var b;if(Ext.isDefined(a)){b=[];if(Ext.isArray(a)){Ext.each(a,function(e,d){b.push(e)})}else{b.push(a)}}return b}}}();Ext.namespace("afStudio.layoutDesigner.view");afStudio.layoutDesigner.view.ViewMessageBox=Ext.extend(Ext.Panel,{floating:true,style:"z-index: 10; text-align: center; font-size: 20px;",width:600,_beforeInitComponent:function(){var a=this;return{items:{ref:"messageHolder",xtype:"container",style:"padding: 20px",html:this.viewMessage}}},initComponent:function(){Ext.apply(this,Ext.apply(this.initialConfig,this._beforeInitComponent()));afStudio.layoutDesigner.view.ViewMessageBox.superclass.initComponent.apply(this,arguments);this._afterInitComponent()},_afterInitComponent:function(){var a=this;a.on({afterrender:a.onAfterRender,scope:a})},onAfterRender:function(){var b=this.viewContainer.getBox(),a=Ext.util.Format.round(b.width/2,0)-this.getWidth()/2,c=Ext.util.Format.round(b.height/2,0)-this.getHeight();this.setPosition(a,c)}});Ext.namespace("afStudio.layoutDesigner.view");afStudio.layoutDesigner.view.TabbedView=Ext.extend(afStudio.layoutDesigner.view.TabViewPanel,{viewLayout:1,viewMetaPosition:0,getViewLayout:function(){return this.viewMeta.attributes.layout},getViewTabsMetaData:function(){return this.viewMeta["i:tab"]},addEmptyTabMetaData:function(){var a=this.getViewTabsMetaData();var b;if(Ext.isArray(a)){b=this.viewMeta["i:tab"].push({});b--}else{if(Ext.isDefined(a)){this.viewMeta["i:tab"]=[a,{}];b=1}else{this.viewMeta["i:tab"]=[{}];b=0}}return b},getViewTabMetaData:function(a){return this.getViewTabsMetaData()[a]},getViewTabComponentsMetaData:function(a){return this.getViewTabMetaData(a)["i:component"]},getViewTabLayout:function(b){var a=b.attributes.layout;return !Ext.isDefined(a)?this.getViewLayout():a},constructor:function(a){if(!Ext.isDefined(a.viewMeta.attributes.layout)){a.viewMeta.attributes.layout=this.viewLayout}afStudio.layoutDesigner.view.TabbedView.superclass.constructor.call(this,a)},_beforeInitComponent:function(){var b=this;var a=this.initView();return{activeTab:0,anchor:"100%",items:a}},initComponent:function(){Ext.apply(this,Ext.apply(this.initialConfig,this._beforeInitComponent()));afStudio.layoutDesigner.view.TabbedView.superclass.initComponent.apply(this,arguments);this._afterInitComponent()},_afterInitComponent:function(){var a=this;a.on({alltabswereclosed:a.onAllTabsWereClosed,scope:a})},initView:function(){var c=this,a=this.getViewTabsMetaData(),b=[];Ext.each(a,function(d,f,e){b.push(c.createTabView(d,f))});return b},createTabView:function(c,b){var e=this,d=c.attributes.title;c.attributes.layout=this.getViewTabLayout(c);var a=new afStudio.layoutDesigner.view.NormalView({title:d,viewMeta:c,viewMetaPosition:b,closable:true});return a},updateMetaData:function(b){var a=this.ownerCt;Ext.apply(this.getViewTabMetaData(b.position),b.meta);a.updateMetaData({meta:this.viewMeta,position:this.viewMetaPosition,callback:b.callback})},deleteViewMetaData:function(g){var c=this.ownerCt;if(Ext.isArray(this.viewMeta["i:tab"])){var d=this.viewMeta["i:tab"];for(var e=0,a=d.length;e<a;e++){var f=true;Ext.iterate(g.meta.attributes,function(h,j){if(d[e]["attributes"][h]!=j){f=false}});if(f){delete d[e];break}}var b=[];for(var e=0,a=d.length;e<a;e++){if(Ext.isDefined(d[e])){b.push(d[e])}}if(b.length>0){this.viewMeta["i:tab"]=b}else{delete this.viewMeta["i:tab"]}}else{delete this.viewMeta["i:tab"]}c.updateMetaData(Ext.apply(g,{meta:this.viewMeta}))},addTabViewComponent:function(c){var e=this;var d={"attributes":{layout:1,title:c}};var a=e.addEmptyTabMetaData();function b(f){this.refreshPageLayout();f.layoutView.getContentView().setActiveTab(a)}e.updateMetaData({position:a,meta:d,callback:b})},onAllTabsWereClosed:function(){var b=this.ownerCt;function a(c){this.refreshPageLayout()}Ext.util.Functions.createDelegate(a,b,[b.designPanel])()}});Ext.reg("afStudio.layoutDesigner.view.tabbedView",afStudio.layoutDesigner.view.TabbedView);Ext.namespace("afStudio.layoutDesigner.view");afStudio.layoutDesigner.view.ViewFactory=function(){return{viewLayoutConfig:{1:[1],2:[0.5,0.5],3:[0.25,0.75],4:[0.75,0.25],5:[0.33,0.33,0.33],6:[0.5,0.25,0.25],7:[0.25,0.5,0.25],8:[0.25,0.25,0.25,0.25],9:[0.4,0.2,0.2,0.2]},getLayoutCfg:function(a){return this.viewLayoutConfig[a]},getLayoutColumnsNumber:function(a){return this.getLayoutCfg(a).length},getLayoutColumnMaxValue:function(a){return this.getLayoutColumnsNumber(a)-1},buildLayout:function(b){var a=[];if(Ext.isArray(b["i:area"])){Ext.each(b["i:area"],function(e,c,d){a.push(this.createView(e,c))},this)}else{a.push(this.createView(b["i:area"],0))}return a},createView:function(b,e){var d,c,a;switch(b.attributes.type){case"content":c={viewMetaPosition:e,region:"center"};break;case"sidebar":c={viewMetaPosition:e,region:"west",split:true,collapseMode:"mini",width:b.attributes.width?b.attributes.width:200};break;case"footer":c={viewMetaPosition:e,region:"south",split:true,collapseMode:"mini",height:130};break}c.viewMeta=b;a=afStudio.layoutDesigner.view.MetaDataProcessor.isViewTabbed(b)?new afStudio.layoutDesigner.view.TabbedView(c):new afStudio.layoutDesigner.view.NormalView(c);return a}}}();Ext.namespace("afStudio.layoutDesigner");afStudio.layoutDesigner.WidgetSelectorTreeWindow=Ext.extend(Ext.Window,{widgetListUrl:"/afsLayoutBuilder/getWidgetList",closeWidgetSelectorTreeWindow:function(){if(this.closeAction=="hide"){this.hide()}else{this.close()}},selectWidget:function(){var a=this.selectorTree,d=a.getSelectionModel(),c=d.getSelectedNode();if(this.isNodeWidget(c)){var b={module:this.getNodeAttribute(c,"module"),widget:this.getNodeAttribute(c,"widget")};this.closeWidgetSelectorTreeWindow();this.fireEvent("widgetselect",b)}},loadWidgetList:function(){var b=this.selectorTree.getLoader(),a=this.selectorTree.root;b.load(a)},onWidgetSelectorShow:function(){this.addWidgetBtn.disable();this.loadWidgetList()},_beforeInitComponent:function(){var b=this;var a=new Ext.tree.TreePanel({ref:"selectorTree",autoScroll:true,animate:true,containerScroll:true,anchor:"100%",border:false,dataUrl:b.widgetListUrl,root:{nodeType:"node",text:"WidgetList",draggable:false,id:"widget-list-root"},rootVisible:false});return{title:"Add Widget",closeAction:"hide",modal:true,frame:true,width:348,height:400,closable:true,resizable:false,layout:"fit",items:a,buttonAlign:"center",buttons:[{text:"Add Widget",ref:"../addWidgetBtn",disabled:true,handler:b.selectWidget,scope:b},{text:"Cancel",handler:b.closeWidgetSelectorTreeWindow,scope:b}]}},initComponent:function(){Ext.apply(this,Ext.apply(this.initialConfig,this._beforeInitComponent()));afStudio.layoutDesigner.WidgetSelectorTreeWindow.superclass.initComponent.apply(this,arguments);this._afterInitComponent()},_afterInitComponent:function(){var c=this,a=this.selectorTree,b=a.getLoader();c.addEvents("widgetselect");b.on({beforeload:function(d,e,f){e.getOwnerTree().body.mask("loading, please wait...","x-mask-loading")},load:function(d,e,f){e.getOwnerTree().body.unmask()},loadexception:function(d,e,f){e.getOwnerTree().body.unmask()}});a.on({click:c.onNodeClick,dblclick:c.onNodeDblClick,scope:c});c.on({"show":Ext.util.Functions.createDelegate(c.onWidgetSelectorShow,c)})},getNodeAttribute:function(c,b,a){return c.attributes[b]?c.attributes[b]:(a?a:null)},isNodeWidget:function(c){var b=this.getNodeAttribute(c,"type"),a=false;if(b=="xml"){a=true}return a},onNodeClick:function(a,b){if(this.isNodeWidget(a)){this.addWidgetBtn.enable()}else{this.addWidgetBtn.disable()}},onNodeDblClick:function(a,b){if(this.isNodeWidget(a)){this.selectWidget()}}});Ext.namespace("afStudio.layoutDesigner");afStudio.layoutDesigner.TabNamePickerWindow=Ext.extend(Ext.Window,{closePickerWindow:function(){if(this.closeAction=="hide"){this.hide()}else{this.close()}},pickTabName:function(){var b=this.pickerForm.getForm();if(b.isValid()){var a=this.pickerForm.tabNameField.getValue();this.closePickerWindow();this.fireEvent("tabnamepicked",a)}},onTabNamePickerShow:function(){var b=this,a=this.pickerForm;a.getForm().reset();a.tabNameField.focus(true,200)},onTabPickerFieldKeyPress:function(b,a){if(a.getKey()==a.ENTER){this.pickTabName()}},_beforeInitComponent:function(){var b=this;var a=new Ext.FormPanel({ref:"pickerForm",baseCls:"x-plain",anchor:"100%",border:false,defaults:{anchor:"100%",msgTarget:"qtip"},items:[{xtype:"textfield",ref:"tabNameField",allowBlank:false,blankText:"Tab title is required!",vtype:"alphanum",hideLabel:true,height:35,style:"font-size: 20px",enableKeyEvents:true,name:"tabNameField"}]});return{title:"Choose tab title",closeAction:"hide",modal:true,frame:true,width:200,height:100,closable:true,resizable:false,items:a,buttonAlign:"center",buttons:[{text:"Save",handler:b.pickTabName,scope:b},{text:"Cancel",handler:b.closePickerWindow,scope:b}]}},initComponent:function(){Ext.apply(this,Ext.apply(this.initialConfig,this._beforeInitComponent()));afStudio.layoutDesigner.TabNamePickerWindow.superclass.initComponent.apply(this,arguments);this._afterInitComponent()},_afterInitComponent:function(){var b=this,a=this.pickerForm.tabNameField;b.addEvents("tabnamepicked");a.on("keypress",b.onTabPickerFieldKeyPress,b);b.on({show:b.onTabNamePickerShow,scope:b})}});Ext.namespace("afStudio.layoutDesigner");afStudio.layoutDesigner.DesignerPanel=Ext.extend(Ext.Panel,{widgetMetaUrl:"afsLayoutBuilder/getWidget",saveLayoutUrl:"afsLayoutBuilder/save",pagePreviewWindow:null,executeAction:function(a){afStudio.vp.mask({msg:a.loadingMessage?a.loadingMessage:"Loading...",region:"center"});Ext.Ajax.request({url:a.url,params:a.params,success:function(d,c){afStudio.vp.unmask("center");var b=Ext.decode(d.responseText);if(b.success){Ext.util.Functions.createDelegate(a.run,a.scope?a.scope:this,[b],false)()}else{Ext.Msg.alert("Error",b.content)}},failure:function(c,b){afStudio.vp.unmask("center");Ext.Msg.alert("Error",String.format("Status code: {0}, message: {1}",c.status,c.statusText))}})},isLayoutTabbed:function(){var a=this.layoutView.getContentView(),b=a.viewMeta;return this.isViewTabbed(b)},getFormatMenuItem:function(b){var a=this.getTopToolbar().getComponent("formatMenu").menu;return a.getComponent(b)},getFormatTypeMenuItem:function(a){var b=this.getFormatMenuItem("typeItem").menu;return b.getComponent(a)},getFormatLayoutMenuItem:function(a){var b=this.getFormatMenuItem("layoutItem").menu;return b.getComponent(a)},updateDesignerPanelControls:function(){var a=this.getFormatMenuItem("addNewTab");if(this.isLayoutTabbed()){this.getFormatTypeMenuItem("tabbedView").setChecked(true,true);a.enable()}else{this.getFormatTypeMenuItem("normalView").setChecked(true,true);a.disable()}},updateLayoutView:function(a){this.removeAll(true);this.layoutView=this.add(a);this.doLayout();this.updateDesignerPanelControls()},_beforeInitComponent:function(){var b=this;var a=new Ext.Toolbar({items:[{text:"Save",itemId:"saveLayoutBtn",iconCls:"icon-save"},"-",{text:"Add Widget",itemId:"addWidgetBtn",iconCls:"icon-add"},"-",{text:"Format",itemId:"formatMenu",iconCls:"icon-format",menu:{ignoreParentClicks:true,items:[{text:"Type",itemId:"typeItem",menu:{defaults:{xtype:"menucheckitem",group:"layoutType"},items:[{itemId:"normalView",type:"normal",text:"Normal"},{itemId:"tabbedView",type:"tabbed",text:"Tabbed"}]}},{text:"Columns",itemId:"layoutItem",menu:{items:[{xtype:"combo",itemId:"layoutStructure",triggerAction:"all",mode:"local",emptyText:"Select an item...",forceSelection:true,store:[[1,"1 - column 100%"],[2,"2 - columns 50/50"],[3,"3 - columns 25/75"],[4,"4 - columns 75/25"],[5,"5 - columns 33/33/33"],[6,"6 - columns - 50/25/25"],[7,"7 - columns 25/50/25"],[8,"8 - columns 25/25/25/25"],[9,"9 - columns - 40/20/20/20"]]}]}},{itemId:"addNewTab",text:"Add new Tab"}]}},"-",{text:"Preview",itemId:"previewPageBtn",iconCls:"icon-preview"}]});return{title:"Layout Designer",layout:"fit",tbar:a,items:{xtype:"afStudio.layoutDesigner.view.page",pageMeta:b.layoutMeta,ref:"layoutView"}}},initComponent:function(){Ext.apply(this,Ext.apply(this.initialConfig,this._beforeInitComponent()));afStudio.layoutDesigner.DesignerPanel.superclass.initComponent.apply(this,arguments);this._afterInitComponent()},_afterInitComponent:function(){var e=this,d=e.getTopToolbar(),c=d.getComponent("saveLayoutBtn"),b=d.getComponent("addWidgetBtn"),a=d.getComponent("previewPageBtn");e.addEvents("layouttypechanged");c.on("click",e.onSaveDesignerLayout,e);b.on("click",e.onClickNewWidget,e);a.on("click",e.onPreviewPage,e);e.getFormatLayoutMenuItem("layoutStructure").on({select:e.onSelectDesignerColumnsNumber,scope:e});e.getFormatMenuItem("typeItem").menu.on({itemclick:e.onLayoutTypeChanged,scope:e});e.getFormatMenuItem("addNewTab").on({click:e.onClickAddNewPagesTab,scope:e});e.on("afterrender",e.initDesignerPanel,e)},initDesignerPanel:function(){this.updateDesignerPanelControls()},onLayoutTypeChanged:function(d,g){var j=this,h=d.type,c=j.layoutView.getContentView().viewMeta,b=j.layoutView.pageMeta;var a=j.isViewTabbed(c);switch(h){case"normal":if(a){var f=j.changeContentViewMetaData("normal",b);j.updateLayoutView(new afStudio.layoutDesigner.view.Page({pageMeta:f}))}break;case"tabbed":if(!a){var f=j.changeContentViewMetaData("tabbed",b);j.updateLayoutView(new afStudio.layoutDesigner.view.Page({pageMeta:f}))}break}this.fireEvent("layouttypechanged",d.type);this.updateDesignerPanelControls()},onSelectDesignerColumnsNumber:function(e,a,c){var d=this.layoutView,b=e.getValue();d.setActiveContentViewLayout(b)},onClickAddNewPagesTab:function(){if(!this.tabNamePickerWindow){this.tabNamePickerWindow=new afStudio.layoutDesigner.TabNamePickerWindow();this.tabNamePickerWindow.on("tabnamepicked",this.onAddNewPagesTab,this)}this.tabNamePickerWindow.show()},onAddNewPagesTab:function(a){var b=this.layoutView.getContentView();b.addTabViewComponent(a)},onClickNewWidget:function(){if(!this.widgetSelectorWindow){this.widgetSelectorWindow=new afStudio.layoutDesigner.WidgetSelectorTreeWindow();this.widgetSelectorWindow.on("widgetselect",this.onAddWidget,this)}this.widgetSelectorWindow.show()},onAddWidget:function(a){var c=this,b=c.layoutView;c.executeAction({url:c.widgetMetaUrl,params:{module_name:a.module,action_name:a.widget},run:function(d){b.addWidgetComponentToContentView(Ext.apply(a,{meta:d.content}))},loadingMessage:"Add Widget..."})},onSaveDesignerLayout:function(){var b=this,a=b.layoutView.getPageMetaData();b.executeAction({url:b.saveLayoutUrl,params:{app:b.layoutApp,page:b.layoutPage,definition:Ext.encode(a)},scope:b,run:function(c){afStudio.Msg.info("Layout Designer",c.content);this.fireEvent("logmessage",this,"layout saved")},loadingMessage:"Saving..."})},onPreviewPage:function(){var b=this.layoutPage,a=b.substring(0,b.lastIndexOf(".xml"));this.pagePreviewWindow=window.open("/#/pages/"+a,"layoutDesignerPagePreview")},resizeItems:function(){var c=this;var b=c.columnsNumber;c.resizer=[];for(var a=0;a<b;a++){var d=new Ext.Resizable("portal-column-"+a,{width:200,minWidth:100,minHeight:50,listeners:{beforeresize:function(h,g){var f=Ext.fly(h.el);h._width=Ext.fly(f).getWidth()},resize:function(j,g,f,h){c.resizerHandler(j,g,f,h)}}});c.resizer.push(d)}},autoAdjust:function(){var d=Ext.DomQuery.select('div[class*="x-portlet"]',this.designerPortal.el);for(var c=0,a=d.length;c<a;c++){var e=Ext.getCmp(d[c].id);var b=e.ownerCt.getWidth();e.setWidth(b);Ext.get(d[c]).setWidth(b);e.doLayout();e.ownerCt.doLayout()}}});Ext.reg("afStudio.layoutDesigner.designerPanel",afStudio.layoutDesigner.DesignerPanel);Ext.apply(afStudio.layoutDesigner.DesignerPanel.prototype,afStudio.layoutDesigner.view.MetaDataProcessor);Ext.namespace("afStudio.layoutDesigner");afStudio.layoutDesigner.WidgetSelectorWindow=Ext.extend(Ext.Window,{moduleUrl:afStudioWSUrls.getModulesUrl(),widgetUrl:afStudioWSUrls.getModuleWidgetsUrl(),closeWidgetSelectorWindow:function(){if(this.closeAction=="hide"){this.hide()}else{this.close()}},selectWidget:function(){var a=this.selectorForm.getForm();if(a.isValid()){this.closeWidgetSelectorWindow();this.fireEvent("widgetselect",a.getFieldValues())}},loadModules:function(){this.modulesCombo.getStore().load()},onModuleSelect:function(g,e,a){var f=this,d=this.widgetsCombo,b=d.getStore();b.load({params:{app_name:e.get("group"),module_name:e.get("value")},callback:function(){d.reset();d.enable()}})},onWidgetSelectorShow:function(){var b=this,a=this.selectorForm;a.getForm().reset();b.widgetsCombo.disable();b.loadModules()},_beforeInitComponent:function(){var d=this;var c=new Ext.ux.form.GroupingComboBox({ref:"../modulesCombo",fieldLabel:"Module Location",typeAhead:true,triggerAction:"all",forceSelection:true,mode:"local",store:new Ext.data.JsonStore({url:d.moduleUrl,baseParams:{cmd:"getGrouped"},idProperty:"value",fields:["value","text","group"]}),valueField:"value",displayField:"text",groupField:"group",allowBlank:false,hiddenName:"module",name:"module"});var b=new Ext.form.ComboBox({ref:"../widgetsCombo",fieldLabel:"Widget",typeAhead:true,triggerAction:"all",forceSelection:true,mode:"local",store:new Ext.data.JsonStore({url:d.widgetUrl,idProperty:"id",fields:["id","name"]}),valueField:"name",displayField:"name",allowBlank:false,disabled:true,hiddenName:"widget",name:"widget"});var a=new Ext.FormPanel({ref:"selectorForm",baseCls:"x-plain",style:"padding: 5px",border:false,labelWidth:100,defaults:{anchor:"100%",msgTarget:"qtip"},items:[c,b]});return{title:"Add Widget",closeAction:"hide",modal:true,frame:true,width:463,closable:true,resizable:false,items:a,buttons:[{text:"Add Widget",handler:d.selectWidget,scope:d},{text:"Cancel",handler:d.closeWidgetSelectorWindow,scope:d}]}},initComponent:function(){Ext.apply(this,Ext.apply(this.initialConfig,this._beforeInitComponent()));afStudio.layoutDesigner.WidgetSelectorWindow.superclass.initComponent.apply(this,arguments);this._afterInitComponent()},_afterInitComponent:function(){var a=this;a.addEvents("widgetselect");a.on({"show":Ext.util.Functions.createDelegate(a.onWidgetSelectorShow,a)});a.modulesCombo.on("select",a.onModuleSelect,a)}});Ext.ux.FileTreePanel=Ext.extend(Ext.tree.TreePanel,{confirmText:"Confirm",containerScroll:true,deleteText:"Delete",enableDD:true,enableDelete:true,enableNewDir:true,enableOpen:true,enableProgress:true,enableRename:true,enableSort:true,enableUpload:true,errorText:"Error",existsText:"File <b>{0}</b> already exists",expandOnRender:true,fileCls:"file",fileText:"File",focusPopup:true,folderSort:true,hrefPrefix:"",hrefSuffix:"",layout:"fit",loadingText:"Loading",loadMask:false,maxFileSize:524288,maxMsgLen:2000,method:"post",newdirText:"New Folder",newfileText:"file.php",openMode:"_self",overwriteText:"Do you want to overwrite it?",popupFeatures:"width=800,height=600,dependent=1,scrollbars=1,resizable=1,toolbar=1",readOnly:false,reallyWantText:"Do you really want to",rootPath:"root",rootText:"Tree Root",rootVisible:true,selectOnEdit:true,singleUpload:false,topMenu:false,url:"",initComponent:function(){Ext.apply(this,{root:new Ext.tree.AsyncTreeNode({text:this.rootText,path:this.rootPath,rootVisible:this.rootVisible,allowDrag:false}),treeEditor:!this.readOnly?new Ext.tree.TreeEditor(this,{allowBlank:false,cancelOnEsc:true,completeOnEnter:true,ignoreNoChange:true,selectOnFocus:this.selectOnEdit}):undefined,dropConfig:this.dropConfig?this.dropConfig:{ddGroup:this.ddGroup||"TreeDD",appendOnly:this.enableSort,expandDelay:3600000},treeSorter:this.enableSort?new Ext.tree.TreeSorter(this,{folderSort:this.folderSort}):undefined,keys:[{key:Ext.EventObject.ENTER,scope:this,fn:function(a,c){var d=this.getSelectionModel();var b=d.getSelectedNode();if(b&&0!==b.getDepth()&&b.isLeaf()){this.openNode(b)}}},{key:113,scope:this,fn:function(a,c){var d=this.getSelectionModel();var b=d.getSelectedNode();if(b&&0!==b.getDepth()&&this.enableRename&&this.readOnly!==true){this.treeEditor.triggerEdit(b)}}},{key:46,stopEvent:true,scope:this,fn:function(a,c){var d=this.getSelectionModel();var b=d.getSelectedNode();if(b&&0!==b.getDepth()&&this.enableDelete&&this.readOnly!==true){this.deleteNode(b)}}},{key:69,ctrl:true,stopEvent:true,scope:this,fn:function(a,c){var d=this.getSelectionModel();var b=d.getSelectedNode();if(b){b=b.isLeaf()?b.parentNode:b;d.select(b);b.reload()}}},{key:39,ctrl:true,stopEvent:true,scope:this,fn:function(a,c){var d=this.getSelectionModel();var b=d.getSelectedNode();if(b&&!b.isLeaf()){d.select(b);b.expand.defer(1,b,[true])}}},{key:37,ctrl:true,scope:this,stopEvent:true,fn:function(a,c){var d=this.getSelectionModel();var b=d.getSelectedNode();if(b&&!b.isLeaf()){d.select(b);b.collapse.defer(1,b,[true])}}},{key:78,ctrl:true,scope:this,stopEvent:true,fn:function(a,c){var d,b;d=this.getSelectionModel();b=d.getSelectedNode();if(b&&this.enableNewDir&&this.readOnly!==true){b=b.isLeaf()?b.parentNode:b;this.createNewDir(b)}}}]});if(!this.loader){this.loader=new Ext.tree.TreeLoader({url:this.url,baseParams:{cmd:"get"},listeners:{beforeload:{scope:this,fn:function(a,b){a.baseParams.path=this.getPath(b)}}}})}if(true===this.topMenu){this.tbar=[{text:this.fileText,disabled:true,scope:this,menu:this.getContextMenu()}]}Ext.ux.FileTreePanel.superclass.initComponent.apply(this,arguments);if(this.treeEditor){this.treeEditor.beforeNodeClick=function(a,b){return true};this.treeEditor.on({complete:{scope:this,fn:this.onEditComplete},beforecomplete:{scope:this,fn:this.onBeforeEditComplete}})}this.on({contextmenu:{scope:this,fn:this.onContextMenu,stopEvent:true},dblclick:{scope:this,fn:this.onDblClick},beforenodedrop:{scope:this,fn:this.onBeforeNodeDrop},nodedrop:{scope:this,fn:this.onNodeDrop},nodedragover:{scope:this,fn:this.onNodeDragOver},newfile:{scope:this,fn:this.onNewFileSuccess},"delete":{scope:this,fn:this.onDeleteSuccess}});this.addEvents("beforeopen","open","beforerename","rename","renamefailure","beforedelete","delete","deletefailure","beforenewdir","newdir","newdirfailure","beforenewfile","newfile","newfilefailure")},onRender:function(){Ext.ux.FileTreePanel.superclass.onRender.apply(this,arguments);if(true===this.topMenu){this.topMenu=Ext.getCmp(this.getTopToolbar().items.itemAt(0).id);this.getSelectionModel().on({scope:this,selectionchange:function(c,b){var a=b?false:true;a=a||this.readOnly;this.topMenu.setDisabled(a)}});Ext.apply(this.topMenu,{showMenu:function(){this.showContextMenu(false)}.createDelegate(this)})}if(this.expandOnRender){this.root.expand()}this.el.on({contextmenu:{fn:function(){return false},stopEvent:true}});if(true===this.loadMask){this.loader.on({scope:this.el,beforeload:this.el.mask.createDelegate(this.el,[this.loadingText+"..."]),load:this.el.unmask,loadexception:this.el.unmask})}},cmdCallback:function(b,h,a){var d,g,e;var f=true;if(true===h){try{g=Ext.decode(a.responseText)}catch(c){this.showError(a.responseText)}if(true===g.success){switch(b.params.cmd){case"delete":if(true!==this.eventsSuspended){this.fireEvent("delete",this,b.node)}b.node.parentNode.removeChild(b.node);break;case"newdir":if(true!==this.eventsSuspended){this.fireEvent("newdir",this,b.node)}break;case"newfile":if(true!==this.eventsSuspended){this.fireEvent("newfile",this,b.node)}break;case"rename":this.updateCls(b.node,b.params.oldname);if(true!==this.eventsSuspended){this.fireEvent("rename",this,b.node,b.params.newname,b.params.oldname)}break}}else{switch(b.params.cmd){case"rename":if(b.oldParent){b.oldParent.appendChild(b.node)}else{b.node.setText(b.oldName)}if(b.e){b.e.failure=true}if(true!==this.eventsSuspended){this.fireEvent("renamefailure",this,b.node,b.params.newname,b.params.oldname)}break;case"newdir":if(false!==this.eventsSuspended){this.fireEvent("newdirfailure",this,b.params.dir)}b.node.parentNode.removeChild(b.node);break;case"newfile":if(false!==this.eventsSuspended){this.fireEvent("newfilefailure",this,b.params.file)}b.node.parentNode.removeChild(b.node);break;case"delete":if(true!==this.eventsSuspended){this.fireEvent("deletefailure",this,b.node)}b.node.parentNode.reload.defer(1,b.node.parentNode);break;default:this.root.reload();break}this.showError(g.error||a.responseText)}}else{this.showError(a.responseText)}},confirmOverwrite:function(a,c,b){Ext.Msg.show({title:this.confirmText,msg:String.format(this.existsText,a)+". "+this.overwriteText,icon:Ext.Msg.QUESTION,buttons:Ext.Msg.YESNO,fn:c.createDelegate(b||this)})},createNewDir:function(d){if(true!==this.eventsSuspended&&false===this.fireEvent("beforenewdir",this,d)){return}var b=this.treeEditor;var a;var c=d.isLeaf()?d.parentNode:d;c.expand(false,false,function(e){a=e.appendChild(new Ext.tree.AsyncTreeNode({text:this.newdirText,iconCls:"folder"}));b.on({complete:{scope:this,single:true,fn:this.onNewDir}});b.creatingNewDir=true;(function(){b.triggerEdit(a)}.defer(10))}.createDelegate(this))},createNewFile:function(d){if(true!==this.eventsSuspended&&false===this.fireEvent("beforenewfile",this,d)){return}var b=this.treeEditor;var a;var c=d.isLeaf()?d.parentNode:d;c.expand(false,false,function(e){a=e.appendChild(new Ext.tree.AsyncTreeNode({text:this.newfileText,leaf:true}));b.on({complete:{scope:this,single:true,fn:this.onNewFile}});b.creatingNewFile=true;(function(){b.triggerEdit(a)}.defer(10))}.createDelegate(this))},deleteNode:function(a){if(true!==this.eventsSuspended&&false===this.fireEvent("beforedelete",this,a)){return}Ext.Msg.show({title:this.deleteText,msg:this.reallyWantText+" "+this.deleteText.toLowerCase()+" <b>"+a.text+"</b>?",icon:Ext.Msg.WARNING,buttons:Ext.Msg.YESNO,scope:this,fn:function(b){if("yes"!==b){this.getEl().dom.focus();return}var c={url:this.deleteUrl||this.url,method:this.method,scope:this,callback:this.cmdCallback,node:a,params:{cmd:"delete",file:this.getPath(a)}};Ext.Ajax.request(c)}})},downloadFile:function(c){var f=Ext.id();var d=document.createElement("iframe");d.id=f;d.name=f;d.className="x-hidden";if(Ext.isIE){d.src=Ext.SSL_SECURE_URL}document.body.appendChild(d);if(Ext.isIE){document.frames[f].name=f}var a=Ext.DomHelper.append(document.body,{tag:"form",method:"post",action:this.downloadUrl||this.url,target:f});document.body.appendChild(a);var b;b=document.createElement("input");b.type="hidden";b.name="cmd";b.value="download";a.appendChild(b);b=document.createElement("input");b.type="hidden";b.name="path";b.value=c;a.appendChild(b);var e=function(){Ext.EventManager.removeListener(d,"load",e,this);setTimeout(function(){document.body.removeChild(a)},100);setTimeout(function(){document.body.removeChild(d)},110)};Ext.EventManager.on(d,"load",e,this);a.submit()},openFile:function(d,e){var h=Ext.id();var f=this.findParentByType("afStudio.wd.widgetTabPanel");var c=f.items.items;var g=this.getFileName(e);var a=f.find("filePath",e);if(a.length>0){var b=a[0];b.show()}else{f.addCodeEditorTab(g,e,e,e)}},getContextMenu:function(){if(!this.contextmenu){var a={singleUpload:this.singleUpload,maxFileSize:this.maxFileSize,enableProgress:this.enableProgress};if(this.baseParams){a.baseParams=this.baseParams}this.contextmenu=new Ext.ux.FileTreeMenu(a);this.contextmenu.on({click:{scope:this,fn:this.onContextClick}});this.uploadPanel=this.contextmenu.getItemByCmd("upload-panel");this.uploadPanel.on({beforeupload:{scope:this,fn:this.onBeforeUpload},allfinished:{scope:this,fn:this.onAllFinished}});this.uploadPanel.setUrl(this.uploadUrl||this.url)}return this.contextmenu},getFileCls:function(a){var b=a.split(".");if(1===b.length){return this.fileCls}else{return this.fileCls+"-"+b.pop().toLowerCase()}},getFileName:function(a){var b=a.split("/");return b[b.length-1]},getPath:function(c){var e,d,b;if(c!==this.root){d=c.parentNode;b=[c.text];while(d&&d!==this.root){b.unshift(d.text);d=d.parentNode}b.unshift(this.root.attributes.path||"");e=b.join(this.pathSeparator)}else{e=c.attributes.path||""}e=e.replace(/^[\/\.]*/,"");return e},hasChild:function(b,a){return(b.isLeaf()?b.parentNode:b).findChild("text",a)!==null},hideContextMenu:function(){if(this.contextmenu&&this.contextmenu.isVisible()){this.contextmenu.hide()}return this},onBeforeEditComplete:function(c,a,b){if(c.cancellingEdit){c.cancellingEdit=false;return}var e=this.getPath(c.editNode);var d=e.replace(/\/[^\\]+$/,"/"+a);if(false===this.fireEvent("beforerename",this,c.editNode,d,e)){c.cancellingEdit=true;c.cancelEdit();return false}},onBeforeNodeDrop:function(g){var f=g.dropNode;var h=g.target.leaf?g.target.parentNode:g.target;if(f.parentNode===h){return false}if(this.hasChild(h,f.text)&&undefined===g.confirmed){this.confirmOverwrite(f.text,function(d){g.confirmed="yes"===d;this.onBeforeNodeDrop(g)});return false}if(false===g.confirmed){return false}g.confirmed=undefined;g.oldParent=f.parentNode;var c=this.getPath(f);var a=this.getPath(h)+"/"+f.text;if(true!==this.eventsSuspended&&false===this.fireEvent("beforerename",this,f,a,c)){return false}var b={url:this.renameUrl||this.url,method:this.method,scope:this,callback:this.cmdCallback,node:f,oldParent:f.parentNode,e:g,params:{cmd:"rename",oldname:c,newname:a}};Ext.Ajax.request(b);return true},onBeforeUpload:function(c){var b=this.getContextMenu();var a=this.getPath(b.node);if(b.node.isLeaf()){a=a.replace(/\/[^\/]+$/,"",a)}c.setPath(a)},onAllFinished:function(a){var b=this.getContextMenu();(b.node.isLeaf()?b.node.parentNode:b.node).reload()},onContextClick:function(d,b,c){if(b.disabled){return}var a=d.node;if(!a){a=d.parentMenu.node}switch(b.cmd){case"reload":a.reload();break;case"expand":a.expand(true);break;case"collapse":a.collapse(true);break;case"open":this.openNode(a);break;case"open-self":this.openNode(a,"_self");break;case"open-popup":this.openNode(a,"popup");break;case"open-blank":this.openNode(a,"_blank");break;case"open-dwnld":this.openNode(a,"download");break;case"rename":this.treeEditor.triggerEdit(a);break;case"delete":this.deleteNode(a);break;case"newdir":this.createNewDir(a);break;case"newfile":this.createNewFile(a);break;default:break}},onContextMenu:function(a,b){if(this.readOnly){return false}this.showContextMenu(a);return false},onDblClick:function(a,b){this.openNode(a)},onDestroy:function(){if(this.contextmenu){this.contextmenu.purgeListeners();this.contextmenu.destroy();this.contextmenu=null}if(this.treeEditor){this.treeEditor.purgeListeners();this.treeEditor.destroy();this.treeEditor=null}if(this.treeSorter){this.treeSorter=null}Ext.ux.FileTreePanel.superclass.onDestroy.call(this)},onEditComplete:function(d,a,c){var e=d.editNode;if(a===c||d.creatingNewDir||d.creatingNewFile){d.creatingNewDir=false;d.creatingNewFile=false;return}var f=this.getPath(e.parentNode);var b={url:this.renameUrl||this.url,method:this.method,scope:this,callback:this.cmdCallback,node:e,oldName:c,params:{cmd:"rename",oldname:f+"/"+c,newname:f+"/"+a}};Ext.Ajax.request(b)},onNewDir:function(b){var c=this.getPath(b.editNode);var a={url:this.newdirUrl||this.url,method:this.method,scope:this,node:b.editNode,callback:this.cmdCallback,params:{cmd:"newdir",dir:c}};Ext.Ajax.request(a)},onNewFile:function(b){var c=this.getPath(b.editNode);var a={url:this.newfileUrl||this.url,method:this.method,scope:this,node:b.editNode,callback:this.cmdCallback,params:{cmd:"newfile",file:c}};Ext.Ajax.request(a)},onNewFileSuccess:function(a,b){this.openNode(b,"_self")},onDeleteSuccess:function(a,d){var f=Ext.getCmp(this.tabPanelId);var e=this.getPath(d);var b=f.find("path",e);if(b.length>0){for(var c in b){f.remove(c)}}},onNodeDragOver:function(a){a.cancel=a.target.disabled||a.dropNode.parentNode===a.target.parentNode&&a.target.isLeaf()},onNodeDrop:function(b){if(true===b.failure){b.oldParent.appendChild(b.dropNode);return}var a=b.dropNode.parentNode.findChild("text",b.dropNode.text);if(a&&a!==b.dropNode){a.parentNode.removeChild(a)}},openNode:function(b,d){if(!this.enableOpen){return}d=d||this.openMode;var a;var c;if(b.isLeaf()){c=this.getPath(b);a=this.hrefPrefix+c+this.hrefSuffix;if(true!==this.eventsSuspended&&false===this.fireEvent("beforeopen",this,b.text,a,d)){return}switch(d){case"popup":if(!this.popup||this.popup.closed){this.popup=window.open(a,this.hrefTarget,this.popupFeatures)}this.popup.location=a;if(this.focusPopup){this.popup.focus()}break;case"_self":this.openFile(b,c);break;case"_blank":window.open(a);break;case"download":this.downloadFile(c);break}if(true!==this.eventsSuspended){this.fireEvent("open",this,b.text,a,d)}}},setDeleteDisabled:function(a){a=!(!a);if(!this.enableDelete===a){return this}this.hideContextMenu();this.enableDelete=!a},setNewdirDisabled:function(a){a=!(!a);if(!this.enableNewDir===a){return this}this.hideContextMenu();this.enableNewDir=!a},setOpenDisabled:function(a){a=!(!a);if(!this.enableOpen===a){return this}this.hideContextMenu();this.enableOpen=!a;return this},setReadOnly:function(a){a=!(!a);if(this.readOnly===a){return this}this.hideContextMenu();if(this.dragZone){this.dragZone.locked=a}this.readOnly=a;return this},setRenameDisabled:function(a){a=!(!a);if(!this.enableRename===a){return this}this.hideContextMenu();if(this.dragZone){this.dragZone.locked=a}this.enableRename=!a;return this},setUploadDisabled:function(a){a=!(!a);if(!this.enableUpload===a){return this}this.hideContextMenu();this.enableUpload=!a;return this},showContextMenu:function(c){var a=false;var b=this.topMenu?this.topMenu.getEl():this.body;if(!c){c=this.getSelectionModel().getSelectedNode();a=true}else{b=c.getUI().getEl()}if(!c){return}var d=this.getContextMenu();d.node=c;d.getItemByCmd("nodename").setText(Ext.util.Format.ellipsis(c.text,22));d.setItemDisabled("open",!c.isLeaf());d.setItemDisabled("reload",c.isLeaf());d.setItemDisabled("expand",c.isLeaf());d.setItemDisabled("collapse",c.isLeaf());d.setItemDisabled("delete",c===this.root||c.disabled);d.setItemDisabled("rename",this.readOnly||c===this.root||c.disabled);d.setItemDisabled("newdir",this.readOnly||(c.isLeaf()?c.parentNode.disabled:c.disabled));d.setItemDisabled("newfile",this.readOnly||(c.isLeaf()?c.parentNode.disabled:c.disabled));d.setItemDisabled("upload",c.isLeaf()?c.parentNode.disabled:c.disabled);d.setItemDisabled("upload-panel",c.isLeaf()?c.parentNode.disabled:c.disabled);d.getItemByCmd("open").setVisible(this.enableOpen);d.getItemByCmd("delete").setVisible(this.enableDelete);d.getItemByCmd("newdir").setVisible(this.enableNewDir);d.getItemByCmd("rename").setVisible(this.enableRename);d.getItemByCmd("upload").setVisible(this.enableUpload);d.getItemByCmd("upload-panel").setVisible(this.enableUpload);d.getItemByCmd("sep-upload").setVisible(this.enableUpload);d.getItemByCmd("sep-collapse").setVisible(this.enableNewDir||this.enableDelete||this.enableRename);d.render();c.select();if(a){d.showAt(d.getEl().getAlignToXY(b,"tl-bl?"))}else{d.showAt(d.getEl().getAlignToXY(b,"tl-tl?",[0,18]))}},showError:function(b,a){Ext.Msg.show({title:a||this.errorText,msg:Ext.util.Format.ellipsis(b,this.maxMsgLen),fixCursor:true,icon:Ext.Msg.ERROR,buttons:Ext.Msg.OK,minWidth:1200>String(b).length?360:600})},updateCls:function(b,a){if(b.isLeaf()){Ext.fly(b.getUI().iconNode).removeClass(this.getFileCls(a));Ext.fly(b.getUI().iconNode).addClass(this.getFileCls(b.text))}}});Ext.reg("filetreepanel",Ext.ux.FileTreePanel);Ext.ux.FileTreeMenu=function(b){b=b||{};var a={hideOnClick:false,cmd:"upload-panel",contextmenu:this,buttonsAt:b.buttonsAt||"tbar",singleUpload:b.singleUpload||false,maxFileSize:b.maxFileSize,enableProgress:b.enableProgress};if(b.baseParams){b.baseParams.cmd=b.baseParams.cmd||"upload";b.baseParams.dir=b.baseParams.dir||".";a.baseParams=b.baseParams}Ext.apply(b,{items:[{text:"&#160",cls:"ux-ftm-nodename",disabledClass:"",disabled:true,cmd:"nodename"},{text:this.openText+" (Enter)",iconCls:this.openIconCls,cmd:"open",menu:{items:[{text:this.openSelfText,iconCls:this.openSelfIconCls,cmd:"open-self"}]}},new Ext.menu.Separator({cmd:"sep-open"}),{text:this.reloadText+" (Ctrl+E)",iconCls:this.reloadIconCls,cmd:"reload"},{text:this.expandText+" (Ctrl+&nbsp;&rarr;)",iconCls:this.expandIconCls,cmd:"expand"},{text:this.collapseText+" (Ctrl+&nbsp;&larr;)",iconCls:this.collapseIconCls,cmd:"collapse"},new Ext.menu.Separator({cmd:"sep-collapse"}),{text:this.renameText+" (F2)",iconCls:this.renameIconCls,cmd:"rename"},{text:this.deleteText+" ("+this.deleteKeyName+")",iconCls:this.deleteIconCls,cmd:"delete"},{text:this.newdirText+"... (Ctrl+N)",iconCls:this.newdirIconCls,cmd:"newdir"},{text:this.newfileText,iconCls:this.newfileIconCls,cmd:"newfile"},new Ext.menu.Separator({cmd:"sep-upload"}),{text:this.uploadFileText+" (Ctrl+U)",iconCls:this.uploadIconCls,hideOnClick:false,cmd:"upload"},new Ext.ux.UploadPanel(a)]});Ext.ux.FileTreeMenu.superclass.constructor.call(this,b);this.relayEvents(this.getItemByCmd("open").menu,["click","itemclick"])};Ext.extend(Ext.ux.FileTreeMenu,Ext.menu.Menu,{collapseIconCls:"icon-collapse-all",collapseText:"Collapse all",deleteIconCls:"icon-cross",deleteKeyName:"Delete Key",deleteText:"Delete",expandIconCls:"icon-expand-all",expandText:"Expand all",newdirIconCls:"icon-folder-add",newdirText:"New folder",newfileIconCls:"icon-plus",newfileText:"New file",openBlankIconCls:"icon-open-blank",openBlankText:"Open in new window",openDwnldIconCls:"icon-open-download",openDwnldText:"Download",openIconCls:"icon-open",openPopupIconCls:"icon-open-popup",openPopupText:"Open in popup",openSelfIconCls:"icon-open-self",openSelfText:"Open in this window",openText:"Open",reloadIconCls:"icon-refresh",reloadText:'R<span style="text-decoration:underline">e</span>load',renameIconCls:"icon-pencil",renameText:"Rename",uploadFileText:'<span style="text-decoration:underline">U</span>pload file',uploadIconCls:"icon-upload",uploadText:"Upload",width:190,getItemByCmd:function(c){var a;var b=this.items.find(function(d){return c===d.cmd});if(!b){a=this.items.find(function(d){return"open"===d.cmd});if(!a){return null}b=a.menu.items.find(function(d){return c===d.cmd})}return b},setItemDisabled:function(c,a){var b=this.getItemByCmd(c);if(b){b.setDisabled(a)}},beforeDestroy:function(){var a=this.getItemByCmd("upload-panel");if(a&&a.component){a.component.purgeListeners();a.component.destroy();a.component=null}}});Ext.reg("filetreemenu",Ext.ux.FileTreeMenu);Ext.namespace("Ext.ux.form");Ext.ux.form.BrowseButton=Ext.extend(Ext.Button,{inputFileName:"file",debug:false,FLOAT_EL_WIDTH:60,FLOAT_EL_HEIGHT:18,buttonCt:null,clipEl:null,floatEl:null,inputFileEl:null,originalHandler:null,originalScope:null,initComponent:function(){Ext.ux.form.BrowseButton.superclass.initComponent.call(this);this.originalHandler=this.handler;this.originalScope=this.scope;this.handler=null;this.scope=null},onRender:function(d,b){Ext.ux.form.BrowseButton.superclass.onRender.call(this,d,b);this.buttonCt=this.el.child(".x-btn-mc em");this.buttonCt.position("relative");var c={position:"absolute",overflow:"hidden",top:"0px",left:"0px"};if(Ext.isIE){Ext.apply(c,{left:"-3px",top:"-3px"})}else{if(Ext.isGecko){Ext.apply(c,{left:"-3px",top:"-3px"})}else{if(Ext.isSafari){Ext.apply(c,{left:"-4px",top:"-2px"})}}}this.clipEl=this.buttonCt.createChild({tag:"div",style:c});this.setClipSize();this.clipEl.on({"mousemove":this.onButtonMouseMove,"mouseover":this.onButtonMouseMove,scope:this});this.floatEl=this.clipEl.createChild({tag:"div",style:{position:"absolute",width:this.FLOAT_EL_WIDTH+"px",height:this.FLOAT_EL_HEIGHT+"px",overflow:"hidden"}});if(this.debug){this.clipEl.applyStyles({"background-color":"green"});this.floatEl.applyStyles({"background-color":"red"})}else{this.clipEl.setOpacity(0)}var a=this.el.child(this.buttonSelector);a.on("focus",this.onButtonFocus,this);if(Ext.isIE){this.el.on("keydown",this.onButtonKeyDown,this)}this.createInputFile()},setClipSize:function(){if(this.clipEl){var b=this.buttonCt.getWidth();var a=this.buttonCt.getHeight();if(b===0||a===0){this.setClipSize.defer(100,this)}else{if(Ext.isIE){b=b+5;a=a+5}else{if(Ext.isGecko){b=b+6;a=a+6}else{if(Ext.isSafari){b=b+6;a=a+6}}}this.clipEl.setSize(b,a)}}},createInputFile:function(){this.floatEl.select("em").each(function(a){a.remove()});this.inputFileEl=this.floatEl.createChild({tag:"input",type:"file",size:1,name:this.inputFileName||Ext.id(this.el),tabindex:this.tabIndex,style:{position:"absolute",cursor:"pointer",right:"0px",top:Ext.isIE?"10px":"0px"}});this.inputFileEl=this.inputFileEl.child("input")||this.inputFileEl;this.inputFileEl.on({"click":this.onInputFileClick,"change":this.onInputFileChange,"focus":this.onInputFileFocus,"select":this.onInputFileFocus,"blur":this.onInputFileBlur,scope:this});if(this.tooltip){if(typeof this.tooltip=="object"){Ext.QuickTips.register(Ext.apply({target:this.inputFileEl},this.tooltip))}else{this.inputFileEl.dom[this.tooltipType]=this.tooltip}}},onButtonFocus:function(a){if(this.inputFileEl){this.inputFileEl.focus();a.stopEvent()}},onButtonKeyDown:function(a){if(this.inputFileEl&&a.getKey()==Ext.EventObject.SPACE){this.inputFileEl.dom.click();a.stopEvent()}},onButtonMouseMove:function(b){var a=b.getXY();a[0]-=this.FLOAT_EL_WIDTH/2;a[1]-=this.FLOAT_EL_HEIGHT/2;this.floatEl.setXY(a)},onInputFileFocus:function(a){if(!this.isDisabled){this.el.addClass("x-btn-over")}},onInputFileBlur:function(a){this.el.removeClass("x-btn-over")},onInputFileClick:function(a){a.stopPropagation()},onInputFileChange:function(){if(this.originalHandler){this.originalHandler.call(this.originalScope,this)}},detachInputFile:function(b){var a=this.inputFileEl;if(typeof this.tooltip=="object"){Ext.QuickTips.unregister(this.inputFileEl)}else{this.inputFileEl.dom[this.tooltipType]=null}this.inputFileEl.removeAllListeners();this.inputFileEl=null;if(!b){this.createInputFile()}return a},getInputFile:function(){return this.inputFileEl},disable:function(){Ext.ux.form.BrowseButton.superclass.disable.call(this);this.inputFileEl.dom.disabled=true},enable:function(){Ext.ux.form.BrowseButton.superclass.enable.call(this);this.inputFileEl.dom.disabled=false}});Ext.reg("browsebutton",Ext.ux.form.BrowseButton);Ext.ux.FileUploader=function(a){Ext.apply(this,a);Ext.ux.FileUploader.superclass.constructor.apply(this,arguments);this.addEvents("beforeallstart","allfinished","beforefilestart","filefinished","progress")};Ext.extend(Ext.ux.FileUploader,Ext.util.Observable,{baseParams:{cmd:"upload",dir:"."},concurrent:true,enableProgress:true,jsonErrorText:"Cannot decode JSON object",maxFileSize:524288,progressIdName:"UPLOAD_IDENTIFIER",progressInterval:2000,progressUrl:"progress.php",progressMap:{bytes_total:"bytesTotal",bytes_uploaded:"bytesUploaded",est_sec:"estSec",files_uploaded:"filesUploaded",speed_average:"speedAverage",speed_last:"speedLast",time_last:"timeLast",time_start:"timeStart"},singleUpload:false,unknownErrorText:"Unknown error",upCount:0,createForm:function(a){var c=parseInt(Math.random()*10000000000,10);var b=Ext.getBody().createChild({tag:"form",action:this.url,method:"post",cls:"x-hidden",id:Ext.id(),cn:[{tag:"input",type:"hidden",name:"APC_UPLOAD_PROGRESS",value:c},{tag:"input",type:"hidden",name:this.progressIdName,value:c},{tag:"input",type:"hidden",name:"MAX_FILE_SIZE",value:this.maxFileSize}]});if(a){if(Ext.isIE){a.set("form",undefined)}else{a.set("form",b)}a.set("progressId",c)}else{this.progressId=c}return b},deleteForm:function(b,a){b.remove();if(a){a.set("form",null)}},fireFinishEvents:function(a){if(true!==this.eventsSuspended&&!this.singleUpload){this.fireEvent("filefinished",this,a&&a.record)}if(true!==this.eventsSuspended&&0===this.upCount){this.stopProgress();this.fireEvent("allfinished",this)}},getIframe:function(a){var b=null;var c=a.get("form");if(c&&c.dom&&c.dom.target){b=Ext.get(c.dom.target)}return b},getOptions:function(a,c){var b={url:this.url,method:"post",isUpload:true,scope:this,callback:this.uploadCallback,record:a,params:this.getParams(a,c)};return b},getParams:function(a,c){var b={path:this.path};Ext.apply(b,this.baseParams||{},c||{});return b},processSuccess:function(c,b,d){var a=false;if(this.singleUpload){this.store.each(function(e){e.set("state","done");e.set("error","");e.commit()})}else{a=c.record;a.set("state","done");a.set("error","");a.commit()}this.deleteForm(c.form,a)},processFailure:function(e,c,d){var a=e.record;var b;if(this.singleUpload){b=this.store.queryBy(function(f){var g=f.get("state");return"done"!==g&&"uploading"!==g});b.each(function(f){var g=d.errors?d.errors[f.id]:this.unknownErrorText;if(g){f.set("state","failed");f.set("error",g);Ext.getBody().appendChild(f.get("input"))}else{f.set("state","done");f.set("error","")}f.commit()},this);this.deleteForm(e.form)}else{if(d&&"object"===Ext.type(d)){a.set("error",d.errors&&d.errors[a.id]?d.errors[a.id]:this.unknownErrorText)}else{if(d){a.set("error",d)}else{if(c&&c.responseText){a.set("error",c.responseText)}else{a.set("error",this.unknownErrorText)}}}a.set("state","failed");a.commit()}},requestProgress:function(){var a,b;var c={url:this.progressUrl,method:"post",params:{},scope:this,callback:function(f,j,d){var h;if(true!==j){return}try{h=Ext.decode(d.responseText)}catch(g){return}if("object"!==Ext.type(h)||true!==h.success){return}if(this.singleUpload){this.progress={};for(b in h){if(this.progressMap[b]){this.progress[this.progressMap[b]]=parseInt(h[b],10)}}if(true!==this.eventsSuspended){this.fireEvent("progress",this,this.progress)}}else{for(b in h){if(this.progressMap[b]&&f.record){f.record.set(this.progressMap[b],parseInt(h[b],10))}}if(f.record){f.record.commit();if(true!==this.eventsSuspended){this.fireEvent("progress",this,f.record.data,f.record)}}}this.progressTask.delay(this.progressInterval)}};if(this.singleUpload){c.params[this.progressIdName]=this.progressId;c.params.APC_UPLOAD_PROGRESS=this.progressId;Ext.Ajax.request(c)}else{a=this.store.query("state","uploading");a.each(function(d){c.params[this.progressIdName]=d.get("progressId");c.params.APC_UPLOAD_PROGRESS=c.params[this.progressIdName];c.record=d;(function(){Ext.Ajax.request(c)}).defer(250)},this)}},setPath:function(a){this.path=a},setUrl:function(a){this.url=a},startProgress:function(){if(!this.progressTask){this.progressTask=new Ext.util.DelayedTask(this.requestProgress,this)}this.progressTask.delay.defer(this.progressInterval/2,this.progressTask,[this.progressInterval])},stopProgress:function(){if(this.progressTask){this.progressTask.cancel()}},stopAll:function(){var a=this.store.query("state","uploading");a.each(this.stopUpload,this)},stopUpload:function(a){var b=false;if(a){b=this.getIframe(a);this.stopIframe(b);this.upCount--;this.upCount=0>this.upCount?0:this.upCount;a.set("state","stopped");this.fireFinishEvents({record:a})}else{if(this.form){b=Ext.fly(this.form.dom.target);this.stopIframe(b);this.upCount=0;this.fireFinishEvents()}}},stopIframe:function(a){if(a){try{a.dom.contentWindow.stop();a.remove.defer(250,a)}catch(b){}}},upload:function(){var a=this.store.queryBy(function(b){return"done"!==b.get("state")});if(!a.getCount()){return}if(true!==this.eventsSuspended&&false===this.fireEvent("beforeallstart",this)){return}if(this.singleUpload){this.uploadSingle()}else{a.each(this.uploadFile,this)}if(true===this.enableProgress){this.startProgress()}},uploadCallback:function(b,f,a){var d;this.upCount--;this.form=false;if(true===f){try{d=Ext.decode(a.responseText)}catch(c){this.processFailure(b,a,this.jsonErrorText);this.fireFinishEvents(b);return}if(true===d.success){this.processSuccess(b,a,d)}else{this.processFailure(b,a,d)}}else{this.processFailure(b,a)}this.fireFinishEvents(b)},uploadFile:function(a,e){if(true!==this.eventsSuspended&&false===this.fireEvent("beforefilestart",this,a)){return}var c=this.createForm(a);var b=a.get("input");b.set({name:b.id});c.appendChild(b);var d=this.getOptions(a,e);d.form=c;a.set("state","uploading");a.set("pctComplete",0);this.upCount++;Ext.Ajax.request(d);this.getIframe.defer(100,this,[a])},uploadSingle:function(){var a=this.store.queryBy(function(d){return"done"!==d.get("state")});if(!a.getCount()){return}var b=this.createForm();a.each(function(d){var e=d.get("input");e.set({name:e.id});b.appendChild(e);d.set("state","uploading")},this);var c=this.getOptions();c.form=b;this.form=b;this.upCount++;Ext.Ajax.request(c)}});Ext.reg("fileuploader",Ext.ux.FileUploader);Ext.ux.UploadPanel=Ext.extend(Ext.Panel,{addIconCls:"icon-plus",addText:"Add",bodyStyle:"padding:2px",buttonsAt:"tbar",clickRemoveText:"Click to remove",clickStopText:"Click to stop",emptyText:"No files",enableProgress:true,errorText:"Error",fileCls:"file",fileQueuedText:"File <b>{0}</b> is queued for upload",fileDoneText:"File <b>{0}</b> has been successfully uploaded",fileFailedText:"File <b>{0}</b> failed to upload",fileStoppedText:"File <b>{0}</b> stopped by user",fileUploadingText:"Uploading file <b>{0}</b>",maxFileSize:524288,maxLength:18,removeAllIconCls:"icon-cross",removeAllText:"Remove All",removeIconCls:"icon-minus",removeText:"Remove",selectedClass:"ux-up-item-selected",singleUpload:false,stopAllText:"Stop All",stopIconCls:"icon-stop",uploadText:"Upload",uploadIconCls:"icon-upload",workingIconCls:"icon-working",initComponent:function(){var d={xtype:"browsebutton",text:this.addText+"...",iconCls:this.addIconCls,scope:this,handler:this.onAddFile};var b={xtype:"button",iconCls:this.uploadIconCls,text:this.uploadText,scope:this,handler:this.onUpload,disabled:true};var e={xtype:"button",iconCls:this.removeAllIconCls,tooltip:this.removeAllText,scope:this,handler:this.onRemoveAllClick,disabled:true};if("body"!==this.buttonsAt){this[this.buttonsAt]=[d,b,"->",e]}var a=[{name:"id",type:"text",system:true},{name:"shortName",type:"text",system:true},{name:"fileName",type:"text",system:true},{name:"filePath",type:"text",system:true},{name:"fileCls",type:"text",system:true},{name:"input",system:true},{name:"form",system:true},{name:"state",type:"text",system:true},{name:"error",type:"text",system:true},{name:"progressId",type:"int",system:true},{name:"bytesTotal",type:"int",system:true},{name:"bytesUploaded",type:"int",system:true},{name:"estSec",type:"int",system:true},{name:"filesUploaded",type:"int",system:true},{name:"speedAverage",type:"int",system:true},{name:"speedLast",type:"int",system:true},{name:"timeLast",type:"int",system:true},{name:"timeStart",type:"int",system:true},{name:"pctComplete",type:"int",system:true}];if(Ext.isArray(this.customFields)){a.push(this.customFields)}this.store=new Ext.data.SimpleStore({id:0,fields:a,data:[]});Ext.apply(this,{items:[{xtype:"dataview",itemSelector:"div.ux-up-item",store:this.store,selectedClass:this.selectedClass,singleSelect:true,emptyText:this.emptyText,tpl:this.tpl||new Ext.XTemplate('<tpl for=".">'+'<div class="ux-up-item">'+'<div class="ux-up-icon-file {fileCls}">&#160;</div>'+'<div class="ux-up-text x-unselectable" qtip="{fileName}">{shortName}</div>'+'<div id="remove-{[values.input.id]}" class="ux-up-icon-state ux-up-icon-{state}"'+'qtip="{[this.scope.getQtip(values)]}">&#160;</div>'+"</div>"+"</tpl>",{scope:this}),listeners:{click:{scope:this,fn:this.onViewClick}}}]});Ext.ux.UploadPanel.superclass.initComponent.apply(this,arguments);this.view=this.items.itemAt(0);this.addEvents("beforefileadd","fileadd","beforefileremove","fileremove","beforequeueclear","queueclear","beforeupload");this.relayEvents(this.view,["beforeclick","beforeselect","click","containerclick","contextmenu","dblclick","selectionchange"]);var c={store:this.store,singleUpload:this.singleUpload,maxFileSize:this.maxFileSize,enableProgress:this.enableProgress,url:this.url,path:this.path};if(this.baseParams){c.baseParams=this.baseParams}this.uploader=new Ext.ux.FileUploader(c);this.relayEvents(this.uploader,["beforeallstart","allfinished","progress"]);this.on({beforeallstart:{scope:this,fn:function(){this.uploading=true;this.updateButtons()}},allfinished:{scope:this,fn:function(){this.uploading=false;this.updateButtons()}},progress:{fn:this.onProgress.createDelegate(this)}})},onRender:function(){Ext.ux.UploadPanel.superclass.onRender.apply(this,arguments);var a="tbar"===this.buttonsAt?this.getTopToolbar():this.getBottomToolbar();this.addBtn=Ext.getCmp(a.items.first().id);this.uploadBtn=Ext.getCmp(a.items.itemAt(1).id);this.removeAllBtn=Ext.getCmp(a.items.last().id);this.ownerCt.doLayout()},getQtip:function(a){var b="";switch(a.state){case"queued":b=String.format(this.fileQueuedText,a.fileName);b+="<br>"+this.clickRemoveText;break;case"uploading":b=String.format(this.fileUploadingText,a.fileName);b+="<br>"+a.pctComplete+"% done";b+="<br>"+this.clickStopText;break;case"done":b=String.format(this.fileDoneText,a.fileName);b+="<br>"+this.clickRemoveText;break;case"failed":b=String.format(this.fileFailedText,a.fileName);b+="<br>"+this.errorText+":"+a.error;b+="<br>"+this.clickRemoveText;break;case"stopped":b=String.format(this.fileStoppedText,a.fileName);b+="<br>"+this.clickRemoveText;break}return b},getFileName:function(a){return a.getValue().split(/[\/\\]/).pop()},getFilePath:function(a){return a.getValue().replace(/[^\/\\]+$/,"")},getFileCls:function(a){var b=a.split(".");if(1===b.length){return this.fileCls}else{return this.fileCls+"-"+b.pop().toLowerCase()}},onAddFile:function(c){if(true!==this.eventsSuspended&&false===this.fireEvent("beforefileadd",this,c.getInputFile())){return}var a=c.detachInputFile();a.addClass("x-hidden");var d=this.getFileName(a);var b=new this.store.recordType({input:a,fileName:d,filePath:this.getFilePath(a),shortName:Ext.util.Format.ellipsis(d,this.maxLength),fileCls:this.getFileCls(d),state:"queued"},a.id);b.commit();this.store.add(b);this.syncShadow();this.uploadBtn.enable();this.removeAllBtn.enable();if(true!==this.eventsSuspended){this.fireEvent("fileadd",this,this.store,b)}},onDestroy:function(){if(this.uploader){this.uploader.stopAll();this.uploader.purgeListeners();this.uploader=null}if(this.view){this.view.purgeListeners();this.view.destroy();this.view=null}if(this.store){this.store.purgeListeners();this.store.destroy();this.store=null}},onProgress:function(h,f,g){var e,d,j,a,l,m,b,c;if(g){a=g.get("state");e=g.get("bytesTotal")||1;d=g.get("bytesUploaded")||0;if("uploading"===a){j=Math.round(1000*d/e)/10}else{if("done"===a){j=100}else{j=0}}g.set("pctComplete",j);l=this.store.indexOf(g);m=Ext.get(this.view.getNode(l));if(m){b=m.getWidth();m.applyStyles({"background-position":b*j/100+"px"})}}},onRemoveFile:function(a){if(true!==this.eventsSuspended&&false===this.fireEvent("beforefileremove",this,this.store,a)){return}var d=a.get("input");var b=d.up("em");d.remove();if(b){b.remove()}this.store.remove(a);var c=this.store.getCount();this.uploadBtn.setDisabled(!c);this.removeAllBtn.setDisabled(!c);if(true!==this.eventsSuspended){this.fireEvent("fileremove",this,this.store);this.syncShadow()}},onRemoveAllClick:function(a){if(true===this.uploading){this.stopAll()}else{this.removeAll()}},stopAll:function(){this.uploader.stopAll()},onViewClick:function(a,b,d,f){var c=f.getTarget("div:any(.ux-up-icon-queued|.ux-up-icon-failed|.ux-up-icon-done|.ux-up-icon-stopped)");if(c){this.onRemoveFile(this.store.getAt(b))}c=f.getTarget("div.ux-up-icon-uploading");if(c){this.uploader.stopUpload(this.store.getAt(b))}},onUpload:function(){if(true!==this.eventsSuspended&&false===this.fireEvent("beforeupload",this)){return false}this.uploader.upload()},setUrl:function(a){this.url=a;this.uploader.setUrl(a)},setPath:function(a){this.uploader.setPath(a)},updateButtons:function(){if(true===this.uploading){this.addBtn.disable();this.uploadBtn.disable();this.removeAllBtn.setIconClass(this.stopIconCls);this.removeAllBtn.getEl().child(this.removeAllBtn.buttonSelector).dom[this.removeAllBtn.tooltipType]=this.stopAllText}else{this.addBtn.enable();this.uploadBtn.enable();this.removeAllBtn.setIconClass(this.removeAllIconCls);this.removeAllBtn.getEl().child(this.removeAllBtn.buttonSelector).dom[this.removeAllBtn.tooltipType]=this.removeAllText}},removeAll:function(){var a=this.eventsSuspended;if(false!==this.eventsSuspended&&false===this.fireEvent("beforequeueclear",this,this.store)){return false}this.suspendEvents();this.store.each(this.onRemoveFile,this);this.eventsSuspended=a;if(true!==this.eventsSuspended){this.fireEvent("queueclear",this,this.store)}this.syncShadow()},syncShadow:function(){if(this.contextmenu&&this.contextmenu.shadow){this.contextmenu.getEl().shadow.show(this.contextmenu.getEl())}}});Ext.reg("uploadpanel",Ext.ux.UploadPanel);Ext.namespace("afStudio.wi");afStudio.wi.BaseBehavior=function(){};Ext.apply(afStudio.wi.BaseBehavior.prototype,{createBehaviorProperties:function(){return[]},configureFor:function(a){},propertyChanged:function(a){},dumpDataForWidgetDefinition:function(a){return a},setNode:function(a){this.node=a}});Ext.namespace("afStudio.wi");afStudio.wi.WithNamePropertyAsLabelBehavior=Ext.extend(afStudio.wi.BaseBehavior,{propertyChanged:function(a){if(a.id=="name"){this.namePropertyChanged(a)}},namePropertyChanged:function(a){this.node.setText(a.get("value"))}});Ext.namespace("afStudio.wi");afStudio.wi.WithValueTypeBehavior=Ext.extend(afStudio.wi.BaseBehavior,{setValueTypeDataKey:function(a){this.key=a},createBehaviorProperties:function(){return[new afStudio.wi.ValueType().create(),new afStudio.wi.ValueSource().create()]},getValueTypeData:function(a){if(this.key){if(a[this.key]){return a[this.key]}else{return{}}}else{return a}},mergeInValueTypeData:function(b,a){if(this.key){b[this.key]=a}else{for(i in a){b[i]=a[i]}}return b},configureFor:function(c){if(c){var a=this.getValueTypeData(c);this.node.getProperty("valueType").set("value",a["type"]);var b=this.node.getProperty("valueSource");if(a["i:source"]){b.set("value","source")}else{if(a["i:class"]){b.set("value","classAndMethod")}else{if(a["i:item"]){b.set("value","item")}else{if(a["i:static"]){b.set("value","static")}}}}this.valueSourceChanged(a)}},valueSourceChanged:function(e){if(!e){e={}}if(this.node.rendered){var f=this.node.childNodes.length;if(f>0){for(var d=(f-1);d>=0;d--){var c=this.node.childNodes[d];if(c.text=="Value Source"){c.destroy()}}}}switch(this.node.getProperty("valueSource").get("value")){case"source":var b=new afStudio.wi.FieldNodeValueSourceSource();if(e["i:source"]){var a=e["i:source"];a["sourceName"]=a["name"]}break;case"classAndMethod":var b=new afStudio.wi.FieldNodeValueSourceMethod();var a=e;break;case"item":var b=new afStudio.wi.FieldNodeValueSourceItem();if(e["i:item"]){var a=e["i:item"]}break;case"static":var b=new afStudio.wi.FieldNodeValueSourceStatic();if(e["i:static"]){var a=e["i:static"]}break}if(b){if(a){b.configureFor(a)}this.node.appendChild(b)}},propertyChanged:function(a){if(a.id=="valueSource"){this.valueSourceChanged()}},dumpDataForWidgetDefinition:function(c){if(c["valueType"]){delete c.valueType}if(c["valueSource"]){delete c.valueSource}var d=this.node.getProperty("valueType").get("value");var b=this.node.getProperty("valueSource").get("value");var a={};if(d){a["type"]=d}else{a["type"]="orm"}if(a["type"]=="orm"){switch(b){case"source":a["i:source"]={name:c["sourceName"]};delete c["sourceName"];c=this.mergeInValueTypeData(c,a);break;case"classAndMethod":a["i:class"]=c["i:class"];if(c["i:method"]&&c["i:method"]!=""){a["i:method"]={name:c["i:method"],"i:param":c["i:param"]};delete c["i:param"];delete c["i:class"];delete c["i:method"]}c=this.mergeInValueTypeData(c,a);break;case"item":a["i:source"]={name:c["name"]};c=this.mergeInValueTypeData(c,a);break;case"static":a["i:source"]={name:c["name"]};c=this.mergeInValueTypeData(c,a);break}}return c}});Ext.namespace("afStudio.wi");afStudio.wi.WithIParamsBehavior=Ext.extend(afStudio.wi.BaseBehavior,{setProperties:function(a){this.properties=a},createBehaviorProperties:function(){return this.properties},configureFor:function(f){if(f["i:params"]){var d=f["i:params"];delete f["i:params"];if(!d["i:param"]){return}if(Ext.isArray(d["i:param"])){d=d["i:param"]}else{d=[d["i:param"]]}var e={};for(var c=0;c<d.length;c++){e[d[c]["name"]]=d[c]["_content"]}for(var c=0;c<this.properties.length;c++){var b=this.properties[c],a=b.id;if(e[a]){b.set("value",e[a])}}}},dumpDataForWidgetDefinition:function(f){var e=[];for(var d=0;d<this.properties.length;d++){var c=this.properties[d],b=c.id,a=c.get("value");if(f[b]){e.push({"name":b,"_content":a})}delete f[b]}f["i:params"]={"i:param":e};return f}});Ext.namespace("afStudio.wi");afStudio.wi.BaseNode=Ext.extend(Ext.tree.TreeNode,{constructor:function(a){a=Ext.apply(a||this.getNodeConfig(),{editable:false});this.createContextMenu();afStudio.wi.BaseNode.superclass.constructor.call(this,a);this._initEvents();this.createProperties();this.addRequiredChilds();this.behaviors=[]},getNodeConfig:Ext.emptyFn,createContextMenu:Ext.emptyFn,_initEvents:function(){if(Ext.isFunction(this.onContextMenuClick)){this.on("contextmenu",this.onContextMenuClick)}},onContextMenuClick:Ext.emptyFn,createProperties:function(){return[]},addRequiredChilds:Ext.emptyFn,getProperties:function(){var a=[];for(i in this.properties){a.push(this.properties[i])}return a},getProperty:function(a){return this.properties[a]},getPropertyValue:function(a){return this.properties[a].get("value")},setProperty:function(b,a){this.getProperty(b).set("value",a)},addProperty:function(a){if(!this.properties){this.properties={}}a.WITreeNode=this;this.properties[a.id]=a},addProperties:function(b){for(var a=0;a<b.length;a++){this.addProperty(b[a])}},configureFor:function(c){for(var b in c){this.configureForValue(b,c[b])}for(var a=0;a<this.behaviors.length;a++){this.behaviors[a].configureFor(c)}},configureForValue:function(e,b){if(this.properties&&this.properties[e]){var a=this.getProperty(e);a.set("value",b);this.propertyChanged(a)}else{var d=this.findChild("id",e);if(d){d.configureFor(b)}else{d=this.findChild("childNodeId",e);if(d){var c={};c[e]=b;d.configureFor(c)}}}},propertyChanged:function(b){if(!b){return}for(var a=0;a<this.behaviors.length;a++){this.behaviors[a].propertyChanged(b)}},dumpDataForWidgetDefinition:function(c){if(!c){c={}}var a=this.dumpChildsData();var d=this.dumpPropertiesData();Ext.apply(a,d);for(var b=0;b<this.behaviors.length;b++){a=this.behaviors[b].dumpDataForWidgetDefinition(a)}if(this.id.substr(0,6)=="xnode-"){for(b in a){c[b]=a[b]}}else{c[this.id]=a}return c},dumpChildsData:function(){var a={};this.eachChild(function(b){a=b.dumpDataForWidgetDefinition(a)});return a},dumpPropertiesData:function(){var c={};for(i in this.properties){var b=this.properties[i];var a=b.get("value");if(a===false){a="false"}else{if(a===true){a="true"}}if(!Ext.isEmpty(b.id)){c[b.id]=a}}return c},getPropertyRecordCfg:Ext.emptyFn,addBehavior:function(a){a.setNode(this);this.behaviors.push(a);this.addProperties(a.createBehaviorProperties())}});afStudio.wi.ContainerNode=Ext.extend(afStudio.wi.BaseNode,{});afStudio.wi.CollectionNode=Ext.extend(afStudio.wi.BaseNode,{addChildActionLabel:"Add child",childNodeId:"i:child",dumpEvenWhenEmpty:true,createContextMenu:function(){this.contextMenu=new Ext.menu.Menu({items:[{text:this.addChildActionLabel,iconCls:"icon-add",handler:this.onContextAddChildItemClick,scope:this}]})},onContextMenuClick:function(a,b){a.select();this.contextMenu.showAt(b.getXY())},onContextAddChildItemClick:function(b,c){var a=this.addChild()},configureForValue:function(d,c){if(d==this.childNodeId){if(!Ext.isArray(c)){c=[c]}for(var b=0;b<c.length;b++){var a=this.addChild();a.configureFor(c[b])}}else{afStudio.wi.CollectionNode.superclass.configureForValue.apply(this,arguments)}},addChild:function(){var a=this.createChild();this.appendChild(a);if(this.rendered){this.expand()}return a},dumpChildsData:function(){var b=[],a={};this.eachChild(function(c){b.push(c.dumpDataForWidgetDefinition())});if(b.length==0&&!this.dumpEvenWhenEmpty){return a}a[this.childNodeId]=b;return a},createChild:Ext.emptyFn});afStudio.wi.FieldsNode=Ext.extend(afStudio.wi.CollectionNode,{constructor:function(a){this.childIdsOrdered=[];afStudio.wi.FieldsNode.superclass.constructor.apply(this,arguments)},createProperties:function(){this.addProperties([new afStudio.wi.PropertyTypeString({id:"url",label:"Url"}).create(),new afStudio.wi.PropertyTypeString({id:"action",label:"Action"}).create(),new afStudio.wi.PropertyTypeBoolean({id:"classic",label:"Classic"}).create(),new afStudio.wi.PropertyTypeString({id:"bodyStyle",label:"Body Style"}).create(),new afStudio.wi.PropertyTypeString({id:"redirect",label:"Redirect"}).create(),new afStudio.wi.PropertyTypeBoolean({id:"remoteLoad",label:"Remote Load"}).create(),new afStudio.wi.PropertyTypeString({id:"plugin",label:"Plugin"}).create()])},addChild:function(){var a=afStudio.wi.FieldsNode.superclass.addChild.apply(this,arguments);this.childIdsOrdered.push(a.id);return a},deleteChild:function(a){if(this.childIdsOrdered.indexOf(a.id)!=-1){this.childIdsOrdered.remove(a.id);a.destroy()}},dumpChildsData:function(){var c=[],d=[],a={};for(var b=0;b<this.childIdsOrdered.length;b++){var e=this.findChild("id",this.childIdsOrdered[b]);d.push(e)}for(var b=0;b<d.length;b++){c.push(d[b].dumpDataForWidgetDefinition())}if(c.length==0&&!this.dumpEvenWhenEmpty){return a}a[this.childNodeId]=c;return a},setChildsOrder:function(a){this.childIdsOrdered=a}});afStudio.wi.NodeBuilder={createContainerNode:function(a,b){if(!b){b=afStudio.wi.ContainerNode}var c=Ext.extend(b,{});var d=c.prototype;d.getNodeConfig=function(){var e={};if(a.id){e.id=a.id}if(a.text){e.text=a.text}if(a.iconCls){e.iconCls=a.iconCls}if(a.metaField){e.metaField=a.metaField}return e};if(a.createProperties){d.createProperties=function(){var e=a.createProperties.call(this);this.addProperties(e)}}if(a.createRequiredChilds){d.addRequiredChilds=function(){var f=a.createRequiredChilds();for(var e=0;e<f.length;e++){this.appendChild(f[e])}}}return c},createCollectionNode:function(a,b){var c=this.createContainerNode(a,(b?b:afStudio.wi.CollectionNode));var d=c.prototype;if(a.addChildActionLabel){d.addChildActionLabel=a.addChildActionLabel}if(a.childNodeId){d.childNodeId=a.childNodeId}if(Ext.isDefined(a.dumpEvenWhenEmpty)){d.dumpEvenWhenEmpty=a.dumpEvenWhenEmpty}if(a.createChildConstructor){d.createChild=function(){return new a.createChildConstructor}}return c}};afStudio.wi.ValidatorsNode=Ext.extend(afStudio.wi.CollectionNode,{addChildActionLabel:"Add Validator",childNodeId:"i:validator",getNodeConfig:function(){return{"text":"Validators","childNodeId":"i:validator"}},createChild:function(){return new afStudio.wi.ValidatorNode()},dumpDataForWidgetDefinition:function(){var a=this.dumpChildsData();var b=this.dumpPropertiesData();for(key in b){if(b[key]!=""){a[key]=b[key]}}for(i=0;i<this.behaviors.length;i++){a=this.behaviors[i].dumpDataForWidgetDefinition(this,a)}return a}});afStudio.wi.FieldNode=Ext.extend(afStudio.wi.ContainerNode,{constructor:function(){afStudio.wi.FieldNode.superclass.constructor.apply(this,arguments);var a=new afStudio.wi.WithValueTypeBehavior;a.setValueTypeDataKey("i:value");this.addBehavior(a);this.addBehavior(new afStudio.wi.WithNamePropertyAsLabelBehavior)},getNodeConfig:function(){return{"text":"new field","iconCls":"icon-field"}},createProperties:function(){var a=[new afStudio.wi.PropertyTypeString({id:"name",label:"Name"}).setRequired().create(),new afStudio.wi.PropertyTypeString({id:"label",label:"Label"}).create(),new afStudio.wi.FieldType().create(),new afStudio.wi.PropertyTypeString({id:"state",label:"State"}).create(),new afStudio.wi.PropertyTypeString({id:"style",label:"Style"}).create()];this.addProperties(a)},addRequiredChilds:function(){this.validatorsNode=new afStudio.wi.ValidatorsNode;this.appendChild(this.validatorsNode)},setNameAndLabel:function(b,a){this.properties["name"].set("value",b);this.properties["label"].set("value",a)},setTypeAndValidatorFromModelType:function(a){this.setTypeFromModelType(a.type);if(a.required){var b=this.validatorsNode.addChild();b.getProperty("name").set("value","immValidatorRequired")}},setTypeFromModelType:function(a){var b="";if(a.substr(0,7)=="varchar"){a="varchar"}switch(a){case"integer":b="input";break;case"varchar":b="input";break;case"longvarchar":b="textarea";break;case"timestamp":b="input";break;case"boolean":b="checkbox";break;default:break}this.properties["type"].set("value",b)}});afStudio.wi.ValidatorNode=Ext.extend(afStudio.wi.CollectionNode,{addChildActionLabel:"Add Parameter",childNodeId:"i:param",constructor:function(){afStudio.wi.ValidatorNode.superclass.constructor.apply(this,arguments);this.addBehavior(new afStudio.wi.WithNamePropertyAsLabelBehavior)},getNodeConfig:function(){return{"text":"Validator"}},createChild:function(){return new afStudio.wi.ParamNode()},createProperties:function(){var a=[new afStudio.wi.PropertyTypeString({id:"name",label:"Name"}).setRequired().create()];this.addProperties(a)}});afStudio.wi.ParamNode=Ext.extend(afStudio.wi.ContainerNode,{constructor:function(){afStudio.wi.ParamNode.superclass.constructor.apply(this,arguments);this.addBehavior(new afStudio.wi.WithNamePropertyAsLabelBehavior)},getNodeConfig:function(){return{"text":"parameter"}},createProperties:function(){var a=[new afStudio.wi.PropertyTypeString({id:"name",label:"Name"}).setRequired().create(),new afStudio.wi.PropertyTypeString({id:"_content",label:"Value"}).setRequired().create()];this.addProperties(a)}});afStudio.wi.FieldNodeValueSourceBase=Ext.extend(afStudio.wi.ContainerNode,{getNodeConfig:function(){return{"text":"Value Source"}}});afStudio.wi.FieldNodeValueSourceSource=Ext.extend(afStudio.wi.FieldNodeValueSourceBase,{createProperties:function(){this.addProperty(new afStudio.wi.PropertyTypeString({id:"sourceName",label:"Name"}).setRequired().create())}});afStudio.wi.FieldNodeValueSourceMethod=Ext.extend(afStudio.wi.CollectionNode,{addChildActionLabel:"Add Param",childNodeId:"i:param",getNodeConfig:function(){return{"text":"Value Source"}},createChild:function(){return new afStudio.wi.ParamNode()},createProperties:function(){this.addProperty(new afStudio.wi.PropertyTypeString({id:"i:class",label:"Class"}).setRequired().create());this.addProperty(new afStudio.wi.PropertyTypeString({id:"i:method",label:"Method"}).setRequired().create())},configureFor:function(d){if(d["i:method"]){var c=d["i:method"];if(c["i:param"]){var a=c["i:param"]}var b=c["name"];d["i:method"]=b;if(a){d["i:param"]=a}}afStudio.wi.FieldNodeValueSourceMethod.superclass.configureFor.apply(this,[d])}});afStudio.wi.FieldNodeValueSourceItem=Ext.extend(afStudio.wi.FieldNodeValueSourceBase,{createProperties:function(){this.addProperty(new afStudio.wi.PropertyTypeString({id:"i:item",label:"Item"}).setRequired().create())}});afStudio.wi.FieldNodeValueSourceStatic=Ext.extend(afStudio.wi.FieldNodeValueSourceBase,{createProperties:function(){this.addProperty(new afStudio.wi.PropertyTypeString({id:"i:static",label:"Callback function"}).setRequired().create())}});afStudio.wi.ActionNode=Ext.extend(afStudio.wi.ContainerNode,{deleteNodeActionLabel:"Delete Action",constructor:function(){afStudio.wi.ActionNode.superclass.constructor.apply(this,arguments);this.addBehavior(new afStudio.wi.WithNamePropertyAsLabelBehavior)},getNodeConfig:function(){return{text:"newaction",metaField:"i:action"}},createContextMenu:function(){this.contextMenu=new Ext.menu.Menu({items:[{text:this.deleteNodeActionLabel,iconCls:"afs-icon-delete",handler:this.onContextDeleteChildItemClick,scope:this}]})},onContextMenuClick:function(a,b){a.select();this.contextMenu._node=a;this.contextMenu.showAt(b.getXY())},createProperties:function(){var a=[new afStudio.wi.PropertyTypeString({id:"name",label:"Name",defaultValue:"newaction",required:true}).create(),new afStudio.wi.PropertyTypeString({id:"url",label:"Url",required:true}).create(),new afStudio.wi.PropertyTypeString({id:"text",label:"Text"}).create(),new afStudio.wi.PropertyTypeString({id:"iconCls",label:"Icon CSS class"}).create(),new afStudio.wi.PropertyTypeString({id:"icon",label:"Icon URL"}).create(),new afStudio.wi.PropertyTypeBoolean({id:"forceSelection",label:"Force selection"}).create(),new afStudio.wi.PropertyTypeBoolean({id:"post",label:"Post"}).create(),new afStudio.wi.PropertyTypeString({id:"tooltip",label:"Tooltip"}).create(),new afStudio.wi.PropertyTypeString({id:"confirmMsg",label:"Confirm message"}).create(),new afStudio.wi.PropertyTypeString({id:"condition",label:"Condition"}).create(),new afStudio.wi.PropertyTypeString({id:"style",label:"Style"}).create()];this.addProperties(a)},onContextDeleteChildItemClick:function(a,b){a.parentMenu._node.remove()}});afStudio.wi.ColumnNode=Ext.extend(afStudio.wi.ContainerNode,{constructor:function(){afStudio.wi.ColumnNode.superclass.constructor.apply(this,arguments);this.initBehavior()},getNodeConfig:function(){return{text:"newcolumn",iconCls:"icon-field",metaField:"i:column"}},createProperties:function(){var a=[new afStudio.wi.AlignType().create(),new afStudio.wi.PropertyTypeString({id:"label",label:"Label",value:"NewColumn",required:true}).create(),new afStudio.wi.PropertyTypeString({id:"name",label:"Name",value:"newcolumn",required:true}).create(),new afStudio.wi.PropertyTypeBoolean({id:"qtip",label:"Qtip",defaultValue:false}).create(),new afStudio.wi.PropertyBaseType({id:"width",label:"Width",type:"posint"}).create(),new afStudio.wi.PropertyTypeBoolean({id:"sortable",label:"Sortable"}).create(),new afStudio.wi.PropertyTypeBoolean({id:"editable",label:"Editable"}).create(),new afStudio.wi.PropertyTypeBoolean({id:"resizable",label:"Resizable"}).create(),new afStudio.wi.PropertyTypeBoolean({id:"groupField",label:"GroupField"}).create(),new afStudio.wi.PropertyTypeBoolean({id:"hidden",label:"Hidden"}).create(),new afStudio.wi.PropertyTypeBoolean({id:"hideable",label:"Hideable",defaultValue:true}).create(),new afStudio.wi.PropertyTypeString({id:"style",label:"Style"}).create(),new afStudio.wi.PropertyTypeString({id:"filter",label:"Filter"}).create()];this.addProperties(a)},setNameAndLabel:function(b,a){this.properties["name"].set("value",b);this.properties["label"].set("value",a)},initBehavior:function(){this.addBehavior(new afStudio.wi.WithNamePropertyAsLabelBehavior)}});afStudio.wi.DatasourceNode=Ext.extend(afStudio.wi.ContainerNode,{constructor:function(){afStudio.wi.DatasourceNode.superclass.constructor.apply(this,arguments);this.addBehavior(new afStudio.wi.WithValueTypeBehavior)},getNodeConfig:function(){return{id:"i:datasource",text:"Datasource"}},createProperties:function(){var a=[new afStudio.wi.PropertyTypeString({id:"modelName",label:"Model Name"}).create()];this.addProperties(a)},setClassFromModel:function(a,c){if(c=="list"){this.properties["modelName"].set("value",a);this.behaviors[0].configureFor(this,{"type":"orm","i:class":"ModelCriteriaFetcher","i:method":{"name":"getDataForList","i:param":[{name:"modelName",_content:a}]}})}else{var b=a+"Peer";this.behaviors[0].configureFor(this,{"type":"orm","i:class":b,"i:method":{"name":"retrieveByPk","i:param":{name:"id",_content:"{id}"}}})}}});Ext.ns("afStudio.wi");afStudio.wi.PropertyRecord=Ext.data.Record.create([{name:"name",type:"string"},"value","required"]);afStudio.wi.PropertyStore=Ext.extend(Ext.grid.PropertyStore,{constructor:function(a,b){afStudio.wi.PropertyStore.superclass.constructor.call(this);this.grid=a;this.store=new Ext.data.GroupingStore({recordType:afStudio.wi.PropertyRecord,groupField:"required"});this.store.on("update",this.onUpdate,this);if(b){this.setSource(b)}},setSource:function(a){this.source=a;this.store.removeAll();this.store.loadRecords({records:a},{},true)}});afStudio.wi.PropertyColumnModel=Ext.extend(Ext.grid.PropertyColumnModel,{constructor:function(c,b){var d=Ext.grid,h=Ext.form;this.grid=c;d.PropertyColumnModel.superclass.constructor.call(this,[{header:this.nameText,id:"name",dataIndex:"name",width:50,sortable:true,menuDisabled:true},{header:this.valueText,id:"value",dataIndex:"value",width:50,resizable:false,menuDisabled:true},{header:"RequiredHeader",id:"required",dataIndex:"required",width:50,resizable:false,menuDisabled:true,hidden:true}]);this.store=b;var a=new h.Field({autoCreate:{tag:"select",children:[{tag:"option",value:"true",html:this.trueText},{tag:"option",value:"false",html:this.falseText}]},getValue:function(){return this.el.dom.value=="true"}});var e=new h.NumberField({selectOnFocus:true,allowDecimals:false,allowNegative:false,style:"text-align:left;"});this.editors={"date":new d.GridEditor(new h.DateField({selectOnFocus:true})),"string":new d.GridEditor(new h.TextField({selectOnFocus:true})),"number":new d.GridEditor(new h.NumberField({selectOnFocus:true,style:"text-align:left;"})),"posint":new d.GridEditor(e),"boolean":new d.GridEditor(a,{autoSize:"both"})};this.renderCellDelegate=this.renderCell.createDelegate(this);this.renderPropDelegate=this.renderProp.createDelegate(this)},getCellEditor:function(a,e){var b=this.store.getProperty(e),d=b.id,c=b.data.value;if(this.grid.customEditors[d]){return this.grid.customEditors[d]}if(this.editors[b.type]){return this.editors[b.type]}if(Ext.isDate(c)){return this.editors.date}else{if(typeof c=="number"){return this.editors.number}else{if(typeof c=="boolean"){return this.editors["boolean"]}else{return this.editors.string}}}}});afStudio.wi.PropertyGrid=Ext.extend(Ext.grid.EditorGridPanel,{enableColumnMove:false,stripeRows:false,trackMouseOver:false,clicksToEdit:1,enableHdMenu:false,viewConfig:{forceFit:true},initComponent:function(){this.customRenderers=this.customRenderers||{};this.customEditors=this.customEditors||{};this.lastEditRow=null;var b=new afStudio.wi.PropertyStore(this);this.propStore=b;var a=new afStudio.wi.PropertyColumnModel(this,b);b.store.sort("name","ASC");this.addEvents("beforepropertychange","propertychange","metaPropertyChange");this.cm=a;this.ds=b.store;afStudio.wi.PropertyGrid.superclass.initComponent.call(this);this.mon(this.selModel,"beforecellselect",function(e,d,c){if(c===0){this.startEditing.defer(200,this,[d,1]);return false}},this)},onRender:function(){Ext.grid.PropertyGrid.superclass.onRender.apply(this,arguments);this.getGridEl().addClass("x-props-grid")},afterRender:function(){afStudio.wi.PropertyGrid.superclass.afterRender.apply(this,arguments);if(this.source){this.setSource(this.source)}},setSource:function(a){this.addCustomEditorsAndRenderers(a);this.propStore.setSource(a);this.hideMandatoryCheckers()},addCustomEditorsAndRenderers:function(e){for(var d=0,a=e.length;d<a;d++){if("choice"==e[d].type){if(!this.customEditors[e[d].id]){var b=[];for(var c in e[d].originalStore){b.push([c,e[d].originalStore[c]])}this.customEditors[e[d].id]=new Ext.grid.GridEditor(new Ext.form.ComboBox({selectOnFocus:true,value:e[d].get("value"),tpl:'<tpl for="."><div ext:qtip="{field2}" class="x-combo-list-item">{field2}</div></tpl>',store:b,triggerAction:"all"}))}if(!this.customRenderers[e[d].id]){this.customRenderers[e[d].id]=function(f,h,g){return g.originalStore[f]}}}}},hideMandatoryCheckers:function(){var a=Ext.select('div[id*="-gp-required-Mandatory-hd"]');if(a){a.setStyle({display:"none"})}},getSource:function(){return this.propStore.getSource()}});Ext.reg("afStudio.wi.propertyGrid",afStudio.wi.PropertyGrid);Ext.ns("afStudio.wi");afStudio.wi.PropertyBaseType=Ext.extend(Object,{defaultValue:"",type:"string",required:false,constructor:function(a){a=a||{};Ext.apply(this,a)},setRequired:function(){this.required=true;return this},setValue:function(a){this.value=a;return this},create:function(){var a=Ext.data.Record.create([{name:"name",type:"string"},{name:"value",type:this.type},"required"]);var b=new a({name:this.label,value:Ext.isDefined(this.value)?this.value:this.defaultValue,required:this.required?"Mandatory":"Optional"},this.id);b.type=this.type;b.originalStore=this.store;return b}});afStudio.wi.PropertyTypeBoolean=Ext.extend(afStudio.wi.PropertyBaseType,{type:"boolean",defaultValue:false});afStudio.wi.PropertyTypeChoice=Ext.extend(afStudio.wi.PropertyBaseType,{type:"choice",defaultValue:"",setChoices:function(a){this.store=a;return this}});afStudio.wi.PropertyTypeString=Ext.extend(afStudio.wi.PropertyBaseType,{type:"string",defaultValue:""});afStudio.wi.ValueSource=Ext.extend(afStudio.wi.PropertyTypeChoice,{id:"valueSource",label:"Value Source",defaultValue:"",constructor:function(){afStudio.wi.ValueSource.superclass.constructor.apply(this,arguments);this.setChoices({"source":"source","classAndMethod":"class and method","static":"static","file":"file"});this.setRequired()}});afStudio.wi.AlignType=Ext.extend(afStudio.wi.PropertyTypeChoice,{id:"align",label:"Align",defaultValue:"left",constructor:function(){afStudio.wi.AlignType.superclass.constructor.call(this,arguments);this.setChoices({"left":"left","center":"center","right":"right"})}});afStudio.wi.ValueType=Ext.extend(afStudio.wi.PropertyTypeChoice,{id:"valueType",label:"Value Type",defaultValue:"",constructor:function(){afStudio.wi.ValueType.superclass.constructor.apply(this,arguments);this.setChoices({"default":"default","orm":"orm","static":"static","file":"file"});this.setRequired()}});afStudio.wi.FieldType=Ext.extend(afStudio.wi.PropertyTypeChoice,{defaultValue:"",constructor:function(){afStudio.wi.FieldType.superclass.constructor.call(this,{id:"type",label:"Type"});this.setChoices({"input":"input","textarea":"textarea","checkbox":"checkbox","hidden":"hidden","password":"password","radio":"radio","file":"file","combo":"combo","multicombo":"multicombo"})}});afStudio.wi.ObjectRootNode=Ext.extend(afStudio.wi.BaseNode,{getFieldsNode:function(){return this.fieldsNode},getDatasourceNode:function(){return this.datasourceNode},setTitle:function(a){this.getProperty("i:title").set("value",a)},getNodeConfig:function(){var a={text:"Abstract root Object node",iconCls:"icon-obj",expanded:true};return a},createProperties:function(){this.addProperty(new afStudio.wi.PropertyTypeString({id:"i:title",label:"Title"}).create());this.addProperty(new afStudio.wi.PropertyTypeString({id:"i:description",label:"Description"}).create())},addRequiredChilds:function(){this.fieldsNode=this.buildFieldsNode();this.datasourceNode=new afStudio.wi.DatasourceNode();this.appendChild(this.datasourceNode);this.appendChild(this.fieldsNode)},buildFieldsNode:Ext.emptyFn});afStudio.wi.EditNode=Ext.extend(afStudio.wi.ObjectRootNode,{widgetType:"edit",getNodeConfig:function(){var a={text:"New edit widget"};return a},buildFieldsNode:function(){var a=afStudio.wi.NodeBuilder.createCollectionNode({text:"Fields",id:"i:fields",createChildConstructor:afStudio.wi.FieldNode,childNodeId:"i:field",addChildActionLabel:"Add field",createProperties:function(){this.constructor.superclass.createProperties.call(this);return[new afStudio.wi.PropertyTypeBoolean({id:"resetable",label:"Resetable",defaultValue:true}).create(),new afStudio.wi.PropertyTypeString({id:"resetlabel",label:"Submit Label",defaultValue:"Reset"}).create(),new afStudio.wi.PropertyTypeString({id:"submitlabel",label:"Submit Label",defaultValue:"Submit"}).create(),new afStudio.wi.PropertyTypeBoolean({id:"multipart",label:"Multipart"}).create(),new afStudio.wi.PropertyTypeBoolean({id:"submit",label:"Submit",defaultValue:true}).create(),new afStudio.wi.PropertyTypeBoolean({id:"border",label:"Border",defaultValue:true}).create(),new afStudio.wi.PropertyTypeString({id:"label",label:"Label",defaultValue:"Save Selection"}).create(),new afStudio.wi.PropertyTypeString({id:"labelWidth",label:"Label Width",defaultValue:75}).create()]}},afStudio.wi.FieldsNode);return new a}});afStudio.wi.ListNode=Ext.extend(afStudio.wi.ObjectRootNode,{widgetType:"list",getNodeConfig:function(){return{text:"New list widget",metaField:"root"}},constructor:function(){afStudio.wi.ListNode.superclass.constructor.apply(this,arguments);var a=new afStudio.wi.WithIParamsBehavior();a.setProperties([new afStudio.wi.PropertyTypeString({id:"maxperpage",label:"Max records per page",value:10}).create()]);this.addBehavior(a)},addRequiredChilds:function(){afStudio.wi.ListNode.superclass.addRequiredChilds.apply(this);var a=[];a.push(this.buildActionsNode(afStudio.wi.ActionNode));a.push(this.buildRowactionsNode(afStudio.wi.ActionNode));a.push(this.buildMoreactionsNode(afStudio.wi.ActionNode));this.appendChild(a)},buildFieldsNode:function(){var a=afStudio.wi.NodeBuilder.createCollectionNode({id:"i:fields",text:"Fields",metaField:"i:fields",addChildActionLabel:"Add column",childNodeId:"i:column",createChildConstructor:afStudio.wi.ColumnNode,createProperties:function(){this.constructor.superclass.createProperties.call(this);return[new afStudio.wi.PropertyTypeBoolean({id:"tree",label:"Tree"}).create(),new afStudio.wi.PropertyTypeBoolean({id:"selectable",label:"Selectable",defaultValue:true}).create(),new afStudio.wi.PropertyTypeBoolean({id:"exportable",label:"Exportable",defaultValue:true}).create(),new afStudio.wi.PropertyTypeBoolean({id:"expandButton",label:"Expand Button"}).create(),new afStudio.wi.PropertyTypeBoolean({id:"select",label:"Select"}).create(),new afStudio.wi.PropertyTypeBoolean({id:"pager",label:"Pager",defaultValue:true}).create(),new afStudio.wi.PropertyTypeString({id:"pagerTemplate",label:"Pager Template"}).create(),new afStudio.wi.PropertyTypeBoolean({id:"remoteSort",label:"Remote Sort"}).create(),new afStudio.wi.PropertyTypeString({id:"iconCls",label:"Icon Cls"}).create(),new afStudio.wi.PropertyTypeString({id:"icon",label:"Icon",defaultValue:"/images/famfamfam/accept.png"}).create(),new afStudio.wi.PropertyTypeBoolean({id:"remoteFilter",label:"Remote Filter"}).create()]}},afStudio.wi.FieldsNode);return new a},buildProxyNode:function(){var a=afStudio.wi.NodeBuilder.createContainerNode({text:"Proxy",id:"i:proxy",createProperties:function(){return[new afStudio.wi.PropertyTypeString({id:"url",label:"Url",required:true}).create()]}});return new a},buildActionsNode:function(b){var a=afStudio.wi.NodeBuilder.createCollectionNode({id:"i:actions",text:"Actions",metaField:"i:actions",createChildConstructor:b,childNodeId:"i:action",addChildActionLabel:"Add action",dumpEvenWhenEmpty:false});return new a},buildRowactionsNode:function(b){b=Ext.extend(b,{getNodeConfig:function(){var c=b.superclass.getNodeConfig.call(this);return Ext.apply(c,{metaField:"i:rowaction"})},createProperties:function(){b.superclass.createProperties.call(this);this.addProperties([new afStudio.wi.PropertyTypeString({id:"params",label:"URL Parameters"}).create()])}});var a=afStudio.wi.NodeBuilder.createCollectionNode({id:"i:rowactions",text:"Row Actions",metaField:"i:rowactions",createChildConstructor:b,childNodeId:"i:action",addChildActionLabel:"Add Row Action",dumpEvenWhenEmpty:false});return new a},buildMoreactionsNode:function(b){b=Ext.extend(b,{getNodeConfig:function(){var c=b.superclass.getNodeConfig.call(this);return Ext.apply(c,{metaField:"i:moreaction"})}});var a=afStudio.wi.NodeBuilder.createCollectionNode({id:"i:moreactions",text:"More Actions",metaField:"i:moreactions",createChildConstructor:b,childNodeId:"i:action",addChildActionLabel:'Add "more action"',dumpEvenWhenEmpty:false});return new a}});afStudio.wi.HtmlNode=Ext.extend(afStudio.wi.ObjectRootNode,{widgetType:"html",getNodeConfig:function(){return{text:"New html widget",metaField:"root"}},constructor:function(){afStudio.wi.HtmlNode.superclass.constructor.apply(this,arguments)},addRequiredChilds:function(){this.appendChild([this.buildActionsNode(afStudio.wi.ActionNode),this.buildMoreactionsNode(afStudio.wi.ActionNode)])},buildActionsNode:function(b){var a=afStudio.wi.NodeBuilder.createCollectionNode({id:"i:actions",text:"Actions",metaField:"i:actions",createChildConstructor:b,childNodeId:"i:action",addChildActionLabel:"Add action",dumpEvenWhenEmpty:false});return new a},buildMoreactionsNode:function(b){b=Ext.extend(b,{getNodeConfig:function(){var c=b.superclass.getNodeConfig.call(this);return Ext.apply(c,{metaField:"i:moreaction"})}});var a=afStudio.wi.NodeBuilder.createCollectionNode({id:"i:moreactions",text:"More Actions",metaField:"i:moreactions",createChildConstructor:b,childNodeId:"i:action",addChildActionLabel:'Add "more action"',dumpEvenWhenEmpty:false});return new a}});Ext.namespace("afStudio.wi");afStudio.wi.WidgetInspectorTree=Ext.extend(Ext.tree.TreePanel,{layout:"fit",_beforeInitComponent:function(){var b=this;var a=this.createRootNode();this.treeSorter=new Ext.tree.TreeSorter(this,{folderSort:true});return{root:a,animate:true,containerScroll:true,autoScroll:true}},initComponent:function(){Ext.apply(this,Ext.apply(this.initialConfig,this._beforeInitComponent()));afStudio.wi.WidgetInspectorTree.superclass.initComponent.apply(this,arguments);this._afterInitComponent()},_afterInitComponent:function(){var a=this;this.on({scope:a,afterrender:a.initWidgetInspectorTree})},initWidgetInspectorTree:function(){this.expandAll()},createRootNode:function(){var b=this.widgetMeta.widgetUri,c=this.widgetMeta.definition,a=afStudio.wd.WidgetFactory.createWIRootNode(c.type);a.setText(b+" ["+c.type+"]");a.configureFor(c);return a}});Ext.reg("afStudio.wi.widgetInspectorTree",afStudio.wi.WidgetInspectorTree);Ext.namespace("afStudio.wi");afStudio.wi.InspectorPanel=Ext.extend(Ext.Panel,{layout:"border",_beforeInitComponent:function(){var a=this;return{title:"Widget Inspector",items:[{xtype:"afStudio.wi.widgetInspectorTree",ref:"inspectorTree",region:"center",widgetMeta:this.widgetMeta},{xtype:"afStudio.wi.propertyGrid",ref:"propertyGrid",region:"south",split:true,height:150,layout:"fit",view:new Ext.grid.GroupingView({scrollOffset:19,forceFit:true,showGroupName:false,groupTextTpl:"{text}"})}]}},initComponent:function(){Ext.apply(this,Ext.apply(this.initialConfig,this._beforeInitComponent()));afStudio.wi.InspectorPanel.superclass.initComponent.apply(this,arguments);this._afterInitComponent()},_afterInitComponent:function(){var a=this;this.inspectorTree.on({scope:a,click:a.onInspectorTreeNodeClick});this.propertyGrid.on({scope:a,afteredit:a.onPropertyGridAfterEdit});this.propertyGrid.getView().on("refresh",a.onGridRefresh,a)},onInspectorTreeNodeClick:function(b,c){var a=b.getProperties();this.propertyGrid.setSource(a)},onPropertyGridAfterEdit:function(a){this.onGridRefresh(a.grid.getView());if(a.record&&a.record.WITreeNode){var b=a.record.WITreeNode;this.propertyGrid.fireEvent("metaPropertyChange",b,a.record.id,a.value,a.originalValue);b.propertyChanged(a.record)}},onGridRefresh:function(m){var a=m.grid,b=a.getStore();for(var g=0,l=b.getCount();g<l;g++){var c=b.getAt(g);var h="<b>"+c.get("name")+":</b> "+c.get("value");var n=m.getRow(g);var f=Ext.get(n).select(".x-grid3-cell-inner");for(var e=0,d=f.getCount();e<d;e++){Ext.QuickTips.register({target:f.item(e),text:h})}}a.hideMandatoryCheckers()}});Ext.reg("afStudio.wi.inspectorPanel",afStudio.wi.InspectorPanel);Ext.namespace("afStudio.wi");afStudio.wi.InspectorPalette=Ext.extend(Ext.Container,{layout:"accordion",style:"border-top: 1px solid #99BBE8;",_beforeInitComponent:function(){var a=this;return{items:[{xtype:"afStudio.wi.inspectorPanel",ref:"inspectorPanel",widgetMeta:this.widgetMeta},{xtype:"filetreepanel",ref:"codeBrowser",title:"Code Browser",url:afStudioWSUrls.getFiletreeUrl(),rootText:"Home",rootPath:"root",rootVisible:true,maxFileSize:524288*2*10,autoScroll:true,enableProgress:false,singleUpload:true}]}},initComponent:function(){Ext.apply(this,Ext.apply(this.initialConfig,this._beforeInitComponent()));afStudio.wi.InspectorPalette.superclass.initComponent.apply(this,arguments);this._afterInitComponent()},_afterInitComponent:function(){var a=this;this.on({scope:this,afterrender:function(){(function(){var f=this.inspectorPanel.propertyGrid,e=this.inspectorPanel.inspectorTree;var c=f.getHeight(),b=e.getHeight(),d=(c+b)/2;f.setHeight(d);e.setHeight(d);this.layout.setActiveItem(1);this.layout.setActiveItem(0)}).defer(100,this)}})},getPropertyGrid:function(){return this.inspectorPanel.propertyGrid},getInspectorTree:function(){return this.inspectorPanel.inspectorTree}});Ext.reg("afStudio.wi.inspectorPalette",afStudio.wi.InspectorPalette);Ext.ns("afStudio.wd.list");afStudio.wd.list.ListMetaProcessor=(function(){return{createIAction:function(b){var c={name:b.name,text:b.text?b.text:b.name,iconCls:b.iconCls?b.iconCls:null,icon:b.icon?b.icon:null,tooltip:b.tooltip?b.tooltip:null,style:b.style?b.style:null};return c},addIAction:function(b){var d=this.getTopToolbar().getComponent("actions"),c=this.createIAction(b);d.insertButton(0,c)},deleteIAction:function(a,b){b.items.each(function(c){if(c.name==a){c.destroy();return false}});this.updateActionBarVisibilityState()},addMoreAction:function(c){var e=this.getTopToolbar().getComponent("actions"),b=e.getComponent("more"),d=this.createIAction(c);b.menu.add(d)},createRowAction:function(b){var c={name:b.name,iconCls:b.iconCls?b.iconCls:null,icon:b.icon?b.icon:null,altText:b.text?b.text:b.name,tooltip:b.tooltip?b.tooltip:b.name};return c},createRowActionColumn:function(d){var g=this,f=18,e=50;var b={id:"action-column",xtype:"listactioncolumn",header:"Actions",menuDisabled:true,width:e,fixed:true,items:[]};if(Ext.isArray(d)){Ext.iterate(d,function(m,h,l){var j=g.createRowAction(m);b.items.push(j)});b.width=(d.length*f)>e?(d.length*f):e}else{var c=g.createRowAction(d);b.items.push(c)}return b},addIRowaction:function(c){var b=this.getColumnModel(),d=this.getStore(),f=b.getColumnById("action-column");if(!f){f=this.createRowActionColumn(c);b.config.push(f)}else{b.config.pop();var e=f.items;c=this.createRowAction(c);e.push(c);f=this.createRowActionColumn(e);b.config.push(f)}b=new Ext.grid.ColumnModel(b.config);this.reconfigure(d,b)},deleteIRowaction:function(b){var a=this.getColumnModel(),c=this.getStore(),e=a.getColumnById("action-column");var d=[];Ext.iterate(e.items,function(g,f){if(g.name!=b){d.push(g)}});a.config.pop();if(d.length>0){e=this.createRowActionColumn(d);a.config.push(e)}a=new Ext.grid.ColumnModel(a.config);this.reconfigure(c,a)},processMeta:function(c){var b=c.node.attributes.metaField;if(Ext.isDefined(b)){var a=b;if(a.indexOf("i:")!=-1){a="I"+a.replace(/^i:(\w+)/i,"$1").ucfirst()}else{a=a.ucfirst()}a=String.format("process{0}Tag",a);this[a](c)}},processIFieldsTag:function(m){var a=this.getBottomToolbar(),c=this.getTopToolbar().getComponent("actions"),d=c.getComponent("more");switch(m.name){case"select":var e=this.getColumnModel().config;if(m.value){if(e[0]&&(e[0].id!="checker")){var j=new Ext.grid.CheckboxSelectionModel();Ext.destroy(this.selModel);this.selModel=j;this.selModel.init(this);e.unshift(j);var h=new Ext.grid.ColumnModel(e),g=this.getStore();this.reconfigure(g,h)}}else{if(e[0]&&(e[0].id=="checker")){var j=new Ext.grid.RowSelectionModel();Ext.destroy(this.selModel);this.selModel=j;this.selModel.init(this);e.shift();var h=new Ext.grid.ColumnModel(e),g=this.getStore();this.reconfigure(g,h)}}break;case"exportable":var b=d.menu.getComponent("exports");m.value?b.show():b.hide();this.updateActionBarVisibilityState();break;case"selectable":var f=d.menu.getComponent("sel-all"),n=d.menu.getComponent("desel-all");m.value?(f.enable(),n.enable()):(f.disable(),n.disable());this.updateActionBarVisibilityState();break;case"expandButton":var l=c.getComponent("expanded-view");m.value?l.show():l.hide();this.updateActionBarVisibilityState();break;case"pager":if(m.value===false){a.hide()}else{a.show()}this.doLayout();break}},processIColumnTag:function(c){var a=this.getColumnModel(),f=c.node.getProperty("name").data.value;if(c.name=="name"){f=c.oldValue}var e=a.getColumnsBy(function(g){return g.name==f})[0],d=a.getIndexById(e.id);switch(c.name){case"label":a.setColumnHeader(d,c.value);break;case"name":e.name=c.value;break;case"hidden":a.setHidden(d,c.value);break;case"hideable":e.hideable=c.value;a.setConfig(a.config,true);break;case"resizable":e.fixed=!c.value;a.setConfig(a.config,true);break;case"width":var b=parseInt(c.value);if(Ext.isNumber(b)){e.width=b;a.setConfig(a.config)}break}},processRootTag:function(a){switch(a.name){case"i:title":this.setTitle(a.value);break;case"i:description":var b=this.getTopToolbar().getComponent("desc");b.get(0).setText(a.value);if(Ext.util.Format.trim(a.value)){b.show()}else{b.hide()}this.doLayout();break}},processIActionTag:function(a){var b=this.getTopToolbar().getComponent("actions");this.processActions(a,b)},processIMoreactionTag:function(b){var c=this.getTopToolbar().getComponent("actions"),a=c.getComponent("more");this.processActions(b,a.menu)},processActions:function(b,f){var g=b.node.getProperty("name").data.value,c;if(b.name=="name"){g=b.oldValue}f.items.each(function(e){if(e.name==g){c=e;return false}});switch(b.name){case"name":c.name=b.value;var a=Ext.util.Format.trim(b.node.getPropertyValue("text"));if(Ext.isEmpty(a)){c.setText(b.value)}break;case"text":var a=Ext.util.Format.trim(b.value);a=a?a:c.name;c.setText(a);break;case"iconCls":c.setIconClass(b.value);break;case"icon":if(f.getXType()=="menu"){c.icon=b.value;try{c.el.child("img").set({src:b.value})}catch(d){}}else{c.setIcon(b.value)}break;case"tooltip":if(f.getXType()=="menu"){}else{c.setTooltip(b.value)}break;case"style":c.el.dom.removeAttribute("style","");c.el.applyStyles(b.value);break}},processIRowactionTag:function(c){var a=this.getColumnModel(),d=this.getStore(),f=a.getColumnById("action-column"),g=c.node.getProperty("name").data.value;if(c.name=="name"){g=c.oldValue}var e;Ext.iterate(f.items,function(h){if(h.name==g){e=h}});if(e){switch(c.name){case"name":e.name=c.value;var b=Ext.util.Format.trim(c.node.getPropertyValue("tooltip"));if(Ext.isEmpty(b)){e.tooltip=c.value}break;case"text":e.altText=c.value;break;case"iconCls":e.iconCls=c.value;break;case"icon":e.icon=c.value;break;case"tooltip":var b=Ext.util.Format.trim(c.value);b=b?b:e.name;e.tooltip=b;break}a.config.pop();f=this.createRowActionColumn(f.items);a.config.push(f);a=new Ext.grid.ColumnModel(a.config);this.reconfigure(d,a)}}}})();Ext.ns("afStudio.wd.list");afStudio.wd.list.ActionColumn=Ext.extend(Ext.grid.ActionColumn,{constructor:function(b){afStudio.wd.list.ActionColumn.superclass.constructor.call(this,b);var f=this,c=b.items||(f.items=[f]),a=c.length,d,e;f.renderer=function(g,h){g=Ext.isFunction(b.renderer)?(b.renderer.apply(this,arguments)||""):"";h.css+=" x-action-col-cell";for(d=0;d<a;d++){e=c[d];g+='<img width="16" alt="'+f.altText+'" src="'+(e.icon||Ext.BLANK_IMAGE_URL)+'" class="x-action-col-icon x-action-col-'+String(d)+" "+(e.iconCls||"")+" "+(Ext.isFunction(e.getClass)?e.getClass.apply(e.scope||this.scope||this,arguments):"")+'"'+((e.tooltip)?' ext:qtip="'+e.tooltip+'"':"")+" />"}return g}}});Ext.apply(Ext.grid.Column.types,{listactioncolumn:afStudio.wd.list.ActionColumn});Ext.ns("afStudio.wd.list");afStudio.wd.list.ListGridView=Ext.extend(Ext.grid.GridView,{invalidColumnName:'Column name must contain only characters, digits or "_" and start from character or "_"',beforeColMenuShow:function(){var b=this.cm,d=b.getColumnCount(),a=this.colMenu,c;a.removeAll();for(c=0;c<d;c++){var e=b.config[c];if(e.hideable!==false&&!e.uninit&&e.xtype!="actioncolumn"){a.add(new Ext.menu.CheckItem({text:b.getColumnHeader(c),itemId:"col-"+b.getColumnId(c),checked:!b.isHidden(c),disabled:b.config[c].hideable===false,hideOnClick:false}))}}},afterRenderUI:function(){var a=this.grid;this.initElements();Ext.fly(this.innerHd).on("click",this.handleHdDown,this);this.mainHd.on({scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut,mousemove:this.handleHdMove});this.scroller.on("scroll",this.syncScroll,this);if(a.enableColumnResize!==false){this.splitZone=new Ext.grid.GridView.SplitDragZone(a,this.mainHd.dom)}if(a.enableColumnMove){this.columnDrag=new afStudio.wd.list.ListGridView.ColumnDragZone(a,this.innerHd);this.columnDrop=new Ext.grid.HeaderDropZone(a,this.mainHd.dom)}if(a.enableHdMenu!==false){this.hmenu=new Ext.menu.Menu({id:a.id+"-hctx",show:function(c,d,b){this.parentMenu=b;if(!this.el){this.render()}this.fireEvent("beforeshow",this);this._el=c;this.showAt(this.el.getAlignToXY(c,d||this.defaultAlign),b,false)}});this.colMenu=new Ext.menu.Menu({id:a.id+"-hcols-menu"});this.colMenu.on({scope:this,beforeshow:this.beforeColMenuShow,itemclick:this.handleColumnMenuClick});this.hmenu.add({itemId:"renameClm",text:"Rename Column"},{itemId:"deleteClm",text:"Delete Column"},"-",{itemId:"columns",text:this.columnsText,menu:this.colMenu,hideOnClick:false,iconCls:"x-cols-icon"});this.hmenu.on("itemclick",this.handleHdMenuClick,this)}if(a.trackMouseOver){this.mainBody.on({scope:this,mouseover:this.onRowOver,mouseout:this.onRowOut})}if(a.enableDragDrop||a.enableDrag){this.dragZone=new Ext.grid.GridDragZone(a,{ddGroup:a.ddGroup||"GridDD"})}this.updateHeaderSortState()},handleColumnMenuClick:function(c){var b=this.hdCtxIndex,a=this.cm,d=this.ds;b=a.getIndexById(c.itemId.substr(4));if(b!=-1){if(c.checked&&a.getColumnsBy(this.isHideableColumn,this).length<=1){this.onDenyColumnHide();return false}a.setHidden(b,c.checked)}return true},getUninitColumn:function(){for(var a=0;a<this.cm.config.length;a++){var b=this.cm.config[a];if(b.uninit){return a}}return -1},handleHdMenuClick:function(l){var d=this.hdCtxIndex,h=this.cm,a=this.ds,f=h.getDataIndex(d);switch(l.itemId){case"addClmAfter":var e=this.getUninitColumn();this.cm.config[e].uninit=false;this.cm.moveColumn(e,d+1);this.cm.setHidden(d+1,false);break;case"addClmBefore":var e=this.getUninitColumn();this.cm.config[e].uninit=false;this.cm.moveColumn(e,d);this.cm.setHidden(d,false);break;case"renameClm":var c=this.findHeaderCell(l.parentMenu._el);this.editHeadColumn(c.firstChild,d);break;case"deleteClm":var j=h.getColumnCount(true);if(j>1){var g=h.config[d].name;h.setHidden(d,true);h.config[d].uninit=true;h.config[d].header=this.grid.columnName;delete h.config[d].name;if(d<j-1){for(var b=d;b<j;b++){h.moveColumn(b,b+1)}}this.grid.fireEvent("deleteColumn",g)}break}return true},editHeadColumn:function(c,b){var e=this,d=this.cm.getColumnHeader(b);var a=new Ext.grid.GridEditor(new Ext.form.TextField({allowBlank:false}));a._index=b;a.on("complete",this.onHeadColumnEditComplete,this);a.startEdit(c,d)},onHeadColumnEditComplete:function(d,c,b){var e=d._index,f=this.grid,a=this.cm;if(c!=b){a.setColumnHeader(e,c);f.fireEvent("changeColumnLabel",a.config[e],e,c)}},handleHdDown:function(j,m){var l=this.cm,g=this.findHeaderCell(m),h=this.getCellIndex(g),d=this.hmenu,b=d.items,a=this.headerMenuOpenCls;if(Ext.fly(m).hasClass("x-grid3-hd-btn")){j.stopEvent();Ext.fly(g).addClass(a);this.hdCtxIndex=h;d.on("hide",function(){Ext.fly(g).removeClass(a)},this,{single:true});d.show(m,"tl-bl?")}else{if(h){var c=this.cm.getColumnId(h);if(Ext.isDefined(c)){var f=this.cm.getColumnById(c);if(c=="checker"||f.xtype=="actioncolumn"){return false}}this.editHeadColumn(g.firstChild,h)}}}});afStudio.wd.list.ListGridView.ColumnDragZone=Ext.extend(Ext.grid.GridView.ColumnDragZone,{onBeforeDrag:function(f,g){var b=this.view.cm,c=this.view.findCellIndex(f.header),a=c!==false?b.getColumnId(c):null;if(Ext.isDefined(a)){var d=b.getColumnById(a);if(a=="checker"||d.xtype=="actioncolumn"){return false}}return true},beforeDragDrop:function(h,g,j){var b=this.view.cm,f=this.getDragData(g),c=this.view.findCellIndex(f.header),a=c!==false?b.getColumnId(c):undefined;if(Ext.isDefined(a)){var d=b.getColumnById(a);if(a=="checker"||d.xtype=="actioncolumn"){this.onInvalidDrop(h,g,j);return false}}return true}});Ext.ns("afStudio.wd.list");afStudio.wd.list.SimpleListView=Ext.extend(Ext.grid.GridPanel,{columnName:"newcolumn",columnWidth:80,maxColumns:30,_beforeInitComponent:function(){var l=this,e=this.viewMeta,g=[];if(!Ext.isEmpty(e["i:fields"])&&e["i:fields"]["i:column"]){var d=e["i:fields"]["i:column"];if(Ext.isArray(d)){for(var j=0;j<d.length;j++){var m=d[j];g.push({header:m.label,name:m.name,width:m.width?parseInt(m.width):this.columnWidth,hidden:m.hidden?m.hidden.bool():false,hideable:m.hideable?m.hideable.bool():true})}for(var j=g.length-1;j<this.maxColumns;j++){g.push({header:this.columnName,width:this.columnWidth,hidden:true,uninit:true})}}else{g.push({header:d.label,name:d.name,width:d.width?parseInt(d.width):this.columnWidth,hidden:d.hidden?d.hidden.bool():false,hideable:d.hideable?d.hideable.bool():true});for(var j=1;j<this.maxColumns;j++){g.push({header:this.columnName,width:this.columnWidth,hidden:true,uninit:true})}}}var f=new Ext.grid.RowSelectionModel();if(!Ext.isEmpty(e["i:fields"])&&e["i:fields"].select&&e["i:fields"].select.bool()){f=new Ext.grid.CheckboxSelectionModel();g.unshift(f)}if(!Ext.isEmpty(e["i:rowactions"])&&e["i:rowactions"]["i:action"]){var h=this.createRowActionColumn(e["i:rowactions"]["i:action"]);g.push(h)}var n=new Ext.data.ArrayStore({idIndex:0,data:[[]],fields:[]});var b={itemId:"actions",items:["->",{itemId:"expanded-view",text:"Expanded View",iconCls:"icon-application-split"},{itemId:"more",text:"More Actions",menu:{items:[{itemId:"exports",text:"Exports",iconCls:"icon-database-save"},{itemId:"sel-all",text:"Select All"},{itemId:"desel-all",text:"Deselect All"}]}}]};var a={itemId:"desc",hidden:true,items:{xtype:"tbtext",style:"white-space: normal;",text:""}};if(e["i:description"]&&!Ext.isEmpty(Ext.util.Format.trim(e["i:description"]))){a.hidden=false;a.items.text=e["i:description"]}return{title:e["i:title"],store:n,selModel:f,columns:g,view:new afStudio.wd.list.ListGridView(),columnLines:true,autoScroll:true,tbar:{xtype:"container",defaults:{xtype:"toolbar"},items:[b,a]},bbar:{xtype:"paging",hidden:Ext.isDefined(e["i:fields"].pager)?!(e["i:fields"].pager.bool()):false,store:n,displayInfo:true}}},initComponent:function(){Ext.apply(this,Ext.apply(this.initialConfig,this._beforeInitComponent()));afStudio.wd.list.SimpleListView.superclass.initComponent.apply(this,arguments);this._afterInitComponent()},_afterInitComponent:function(){var a=this;this.configureView();this.addEvents("changeColumnPosition","changeColumnLabel","deleteColumn");this.on({scope:a,columnmove:a.onColumnMove,contextmenu:function(b){b.preventDefault()}})},configureView:function(){var d=this,b=this.viewMeta,a=this.getTopToolbar(),c=a.getComponent("actions"),f=c.getComponent("more");if(b["i:actions"]&&b["i:actions"]["i:action"]){var g=b["i:actions"]["i:action"];if(Ext.isArray(g)){Ext.iterate(g,function(l){d.addIAction(l)})}else{d.addIAction(g)}}if(b["i:fields"]){var h=b["i:fields"].selectable?b["i:fields"].selectable.bool():true,e=b["i:fields"].exportable?b["i:fields"].exportable.bool():true,j=b["i:fields"].expandButton?b["i:fields"].expandButton.bool():false;if(h){f.menu.getComponent("sel-all").enable();f.menu.getComponent("desel-all").enable()}else{f.menu.getComponent("sel-all").disable();f.menu.getComponent("desel-all").disable()}if(e){f.menu.getComponent("exports").show()}else{f.menu.getComponent("exports").hide()}if(j){c.getComponent("expanded-view").show()}else{c.getComponent("expanded-view").hide()}}if(b["i:moreactions"]&&b["i:moreactions"]["i:action"]){var g=b["i:moreactions"]["i:action"];if(Ext.isArray(g)){Ext.iterate(g,function(l){d.addMoreAction(l)})}else{d.addMoreAction(g)}}this.updateActionBarVisibilityState()},onColumnMove:function(c,a){if(c!=a){var b=this.getColumnModel().config[a];this.fireEvent("changeColumnPosition",b,c,a)}},updateActionBarVisibilityState:function(){var b=this.getTopToolbar().getComponent("actions"),a=0;this.updateMoreActionVisibilityState();b.items.each(function(c){if(c.hidden){a++}});if(a>0&&((a+1)==b.items.getCount())){b.hide()}else{b.show()}this.doLayout()},updateMoreActionVisibilityState:function(){var e=this.getTopToolbar().getComponent("actions"),b=e.getComponent("more"),d=b.menu.getComponent("sel-all"),c=b.menu.getComponent("desel-all");if(d.disabled&&c.disabled){var a=2;b.menu.items.each(function(f){if(f.hidden){a++}});if(a==b.menu.items.getCount()){b.hide()}else{b.show()}}else{b.show()}}});Ext.apply(afStudio.wd.list.SimpleListView.prototype,afStudio.wd.list.ListMetaProcessor);Ext.reg("afStudio.wd.list.simpleListView",afStudio.wd.list.SimpleListView);Ext.namespace("afStudio.wd");afStudio.wd.GuiFactory=function(){return{LIST:"list",EDIT:"edit",SHOW:"show",HTML:"html",getWidgetType:function(a){return a.definition?a.definition.type:a.type},isWidgetTypeValid:function(a){return[this.LIST,this.EDIT,this.SHOW,this.HTML].indexOf(a)!=-1?true:false},buildGui:function(c){var a=c.definition.type,b={};switch(a){case this.LIST:b.view=new afStudio.wd.list.SimpleListView({viewMeta:c.definition});b.controls=this.createListViewToolbar();break;case this.EDIT:b.view={xtype:"container",html:"EDIT view <br /> is under construction."};b.controls=this.createEditViewToolbar();break;case this.SHOW:b.view={xtype:"container",html:"SHOW view <br /> is under construction."};b.controls=this.createShowViewToolbar();break;case this.HTML:b.view={xtype:"container",html:"HTML view <br /> is under construction."};b.controls=this.createHtmlViewToolbar();break}return b},createListViewToolbar:function(){return[]},createEditViewToolbar:function(){return new Array({text:"Add Field",iconCls:"icon-add"},"-",{text:"Format",iconCls:"icon-format",menu:{ignoreParentClicks:true,items:[{text:"Columns",menu:{items:[{xtype:"combo",triggerAction:"all",mode:"local",emptyText:"Select an item...",store:[[1,"1 columns"],[2,"2 columns"],[3,"3 columns"],[4,"4 columns"]]}]}},{text:"Re-size"}]}},"-")},createShowViewToolbar:function(){return[]},createHtmlViewToolbar:function(){return[]}}}();Ext.namespace("afStudio.wd");afStudio.wd.DesignerPanel=Ext.extend(Ext.Panel,{layout:"fit",_beforeInitComponent:function(){var d=this,b=afStudio.wd.GuiFactory;var a=b.buildGui(this.widgetMeta);var c=[{text:"Save",itemId:"saveBtn",iconCls:"icon-save"},"-",{text:"Preview",itemId:"previewBtn",iconCls:"icon-preview"}];Ext.flatten(c.splice(2,0,a.controls));return{border:true,bodyStyle:"padding: 4px;",tbar:{items:c},items:[a.view]}},initComponent:function(){Ext.apply(this,Ext.apply(this.initialConfig,this._beforeInitComponent()));afStudio.wd.DesignerPanel.superclass.initComponent.apply(this,arguments)},getDesignerView:function(){return this.items.itemAt(0)},getMenuItem:function(a){return this.getTopToolbar().getComponent(a)}});Ext.reg("afStudio.wd.designerPanel",afStudio.wd.DesignerPanel);Ext.namespace("afStudio.wd");afStudio.wd.DesignerTab=Ext.extend(Ext.Panel,{layout:"hbox",layoutConfig:{align:"stretch",pack:"start"},_beforeInitComponent:function(){return{title:"Widget Designer",defaults:{layout:"fit",style:"padding: 2px;"},items:[{xtype:"afStudio.wd.designerPanel",ref:"designerPanel",widgetMeta:this.widgetMeta,flex:3},{xtype:"container",flex:1,items:[{xtype:"afStudio.wi.inspectorPalette",ref:"../inspectorPalette",widgetMeta:this.widgetMeta}]}]}},initComponent:function(){Ext.apply(this,Ext.apply(this.initialConfig,this._beforeInitComponent()));afStudio.wd.DesignerTab.superclass.initComponent.apply(this,arguments);this._afterInitComponent()},_afterInitComponent:function(){var b=this,a=afStudio.wd.GuiFactory;this.widgetType=a.getWidgetType(this.widgetMeta);this.designerView=this.designerPanel.getDesignerView();this.viewProperty=this.inspectorPalette.getPropertyGrid();this.viewInspector=this.inspectorPalette.getInspectorTree();this.designerPanel.getMenuItem("saveBtn").on("click",this.onSaveWidgetView,this);this.designerPanel.getMenuItem("previewBtn").on("click",this.onPreviewWidgetView,this);this.relayEvents(this.viewInspector,["append","remove"]);if(a.isWidgetTypeValid(this.widgetType)){this["init"+this.widgetType.ucfirst()+"DesignerView"]()}else{afStudio.Msg.error("Widget Designer",String.format("Unknown widget type <b>{0}</b>",this.widgetType))}b.on({scope:this,append:this.onViewInspectorAppendProperty,remove:this.onViewInspectorRemoveProperty})},initListDesignerView:function(){this.relayEvents(this.designerView,["changeColumnPosition","changeColumnLabel","deleteColumn","columnresize"]);this.relayEvents(this.viewProperty,["metaPropertyChange"]);this.on({scope:this,changeColumnPosition:this.onListViewChangeColumnPosition,changeColumnLabel:this.onListViewChangeColumnLabel,deleteColumn:this.onListViewDeleteColumn,columnresize:this.onListViewColumnResize,metaPropertyChange:this.onListViewMetaPropertyChange})},initEditDesignerView:function(){},initShowDesignerView:function(){},initHtmlDesignerView:function(){},onSaveWidgetView:function(){var a=this.widgetMeta.widgetUri,d=afStudio.wd.GuiFactory.getWidgetType(this.widgetMeta),e=this.viewInspector,c=e.getRootNode();var f=c.dumpDataForWidgetDefinition();var b=new afStudio.wd.WidgetDefinition({widgetUri:a,widgetType:d});b.saveDefinition(f)},onPreviewWidgetView:function(){var a=this.widgetMeta.widgetUri,b=this.viewInspector.getRootNode();afApp.widgetPopup(a,b.text,null,null,afStudio)},onViewInspectorAppendProperty:function(f,n,d,g){var m=afStudio.wd.GuiFactory,j=this.designerView,c=this.viewProperty,a=this.viewInspector;switch(this.widgetType){case m.LIST:switch(n.id){case"i:actions":c.setSource(d.getProperties());(function(){a.getSelectionModel().select(d)}).defer(100,this);var e=j.getTopToolbar().getComponent("actions");if(e.hidden){e.show();j.doLayout()}j.addIAction({name:d.getProperty("name").get("value")});e.doLayout();break;case"i:rowactions":c.setSource(d.getProperties());(function(){a.getSelectionModel().select(d)}).defer(100,this);j.addIRowaction({name:d.getProperty("name").get("value")});break;case"i:moreactions":c.setSource(d.getProperties());(function(){a.getSelectionModel().select(d)}).defer(100,this);j.addMoreAction({name:d.getProperty("name").get("value")});j.updateActionBarVisibilityState();break;case"i:fields":var h=j.getColumnModel(),l=j.getView().getUninitColumn(),b=h.getColumnCount(true);if(l!=-1){c.setSource(d.getProperties());(function(){a.getSelectionModel().select(d)}).defer(100,this);h.config[l].uninit=false;h.config[l].header=d.getProperty("label").get("value");h.config[l].name=d.getProperty("name").get("value");h.moveColumn(l,b);h.setHidden(b,false)}else{(function(){d.destroy();c.setSource([])}).defer(100,this);afStudio.Msg.info("Widget Designer: List View",String.format("Max columns size <u>{0}</u>",j.maxColumns))}break}break}},onViewInspectorRemoveProperty:function(e,l,c){var j=afStudio.wd.GuiFactory,g=this.designerView,b=this.viewProperty,a=this.viewInspector;switch(this.widgetType){case j.LIST:switch(l.id){case"i:actions":var h=c.getProperty("name").get("value"),d=g.getTopToolbar().getComponent("actions");b.setSource({});g.deleteIAction(h,d);break;case"i:rowactions":var h=c.getProperty("name").get("value");b.setSource({});g.deleteIRowaction(h);break;case"i:moreactions":var h=c.getProperty("name").get("value"),d=g.getTopToolbar().getComponent("actions"),f=d.getComponent("more");b.setSource({});g.deleteIAction(h,f.menu);break}break}},onListViewChangeColumnPosition:function(f,a,b){var g=this.viewInspector,e=this.designerView.getColumnModel(),d=g.getRootNode(),c=d.getFieldsNode();if(c&&c.findChild("text",f.name)){if(e.config[0]&&e.config[0].id=="checker"){a--;b--}if(a>b){c.childIdsOrdered.dragUp(a,b)}else{c.childIdsOrdered.dragDown(a,b)}}},onListViewChangeColumnLabel:function(g,d,f){var h=this.viewInspector,e=h.getRootNode(),c=e.getFieldsNode(),b;if(c&&(b=c.findChild("text",g.name))){var a=b.getProperty("label");a.set("value",f)}},onListViewDeleteColumn:function(a){var d=this.viewInspector,c=d.getRootNode().getFieldsNode(),b;if(c&&(b=c.findChild("text",a))){c.deleteChild(b)}},onListViewColumnResize:function(e,b){var c=this.designerView,h=this.viewInspector,a=c.getColumnModel(),g=a.config[e],d=h.getRootNode().getFieldsNode();if(d){var f=d.findChild("text",g.name);f.setProperty("width",b)}},onListViewMetaPropertyChange:function(d,c,e,a){var b=this.designerView;b.processMeta({node:d,name:c,value:e,oldValue:a})}});Ext.reg("afStudio.wd.designerTab",afStudio.wd.DesignerTab);Ext.namespace("afStudio.wd");afStudio.wd.CodeEditorTab=Ext.extend(Ext.Panel,{layout:"hbox",layoutConfig:{align:"stretch"},closable:true,_beforeInitComponent:function(){var a=this;a.codePress=new Ext.ux.CodePress({title:this.fileName,path:this.filePath,tabTip:this.tabTip,file:this.file,closable:true,tabPanel:this,ctCls:"codeEditorCls"});a.codeBrowserTree=new Ext.ux.FileTreePanel({title:"Code Browser",flex:1,rootPath:"root",rootVisible:true,rootText:"Home",url:afStudioWSUrls.getFiletreeUrl(),maxFileSize:524288*2*10,topMenu:false,autoScroll:true,enableProgress:false,singleUpload:true});return{title:this.fileName,iconCls:"icon-script-edit",defaults:{style:"padding: 5px;"},tbar:[{text:"Save",itemId:"saveBtn",iconCls:"icon-save"}],items:[{title:"Code Editor",flex:3,layout:"fit",items:[{border:false,layout:"fit",items:a.codePress}]},a.codeBrowserTree]}},initComponent:function(){Ext.apply(this,Ext.apply(this.initialConfig,this._beforeInitComponent()));afStudio.wd.CodeEditorTab.superclass.initComponent.apply(this,arguments);this._afterInitComponent()},_afterInitComponent:function(){var b=this,a=this.getTopToolbar().getComponent("saveBtn");a.on("click",b.onCodeSaveClick,b)},onCodeSaveClick:function(){var a=this;Ext.Ajax.request({url:a.codePress.fileContentUrl,params:{"file":a.codePress.file,"code":a.codePress.getCode()},success:function(b,c){a.fireEvent("logmessage",a,"Widget Designer code Saved");afStudio.Msg.info(String.format("File <u>{0}</u> was successfully saved.",a.codePress.title))},failure:function(d,c){var b=String.format("Status code: {0}, message: {1}",d.status,d.statusText);afStudio.Msg.error("Server side error",b)}})}});Ext.reg("afStudio.wd.codeEditorTab",afStudio.wd.CodeEditorTab);Ext.override(Ext.grid.GridDragZone,{afterRepair:function(){Ext.fly(this.DDM.currentTarget).parent("TABLE").frame("#FFA7A7",1);this.dragging=false}});Ext.ns("afStudio.wd");afStudio.wd.WidgetsBuilder=Ext.extend(Ext.Window,{onWndShow:function(){var d=this;var a=this.relationsGrid.getView().scroller.dom;new Ext.dd.DropTarget(a,{ddGroup:"widgetsBuilder",notifyDrop:function(p,o,l){var h=p.dragData.selections;var g=d.fieldsGrid.getSelectionModel().getSelected();var n=d.modelsTree.getSelectionModel().getSelectedNode();var f=d.modelsTree.getModel(n);if(g){Ext.each(h,p.grid.store.remove,p.grid.store);var j=new d.RelationRec({id:g.get("id"),model:f,name:f+"."+g.get("name"),field:g.get("name"),type:g.get("type"),size:g.get("size"),required:g.get("required")});d.relationsGrid.store.add(j);d.relationsGrid.store.sort("name","ASC");return true}else{this.dragging=false}}});var c=Ext.getCmp("widgets-basket");var b=c.body.dom;new Ext.dd.DropTarget(b,{ddGroup:"widgetsBuilderRel",notifyEnter:function(j,h,f){c.body.stopFx();var g=f.grid.getId();if("fields-grid"==g){return this.dropNotAllowed}else{c.body.highlight("#E56060");return this.dropAllowed}},notifyDrop:function(l,j,g){var h=g.grid.getId();if("fields-grid"==h){Ext.fly(this.DDM.currentTarget).parent("TABLE").frame("#8db2e3",1);this.dragging=false;return false}else{var f=l.dragData.selections[0];l.grid.store.remove(f);return true}}})},loadModelFields:function(b,d){var c=this.modelsTree.getSchema(b),a=this.modelsTree.getModel(b);this.fieldsGrid.getStore().load({params:{schema:c,model:a},callback:d||Ext.emptyFn})},onModelClick:function(a,b){this.fieldsGrid.show();this.loadModelFields(a)},onModelsLoad:function(a,b){this.fieldsGrid.getStore().removeAll();this.fieldsGrid.hide()},onRelGridRefresh:function(m){var a=m.grid;var b=a.getStore();for(var g=0,l=b.getCount();g<l;g++){var c=b.getAt(g);var h="<b>Field Specification</b><br>";h+="<br><b>Model: </b>"+c.get("model");h+="<br><b>Field: </b>"+c.get("field");if(type=c.get("type")){h+="<br><b>Type: </b>"+type}if(size=c.get("size")){h+="<br><b>Size: </b>"+size}var n=m.getRow(g);var f=Ext.get(n).select(".x-grid3-cell-inner");for(var e=0,d=f.getCount();e<d;e++){Ext.QuickTips.register({target:f.item(e),text:h})}}},_beforeInitComponent:function(){var a=this;this.RelationRec=Ext.data.Record.create(["id","model","name","field","type","size"]);this.relationsGrid=new Ext.grid.GridPanel({id:"rel-grid",flex:1,width:234,ddGroup:"widgetsBuilderRel",enableDragDrop:true,store:new Ext.data.ArrayStore({idIndex:0,fields:["id","model","name","field","type","size"]}),viewConfig:{scrollOffset:19,forceFit:true},columns:[{header:"Selected fields",sortable:true,width:170,dataIndex:"name"}],loadMask:true,border:true,style:"padding-bottom: 5px;",autoScroll:true});this.fieldsGrid=new Ext.grid.GridPanel({id:"fields-grid",ref:"../fieldsGrid",ddGroup:"widgetsBuilder",enableDragDrop:true,store:new Ext.data.JsonStore({url:a.fieldsUrl,autoLoad:false,baseParams:{xaction:"read"},root:"rows",idProperty:"id",fields:["id","name","type","size","required"]}),sm:new Ext.grid.RowSelectionModel({singleSelect:true}),columns:[{header:"Name",sortable:true,width:150,dataIndex:"name"},{header:"Type",sortable:true,width:110,dataIndex:"type"},{header:"Size",sortable:true,width:60,dataIndex:"size"}],loadMask:true,border:false,autoScroll:true,hidden:true});this.basket=new Ext.Panel({id:"widgets-basket",xtype:"panel",html:"<center><br>Drop Item here,<br> to remove it</br></center>",bodyStyle:"padding: 5px;",height:70,width:234});this.modulesCombo=new Ext.ux.form.GroupingComboBox({fieldLabel:"Module Location",loadingText:"Please wait...",emptyText:"Please select the module location...",store:new Ext.data.JsonStore({url:afStudioWSUrls.getModulesUrl(),baseParams:{cmd:"getGrouped"},totalProperty:"total",idProperty:"value",fields:["value","text","group"],remoteSort:true}),displayField:"text",groupField:"group",anchor:"100%",minChars:0,hiddenName:"model"});this.actionInput=new Ext.form.TextField({fieldLabel:"Widget Name",anchor:"100%"});this.typeCombo=new Ext.form.ComboBox({fieldLabel:"Widget Type",triggerAction:"all",anchor:"100%",store:[["list","List"],["grid","Grid"],["edit","Edit"],["show","Show"]],value:"list"});return{title:"Create new widget",y:150,width:450,height:150,modal:true,tbar:{xtype:"toolbar",id:this.id+"help-toolbar",hidden:true,items:["Please select the fields for each model you want to have displayed in your Widget. And drag each field to the Selected fields area."]},layout:"card",activeItem:0,items:[{border:false,bodyBorder:false,hideBorders:true,items:[new Ext.FormPanel({bodyStyle:"padding: 5px;",labelWidth:100,items:[this.modulesCombo,this.actionInput,this.typeCombo]})]},{border:false,bodyBorder:false,xtype:"panel",layout:"border",items:[{region:"west",layout:"fit",margins:"5 5 5 5",width:220,items:[{xtype:"afStudio.models.modelTree",url:a.modelsUrl,border:false,ref:"../../modelsTree"}]},{region:"center",margins:"5 5 5 0",layout:"fit",items:this.fieldsGrid},{region:"east",margins:"5 5 5 0",width:235,layout:"vbox",border:false,bodyBorder:false,bodyStyle:"background-color: #DFE8F6",items:[this.relationsGrid,this.basket]}]}],buttonAlign:"left",buttons:[{text:"Cancel",handler:this.cancel,scope:this},"->",{text:"&laquo; Back",id:this.id+"-back-btn",handler:this.chStep.createDelegate(a,[0]),disabled:true},{text:"Next &raquo;",id:this.id+"-next-btn",handler:this.chStep.createDelegate(a,[1])},{text:"Save &raquo;",id:this.id+"-save-btn",hidden:true,handler:this.create,scope:this}]}},initComponent:function(){Ext.apply(this,Ext.apply(this.initialConfig,this._beforeInitComponent()));afStudio.wd.WidgetsBuilder.superclass.initComponent.apply(this,arguments);this._afterInitComponent()},_afterInitComponent:function(){this.addEvents("widgetcreated");this.on("show",this.onWndShow,this);this.relationsGrid.getView().on("refresh",this.onRelGridRefresh);this.modelsTree.on({"click":Ext.util.Functions.createDelegate(this.onModelClick,this),"modelsload":Ext.util.Functions.createDelegate(this.onModelsLoad,this)})},chStep:function(c){var a=Ext.getCmp(this.id);if(1==c){var b={width:840,height:450};Ext.getCmp(this.id+"-save-btn").show();Ext.getCmp(this.id+"-next-btn").hide();Ext.getCmp(this.id+"-back-btn").enable();Ext.getCmp(this.id+"help-toolbar").show()}else{var b={width:450,height:150};Ext.getCmp(this.id+"-save-btn").hide();Ext.getCmp(this.id+"-next-btn").show();Ext.getCmp(this.id+"-back-btn").disable();Ext.getCmp(this.id+"help-toolbar").hide()}this.setSize(b);this.setPagePosition((Ext.getBody().getWidth()-b.width)/2,150);a.getLayout().setActiveItem(c)},create:function(){var b=[];this.relationsGrid.getStore().each(function(j){if(j.data){b.push(j.data)}});var d=this.modulesCombo.getValue(),f=this.actionInput.getValue(),a=d+"/"+f,e=this.typeCombo.getValue();var c=afStudio.wd.WidgetFactory.buildWidgetDefinition(b,e);var g=new afStudio.wd.WidgetDefinition({widgetUri:a,widgetType:e});var h=Ext.util.Functions.createDelegate(function(j){this.fireEvent("widgetcreated",a,j);this.close()},this);g.saveDefinition(c,h,true)},cancel:function(){this.close()}});Ext.namespace("afStudio.wd");afStudio.wd.WidgetFactory=function(){return{createWIRootNode:function(b){var a;switch(b){case"list":a=new afStudio.wi.ListNode();break;case"edit":a=new afStudio.wi.EditNode();break;case"html":a=new afStudio.wi.HtmlNode();break}return a},buildWidgetDefinition:function(c,b){var a=this.createWIRootNode(b);a.setTitle("new widget");for(k=0;k<c.length;k++){var e=a.getFieldsNode().addChild();e.setNameAndLabel(c[k].field,c[k].field.ucfirst());if(b=="edit"){e.setTypeAndValidatorFromModelType(c[k]);e.getProperty("valueType").set("value","orm")}}if(c.length>0){var d=c[0].model;a.getDatasourceNode().setClassFromModel(d,b)}return a.dumpDataForWidgetDefinition()},showWidgetDesigner:function(a,b,c){afStudio.vp.addToWorkspace({xtype:"afStudio.wd.widgetPanel",actionPath:b,securityPath:c,widgetUri:a},true)}}}();Ext.namespace("afStudio.wd");afStudio.wd.WidgetTabPanel=Ext.extend(Ext.TabPanel,{_beforeInitComponent:function(){var a=this;this.widgetPanel=this.ownerCt;return{itemId:"widget-designer",border:false,activeTab:0,items:[{xtype:"afStudio.wd.designerTab",widgetMeta:this.widgetMeta},{xtype:"afStudio.wd.codeEditorTab",fileName:"security.yml",filePath:this.widgetMeta.securityPath,tabTip:this.widgetMeta.securityPath,file:this.widgetMeta.securityPath},{xtype:"afStudio.wd.codeEditorTab",fileName:"actions.class.php",filePath:this.widgetMeta.actionPath,tabTip:this.widgetMeta.actionPath,file:this.widgetMeta.actionPath}],plugins:new Ext.ux.TabMenu()}},initComponent:function(){Ext.apply(this,Ext.apply(this.initialConfig,this._beforeInitComponent()));afStudio.wd.WidgetTabPanel.superclass.initComponent.apply(this,arguments);this._afterInitComponent()},_afterInitComponent:function(){var a=this;this.on("beforetabchange",function(c,d,b){if(b&&b.iframe){b.toggleIframe()}if(d&&d.iframe){d.toggleIframe()}},this)},addCodeEditorTab:function(e,d,a,c){var b=this.add({xtype:"afStudio.wd.codeEditorTab",fileName:e,filePath:d,tabTip:a,file:c});this.setActiveTab(b.getId())}});Ext.reg("afStudio.wd.widgetTabPanel",afStudio.wd.WidgetTabPanel);Ext.namespace("afStudio.wd");afStudio.wd.WidgetPanel=Ext.extend(Ext.Panel,{layout:"fit",constructor:function(a){a=a||{};a.widgetMetaData={};if(a.actionPath){a.widgetMetaData.actionPath=a.actionPath;delete a.actionPath}if(a.securityPath){a.widgetMetaData.securityPath=a.securityPath;delete a.securityPath}if(a.widgetUri){a.widgetMetaData.widgetUri=a.widgetUri;delete a.widgetUri}Ext.apply(a,{title:a.widgetMetaData.widgetUri});this.widgetDefinition=new afStudio.wd.WidgetDefinition({widgetUri:a.widgetMetaData.widgetUri});afStudio.wd.WidgetPanel.superclass.constructor.call(this,a)},initComponent:function(){afStudio.wd.WidgetPanel.superclass.initComponent.apply(this,arguments);this._afterInitComponent()},_afterInitComponent:function(){var a=this;this.on({scope:a,afterrender:a.initWidgetPanel})},initWidgetPanel:function(){afStudio.vp.mask({region:"center"});this.widgetDefinition.fetchDefinition({scope:this,success:function(a){afStudio.vp.unmask("center");this.widgetMetaData.definition=a;this.openWidgetDesigner(a)},error:function(a){afStudio.vp.unmask("center");var b=String.format('Fetching widget "{0}" data failed. <br/> {1}',this.widgetMetaData.widgetUri,a.message);afStudio.Msg.error(b)}})},openWidgetDesigner:function(a){this.add({xtype:"afStudio.wd.widgetTabPanel",widgetMeta:this.widgetMetaData});this.doLayout()}});Ext.reg("afStudio.wd.widgetPanel",afStudio.wd.WidgetPanel);Ext.ns("afStudio.wd");afStudio.wd.WidgetDefinition=Ext.extend(Ext.util.Observable,{constructor:function(a){a=a||{};Ext.apply(this,a);this.addEvents("datafetched","fetchingexception");afStudio.wd.WidgetDefinition.superclass.constructor.call(this)},fetchDefinition:function(a){var b=this;Ext.Ajax.request({url:afStudioWSUrls.getGetWidgetUrl(this.widgetUri),scope:a.scope?a.scope:b,success:function(e){var c=Ext.util.JSON.decode(e.responseText);if(c.success){var d=c.data;if(Ext.isFunction(a.success)){Ext.util.Functions.createDelegate(a.success,this,[d],false)()}b.fireEvent("datafetched",d)}else{if(Ext.isFunction(a.error)){Ext.util.Functions.createDelegate(a.error,this,[c],false)()}b.fireEvent("fetchingexception",c)}},failure:function(e,c){var d=String.format("Status code: {0}, message: {1}",e.status,e.statusText);afStudio.Msg.error("Server side error",d)}})},saveDefinition:function(b,d,a){var c=this,b=Ext.util.JSON.encode(b);Ext.Ajax.request({url:afStudioWSUrls.getSaveWidgetUrl(this.widgetUri),params:{data:b,widgetType:this.widgetType,createNewWidget:a?true:false},success:function(f){var e=Ext.decode(f.responseText);if(e.success){afStudio.Msg.info(e.message);if(Ext.isFunction(d)){d(e)}}else{afStudio.Msg.error(e.message)}},failure:function(g,e){var f=String.format("Status code: {0}, message: {1}",g.status,g.statusText);afStudio.Msg.error("Server side error",f)}})}});
/*
 * jQuery JavaScript Library v1.4.4
 * http://jquery.com/
 *
 * Copyright 2010, John Resig
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 * Copyright 2010, The Dojo Foundation
 * Released under the MIT, BSD, and GPL Licenses.
 *
 * Date: Thu Nov 11 19:04:53 2010 -0500
 */
(function(ay,aC){function j(t,c,E){if(E===aC&&t.nodeType===1){E=t.getAttribute("data-"+c);if(typeof E==="string"){try{E=E==="true"?true:E==="false"?false:E==="null"?null:!ac.isNaN(E)?parseFloat(E):ad.test(E)?ac.parseJSON(E):E}catch(B){}ac.data(t,c,E)}else{E=aC}}return E}function an(){return false}function K(){return true}function a0(t,c,B){B[0].type=t;return ac.event.handle.apply(c,B)}function C(aa){var X,W,V,U,T,P,S,E,Z,c,B,t=[];U=[];T=ac.data(this,this.nodeType?"events":"__events__");if(typeof T==="function"){T=T.events}if(!(aa.liveFired===this||!T||!T.live||aa.button&&aa.type==="click")){if(aa.namespace){B=RegExp("(^|\\.)"+aa.namespace.split(".").join("\\.(?:.*\\.)?")+"(\\.|$)")}aa.liveFired=this;var Y=T.live.slice(0);for(S=0;S<Y.length;S++){T=Y[S];T.origType.replace(ak,"")===aa.type?U.push(T.selector):Y.splice(S--,1)}U=ac(aa.target).closest(U,aa.currentTarget);E=0;for(Z=U.length;E<Z;E++){c=U[E];for(S=0;S<Y.length;S++){T=Y[S];if(c.selector===T.selector&&(!B||B.test(T.namespace))){P=c.elem;V=null;if(T.preType==="mouseenter"||T.preType==="mouseleave"){aa.type=T.preType;V=ac(aa.relatedTarget).closest(T.selector)[0]}if(!V||V!==P){t.push({elem:P,handleObj:T,level:c.level})}}}}E=0;for(Z=t.length;E<Z;E++){U=t[E];if(W&&U.level>W){break}aa.currentTarget=U.elem;aa.data=U.handleObj.data;aa.handleObj=U.handleObj;B=U.handleObj.origHandler.apply(U.elem,arguments);if(B===false||aa.isPropagationStopped()){W=U.level;if(B===false){X=false}if(aa.isImmediatePropagationStopped()){break}}}return X}}function aj(t,c){return(t&&t!=="*"?t+".":"")+c.replace(o,"`").replace(a4,"&")}function aN(t,c,E){if(ac.isFunction(c)){return ac.grep(t,function(S,P){return !!c.call(S,P,S)===E})}else{if(c.nodeType){return ac.grep(t,function(P){return P===c===E})}else{if(typeof c==="string"){var B=ac.grep(t,function(P){return P.nodeType===1});if(aS.test(c)){return ac.filter(c,B,!E)}else{c=ac.filter(c,B)}}}}return ac.grep(t,function(P){return ac.inArray(P,c)>=0===E})}function az(t,c){var B=0;c.each(function(){if(this.nodeName===(t[B]&&t[B].nodeName)){var T=ac.data(t[B++]),S=ac.data(this,T);if(T=T&&T.events){delete S.handle;S.events={};for(var P in T){for(var E in T[P]){ac.event.add(this,P,T[P][E],T[P][E].data)}}}}})}function aF(t,c){c.src?ac.ajax({url:c.src,async:false,dataType:"script"}):ac.globalEval(c.text||c.textContent||c.innerHTML||"");c.parentNode&&c.parentNode.removeChild(c)}function R(t,c,E){var B=c==="width"?t.offsetWidth:t.offsetHeight;if(E==="border"){return B}ac.each(c==="width"?ag:G,function(){E||(B-=parseFloat(ac.css(t,"padding"+this))||0);if(E==="margin"){B+=parseFloat(ac.css(t,"margin"+this))||0}else{B-=parseFloat(ac.css(t,"border"+this+"Width"))||0}});return B}function v(t,c,E,B){if(ac.isArray(c)&&c.length){ac.each(c,function(S,P){E||r.test(t)?B(t,P):v(t+"["+(typeof P==="object"||ac.isArray(P)?S:"")+"]",P,E,B)})}else{if(!E&&c!=null&&typeof c==="object"){ac.isEmptyObject(c)?B(t,""):ac.each(c,function(S,P){v(t+"["+S+"]",P,E,B)})}else{B(t,c)}}}function ap(t,c){var B={};ac.each(A.concat.apply([],A.slice(0,c)),function(){B[this]=t});return B}function n(t){if(!g[t]){var c=ac("<"+t+">").appendTo("body"),B=c.css("display");c.remove();if(B==="none"||B===""){B="block"}g[t]=B}return g[t]}function aX(c){return ac.isWindow(c)?c:c.nodeType===9?c.defaultView||c.parentWindow:false}var I=ay.document,ac=function(){function bk(){if(!bj.isReady){try{I.documentElement.doScroll("left")}catch(bl){setTimeout(bk,1);return}bj.ready()}}var bj=function(bl,bm){return new bj.fn.init(bl,bm)},bi=ay.jQuery,bh=ay.$,bg,be=/^(?:[^<]*(<[\w\W]+>)[^>]*$|#([\w\-]+)$)/,bb=/\S/,bc=/^\s+/,a8=/\s+$/,V=/\W/,ab=/\d/,a7=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,aa=/^[\],:{}\s]*$/,T=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,W=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,U=/(?:^|:|,)(?:\s*\[)+/g,P=/(webkit)[ \/]([\w.]+)/,bf=/(opera)(?:.*version)?[ \/]([\w.]+)/,bd=/(msie) ([\w.]+)/,a9=/(mozilla)(?:.*? rv:([\w.]+))?/,ba=navigator.userAgent,a6=false,a5=[],Y,S=Object.prototype.toString,X=Object.prototype.hasOwnProperty,E=Array.prototype.push,B=Array.prototype.slice,t=String.prototype.trim,Z=Array.prototype.indexOf,c={};bj.fn=bj.prototype={init:function(bm,bo){var bl,bp,bn;if(!bm){return this}if(bm.nodeType){this.context=this[0]=bm;this.length=1;return this}if(bm==="body"&&!bo&&I.body){this.context=I;this[0]=I.body;this.selector="body";this.length=1;return this}if(typeof bm==="string"){if((bl=be.exec(bm))&&(bl[1]||!bo)){if(bl[1]){bn=bo?bo.ownerDocument||bo:I;if(bp=a7.exec(bm)){if(bj.isPlainObject(bo)){bm=[I.createElement(bp[1])];bj.fn.attr.call(bm,bo,true)}else{bm=[bn.createElement(bp[1])]}}else{bp=bj.buildFragment([bl[1]],[bn]);bm=(bp.cacheable?bp.fragment.cloneNode(true):bp.fragment).childNodes}return bj.merge(this,bm)}else{if((bp=I.getElementById(bl[2]))&&bp.parentNode){if(bp.id!==bl[2]){return bg.find(bm)}this.length=1;this[0]=bp}this.context=I;this.selector=bm;return this}}else{if(!bo&&!V.test(bm)){this.selector=bm;this.context=I;bm=I.getElementsByTagName(bm);return bj.merge(this,bm)}else{return !bo||bo.jquery?(bo||bg).find(bm):bj(bo).find(bm)}}}else{if(bj.isFunction(bm)){return bg.ready(bm)}}if(bm.selector!==aC){this.selector=bm.selector;this.context=bm.context}return bj.makeArray(bm,this)},selector:"",jquery:"1.4.4",length:0,size:function(){return this.length},toArray:function(){return B.call(this,0)},get:function(bl){return bl==null?this.toArray():bl<0?this.slice(bl)[0]:this[bl]},pushStack:function(bm,bn,bl){var bo=bj();bj.isArray(bm)?E.apply(bo,bm):bj.merge(bo,bm);bo.prevObject=this;bo.context=this.context;if(bn==="find"){bo.selector=this.selector+(this.selector?" ":"")+bl}else{if(bn){bo.selector=this.selector+"."+bn+"("+bl+")"}}return bo},each:function(bl,bm){return bj.each(this,bl,bm)},ready:function(bl){bj.bindReady();if(bj.isReady){bl.call(I,bj)}else{a5&&a5.push(bl)}return this},eq:function(bl){return bl===-1?this.slice(bl):this.slice(bl,+bl+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(B.apply(this,arguments),"slice",B.call(arguments).join(","))},map:function(bl){return this.pushStack(bj.map(this,function(bn,bm){return bl.call(bn,bm,bn)}))},end:function(){return this.prevObject||bj(null)},push:E,sort:[].sort,splice:[].splice};bj.fn.init.prototype=bj.fn;bj.extend=bj.fn.extend=function(){var bl,bt,bq,bn,bp,br=arguments[0]||{},bo=1,bm=arguments.length,bs=false;if(typeof br==="boolean"){bs=br;br=arguments[1]||{};bo=2}if(typeof br!=="object"&&!bj.isFunction(br)){br={}}if(bm===bo){br=this;--bo}for(;bo<bm;bo++){if((bl=arguments[bo])!=null){for(bt in bl){bq=br[bt];bn=bl[bt];if(br!==bn){if(bs&&bn&&(bj.isPlainObject(bn)||(bp=bj.isArray(bn)))){if(bp){bp=false;bq=bq&&bj.isArray(bq)?bq:[]}else{bq=bq&&bj.isPlainObject(bq)?bq:{}}br[bt]=bj.extend(bs,bq,bn)}else{if(bn!==aC){br[bt]=bn}}}}}}return br};bj.extend({noConflict:function(bl){ay.$=bh;if(bl){ay.jQuery=bi}return bj},isReady:false,readyWait:1,ready:function(bm){bm===true&&bj.readyWait--;if(!bj.readyWait||bm!==true&&!bj.isReady){if(!I.body){return setTimeout(bj.ready,1)}bj.isReady=true;if(!(bm!==true&&--bj.readyWait>0)){if(a5){var bn=0,bl=a5;for(a5=null;bm=bl[bn++];){bm.call(I,bj)}bj.fn.trigger&&bj(I).trigger("ready").unbind("ready")}}}},bindReady:function(){if(!a6){a6=true;if(I.readyState==="complete"){return setTimeout(bj.ready,1)}if(I.addEventListener){I.addEventListener("DOMContentLoaded",Y,false);ay.addEventListener("load",bj.ready,false)}else{if(I.attachEvent){I.attachEvent("onreadystatechange",Y);ay.attachEvent("onload",bj.ready);var bl=false;try{bl=ay.frameElement==null}catch(bm){}I.documentElement.doScroll&&bl&&bk()}}}},isFunction:function(bl){return bj.type(bl)==="function"},isArray:Array.isArray||function(bl){return bj.type(bl)==="array"},isWindow:function(bl){return bl&&typeof bl==="object"&&"setInterval" in bl},isNaN:function(bl){return bl==null||!ab.test(bl)||isNaN(bl)},type:function(bl){return bl==null?String(bl):c[S.call(bl)]||"object"},isPlainObject:function(bl){if(!bl||bj.type(bl)!=="object"||bl.nodeType||bj.isWindow(bl)){return false}if(bl.constructor&&!X.call(bl,"constructor")&&!X.call(bl.constructor.prototype,"isPrototypeOf")){return false}for(var bm in bl){}return bm===aC||X.call(bl,bm)},isEmptyObject:function(bl){for(var bm in bl){return false}return true},error:function(bl){throw bl},parseJSON:function(bl){if(typeof bl!=="string"||!bl){return null}bl=bj.trim(bl);if(aa.test(bl.replace(T,"@").replace(W,"]").replace(U,""))){return ay.JSON&&ay.JSON.parse?ay.JSON.parse(bl):(new Function("return "+bl))()}else{bj.error("Invalid JSON: "+bl)}},noop:function(){},globalEval:function(bm){if(bm&&bb.test(bm)){var bn=I.getElementsByTagName("head")[0]||I.documentElement,bl=I.createElement("script");bl.type="text/javascript";if(bj.support.scriptEval){bl.appendChild(I.createTextNode(bm))}else{bl.text=bm}bn.insertBefore(bl,bn.firstChild);bn.removeChild(bl)}},nodeName:function(bl,bm){return bl.nodeName&&bl.nodeName.toUpperCase()===bm.toUpperCase()},each:function(bn,bq,bm){var br,bo=0,bp=bn.length,bl=bp===aC||bj.isFunction(bn);if(bm){if(bl){for(br in bn){if(bq.apply(bn[br],bm)===false){break}}}else{for(;bo<bp;){if(bq.apply(bn[bo++],bm)===false){break}}}}else{if(bl){for(br in bn){if(bq.call(bn[br],br,bn[br])===false){break}}}else{for(bm=bn[0];bo<bp&&bq.call(bm,bo,bm)!==false;bm=bn[++bo]){}}}return bn},trim:t?function(bl){return bl==null?"":t.call(bl)}:function(bl){return bl==null?"":bl.toString().replace(bc,"").replace(a8,"")},makeArray:function(bm,bn){var bl=bn||[];if(bm!=null){var bo=bj.type(bm);bm.length==null||bo==="string"||bo==="function"||bo==="regexp"||bj.isWindow(bm)?E.call(bl,bm):bj.merge(bl,bm)}return bl},inArray:function(bm,bn){if(bn.indexOf){return bn.indexOf(bm)}for(var bl=0,bo=bn.length;bl<bo;bl++){if(bn[bl]===bm){return bl}}return -1},merge:function(bm,bo){var bl=bm.length,bp=0;if(typeof bo.length==="number"){for(var bn=bo.length;bp<bn;bp++){bm[bl++]=bo[bp]}}else{for(;bo[bp]!==aC;){bm[bl++]=bo[bp++]}}bm.length=bl;return bm},grep:function(bn,bq,bm){var br=[],bo;bm=!!bm;for(var bp=0,bl=bn.length;bp<bl;bp++){bo=!!bq(bn[bp],bp);bm!==bo&&br.push(bn[bp])}return br},map:function(bn,bq,bm){for(var br=[],bo,bp=0,bl=bn.length;bp<bl;bp++){bo=bq(bn[bp],bp,bm);if(bo!=null){br[br.length]=bo}}return br.concat.apply([],br)},guid:1,proxy:function(bm,bn,bl){if(arguments.length===2){if(typeof bn==="string"){bl=bm;bm=bl[bn];bn=aC}else{if(bn&&!bj.isFunction(bn)){bl=bn;bn=aC}}}if(!bn&&bm){bn=function(){return bm.apply(bl||this,arguments)}}if(bm){bn.guid=bm.guid=bm.guid||bn.guid||bj.guid++}return bn},access:function(bn,bq,bm,bs,bo,bp){var bl=bn.length;if(typeof bq==="object"){for(var br in bq){bj.access(bn,br,bq[br],bs,bo,bm)}return bn}if(bm!==aC){bs=!bp&&bs&&bj.isFunction(bm);for(br=0;br<bl;br++){bo(bn[br],bq,bs?bm.call(bn[br],br,bo(bn[br],bq)):bm,bp)}return bn}return bl?bo(bn[0],bq):aC},now:function(){return(new Date).getTime()},uaMatch:function(bl){bl=bl.toLowerCase();bl=P.exec(bl)||bf.exec(bl)||bd.exec(bl)||bl.indexOf("compatible")<0&&a9.exec(bl)||[];return{browser:bl[1]||"",version:bl[2]||"0"}},browser:{}});bj.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(bl,bm){c["[object "+bm+"]"]=bm.toLowerCase()});ba=bj.uaMatch(ba);if(ba.browser){bj.browser[ba.browser]=true;bj.browser.version=ba.version}if(bj.browser.webkit){bj.browser.safari=true}if(Z){bj.inArray=function(bl,bm){return Z.call(bm,bl)}}if(!/\s/.test("\u00a0")){bc=/^[\s\xA0]+/;a8=/[\s\xA0]+$/}bg=bj(I);if(I.addEventListener){Y=function(){I.removeEventListener("DOMContentLoaded",Y,false);bj.ready()}}else{if(I.attachEvent){Y=function(){if(I.readyState==="complete"){I.detachEvent("onreadystatechange",Y);bj.ready()}}}}return ay.jQuery=ay.$=bj}();(function(){ac.support={};var X=I.documentElement,V=I.createElement("script"),U=I.createElement("div"),T="script"+ac.now();U.style.display="none";U.innerHTML="   <link/><table></table><a href='/a' style='color:red;float:left;opacity:.55;'>a</a><input type='checkbox'/>";var S=U.getElementsByTagName("*"),P=U.getElementsByTagName("a")[0],B=I.createElement("select"),E=B.appendChild(I.createElement("option"));if(!(!S||!S.length||!P)){ac.support={leadingWhitespace:U.firstChild.nodeType===3,tbody:!U.getElementsByTagName("tbody").length,htmlSerialize:!!U.getElementsByTagName("link").length,style:/red/.test(P.getAttribute("style")),hrefNormalized:P.getAttribute("href")==="/a",opacity:/^0.55$/.test(P.style.opacity),cssFloat:!!P.style.cssFloat,checkOn:U.getElementsByTagName("input")[0].value==="on",optSelected:E.selected,deleteExpando:true,optDisabled:false,checkClone:false,scriptEval:false,noCloneEvent:true,boxModel:null,inlineBlockNeedsLayout:false,shrinkWrapBlocks:false,reliableHiddenOffsets:true};B.disabled=true;ac.support.optDisabled=!E.disabled;V.type="text/javascript";try{V.appendChild(I.createTextNode("window."+T+"=1;"))}catch(t){}X.insertBefore(V,X.firstChild);if(ay[T]){ac.support.scriptEval=true;delete ay[T]}try{delete V.test}catch(W){ac.support.deleteExpando=false}X.removeChild(V);if(U.attachEvent&&U.fireEvent){U.attachEvent("onclick",function c(){ac.support.noCloneEvent=false;U.detachEvent("onclick",c)});U.cloneNode(true).fireEvent("onclick")}U=I.createElement("div");U.innerHTML="<input type='radio' name='radiotest' checked='checked'/>";X=I.createDocumentFragment();X.appendChild(U.firstChild);ac.support.checkClone=X.cloneNode(true).cloneNode(true).lastChild.checked;ac(function(){var Z=I.createElement("div");Z.style.width=Z.style.paddingLeft="1px";I.body.appendChild(Z);ac.boxModel=ac.support.boxModel=Z.offsetWidth===2;if("zoom" in Z.style){Z.style.display="inline";Z.style.zoom=1;ac.support.inlineBlockNeedsLayout=Z.offsetWidth===2;Z.style.display="";Z.innerHTML="<div style='width:4px;'></div>";ac.support.shrinkWrapBlocks=Z.offsetWidth!==2}Z.innerHTML="<table><tr><td style='padding:0;display:none'></td><td>t</td></tr></table>";var Y=Z.getElementsByTagName("td");ac.support.reliableHiddenOffsets=Y[0].offsetHeight===0;Y[0].style.display="";Y[1].style.display="none";ac.support.reliableHiddenOffsets=ac.support.reliableHiddenOffsets&&Y[0].offsetHeight===0;Z.innerHTML="";I.body.removeChild(Z).style.display="none"});X=function(Z){var Y=I.createElement("div");Z="on"+Z;var aa=Z in Y;if(!aa){Y.setAttribute(Z,"return;");aa=typeof Y[Z]==="function"}return aa};ac.support.submitBubbles=X("submit");ac.support.changeBubbles=X("change");X=V=U=S=P=null}})();var a3={},ad=/^(?:\{.*\}|\[.*\])$/;ac.extend({cache:{},uuid:0,expando:"jQuery"+ac.now(),noData:{embed:true,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:true},data:function(t,c,S){if(ac.acceptData(t)){t=t==ay?a3:t;var P=t.nodeType,E=P?t[ac.expando]:null,B=ac.cache;if(!(P&&!E&&typeof c==="string"&&S===aC)){if(P){E||(t[ac.expando]=E=++ac.uuid)}else{B=t}if(typeof c==="object"){if(P){B[E]=ac.extend(B[E],c)}else{ac.extend(B,c)}}else{if(P&&!B[E]){B[E]={}}}t=P?B[E]:B;if(S!==aC){t[c]=S}return typeof c==="string"?t[c]:t}}},removeData:function(B,c){if(ac.acceptData(B)){B=B==ay?a3:B;var T=B.nodeType,S=T?B[ac.expando]:B,P=ac.cache,E=T?P[S]:S;if(c){if(E){delete E[c];T&&ac.isEmptyObject(E)&&ac.removeData(B)}}else{if(T&&ac.support.deleteExpando){delete B[ac.expando]}else{if(B.removeAttribute){B.removeAttribute(ac.expando)}else{if(T){delete P[S]}else{for(var t in B){delete B[t]}}}}}}},acceptData:function(t){if(t.nodeName){var c=ac.noData[t.nodeName.toLowerCase()];if(c){return !(c===true||t.getAttribute("classid")!==c)}}return true}});ac.fn.extend({data:function(B,c){var U=null;if(typeof B==="undefined"){if(this.length){var T=this[0].attributes,S;U=ac.data(this[0]);for(var P=0,t=T.length;P<t;P++){S=T[P].name;if(S.indexOf("data-")===0){S=S.substr(5);j(this[0],S,U[S])}}}return U}else{if(typeof B==="object"){return this.each(function(){ac.data(this,B)})}}var E=B.split(".");E[1]=E[1]?"."+E[1]:"";if(c===aC){U=this.triggerHandler("getData"+E[1]+"!",[E[0]]);if(U===aC&&this.length){U=ac.data(this[0],B);U=j(this[0],B,U)}return U===aC&&E[1]?this.data(E[0]):U}else{return this.each(function(){var W=ac(this),V=[E[0],c];W.triggerHandler("setData"+E[1]+"!",V);ac.data(this,B,c);W.triggerHandler("changeData"+E[1]+"!",V)})}},removeData:function(c){return this.each(function(){ac.removeData(this,c)})}});ac.extend({queue:function(t,c,E){if(t){c=(c||"fx")+"queue";var B=ac.data(t,c);if(!E){return B||[]}if(!B||ac.isArray(E)){B=ac.data(t,c,ac.makeArray(E))}else{B.push(E)}return B}},dequeue:function(t,c){c=c||"fx";var E=ac.queue(t,c),B=E.shift();if(B==="inprogress"){B=E.shift()}if(B){c==="fx"&&E.unshift("inprogress");B.call(t,function(){ac.dequeue(t,c)})}}});ac.fn.extend({queue:function(t,c){if(typeof t!=="string"){c=t;t="fx"}if(c===aC){return ac.queue(this[0],t)}return this.each(function(){var B=ac.queue(this,t,c);t==="fx"&&B[0]!=="inprogress"&&ac.dequeue(this,t)})},dequeue:function(c){return this.each(function(){ac.dequeue(this,c)})},delay:function(t,c){t=ac.fx?ac.fx.speeds[t]||t:t;c=c||"fx";return this.queue(c,function(){var B=this;setTimeout(function(){ac.dequeue(B,c)},t)})},clearQueue:function(c){return this.queue(c||"fx",[])}});var aR=/[\n\t]/g,av=/\s+/,d=/\r/g,aU=/^(?:href|src|style)$/,aH=/^(?:button|input)$/i,ai=/^(?:button|input|object|select|textarea)$/i,H=/^a(?:rea)?$/i,aE=/^(?:radio|checkbox)$/i;ac.props={"for":"htmlFor","class":"className",readonly:"readOnly",maxlength:"maxLength",cellspacing:"cellSpacing",rowspan:"rowSpan",colspan:"colSpan",tabindex:"tabIndex",usemap:"useMap",frameborder:"frameBorder"};ac.fn.extend({attr:function(t,c){return ac.access(this,t,c,true,ac.attr)},removeAttr:function(c){return this.each(function(){ac.attr(this,c,"");this.nodeType===1&&this.removeAttribute(c)})},addClass:function(V){if(ac.isFunction(V)){return this.each(function(W){var X=ac(this);X.addClass(V.call(this,W,X.attr("class")))})}if(V&&typeof V==="string"){for(var U=(V||"").split(av),T=0,S=this.length;T<S;T++){var P=this[T];if(P.nodeType===1){if(P.className){for(var E=" "+P.className+" ",t=P.className,B=0,c=U.length;B<c;B++){if(E.indexOf(" "+U[B]+" ")<0){t+=" "+U[B]}}P.className=ac.trim(t)}else{P.className=V}}}}return this},removeClass:function(B){if(ac.isFunction(B)){return this.each(function(W){var V=ac(this);V.removeClass(B.call(this,W,V.attr("class")))})}if(B&&typeof B==="string"||B===aC){for(var c=(B||"").split(av),U=0,T=this.length;U<T;U++){var S=this[U];if(S.nodeType===1&&S.className){if(B){for(var P=(" "+S.className+" ").replace(aR," "),t=0,E=c.length;t<E;t++){P=P.replace(" "+c[t]+" "," ")}S.className=ac.trim(P)}else{S.className=""}}}}return this},toggleClass:function(t,c){var E=typeof t,B=typeof c==="boolean";if(ac.isFunction(t)){return this.each(function(S){var P=ac(this);P.toggleClass(t.call(this,S,P.attr("class"),c),c)})}return this.each(function(){if(E==="string"){for(var U,T=0,P=ac(this),S=c,V=t.split(av);U=V[T++];){S=B?S:!P.hasClass(U);P[S?"addClass":"removeClass"](U)}}else{if(E==="undefined"||E==="boolean"){this.className&&ac.data(this,"__className__",this.className);this.className=this.className||t===false?"":ac.data(this,"__className__")||""}}})},hasClass:function(t){t=" "+t+" ";for(var c=0,B=this.length;c<B;c++){if((" "+this[c].className+" ").replace(aR," ").indexOf(t)>-1){return true}}return false},val:function(B){if(!arguments.length){var c=this[0];if(c){if(ac.nodeName(c,"option")){var U=c.attributes.value;return !U||U.specified?c.value:c.text}if(ac.nodeName(c,"select")){var T=c.selectedIndex;U=[];var S=c.options;c=c.type==="select-one";if(T<0){return null}var P=c?T:0;for(T=c?T+1:S.length;P<T;P++){var t=S[P];if(t.selected&&(ac.support.optDisabled?!t.disabled:t.getAttribute("disabled")===null)&&(!t.parentNode.disabled||!ac.nodeName(t.parentNode,"optgroup"))){B=ac(t).val();if(c){return B}U.push(B)}}return U}if(aE.test(c.type)&&!ac.support.checkOn){return c.getAttribute("value")===null?"on":c.value}return(c.value||"").replace(d,"")}return aC}var E=ac.isFunction(B);return this.each(function(Y){var W=ac(this),X=B;if(this.nodeType===1){if(E){X=B.call(this,Y,W.val())}if(X==null){X=""}else{if(typeof X==="number"){X+=""}else{if(ac.isArray(X)){X=ac.map(X,function(Z){return Z==null?"":Z+""})}}}if(ac.isArray(X)&&aE.test(this.type)){this.checked=ac.inArray(W.val(),X)>=0}else{if(ac.nodeName(this,"select")){var V=ac.makeArray(X);ac("option",this).each(function(){this.selected=ac.inArray(ac(this).val(),V)>=0});if(!V.length){this.selectedIndex=-1}}else{this.value=X}}}})}});ac.extend({attrFn:{val:true,css:true,html:true,text:true,data:true,width:true,height:true,offset:true},attr:function(t,c,S,P){if(!t||t.nodeType===3||t.nodeType===8){return aC}if(P&&c in ac.attrFn){return ac(t)[c](S)}P=t.nodeType!==1||!ac.isXMLDoc(t);var E=S!==aC;c=P&&ac.props[c]||c;var B=aU.test(c);if((c in t||t[c]!==aC)&&P&&!B){if(E){c==="type"&&aH.test(t.nodeName)&&t.parentNode&&ac.error("type property can't be changed");if(S===null){t.nodeType===1&&t.removeAttribute(c)}else{t[c]=S}}if(ac.nodeName(t,"form")&&t.getAttributeNode(c)){return t.getAttributeNode(c).nodeValue}if(c==="tabIndex"){return(c=t.getAttributeNode("tabIndex"))&&c.specified?c.value:ai.test(t.nodeName)||H.test(t.nodeName)&&t.href?0:aC}return t[c]}if(!ac.support.style&&P&&c==="style"){if(E){t.style.cssText=""+S}return t.style.cssText}E&&t.setAttribute(c,""+S);if(!t.attributes[c]&&t.hasAttribute&&!t.hasAttribute(c)){return aC}t=!ac.support.hrefNormalized&&P&&B?t.getAttribute(c,2):t.getAttribute(c);return t===null?aC:t}});var ak=/\.(.*)$/,M=/^(?:textarea|input|select)$/i,o=/\./g,a4=/ /g,s=/[^\w\s.|`]/g,e=function(c){return c.replace(s,"\\$&")},af={focusin:0,focusout:0};ac.event={add:function(Z,X,W,V){if(!(Z.nodeType===3||Z.nodeType===8)){if(ac.isWindow(Z)&&Z!==ay&&!Z.frameElement){Z=ay}if(W===false){W=an}else{if(!W){return}}var U,T;if(W.handler){U=W;W=U.handler}if(!W.guid){W.guid=ac.guid++}if(T=ac.data(Z)){var P=Z.nodeType?"events":"__events__",S=T[P],E=T.handle;if(typeof S==="function"){E=S.handle;S=S.events}else{if(!S){Z.nodeType||(T[P]=T=function(){});T.events=S={}}}if(!E){T.handle=E=function(){return typeof ac!=="undefined"&&!ac.event.triggered?ac.event.handle.apply(E.elem,arguments):aC}}E.elem=Z;X=X.split(" ");for(var Y=0,c;P=X[Y++];){T=U?ac.extend({},U):{handler:W,data:V};if(P.indexOf(".")>-1){c=P.split(".");P=c.shift();T.namespace=c.slice(0).sort().join(".")}else{c=[];T.namespace=""}T.type=P;if(!T.guid){T.guid=W.guid}var B=S[P],t=ac.event.special[P]||{};if(!B){B=S[P]=[];if(!t.setup||t.setup.call(Z,V,c,E)===false){if(Z.addEventListener){Z.addEventListener(P,E,false)}else{Z.attachEvent&&Z.attachEvent("on"+P,E)}}}if(t.add){t.add.call(Z,T);if(!T.handler.guid){T.handler.guid=W.guid}}B.push(T);ac.event.global[P]=true}Z=null}}},global:{},remove:function(aa,X,W,V){if(!(aa.nodeType===3||aa.nodeType===8)){if(W===false){W=an}var U,T,P=0,S,E,Z,c,B,t,Y=aa.nodeType?"events":"__events__",a5=ac.data(aa),ab=a5&&a5[Y];if(a5&&ab){if(typeof ab==="function"){a5=ab;ab=ab.events}if(X&&X.type){W=X.handler;X=X.type}if(!X||typeof X==="string"&&X.charAt(0)==="."){X=X||"";for(U in ab){ac.event.remove(aa,U+X)}}else{for(X=X.split(" ");U=X[P++];){c=U;S=U.indexOf(".")<0;E=[];if(!S){E=U.split(".");U=E.shift();Z=RegExp("(^|\\.)"+ac.map(E.slice(0).sort(),e).join("\\.(?:.*\\.)?")+"(\\.|$)")}if(B=ab[U]){if(W){c=ac.event.special[U]||{};for(T=V||0;T<B.length;T++){t=B[T];if(W.guid===t.guid){if(S||Z.test(t.namespace)){V==null&&B.splice(T--,1);c.remove&&c.remove.call(aa,t)}if(V!=null){break}}}if(B.length===0||V!=null&&B.length===1){if(!c.teardown||c.teardown.call(aa,E)===false){ac.removeEvent(aa,U,a5.handle)}delete ab[U]}}else{for(T=0;T<B.length;T++){t=B[T];if(S||Z.test(t.namespace)){ac.event.remove(aa,c,t.handler,T);B.splice(T--,1)}}}}}if(ac.isEmptyObject(ab)){if(X=a5.handle){X.elem=null}delete a5.events;delete a5.handle;if(typeof a5==="function"){ac.removeData(aa,Y)}else{ac.isEmptyObject(a5)&&ac.removeData(aa)}}}}}},trigger:function(X,V,U,T){var S=X.type||X;if(!T){X=typeof X==="object"?X[ac.expando]?X:ac.extend(ac.Event(S),X):ac.Event(S);if(S.indexOf("!")>=0){X.type=S=S.slice(0,-1);X.exclusive=true}if(!U){X.stopPropagation();ac.event.global[S]&&ac.each(ac.cache,function(){this.events&&this.events[S]&&ac.event.trigger(X,V,this.handle.elem)})}if(!U||U.nodeType===3||U.nodeType===8){return aC}X.result=aC;X.target=U;V=ac.makeArray(V);V.unshift(X)}X.currentTarget=U;(T=U.nodeType?ac.data(U,"handle"):(ac.data(U,"__events__")||{}).handle)&&T.apply(U,V);T=U.parentNode||U.ownerDocument;try{if(!(U&&U.nodeName&&ac.noData[U.nodeName.toLowerCase()])){if(U["on"+S]&&U["on"+S].apply(U,V)===false){X.result=false;X.preventDefault()}}}catch(P){}if(!X.isPropagationStopped()&&T){ac.event.trigger(X,V,T,true)}else{if(!X.isDefaultPrevented()){var B;T=X.target;var E=S.replace(ak,""),t=ac.nodeName(T,"a")&&E==="click",W=ac.event.special[E]||{};if((!W._default||W._default.call(U,X)===false)&&!t&&!(T&&T.nodeName&&ac.noData[T.nodeName.toLowerCase()])){try{if(T[E]){if(B=T["on"+E]){T["on"+E]=null}ac.event.triggered=true;T[E]()}}catch(c){}if(B){T["on"+E]=B}ac.event.triggered=false}}}},handle:function(B){var c,U,T,S;U=[];var P=ac.makeArray(arguments);B=P[0]=ac.event.fix(B||ay.event);B.currentTarget=this;c=B.type.indexOf(".")<0&&!B.exclusive;if(!c){T=B.type.split(".");B.type=T.shift();U=T.slice(0).sort();T=RegExp("(^|\\.)"+U.join("\\.(?:.*\\.)?")+"(\\.|$)")}B.namespace=B.namespace||U.join(".");S=ac.data(this,this.nodeType?"events":"__events__");if(typeof S==="function"){S=S.events}U=(S||{})[B.type];if(S&&U){U=U.slice(0);S=0;for(var t=U.length;S<t;S++){var E=U[S];if(c||T.test(E.namespace)){B.handler=E.handler;B.data=E.data;B.handleObj=E;E=E.handler.apply(this,P);if(E!==aC){B.result=E;if(E===false){B.preventDefault();B.stopPropagation()}}if(B.isImmediatePropagationStopped()){break}}}}return B.result},props:"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode layerX layerY metaKey newValue offsetX offsetY pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" "),fix:function(t){if(t[ac.expando]){return t}var c=t;t=ac.Event(c);for(var E=this.props.length,B;E;){B=this.props[--E];t[B]=c[B]}if(!t.target){t.target=t.srcElement||I}if(t.target.nodeType===3){t.target=t.target.parentNode}if(!t.relatedTarget&&t.fromElement){t.relatedTarget=t.fromElement===t.target?t.toElement:t.fromElement}if(t.pageX==null&&t.clientX!=null){c=I.documentElement;E=I.body;t.pageX=t.clientX+(c&&c.scrollLeft||E&&E.scrollLeft||0)-(c&&c.clientLeft||E&&E.clientLeft||0);t.pageY=t.clientY+(c&&c.scrollTop||E&&E.scrollTop||0)-(c&&c.clientTop||E&&E.clientTop||0)}if(t.which==null&&(t.charCode!=null||t.keyCode!=null)){t.which=t.charCode!=null?t.charCode:t.keyCode}if(!t.metaKey&&t.ctrlKey){t.metaKey=t.ctrlKey}if(!t.which&&t.button!==aC){t.which=t.button&1?1:t.button&2?3:t.button&4?2:0}return t},guid:100000000,proxy:ac.proxy,special:{ready:{setup:ac.bindReady,teardown:ac.noop},live:{add:function(c){ac.event.add(this,aj(c.origType,c.selector),ac.extend({},c,{handler:C,guid:c.handler.guid}))},remove:function(c){ac.event.remove(this,aj(c.origType,c.selector),c)}},beforeunload:{setup:function(t,c,B){if(ac.isWindow(this)){this.onbeforeunload=B}},teardown:function(t,c){if(this.onbeforeunload===c){this.onbeforeunload=null}}}}};ac.removeEvent=I.removeEventListener?function(t,c,B){t.removeEventListener&&t.removeEventListener(c,B,false)}:function(t,c,B){t.detachEvent&&t.detachEvent("on"+c,B)};ac.Event=function(c){if(!this.preventDefault){return new ac.Event(c)}if(c&&c.type){this.originalEvent=c;this.type=c.type}else{this.type=c}this.timeStamp=ac.now();this[ac.expando]=true};ac.Event.prototype={preventDefault:function(){this.isDefaultPrevented=K;var c=this.originalEvent;if(c){if(c.preventDefault){c.preventDefault()}else{c.returnValue=false}}},stopPropagation:function(){this.isPropagationStopped=K;var c=this.originalEvent;if(c){c.stopPropagation&&c.stopPropagation();c.cancelBubble=true}},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=K;this.stopPropagation()},isDefaultPrevented:an,isPropagationStopped:an,isImmediatePropagationStopped:an};var F=function(t){var c=t.relatedTarget;try{for(;c&&c!==this;){c=c.parentNode}if(c!==this){t.type=t.data;ac.event.handle.apply(this,arguments)}}catch(B){}},q=function(c){c.type=c.data;ac.event.handle.apply(this,arguments)};ac.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(t,c){ac.event.special[t]={setup:function(B){ac.event.add(this,c,B&&B.selector?q:F,t)},teardown:function(B){ac.event.remove(this,c,B&&B.selector?q:F)}}});if(!ac.support.submitBubbles){ac.event.special.submit={setup:function(){if(this.nodeName.toLowerCase()!=="form"){ac.event.add(this,"click.specialSubmit",function(t){var c=t.target,B=c.type;if((B==="submit"||B==="image")&&ac(c).closest("form").length){t.liveFired=aC;return a0("submit",this,arguments)}});ac.event.add(this,"keypress.specialSubmit",function(t){var c=t.target,B=c.type;if((B==="text"||B==="password")&&ac(c).closest("form").length&&t.keyCode===13){t.liveFired=aC;return a0("submit",this,arguments)}})}else{return false}},teardown:function(){ac.event.remove(this,".specialSubmit")}}}if(!ac.support.changeBubbles){var am,b=function(t){var c=t.type,B=t.value;if(c==="radio"||c==="checkbox"){B=t.checked}else{if(c==="select-multiple"){B=t.selectedIndex>-1?ac.map(t.options,function(E){return E.selected}).join("-"):""}else{if(t.nodeName.toLowerCase()==="select"){B=t.selectedIndex}}}return B},ah=function(t,c){var P=t.target,E,B;if(!(!M.test(P.nodeName)||P.readOnly)){E=ac.data(P,"_change_data");B=b(P);if(t.type!=="focusout"||P.type!=="radio"){ac.data(P,"_change_data",B)}if(!(E===aC||B===E)){if(E!=null||B){t.type="change";t.liveFired=aC;return ac.event.trigger(t,c,P)}}}};ac.event.special.change={filters:{focusout:ah,beforedeactivate:ah,click:function(t){var c=t.target,B=c.type;if(B==="radio"||B==="checkbox"||c.nodeName.toLowerCase()==="select"){return ah.call(this,t)}},keydown:function(t){var c=t.target,B=c.type;if(t.keyCode===13&&c.nodeName.toLowerCase()!=="textarea"||t.keyCode===32&&(B==="checkbox"||B==="radio")||B==="select-multiple"){return ah.call(this,t)}},beforeactivate:function(c){c=c.target;ac.data(c,"_change_data",b(c))}},setup:function(){if(this.type==="file"){return false}for(var c in am){ac.event.add(this,c+".specialChange",am[c])}return M.test(this.nodeName)},teardown:function(){ac.event.remove(this,".specialChange");return M.test(this.nodeName)}};am=ac.event.special.change.filters;am.focus=am.beforeactivate}I.addEventListener&&ac.each({focus:"focusin",blur:"focusout"},function(t,c){function B(E){E=ac.event.fix(E);E.type=c;return ac.event.trigger(E,null,E.target)}ac.event.special[c]={setup:function(){af[c]++===0&&I.addEventListener(t,B,true)},teardown:function(){--af[c]===0&&I.removeEventListener(t,B,true)}}});ac.each(["bind","one"],function(t,c){ac.fn[c]=function(U,T,S){if(typeof U==="object"){for(var P in U){this[c](P,T,U[P],S)}return this}if(ac.isFunction(T)||T===false){S=T;T=aC}var B=c==="one"?ac.proxy(S,function(V){ac(this).unbind(V,B);return S.apply(this,arguments)}):S;if(U==="unload"&&c!=="one"){this.one(U,T,S)}else{P=0;for(var E=this.length;P<E;P++){ac.event.add(this[P],U,B,T)}}return this}});ac.fn.extend({unbind:function(t,c){if(typeof t==="object"&&!t.preventDefault){for(var E in t){this.unbind(E,t[E])}}else{E=0;for(var B=this.length;E<B;E++){ac.event.remove(this[E],t,c)}}return this},delegate:function(t,c,E,B){return this.live(c,E,B,t)},undelegate:function(t,c,B){return arguments.length===0?this.unbind("live"):this.die(c,null,B,t)},trigger:function(t,c){return this.each(function(){ac.event.trigger(t,c,this)})},triggerHandler:function(t,c){if(this[0]){var B=ac.Event(t);B.preventDefault();B.stopPropagation();ac.event.trigger(B,c,this[0]);return B.result}},toggle:function(t){for(var c=arguments,B=1;B<c.length;){ac.proxy(t,c[B++])}return this.click(ac.proxy(t,function(P){var E=(ac.data(this,"lastToggle"+t.guid)||0)%B;ac.data(this,"lastToggle"+t.guid,E+1);P.preventDefault();return c[E].apply(this,arguments)||false}))},hover:function(t,c){return this.mouseenter(t).mouseleave(c||t)}});var aT={focus:"focusin",blur:"focusout",mouseenter:"mouseover",mouseleave:"mouseout"};ac.each(["live","die"],function(t,c){ac.fn[c]=function(X,W,V,U){var S,T=0,P,Y,B=U||this.selector;U=U?this:ac(this.context);if(typeof X==="object"&&!X.preventDefault){for(S in X){U[c](S,W,X[S],B)}return this}if(ac.isFunction(W)){V=W;W=aC}for(X=(X||"").split(" ");(S=X[T++])!=null;){P=ak.exec(S);Y="";if(P){Y=P[0];S=S.replace(ak,"")}if(S==="hover"){X.push("mouseenter"+Y,"mouseleave"+Y)}else{P=S;if(S==="focus"||S==="blur"){X.push(aT[S]+Y);S+=Y}else{S=(aT[S]||S)+Y}if(c==="live"){Y=0;for(var E=U.length;Y<E;Y++){ac.event.add(U[Y],"live."+aj(S,B),{data:W,selector:B,handler:V,origType:S,origHandler:V,preType:P})}}else{U.unbind("live."+aj(S,B),V)}}}return this}});ac.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error".split(" "),function(t,c){ac.fn[c]=function(E,B){if(B==null){B=E;E=null}return arguments.length>0?this.bind(c,E,B):this.trigger(c)};if(ac.attrFn){ac.attrFn[c]=true}});ay.attachEvent&&!ay.addEventListener&&ac(ay).bind("unload",function(){for(var t in ac.cache){if(ac.cache[t].handle){try{ac.event.remove(ac.cache[t].handle.elem)}catch(c){}}}});(function(){function ab(bc,bb,a9,ba,a8,a7){a8=0;for(var be=ba.length;a8<be;a8++){var bd=ba[a8];if(bd){var bf=false;for(bd=bd[bc];bd;){if(bd.sizcache===a9){bf=ba[bd.sizset];break}if(bd.nodeType===1&&!a7){bd.sizcache=a9;bd.sizset=a8}if(bd.nodeName.toLowerCase()===bb){bf=bd;break}bd=bd[bc]}ba[a8]=bf}}}function Y(bc,bb,a9,ba,a8,a7){a8=0;for(var be=ba.length;a8<be;a8++){var bd=ba[a8];if(bd){var bf=false;for(bd=bd[bc];bd;){if(bd.sizcache===a9){bf=ba[bd.sizset];break}if(bd.nodeType===1){if(!a7){bd.sizcache=a9;bd.sizset=a8}if(typeof bb!=="string"){if(bd===bb){bf=true;break}}else{if(S.filter(bb,[bd]).length>0){bf=bd;break}}}bd=bd[bc]}ba[a8]=bf}}}var W=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,V=0,U=Object.prototype.toString,T=false,P=true;[0,0].sort(function(){P=false;return 0});var S=function(be,bd,ba,bb){ba=ba||[];var a9=bd=bd||I;if(bd.nodeType!==1&&bd.nodeType!==9){return[]}if(!be||typeof be!=="string"){return ba}var a8,bj,bi,bk,bh,bg=true,bf=S.isXML(bd),a7=[],bc=be;do{W.exec("");if(a8=W.exec(bc)){bc=a8[3];a7.push(a8[1]);if(a8[2]){bk=a8[3];break}}}while(a8);if(a7.length>1&&aa.exec(be)){if(a7.length===2&&E.relative[a7[0]]){bj=X(a7[0]+a7[1],bd)}else{for(bj=E.relative[a7[0]]?[bd]:S(a7.shift(),bd);a7.length;){be=a7.shift();if(E.relative[be]){be+=a7.shift()}bj=X(be,bj)}}}else{if(!bb&&a7.length>1&&bd.nodeType===9&&!bf&&E.match.ID.test(a7[0])&&!E.match.ID.test(a7[a7.length-1])){a8=S.find(a7.shift(),bd,bf);bd=a8.expr?S.filter(a8.expr,a8.set)[0]:a8.set[0]}if(bd){a8=bb?{expr:a7.pop(),set:t(bb)}:S.find(a7.pop(),a7.length===1&&(a7[0]==="~"||a7[0]==="+")&&bd.parentNode?bd.parentNode:bd,bf);bj=a8.expr?S.filter(a8.expr,a8.set):a8.set;if(a7.length>0){bi=t(bj)}else{bg=false}for(;a7.length;){a8=bh=a7.pop();if(E.relative[bh]){a8=a7.pop()}else{bh=""}if(a8==null){a8=bd}E.relative[bh](bi,a8,bf)}}else{bi=[]}}bi||(bi=bj);bi||S.error(bh||be);if(U.call(bi)==="[object Array]"){if(bg){if(bd&&bd.nodeType===1){for(be=0;bi[be]!=null;be++){if(bi[be]&&(bi[be]===true||bi[be].nodeType===1&&S.contains(bd,bi[be]))){ba.push(bj[be])}}}else{for(be=0;bi[be]!=null;be++){bi[be]&&bi[be].nodeType===1&&ba.push(bj[be])}}}else{ba.push.apply(ba,bi)}}else{t(bi,ba)}if(bk){S(bk,a9,ba,bb);S.uniqueSort(ba)}return ba};S.uniqueSort=function(a8){if(a6){T=P;a8.sort(a6);if(T){for(var a7=1;a7<a8.length;a7++){a8[a7]===a8[a7-1]&&a8.splice(a7--,1)}}}return a8};S.matches=function(a8,a7){return S(a8,null,null,a7)};S.matchesSelector=function(a8,a7){return S(a7,null,null,[a8]).length>0};S.find=function(bc,bb,a9){var ba;if(!bc){return[]}for(var a8=0,a7=E.order.length;a8<a7;a8++){var be,bd=E.order[a8];if(be=E.leftMatch[bd].exec(bc)){var bf=be[1];be.splice(1,1);if(bf.substr(bf.length-1)!=="\\"){be[1]=(be[1]||"").replace(/\\/g,"");ba=E.find[bd](be,bb,a9);if(ba!=null){bc=bc.replace(E.match[bd],"");break}}}}ba||(ba=bb.getElementsByTagName("*"));return{set:ba,expr:bc}};S.filter=function(bf,be,ba,bb){for(var a9,a8,bk=bf,bj=[],bl=be,bi=be&&be[0]&&S.isXML(be[0]);bf&&be.length;){for(var bh in E.filter){if((a9=E.leftMatch[bh].exec(bf))!=null&&a9[2]){var bg,a7,bd=E.filter[bh];a7=a9[1];a8=false;a9.splice(1,1);if(a7.substr(a7.length-1)!=="\\"){if(bl===bj){bj=[]}if(E.preFilter[bh]){if(a9=E.preFilter[bh](a9,bl,ba,bj,bb,bi)){if(a9===true){continue}}else{a8=bg=true}}if(a9){for(var bc=0;(a7=bl[bc])!=null;bc++){if(a7){bg=bd(a7,a9,bc,bl);var bm=bb^!!bg;if(ba&&bg!=null){if(bm){a8=true}else{bl[bc]=false}}else{if(bm){bj.push(a7);a8=true}}}}}if(bg!==aC){ba||(bl=bj);bf=bf.replace(E.match[bh],"");if(!a8){return[]}break}}}}if(bf===bk){if(a8==null){S.error(bf)}else{break}}bk=bf}return bl};S.error=function(a7){throw"Syntax error, unrecognized expression: "+a7};var E=S.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+\-]*)\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(a7){return a7.getAttribute("href")}},relative:{"+":function(a9,a8){var bc=typeof a8==="string",a7=bc&&!/\W/.test(a8);bc=bc&&!a7;if(a7){a8=a8.toLowerCase()}a7=0;for(var bb=a9.length,ba;a7<bb;a7++){if(ba=a9[a7]){for(;(ba=ba.previousSibling)&&ba.nodeType!==1;){}a9[a7]=bc||ba&&ba.nodeName.toLowerCase()===a8?ba||false:ba===a8}}bc&&S.filter(a8,a9,true)},">":function(a9,a8){var bc,a7=typeof a8==="string",bb=0,ba=a9.length;if(a7&&!/\W/.test(a8)){for(a8=a8.toLowerCase();bb<ba;bb++){if(bc=a9[bb]){bc=bc.parentNode;a9[bb]=bc.nodeName.toLowerCase()===a8?bc:false}}}else{for(;bb<ba;bb++){if(bc=a9[bb]){a9[bb]=a7?bc.parentNode:bc.parentNode===a8}}a7&&S.filter(a8,a9,true)}},"":function(a9,a8,bc){var a7,bb=V++,ba=Y;if(typeof a8==="string"&&!/\W/.test(a8)){a7=a8=a8.toLowerCase();ba=ab}ba("parentNode",a8,bb,a9,a7,bc)},"~":function(a9,a8,bc){var a7,bb=V++,ba=Y;if(typeof a8==="string"&&!/\W/.test(a8)){a7=a8=a8.toLowerCase();ba=ab}ba("previousSibling",a8,bb,a9,a7,bc)}},find:{ID:function(a8,a7,a9){if(typeof a7.getElementById!=="undefined"&&!a9){return(a8=a7.getElementById(a8[1]))&&a8.parentNode?[a8]:[]}},NAME:function(a9,a8){if(typeof a8.getElementsByName!=="undefined"){for(var bc=[],a7=a8.getElementsByName(a9[1]),bb=0,ba=a7.length;bb<ba;bb++){a7[bb].getAttribute("name")===a9[1]&&bc.push(a7[bb])}return bc.length===0?null:bc}},TAG:function(a8,a7){return a7.getElementsByTagName(a8[1])}},preFilter:{CLASS:function(ba,a9,bd,a7,bc,bb){ba=" "+ba[1].replace(/\\/g,"")+" ";if(bb){return ba}bb=0;for(var a8;(a8=a9[bb])!=null;bb++){if(a8){if(bc^(a8.className&&(" "+a8.className+" ").replace(/[\t\n]/g," ").indexOf(ba)>=0)){bd||a7.push(a8)}else{if(bd){a9[bb]=false}}}}return false},ID:function(a7){return a7[1].replace(/\\/g,"")},TAG:function(a7){return a7[1].toLowerCase()},CHILD:function(a8){if(a8[1]==="nth"){var a7=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(a8[2]==="even"&&"2n"||a8[2]==="odd"&&"2n+1"||!/\D/.test(a8[2])&&"0n+"+a8[2]||a8[2]);a8[2]=a7[1]+(a7[2]||1)-0;a8[3]=a7[3]-0}a8[0]=V++;return a8},ATTR:function(a9,a8,bc,a7,bb,ba){a8=a9[1].replace(/\\/g,"");if(!ba&&E.attrMap[a8]){a9[1]=E.attrMap[a8]}if(a9[2]==="~="){a9[4]=" "+a9[4]+" "}return a9},PSEUDO:function(a9,a8,bb,a7,ba){if(a9[1]==="not"){if((W.exec(a9[3])||"").length>1||/^\w/.test(a9[3])){a9[3]=S(a9[3],null,null,a8)}else{a9=S.filter(a9[3],a8,bb,true^ba);bb||a7.push.apply(a7,a9);return false}}else{if(E.match.POS.test(a9[0])||E.match.CHILD.test(a9[0])){return true}}return a9},POS:function(a7){a7.unshift(true);return a7}},filters:{enabled:function(a7){return a7.disabled===false&&a7.type!=="hidden"},disabled:function(a7){return a7.disabled===true},checked:function(a7){return a7.checked===true},selected:function(a7){return a7.selected===true},parent:function(a7){return !!a7.firstChild},empty:function(a7){return !a7.firstChild},has:function(a8,a7,a9){return !!S(a9[3],a8).length},header:function(a7){return/h\d/i.test(a7.nodeName)},text:function(a7){return"text"===a7.type},radio:function(a7){return"radio"===a7.type},checkbox:function(a7){return"checkbox"===a7.type},file:function(a7){return"file"===a7.type},password:function(a7){return"password"===a7.type},submit:function(a7){return"submit"===a7.type},image:function(a7){return"image"===a7.type},reset:function(a7){return"reset"===a7.type},button:function(a7){return"button"===a7.type||a7.nodeName.toLowerCase()==="button"},input:function(a7){return/input|select|textarea|button/i.test(a7.nodeName)}},setFilters:{first:function(a8,a7){return a7===0},last:function(a9,a8,ba,a7){return a8===a7.length-1},even:function(a8,a7){return a7%2===0},odd:function(a8,a7){return a7%2===1},lt:function(a8,a7,a9){return a7<a9[3]-0},gt:function(a8,a7,a9){return a7>a9[3]-0},nth:function(a8,a7,a9){return a9[3]-0===a7},eq:function(a8,a7,a9){return a9[3]-0===a7}},filter:{PSEUDO:function(a9,a8,bc,a7){var bb=a8[1],ba=E.filters[bb];if(ba){return ba(a9,bc,a8,a7)}else{if(bb==="contains"){return(a9.textContent||a9.innerText||S.getText([a9])||"").indexOf(a8[3])>=0}else{if(bb==="not"){a8=a8[3];bc=0;for(a7=a8.length;bc<a7;bc++){if(a8[bc]===a9){return false}}return true}else{S.error("Syntax error, unrecognized expression: "+bb)}}}},CHILD:function(ba,a9){var be=a9[1],a7=ba;switch(be){case"only":case"first":for(;a7=a7.previousSibling;){if(a7.nodeType===1){return false}}if(be==="first"){return true}a7=ba;case"last":for(;a7=a7.nextSibling;){if(a7.nodeType===1){return false}}return true;case"nth":be=a9[2];var bc=a9[3];if(be===1&&bc===0){return true}var bb=a9[0],a8=ba.parentNode;if(a8&&(a8.sizcache!==bb||!ba.nodeIndex)){var bd=0;for(a7=a8.firstChild;a7;a7=a7.nextSibling){if(a7.nodeType===1){a7.nodeIndex=++bd}}a8.sizcache=bb}a7=ba.nodeIndex-bc;return be===0?a7===0:a7%be===0&&a7/be>=0}},ID:function(a8,a7){return a8.nodeType===1&&a8.getAttribute("id")===a7},TAG:function(a8,a7){return a7==="*"&&a8.nodeType===1||a8.nodeName.toLowerCase()===a7},CLASS:function(a8,a7){return(" "+(a8.className||a8.getAttribute("class"))+" ").indexOf(a7)>-1},ATTR:function(a9,a8){var bc=a8[1];bc=E.attrHandle[bc]?E.attrHandle[bc](a9):a9[bc]!=null?a9[bc]:a9.getAttribute(bc);var a7=bc+"",bb=a8[2],ba=a8[4];return bc==null?bb==="!=":bb==="="?a7===ba:bb==="*="?a7.indexOf(ba)>=0:bb==="~="?(" "+a7+" ").indexOf(ba)>=0:!ba?a7&&bc!==false:bb==="!="?a7!==ba:bb==="^="?a7.indexOf(ba)===0:bb==="$="?a7.substr(a7.length-ba.length)===ba:bb==="|="?a7===ba||a7.substr(0,ba.length+1)===ba+"-":false},POS:function(a9,a8,bb,a7){var ba=E.setFilters[a8[2]];if(ba){return ba(a9,bb,a8,a7)}}}},aa=E.match.POS,c=function(a8,a7){return"\\"+(a7-0+1)},B;for(B in E.match){E.match[B]=RegExp(E.match[B].source+/(?![^\[]*\])(?![^\(]*\))/.source);E.leftMatch[B]=RegExp(/(^(?:.|\r|\n)*?)/.source+E.match[B].source.replace(/\\(\d+)/g,c))}var t=function(a8,a7){a8=Array.prototype.slice.call(a8,0);if(a7){a7.push.apply(a7,a8);return a7}return a8};try{Array.prototype.slice.call(I.documentElement.childNodes,0)}catch(Z){t=function(a9,a8){var bb=0,a7=a8||[];if(U.call(a9)==="[object Array]"){Array.prototype.push.apply(a7,a9)}else{if(typeof a9.length==="number"){for(var ba=a9.length;bb<ba;bb++){a7.push(a9[bb])}}else{for(;a9[bb];bb++){a7.push(a9[bb])}}}return a7}}var a6,a5;if(I.documentElement.compareDocumentPosition){a6=function(a8,a7){if(a8===a7){T=true;return 0}if(!a8.compareDocumentPosition||!a7.compareDocumentPosition){return a8.compareDocumentPosition?-1:1}return a8.compareDocumentPosition(a7)&4?-1:1}}else{a6=function(ba,a9){var bd,a7,bc=[],bb=[];bd=ba.parentNode;a7=a9.parentNode;var a8=bd;if(ba===a9){T=true;return 0}else{if(bd===a7){return a5(ba,a9)}else{if(bd){if(!a7){return 1}}else{return -1}}}for(;a8;){bc.unshift(a8);a8=a8.parentNode}for(a8=a7;a8;){bb.unshift(a8);a8=a8.parentNode}bd=bc.length;a7=bb.length;for(a8=0;a8<bd&&a8<a7;a8++){if(bc[a8]!==bb[a8]){return a5(bc[a8],bb[a8])}}return a8===bd?a5(ba,bb[a8],-1):a5(bc[a8],a9,1)};a5=function(a8,a7,a9){if(a8===a7){return a9}for(a8=a8.nextSibling;a8;){if(a8===a7){return -1}a8=a8.nextSibling}return 1}}S.getText=function(a9){for(var a8="",ba,a7=0;a9[a7];a7++){ba=a9[a7];if(ba.nodeType===3||ba.nodeType===4){a8+=ba.nodeValue}else{if(ba.nodeType!==8){a8+=S.getText(ba.childNodes)}}}return a8};(function(){var a8=I.createElement("div"),a7="script"+(new Date).getTime(),a9=I.documentElement;a8.innerHTML="<a name='"+a7+"'/>";a9.insertBefore(a8,a9.firstChild);if(I.getElementById(a7)){E.find.ID=function(ba,bc,bb){if(typeof bc.getElementById!=="undefined"&&!bb){return(bc=bc.getElementById(ba[1]))?bc.id===ba[1]||typeof bc.getAttributeNode!=="undefined"&&bc.getAttributeNode("id").nodeValue===ba[1]?[bc]:aC:[]}};E.filter.ID=function(ba,bc){var bb=typeof ba.getAttributeNode!=="undefined"&&ba.getAttributeNode("id");return ba.nodeType===1&&bb&&bb.nodeValue===bc}}a9.removeChild(a8);a9=a8=null})();(function(){var a7=I.createElement("div");a7.appendChild(I.createComment(""));if(a7.getElementsByTagName("*").length>0){E.find.TAG=function(a9,bc){var a8=bc.getElementsByTagName(a9[1]);if(a9[1]==="*"){for(var bb=[],ba=0;a8[ba];ba++){a8[ba].nodeType===1&&bb.push(a8[ba])}a8=bb}return a8}}a7.innerHTML="<a href='#'></a>";if(a7.firstChild&&typeof a7.firstChild.getAttribute!=="undefined"&&a7.firstChild.getAttribute("href")!=="#"){E.attrHandle.href=function(a8){return a8.getAttribute("href",2)}}a7=null})();I.querySelectorAll&&function(){var a8=S,a7=I.createElement("div");a7.innerHTML="<p class='TEST'></p>";if(!(a7.querySelectorAll&&a7.querySelectorAll(".TEST").length===0)){S=function(ba,be,bd,bb){be=be||I;ba=ba.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!bb&&!S.isXML(be)){if(be.nodeType===9){try{return t(be.querySelectorAll(ba),bd)}catch(bh){}}else{if(be.nodeType===1&&be.nodeName.toLowerCase()!=="object"){var bc=be.getAttribute("id"),bg=bc||"__sizzle__";bc||be.setAttribute("id",bg);try{return t(be.querySelectorAll("#"+bg+" "+ba),bd)}catch(bf){}finally{bc||be.removeAttribute("id")}}}}return a8(ba,be,bd,bb)};for(var a9 in a8){S[a9]=a8[a9]}a7=null}}();(function(){var a9=I.documentElement,a8=a9.matchesSelector||a9.mozMatchesSelector||a9.webkitMatchesSelector||a9.msMatchesSelector,ba=false;try{a8.call(I.documentElement,"[test!='']:sizzle")}catch(a7){ba=true}if(a8){S.matchesSelector=function(bd,bc){bc=bc.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!S.isXML(bd)){try{if(ba||!E.match.PSEUDO.test(bc)&&!/!=/.test(bc)){return a8.call(bd,bc)}}catch(bb){}}return S(bc,null,null,[bd]).length>0}}})();(function(){var a7=I.createElement("div");a7.innerHTML="<div class='test e'></div><div class='test'></div>";if(!(!a7.getElementsByClassName||a7.getElementsByClassName("e").length===0)){a7.lastChild.className="e";if(a7.getElementsByClassName("e").length!==1){E.order.splice(1,0,"CLASS");E.find.CLASS=function(a9,ba,a8){if(typeof ba.getElementsByClassName!=="undefined"&&!a8){return ba.getElementsByClassName(a9[1])}};a7=null}}})();S.contains=I.documentElement.contains?function(a8,a7){return a8!==a7&&(a8.contains?a8.contains(a7):true)}:I.documentElement.compareDocumentPosition?function(a8,a7){return !!(a8.compareDocumentPosition(a7)&16)}:function(){return false};S.isXML=function(a7){return(a7=(a7?a7.ownerDocument||a7:0).documentElement)?a7.nodeName!=="HTML":false};var X=function(ba,a9){for(var bd,a7=[],bc="",bb=a9.nodeType?[a9]:a9;bd=E.match.PSEUDO.exec(ba);){bc+=bd[0];ba=ba.replace(E.match.PSEUDO,"")}ba=E.relative[ba]?ba+"*":ba;bd=0;for(var a8=bb.length;bd<a8;bd++){S(ba,bb[bd],a7)}return S.filter(bc,a7)};ac.find=S;ac.expr=S.selectors;ac.expr[":"]=ac.expr.filters;ac.unique=S.uniqueSort;ac.text=S.getText;ac.isXMLDoc=S.isXML;ac.contains=S.contains})();var aV=/Until$/,aB=/^(?:parents|prevUntil|prevAll)/,aI=/,/,aS=/^.[^:#\[\.,]*$/,aq=Array.prototype.slice,J=ac.expr.match.POS;ac.fn.extend({find:function(B){for(var c=this.pushStack("","find",B),T=0,S=0,P=this.length;S<P;S++){T=c.length;ac.find(B,this[S],c);if(S>0){for(var E=T;E<c.length;E++){for(var t=0;t<T;t++){if(c[t]===c[E]){c.splice(E--,1);break}}}}}return c},has:function(t){var c=ac(t);return this.filter(function(){for(var E=0,B=c.length;E<B;E++){if(ac.contains(this,c[E])){return true}}})},not:function(c){return this.pushStack(aN(this,c,false),"not",c)},filter:function(c){return this.pushStack(aN(this,c,true),"filter",c)},is:function(c){return !!c&&ac.filter(c,this).length>0},closest:function(V,U){var T=[],S,P,E=this[0];if(ac.isArray(V)){var t,B={},c=1;if(E&&V.length){S=0;for(P=V.length;S<P;S++){t=V[S];B[t]||(B[t]=ac.expr.match.POS.test(t)?ac(t,U||this.context):t)}for(;E&&E.ownerDocument&&E!==U;){for(t in B){S=B[t];if(S.jquery?S.index(E)>-1:ac(E).is(S)){T.push({selector:t,elem:E,level:c})}}E=E.parentNode;c++}}return T}t=J.test(V)?ac(V,U||this.context):null;S=0;for(P=this.length;S<P;S++){for(E=this[S];E;){if(t?t.index(E)>-1:ac.find.matchesSelector(E,V)){T.push(E);break}else{E=E.parentNode;if(!E||!E.ownerDocument||E===U){break}}}}T=T.length>1?ac.unique(T):T;return this.pushStack(T,"closest",V)},index:function(c){if(!c||typeof c==="string"){return ac.inArray(this[0],c?ac(c):this.parent().children())}return ac.inArray(c.jquery?c[0]:c,this)},add:function(t,c){var E=typeof t==="string"?ac(t,c||this.context):ac.makeArray(t),B=ac.merge(this.get(),E);return this.pushStack(!E[0]||!E[0].parentNode||E[0].parentNode.nodeType===11||!B[0]||!B[0].parentNode||B[0].parentNode.nodeType===11?B:ac.unique(B))},andSelf:function(){return this.add(this.prevObject)}});ac.each({parent:function(c){return(c=c.parentNode)&&c.nodeType!==11?c:null},parents:function(c){return ac.dir(c,"parentNode")},parentsUntil:function(t,c,B){return ac.dir(t,"parentNode",B)},next:function(c){return ac.nth(c,2,"nextSibling")},prev:function(c){return ac.nth(c,2,"previousSibling")},nextAll:function(c){return ac.dir(c,"nextSibling")},prevAll:function(c){return ac.dir(c,"previousSibling")},nextUntil:function(t,c,B){return ac.dir(t,"nextSibling",B)},prevUntil:function(t,c,B){return ac.dir(t,"previousSibling",B)},siblings:function(c){return ac.sibling(c.parentNode.firstChild,c)},children:function(c){return ac.sibling(c.firstChild)},contents:function(c){return ac.nodeName(c,"iframe")?c.contentDocument||c.contentWindow.document:ac.makeArray(c.childNodes)}},function(t,c){ac.fn[t]=function(P,E){var B=ac.map(this,c,P);aV.test(t)||(E=P);if(E&&typeof E==="string"){B=ac.filter(E,B)}B=this.length>1?ac.unique(B):B;if((this.length>1||aI.test(E))&&aB.test(t)){B=B.reverse()}return this.pushStack(B,t,aq.call(arguments).join(","))}});ac.extend({filter:function(t,c,B){if(B){t=":not("+t+")"}return c.length===1?ac.find.matchesSelector(c[0],t)?[c[0]]:[]:ac.find.matches(t,c)},dir:function(t,c,E){var B=[];for(t=t[c];t&&t.nodeType!==9&&(E===aC||t.nodeType!==1||!ac(t).is(E));){t.nodeType===1&&B.push(t);t=t[c]}return B},nth:function(t,c,E){c=c||1;for(var B=0;t;t=t[E]){if(t.nodeType===1&&++B===c){break}}return t},sibling:function(t,c){for(var B=[];t;t=t.nextSibling){t.nodeType===1&&t!==c&&B.push(t)}return B}});var aG=/ jQuery\d+="(?:\d+|null)"/g,aP=/^\s+/,aY=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,aL=/<([\w:]+)/,u=/<tbody/i,f=/<|&#?\w+;/,aw=/<(?:script|object|embed|option|style)/i,O=/checked\s*(?:[^=]|=\s*.checked.)/i,aW=/\=([^="'>\s]+\/)>/g,ar={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]};ar.optgroup=ar.option;ar.tbody=ar.tfoot=ar.colgroup=ar.caption=ar.thead;ar.th=ar.td;if(!ac.support.htmlSerialize){ar._default=[1,"div<div>","</div>"]}ac.fn.extend({text:function(c){if(ac.isFunction(c)){return this.each(function(t){var B=ac(this);B.text(c.call(this,t,B.text()))})}if(typeof c!=="object"&&c!==aC){return this.empty().append((this[0]&&this[0].ownerDocument||I).createTextNode(c))}return ac.text(this)},wrapAll:function(t){if(ac.isFunction(t)){return this.each(function(B){ac(this).wrapAll(t.call(this,B))})}if(this[0]){var c=ac(t,this[0].ownerDocument).eq(0).clone(true);this[0].parentNode&&c.insertBefore(this[0]);c.map(function(){for(var B=this;B.firstChild&&B.firstChild.nodeType===1;){B=B.firstChild}return B}).append(this)}return this},wrapInner:function(c){if(ac.isFunction(c)){return this.each(function(t){ac(this).wrapInner(c.call(this,t))})}return this.each(function(){var t=ac(this),B=t.contents();B.length?B.wrapAll(c):t.append(c)})},wrap:function(c){return this.each(function(){ac(this).wrapAll(c)})},unwrap:function(){return this.parent().each(function(){ac.nodeName(this,"body")||ac(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,true,function(c){this.nodeType===1&&this.appendChild(c)})},prepend:function(){return this.domManip(arguments,true,function(c){this.nodeType===1&&this.insertBefore(c,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode){return this.domManip(arguments,false,function(t){this.parentNode.insertBefore(t,this)})}else{if(arguments.length){var c=ac(arguments[0]);c.push.apply(c,this.toArray());return this.pushStack(c,"before",arguments)}}},after:function(){if(this[0]&&this[0].parentNode){return this.domManip(arguments,false,function(t){this.parentNode.insertBefore(t,this.nextSibling)})}else{if(arguments.length){var c=this.pushStack(this,"after",arguments);c.push.apply(c,ac(arguments[0]).toArray());return c}}},remove:function(t,c){for(var E=0,B;(B=this[E])!=null;E++){if(!t||ac.filter(t,[B]).length){if(!c&&B.nodeType===1){ac.cleanData(B.getElementsByTagName("*"));ac.cleanData([B])}B.parentNode&&B.parentNode.removeChild(B)}}return this},empty:function(){for(var t=0,c;(c=this[t])!=null;t++){for(c.nodeType===1&&ac.cleanData(c.getElementsByTagName("*"));c.firstChild;){c.removeChild(c.firstChild)}}return this},clone:function(t){var c=this.map(function(){if(!ac.support.noCloneEvent&&!ac.isXMLDoc(this)){var E=this.outerHTML,B=this.ownerDocument;if(!E){E=B.createElement("div");E.appendChild(this.cloneNode(true));E=E.innerHTML}return ac.clean([E.replace(aG,"").replace(aW,'="$1">').replace(aP,"")],B)[0]}else{return this.cloneNode(true)}});if(t===true){az(this,c);az(this.find("*"),c.find("*"))}return c},html:function(t){if(t===aC){return this[0]&&this[0].nodeType===1?this[0].innerHTML.replace(aG,""):null}else{if(typeof t==="string"&&!aw.test(t)&&(ac.support.leadingWhitespace||!aP.test(t))&&!ar[(aL.exec(t)||["",""])[1].toLowerCase()]){t=t.replace(aY,"<$1></$2>");try{for(var c=0,E=this.length;c<E;c++){if(this[c].nodeType===1){ac.cleanData(this[c].getElementsByTagName("*"));this[c].innerHTML=t}}}catch(B){this.empty().append(t)}}else{ac.isFunction(t)?this.each(function(S){var P=ac(this);P.html(t.call(this,S,P.html()))}):this.empty().append(t)}}return this},replaceWith:function(c){if(this[0]&&this[0].parentNode){if(ac.isFunction(c)){return this.each(function(t){var E=ac(this),B=E.html();E.replaceWith(c.call(this,t,B))})}if(typeof c!=="string"){c=ac(c).detach()}return this.each(function(){var t=this.nextSibling,B=this.parentNode;ac(this).remove();t?ac(t).before(c):ac(B).append(c)})}else{return this.pushStack(ac(ac.isFunction(c)?c():c),"replaceWith",c)}},detach:function(c){return this.remove(c,true)},domManip:function(V,U,T){var S,P,E,t=V[0],B=[];if(!ac.support.checkClone&&arguments.length===3&&typeof t==="string"&&O.test(t)){return this.each(function(){ac(this).domManip(V,U,T,true)})}if(ac.isFunction(t)){return this.each(function(W){var X=ac(this);V[0]=t.call(this,W,U?X.html():aC);X.domManip(V,U,T)})}if(this[0]){S=t&&t.parentNode;S=ac.support.parentNode&&S&&S.nodeType===11&&S.childNodes.length===this.length?{fragment:S}:ac.buildFragment(V,this,B);E=S.fragment;if(P=E.childNodes.length===1?E=E.firstChild:E.firstChild){U=U&&ac.nodeName(P,"tr");P=0;for(var c=this.length;P<c;P++){T.call(U?ac.nodeName(this[P],"table")?this[P].getElementsByTagName("tbody")[0]||this[P].appendChild(this[P].ownerDocument.createElement("tbody")):this[P]:this[P],P>0||S.cacheable||this.length>1?E.cloneNode(true):E)}}B.length&&ac.each(B,aF)}return this}});ac.buildFragment=function(t,c,S){var P,E,B;c=c&&c[0]?c[0].ownerDocument||c[0]:I;if(t.length===1&&typeof t[0]==="string"&&t[0].length<512&&c===I&&!aw.test(t[0])&&(ac.support.checkClone||!O.test(t[0]))){E=true;if(B=ac.fragments[t[0]]){if(B!==1){P=B}}}if(!P){P=c.createDocumentFragment();ac.clean(t,c,P,S)}if(E){ac.fragments[t[0]]=B?P:1}return{fragment:P,cacheable:E}};ac.fragments={};ac.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(t,c){ac.fn[t]=function(T){var S=[];T=ac(T);var P=this.length===1&&this[0].parentNode;if(P&&P.nodeType===11&&P.childNodes.length===1&&T.length===1){T[c](this[0]);return this}else{P=0;for(var E=T.length;P<E;P++){var B=(P>0?this.clone(true):this).get();ac(T[P])[c](B);S=S.concat(B)}return this.pushStack(S,t,T.selector)}}});ac.extend({clean:function(X,V,U,T){V=V||I;if(typeof V.createElement==="undefined"){V=V.ownerDocument||V[0]&&V[0].ownerDocument||I}for(var S=[],P=0,B;(B=X[P])!=null;P++){if(typeof B==="number"){B+=""}if(B){if(typeof B==="string"&&!f.test(B)){B=V.createTextNode(B)}else{if(typeof B==="string"){B=B.replace(aY,"<$1></$2>");var E=(aL.exec(B)||["",""])[1].toLowerCase(),t=ar[E]||ar._default,W=t[0],c=V.createElement("div");for(c.innerHTML=t[1]+B+t[2];W--;){c=c.lastChild}if(!ac.support.tbody){W=u.test(B);E=E==="table"&&!W?c.firstChild&&c.firstChild.childNodes:t[1]==="<table>"&&!W?c.childNodes:[];for(t=E.length-1;t>=0;--t){ac.nodeName(E[t],"tbody")&&!E[t].childNodes.length&&E[t].parentNode.removeChild(E[t])}}!ac.support.leadingWhitespace&&aP.test(B)&&c.insertBefore(V.createTextNode(aP.exec(B)[0]),c.firstChild);B=c.childNodes}}if(B.nodeType){S.push(B)}else{S=ac.merge(S,B)}}}if(U){for(P=0;S[P];P++){if(T&&ac.nodeName(S[P],"script")&&(!S[P].type||S[P].type.toLowerCase()==="text/javascript")){T.push(S[P].parentNode?S[P].parentNode.removeChild(S[P]):S[P])}else{S[P].nodeType===1&&S.splice.apply(S,[P+1,0].concat(ac.makeArray(S[P].getElementsByTagName("script"))));U.appendChild(S[P])}}}return S},cleanData:function(V){for(var U,T,S=ac.cache,P=ac.event.special,E=ac.support.deleteExpando,t=0,B;(B=V[t])!=null;t++){if(!(B.nodeName&&ac.noData[B.nodeName.toLowerCase()])){if(T=B[ac.expando]){if((U=S[T])&&U.events){for(var c in U.events){P[c]?ac.event.remove(B,c):ac.removeEvent(B,c,U.handle)}}if(E){delete B[ac.expando]}else{B.removeAttribute&&B.removeAttribute(ac.expando)}delete S[T]}}}}});var y=/alpha\([^)]*\)/i,aK=/opacity=([^)]*)/,au=/-([a-z])/ig,L=/([A-Z])/g,l=/^-?\d+(?:px)?$/i,w=/^-?\d/,h={position:"absolute",visibility:"hidden",display:"block"},ag=["Left","Right"],G=["Top","Bottom"],al,a1,aJ,aZ=function(t,c){return c.toUpperCase()};ac.fn.css=function(t,c){if(arguments.length===2&&c===aC){return this}return ac.access(this,t,c,true,function(P,E,B){return B!==aC?ac.style(P,E,B):ac.css(P,E)})};ac.extend({cssHooks:{opacity:{get:function(t,c){if(c){var B=al(t,"opacity","opacity");return B===""?"1":B}else{return t.style.opacity}}}},cssNumber:{zIndex:true,fontWeight:true,opacity:true,zoom:true,lineHeight:true},cssProps:{"float":ac.support.cssFloat?"cssFloat":"styleFloat"},style:function(V,U,T,S){if(!(!V||V.nodeType===3||V.nodeType===8||!V.style)){var P,E=ac.camelCase(U),t=V.style,B=ac.cssHooks[E];U=ac.cssProps[E]||E;if(T!==aC){if(!(typeof T==="number"&&isNaN(T)||T==null)){if(typeof T==="number"&&!ac.cssNumber[E]){T+="px"}if(!B||!("set" in B)||(T=B.set(V,T))!==aC){try{t[U]=T}catch(c){}}}}else{if(B&&"get" in B&&(P=B.get(V,false,S))!==aC){return P}return t[U]}}},css:function(t,c,S){var P,E=ac.camelCase(c),B=ac.cssHooks[E];c=ac.cssProps[E]||E;if(B&&"get" in B&&(P=B.get(t,true,S))!==aC){return P}else{if(al){return al(t,c,E)}}},swap:function(t,c,P){var E={},B;for(B in c){E[B]=t.style[B];t.style[B]=c[B]}P.call(t);for(B in c){t.style[B]=E[B]}},camelCase:function(c){return c.replace(au,aZ)}});ac.curCSS=ac.css;ac.each(["height","width"],function(t,c){ac.cssHooks[c]={get:function(S,P,E){var B;if(P){if(S.offsetWidth!==0){B=R(S,c,E)}else{ac.swap(S,h,function(){B=R(S,c,E)})}if(B<=0){B=al(S,c,c);if(B==="0px"&&aJ){B=aJ(S,c,c)}if(B!=null){return B===""||B==="auto"?"0px":B}}if(B<0||B==null){B=S.style[c];return B===""||B==="auto"?"0px":B}return typeof B==="string"?B:B+"px"}},set:function(E,B){if(l.test(B)){B=parseFloat(B);if(B>=0){return B+"px"}}else{return B}}}});if(!ac.support.opacity){ac.cssHooks.opacity={get:function(t,c){return aK.test((c&&t.currentStyle?t.currentStyle.filter:t.style.filter)||"")?parseFloat(RegExp.$1)/100+"":c?"1":""},set:function(t,c){var P=t.style;P.zoom=1;var E=ac.isNaN(c)?"":"alpha(opacity="+c*100+")",B=P.filter||"";P.filter=y.test(B)?B.replace(y,E):P.filter+" "+E}}}if(I.defaultView&&I.defaultView.getComputedStyle){a1=function(t,c,E){var B;E=E.replace(L,"-$1").toLowerCase();if(!(c=t.ownerDocument.defaultView)){return aC}if(c=c.getComputedStyle(t,null)){B=c.getPropertyValue(E);if(B===""&&!ac.contains(t.ownerDocument.documentElement,t)){B=ac.style(t,E)}}return B}}if(I.documentElement.currentStyle){aJ=function(t,c){var S,P,E=t.currentStyle&&t.currentStyle[c],B=t.style;if(!l.test(E)&&w.test(E)){S=B.left;P=t.runtimeStyle.left;t.runtimeStyle.left=t.currentStyle.left;B.left=c==="fontSize"?"1em":E||0;E=B.pixelLeft+"px";B.left=S;t.runtimeStyle.left=P}return E===""?"auto":E}}al=a1||aJ;if(ac.expr&&ac.expr.filters){ac.expr.filters.hidden=function(t){var c=t.offsetHeight;return t.offsetWidth===0&&c===0||!ac.support.reliableHiddenOffsets&&(t.style.display||ac.css(t,"display"))==="none"};ac.expr.filters.visible=function(c){return !ac.expr.filters.hidden(c)}}var aM=ac.now(),ax=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,Q=/^(?:select|textarea)/i,z=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,m=/^(?:GET|HEAD)$/,r=/\[\]$/,ao=/\=\?(&|$)/,x=/\?/,a2=/([?&])_=[^&]*/,aQ=/^(\w+:)?\/\/([^\/?#]+)/,aD=/%20/g,ae=/#.*$/,aO=ac.fn.load;ac.fn.extend({load:function(t,c,S){if(typeof t!=="string"&&aO){return aO.apply(this,arguments)}else{if(!this.length){return this}}var P=t.indexOf(" ");if(P>=0){var E=t.slice(P,t.length);t=t.slice(0,P)}P="GET";if(c){if(ac.isFunction(c)){S=c;c=null}else{if(typeof c==="object"){c=ac.param(c,ac.ajaxSettings.traditional);P="POST"}}}var B=this;ac.ajax({url:t,type:P,dataType:"html",data:c,complete:function(T,U){if(U==="success"||U==="notmodified"){B.html(E?ac("<div>").append(T.responseText.replace(ax,"")).find(E):T.responseText)}S&&B.each(S,[T.responseText,U,T])}});return this},serialize:function(){return ac.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?ac.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||Q.test(this.nodeName)||z.test(this.type))}).map(function(t,c){var B=ac(this).val();return B==null?null:ac.isArray(B)?ac.map(B,function(E){return{name:c.name,value:E}}):{name:c.name,value:B}}).get()}});ac.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(t,c){ac.fn[c]=function(B){return this.bind(c,B)}});ac.extend({get:function(t,c,E,B){if(ac.isFunction(c)){B=B||E;E=c;c=null}return ac.ajax({type:"GET",url:t,data:c,success:E,dataType:B})},getScript:function(t,c){return ac.get(t,null,c,"script")},getJSON:function(t,c,B){return ac.get(t,c,B,"json")},post:function(t,c,E,B){if(ac.isFunction(c)){B=B||E;E=c;c={}}return ac.ajax({type:"POST",url:t,data:c,success:E,dataType:B})},ajaxSetup:function(c){ac.extend(ac.ajaxSettings,c)},ajaxSettings:{url:location.href,global:true,type:"GET",contentType:"application/x-www-form-urlencoded",processData:true,async:true,xhr:function(){return new ay.XMLHttpRequest},accepts:{xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"}},ajax:function(a9){var a8=ac.extend(true,{},ac.ajaxSettings,a9),a7,a6,a5,aa=a8.type.toUpperCase(),X=m.test(aa);a8.url=a8.url.replace(ae,"");a8.context=a9&&a9.context!=null?a9.context:a8;if(a8.data&&a8.processData&&typeof a8.data!=="string"){a8.data=ac.param(a8.data,a8.traditional)}if(a8.dataType==="jsonp"){if(aa==="GET"){ao.test(a8.url)||(a8.url+=(x.test(a8.url)?"&":"?")+(a8.jsonp||"callback")+"=?")}else{if(!a8.data||!ao.test(a8.data)){a8.data=(a8.data?a8.data+"&":"")+(a8.jsonp||"callback")+"=?"}}a8.dataType="json"}if(a8.dataType==="json"&&(a8.data&&ao.test(a8.data)||ao.test(a8.url))){a7=a8.jsonpCallback||"jsonp"+aM++;if(a8.data){a8.data=(a8.data+"").replace(ao,"="+a7+"$1")}a8.url=a8.url.replace(ao,"="+a7+"$1");a8.dataType="script";var Y=ay[a7];ay[a7]=function(ba){if(ac.isFunction(Y)){Y(ba)}else{ay[a7]=aC;try{delete ay[a7]}catch(bb){}}a5=ba;ac.handleSuccess(a8,P,a6,a5);ac.handleComplete(a8,P,a6,a5);T&&T.removeChild(U)}}if(a8.dataType==="script"&&a8.cache===null){a8.cache=false}if(a8.cache===false&&X){var V=ac.now(),E=a8.url.replace(a2,"$1_="+V);a8.url=E+(E===a8.url?(x.test(a8.url)?"&":"?")+"_="+V:"")}if(a8.data&&X){a8.url+=(x.test(a8.url)?"&":"?")+a8.data}a8.global&&ac.active++===0&&ac.event.trigger("ajaxStart");V=(V=aQ.exec(a8.url))&&(V[1]&&V[1].toLowerCase()!==location.protocol||V[2].toLowerCase()!==location.host);if(a8.dataType==="script"&&aa==="GET"&&V){var T=I.getElementsByTagName("head")[0]||I.documentElement,U=I.createElement("script");if(a8.scriptCharset){U.charset=a8.scriptCharset}U.src=a8.url;if(!a7){var S=false;U.onload=U.onreadystatechange=function(){if(!S&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){S=true;ac.handleSuccess(a8,P,a6,a5);ac.handleComplete(a8,P,a6,a5);U.onload=U.onreadystatechange=null;T&&U.parentNode&&T.removeChild(U)}}}T.insertBefore(U,T.firstChild);return aC}var t=false,P=a8.xhr();if(P){a8.username?P.open(aa,a8.url,a8.async,a8.username,a8.password):P.open(aa,a8.url,a8.async);try{if(a8.data!=null&&!X||a9&&a9.contentType){P.setRequestHeader("Content-Type",a8.contentType)}if(a8.ifModified){ac.lastModified[a8.url]&&P.setRequestHeader("If-Modified-Since",ac.lastModified[a8.url]);ac.etag[a8.url]&&P.setRequestHeader("If-None-Match",ac.etag[a8.url])}V||P.setRequestHeader("X-Requested-With","XMLHttpRequest");P.setRequestHeader("Accept",a8.dataType&&a8.accepts[a8.dataType]?a8.accepts[a8.dataType]+", */*; q=0.01":a8.accepts._default)}catch(B){}if(a8.beforeSend&&a8.beforeSend.call(a8.context,P,a8)===false){a8.global&&ac.active--===1&&ac.event.trigger("ajaxStop");P.abort();return false}a8.global&&ac.triggerGlobal(a8,"ajaxSend",[P,a8]);var c=P.onreadystatechange=function(ba){if(!P||P.readyState===0||ba==="abort"){t||ac.handleComplete(a8,P,a6,a5);t=true;if(P){P.onreadystatechange=ac.noop}}else{if(!t&&P&&(P.readyState===4||ba==="timeout")){t=true;P.onreadystatechange=ac.noop;a6=ba==="timeout"?"timeout":!ac.httpSuccess(P)?"error":a8.ifModified&&ac.httpNotModified(P,a8.url)?"notmodified":"success";var bc;if(a6==="success"){try{a5=ac.httpData(P,a8.dataType,a8)}catch(bb){a6="parsererror";bc=bb}}if(a6==="success"||a6==="notmodified"){a7||ac.handleSuccess(a8,P,a6,a5)}else{ac.handleError(a8,P,a6,bc)}a7||ac.handleComplete(a8,P,a6,a5);ba==="timeout"&&P.abort();if(a8.async){P=null}}}};try{var ab=P.abort;P.abort=function(){P&&Function.prototype.call.call(ab,P);c("abort")}}catch(Z){}a8.async&&a8.timeout>0&&setTimeout(function(){P&&!t&&c("timeout")},a8.timeout);try{P.send(X||a8.data==null?null:a8.data)}catch(W){ac.handleError(a8,P,null,W);ac.handleComplete(a8,P,a6,a5)}a8.async||c();return P}},param:function(t,c){var P=[],E=function(T,S){S=ac.isFunction(S)?S():S;P[P.length]=encodeURIComponent(T)+"="+encodeURIComponent(S)};if(c===aC){c=ac.ajaxSettings.traditional}if(ac.isArray(t)||t.jquery){ac.each(t,function(){E(this.name,this.value)})}else{for(var B in t){v(B,t[B],c,E)}}return P.join("&").replace(aD,"+")}});ac.extend({active:0,lastModified:{},etag:{},handleError:function(t,c,E,B){t.error&&t.error.call(t.context,c,E,B);t.global&&ac.triggerGlobal(t,"ajaxError",[c,t,B])},handleSuccess:function(t,c,E,B){t.success&&t.success.call(t.context,B,E,c);t.global&&ac.triggerGlobal(t,"ajaxSuccess",[c,t])},handleComplete:function(t,c,B){t.complete&&t.complete.call(t.context,c,B);t.global&&ac.triggerGlobal(t,"ajaxComplete",[c,t]);t.global&&ac.active--===1&&ac.event.trigger("ajaxStop")},triggerGlobal:function(t,c,B){(t.context&&t.context.url==null?ac(t.context):ac.event).trigger(c,B)},httpSuccess:function(t){try{return !t.status&&location.protocol==="file:"||t.status>=200&&t.status<300||t.status===304||t.status===1223}catch(c){}return false},httpNotModified:function(t,c){var E=t.getResponseHeader("Last-Modified"),B=t.getResponseHeader("Etag");if(E){ac.lastModified[c]=E}if(B){ac.etag[c]=B}return t.status===304},httpData:function(t,c,P){var E=t.getResponseHeader("content-type")||"",B=c==="xml"||!c&&E.indexOf("xml")>=0;t=B?t.responseXML:t.responseText;B&&t.documentElement.nodeName==="parsererror"&&ac.error("parsererror");if(P&&P.dataFilter){t=P.dataFilter(t,c)}if(typeof t==="string"){if(c==="json"||!c&&E.indexOf("json")>=0){t=ac.parseJSON(t)}else{if(c==="script"||!c&&E.indexOf("javascript")>=0){ac.globalEval(t)}}}return t}});if(ay.ActiveXObject){ac.ajaxSettings.xhr=function(){if(ay.location.protocol!=="file:"){try{return new ay.XMLHttpRequest}catch(t){}}try{return new ay.ActiveXObject("Microsoft.XMLHTTP")}catch(c){}}}ac.support.ajax=!!ac.ajaxSettings.xhr();var g={},D=/^(?:toggle|show|hide)$/,p=/^([+\-]=)?([\d+.\-]+)(.*)$/,at,A=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]];ac.fn.extend({show:function(t,c,E){if(t||t===0){return this.animate(ap("show",3),t,c,E)}else{E=0;for(var B=this.length;E<B;E++){t=this[E];c=t.style.display;if(!ac.data(t,"olddisplay")&&c==="none"){c=t.style.display=""}c===""&&ac.css(t,"display")==="none"&&ac.data(t,"olddisplay",n(t.nodeName))}for(E=0;E<B;E++){t=this[E];c=t.style.display;if(c===""||c==="none"){t.style.display=ac.data(t,"olddisplay")||""}}return this}},hide:function(t,c,B){if(t||t===0){return this.animate(ap("hide",3),t,c,B)}else{t=0;for(c=this.length;t<c;t++){B=ac.css(this[t],"display");B!=="none"&&ac.data(this[t],"olddisplay",B)}for(t=0;t<c;t++){this[t].style.display="none"}return this}},_toggle:ac.fn.toggle,toggle:function(t,c,E){var B=typeof t==="boolean";if(ac.isFunction(t)&&ac.isFunction(c)){this._toggle.apply(this,arguments)}else{t==null||B?this.each(function(){var P=B?t:ac(this).is(":hidden");ac(this)[P?"show":"hide"]()}):this.animate(ap("toggle",3),t,c,E)}return this},fadeTo:function(t,c,E,B){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:c},t,E,B)},animate:function(t,c,P,E){var B=ac.speed(c,P,E);if(ac.isEmptyObject(t)){return this.each(B.complete)}return this[B.queue===false?"each":"queue"](function(){var V=ac.extend({},B),T,U=this.nodeType===1,X=U&&ac(this).is(":hidden"),S=this;for(T in t){var W=ac.camelCase(T);if(T!==W){t[W]=t[T];delete t[T];T=W}if(t[T]==="hide"&&X||t[T]==="show"&&!X){return V.complete.call(this)}if(U&&(T==="height"||T==="width")){V.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY];if(ac.css(this,"display")==="inline"&&ac.css(this,"float")==="none"){if(ac.support.inlineBlockNeedsLayout){if(n(this.nodeName)==="inline"){this.style.display="inline-block"}else{this.style.display="inline";this.style.zoom=1}}else{this.style.display="inline-block"}}}if(ac.isArray(t[T])){(V.specialEasing=V.specialEasing||{})[T]=t[T][1];t[T]=t[T][0]}}if(V.overflow!=null){this.style.overflow="hidden"}V.curAnim=ac.extend({},t);ac.each(t,function(Z,a7){var ab=new ac.fx(S,V,Z);if(D.test(a7)){ab[a7==="toggle"?X?"show":"hide":a7](t)}else{var aa=p.exec(a7),a5=ab.cur()||0;if(aa){var Y=parseFloat(aa[2]),a6=aa[3]||"px";if(a6!=="px"){ac.style(S,Z,(Y||1)+a6);a5=(Y||1)/ab.cur()*a5;ac.style(S,Z,a5+a6)}if(aa[1]){Y=(aa[1]==="-="?-1:1)*Y+a5}ab.custom(a5,Y,a6)}else{ab.custom(a5,a7,"")}}});return true})},stop:function(t,c){var B=ac.timers;t&&this.queue([]);this.each(function(){for(var E=B.length-1;E>=0;E--){if(B[E].elem===this){c&&B[E](true);B.splice(E,1)}}});c||this.dequeue();return this}});ac.each({slideDown:ap("show",1),slideUp:ap("hide",1),slideToggle:ap("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(t,c){ac.fn[t]=function(P,E,B){return this.animate(c,P,E,B)}});ac.extend({speed:function(t,c,E){var B=t&&typeof t==="object"?ac.extend({},t):{complete:E||!E&&c||ac.isFunction(t)&&t,duration:t,easing:E&&c||c&&!ac.isFunction(c)&&c};B.duration=ac.fx.off?0:typeof B.duration==="number"?B.duration:B.duration in ac.fx.speeds?ac.fx.speeds[B.duration]:ac.fx.speeds._default;B.old=B.complete;B.complete=function(){B.queue!==false&&ac(this).dequeue();ac.isFunction(B.old)&&B.old.call(this)};return B},easing:{linear:function(t,c,E,B){return E+B*t},swing:function(t,c,E,B){return(-Math.cos(t*Math.PI)/2+0.5)*B+E}},timers:[],fx:function(t,c,B){this.options=c;this.elem=t;this.prop=B;if(!c.orig){c.orig={}}}});ac.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this);(ac.fx.step[this.prop]||ac.fx.step._default)(this)},cur:function(){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null)){return this.elem[this.prop]}var c=parseFloat(ac.css(this.elem,this.prop));return c&&c>-10000?c:0},custom:function(t,c,S){function P(T){return E.step(T)}var E=this,B=ac.fx;this.startTime=ac.now();this.start=t;this.end=c;this.unit=S||this.unit||"px";this.now=this.start;this.pos=this.state=0;P.elem=this.elem;if(P()&&ac.timers.push(P)&&!at){at=setInterval(B.tick,B.interval)}},show:function(){this.options.orig[this.prop]=ac.style(this.elem,this.prop);this.options.show=true;this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur());ac(this.elem).show()},hide:function(){this.options.orig[this.prop]=ac.style(this.elem,this.prop);this.options.hide=true;this.custom(this.cur(),0)},step:function(B){var c=ac.now(),T=true;if(B||c>=this.options.duration+this.startTime){this.now=this.end;this.pos=this.state=1;this.update();this.options.curAnim[this.prop]=true;for(var S in this.options.curAnim){if(this.options.curAnim[S]!==true){T=false}}if(T){if(this.options.overflow!=null&&!ac.support.shrinkWrapBlocks){var P=this.elem,E=this.options;ac.each(["","X","Y"],function(U,V){P.style["overflow"+V]=E.overflow[U]})}this.options.hide&&ac(this.elem).hide();if(this.options.hide||this.options.show){for(var t in this.options.curAnim){ac.style(this.elem,t,this.options.orig[t])}}this.options.complete.call(this.elem)}return false}else{B=c-this.startTime;this.state=B/this.options.duration;c=this.options.easing||(ac.easing.swing?"swing":"linear");this.pos=ac.easing[this.options.specialEasing&&this.options.specialEasing[this.prop]||c](this.state,B,0,1,this.options.duration);this.now=this.start+(this.end-this.start)*this.pos;this.update()}return true}};ac.extend(ac.fx,{tick:function(){for(var t=ac.timers,c=0;c<t.length;c++){t[c]()||t.splice(c--,1)}t.length||ac.fx.stop()},interval:13,stop:function(){clearInterval(at);at=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(c){ac.style(c.elem,"opacity",c.now)},_default:function(c){if(c.elem.style&&c.elem.style[c.prop]!=null){c.elem.style[c.prop]=(c.prop==="width"||c.prop==="height"?Math.max(0,c.now):c.now)+c.unit}else{c.elem[c.prop]=c.now}}}});if(ac.expr&&ac.expr.filters){ac.expr.filters.animated=function(c){return ac.grep(ac.timers,function(t){return c===t.elem}).length}}var a=/^t(?:able|d|h)$/i,aA=/^(?:body|html)$/i;ac.fn.offset="getBoundingClientRect" in I.documentElement?function(t){var c=this[0],S;if(t){return this.each(function(T){ac.offset.setOffset(this,t,T)})}if(!c||!c.ownerDocument){return null}if(c===c.ownerDocument.body){return ac.offset.bodyOffset(c)}try{S=c.getBoundingClientRect()}catch(P){}var E=c.ownerDocument,B=E.documentElement;if(!S||!ac.contains(B,c)){return S||{top:0,left:0}}c=E.body;E=aX(E);return{top:S.top+(E.pageYOffset||ac.support.boxModel&&B.scrollTop||c.scrollTop)-(B.clientTop||c.clientTop||0),left:S.left+(E.pageXOffset||ac.support.boxModel&&B.scrollLeft||c.scrollLeft)-(B.clientLeft||c.clientLeft||0)}}:function(V){var U=this[0];if(V){return this.each(function(W){ac.offset.setOffset(this,V,W)})}if(!U||!U.ownerDocument){return null}if(U===U.ownerDocument.body){return ac.offset.bodyOffset(U)}ac.offset.initialize();var T,S=U.offsetParent,P=U.ownerDocument,E=P.documentElement,t=P.body;T=(P=P.defaultView)?P.getComputedStyle(U,null):U.currentStyle;for(var B=U.offsetTop,c=U.offsetLeft;(U=U.parentNode)&&U!==t&&U!==E;){if(ac.offset.supportsFixedPosition&&T.position==="fixed"){break}T=P?P.getComputedStyle(U,null):U.currentStyle;B-=U.scrollTop;c-=U.scrollLeft;if(U===S){B+=U.offsetTop;c+=U.offsetLeft;if(ac.offset.doesNotAddBorder&&!(ac.offset.doesAddBorderForTableAndCells&&a.test(U.nodeName))){B+=parseFloat(T.borderTopWidth)||0;c+=parseFloat(T.borderLeftWidth)||0}S=U.offsetParent}if(ac.offset.subtractsBorderForOverflowNotVisible&&T.overflow!=="visible"){B+=parseFloat(T.borderTopWidth)||0;c+=parseFloat(T.borderLeftWidth)||0}T=T}if(T.position==="relative"||T.position==="static"){B+=t.offsetTop;c+=t.offsetLeft}if(ac.offset.supportsFixedPosition&&T.position==="fixed"){B+=Math.max(E.scrollTop,t.scrollTop);c+=Math.max(E.scrollLeft,t.scrollLeft)}return{top:B,left:c}};ac.offset={initialize:function(){var t=I.body,c=I.createElement("div"),S,P,E,B=parseFloat(ac.css(t,"marginTop"))||0;ac.extend(c.style,{position:"absolute",top:0,left:0,margin:0,border:0,width:"1px",height:"1px",visibility:"hidden"});c.innerHTML="<div style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;'><div></div></div><table style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;' cellpadding='0' cellspacing='0'><tr><td></td></tr></table>";t.insertBefore(c,t.firstChild);S=c.firstChild;P=S.firstChild;E=S.nextSibling.firstChild.firstChild;this.doesNotAddBorder=P.offsetTop!==5;this.doesAddBorderForTableAndCells=E.offsetTop===5;P.style.position="fixed";P.style.top="20px";this.supportsFixedPosition=P.offsetTop===20||P.offsetTop===15;P.style.position=P.style.top="";S.style.overflow="hidden";S.style.position="relative";this.subtractsBorderForOverflowNotVisible=P.offsetTop===-5;this.doesNotIncludeMarginInBodyOffset=t.offsetTop!==B;t.removeChild(c);ac.offset.initialize=ac.noop},bodyOffset:function(t){var c=t.offsetTop,B=t.offsetLeft;ac.offset.initialize();if(ac.offset.doesNotIncludeMarginInBodyOffset){c+=parseFloat(ac.css(t,"marginTop"))||0;B+=parseFloat(ac.css(t,"marginLeft"))||0}return{top:c,left:B}},setOffset:function(W,U,T){var S=ac.css(W,"position");if(S==="static"){W.style.position="relative"}var P=ac(W),E=P.offset(),t=ac.css(W,"top"),B=ac.css(W,"left"),c=S==="absolute"&&ac.inArray("auto",[t,B])>-1;S={};var V={};if(c){V=P.position()}t=c?V.top:parseInt(t,10)||0;B=c?V.left:parseInt(B,10)||0;if(ac.isFunction(U)){U=U.call(W,T,E)}if(U.top!=null){S.top=U.top-E.top+t}if(U.left!=null){S.left=U.left-E.left+B}"using" in U?U.using.call(W,S):P.css(S)}};ac.fn.extend({position:function(){if(!this[0]){return null}var t=this[0],c=this.offsetParent(),E=this.offset(),B=aA.test(c[0].nodeName)?{top:0,left:0}:c.offset();E.top-=parseFloat(ac.css(t,"marginTop"))||0;E.left-=parseFloat(ac.css(t,"marginLeft"))||0;B.top+=parseFloat(ac.css(c[0],"borderTopWidth"))||0;B.left+=parseFloat(ac.css(c[0],"borderLeftWidth"))||0;return{top:E.top-B.top,left:E.left-B.left}},offsetParent:function(){return this.map(function(){for(var c=this.offsetParent||I.body;c&&!aA.test(c.nodeName)&&ac.css(c,"position")==="static";){c=c.offsetParent}return c})}});ac.each(["Left","Top"],function(t,c){var B="scroll"+c;ac.fn[B]=function(S){var P=this[0],E;if(!P){return null}if(S!==aC){return this.each(function(){if(E=aX(this)){E.scrollTo(!t?S:ac(E).scrollLeft(),t?S:ac(E).scrollTop())}else{this[B]=S}})}else{return(E=aX(P))?"pageXOffset" in E?E[t?"pageYOffset":"pageXOffset"]:ac.support.boxModel&&E.document.documentElement[B]||E.document.body[B]:P[B]}}});ac.each(["Height","Width"],function(t,c){var B=c.toLowerCase();ac.fn["inner"+c]=function(){return this[0]?parseFloat(ac.css(this[0],B,"padding")):null};ac.fn["outer"+c]=function(E){return this[0]?parseFloat(ac.css(this[0],B,E?"margin":"border")):null};ac.fn[B]=function(S){var P=this[0];if(!P){return S==null?null:this}if(ac.isFunction(S)){return this.each(function(T){var U=ac(this);U[B](S.call(this,T,U[B]()))})}if(ac.isWindow(P)){return P.document.compatMode==="CSS1Compat"&&P.document.documentElement["client"+c]||P.document.body["client"+c]}else{if(P.nodeType===9){return Math.max(P.documentElement["client"+c],P.body["scroll"+c],P.documentElement["scroll"+c],P.body["offset"+c],P.documentElement["offset"+c])}else{if(S===aC){P=ac.css(P,B);var E=parseFloat(P);return ac.isNaN(E)?P:E}else{return this.css(B,typeof S==="string"?S:S+"px")}}}}})})(window);(function(d,e,f){d.fn.jScrollPane=function(a){function c(br,bc){var bk,ba=this,a2,bF,aK,bD,a7,a1,s,aO,bi,bS,bs,aW,bh,aX,aV,a0,a6,bz,a3,aM,bv,by,bK,bC,bl,aT,bu,bm,aI,bq,bP,aZ,bf,bG=true,bb=true,bQ=false,aU=false,bA=br.clone(false,false).empty(),bN=d.fn.mwheelIntent?"mwheelIntent.jsp":"mousewheel.jsp";bP=br.css("paddingTop")+" "+br.css("paddingRight")+" "+br.css("paddingBottom")+" "+br.css("paddingLeft");aZ=(parseInt(br.css("paddingLeft"),10)||0)+(parseInt(br.css("paddingRight"),10)||0);function bx(j){var m,l,q,o,p,g,h,n;bk=j;if(a2===f){h=br.scrollTop();n=br.scrollLeft();br.css({overflow:"hidden",padding:0});bF=br.innerWidth()+aZ;aK=br.innerHeight();br.width(bF);a2=d('<div class="jspPane" />').css("padding",bP).append(br.children());bD=d('<div class="jspContainer" />').css({width:bF+"px",height:aK+"px"}).append(a2).appendTo(br)}else{br.css("width","");g=br.innerWidth()+aZ!=bF||br.outerHeight()!=aK;if(g){bF=br.innerWidth()+aZ;aK=br.innerHeight();bD.css({width:bF+"px",height:aK+"px"})}if(!g&&bf==a7&&a2.outerHeight()==a1){br.width(bF);return}bf=a7;a2.css("width","");br.width(bF);bD.find(">.jspVerticalBar,>.jspHorizontalBar").remove().end()}m=a2.clone(false,false).css("position","absolute");l=d('<div style="width:1px; position: relative;" />').append(m);d("body").append(l);a7=Math.max(a2.outerWidth(),m.outerWidth());l.remove();a1=a2.outerHeight();s=a7/bF;aO=a1/aK;bi=aO>1;bS=s>1;if(!(bS||bi)){br.removeClass("jspScrollable");a2.css({top:0,width:bD.width()-aZ});aR();bp();a9();aJ();bH()}else{br.addClass("jspScrollable");q=bk.maintainPosition&&(bh||a0);if(q){o=bU();p=bW()}bR();bw();bn();if(q){bd(o,false);be(p,false)}bg();bJ();bB();if(bk.enableKeyboardNavigation){a8()}if(bk.clickOnTrack){aP()}bt();if(bk.hijackInternalLinks){aS()}}if(bk.autoReinitialise&&!bq){bq=setInterval(function(){bx(bk)},bk.autoReinitialiseDelay)}else{if(!bk.autoReinitialise&&bq){clearInterval(bq)}}h&&br.scrollTop(0)&&be(h,false);n&&br.scrollLeft(0)&&bd(n,false);br.trigger("jsp-initialised",[bS||bi])}function bR(){if(bi){bD.append(d('<div class="jspVerticalBar" />').append(d('<div class="jspCap jspCapTop" />'),d('<div class="jspTrack" />').append(d('<div class="jspDrag" />').append(d('<div class="jspDragTop" />'),d('<div class="jspDragBottom" />'))),d('<div class="jspCap jspCapBottom" />')));a6=bD.find(">.jspVerticalBar");bz=a6.find(">.jspTrack");bs=bz.find(">.jspDrag");if(bk.showArrows){by=d('<a class="jspArrow jspArrowUp" />').bind("mousedown.jsp",bT(0,-1)).bind("click.jsp",bV);bK=d('<a class="jspArrow jspArrowDown" />').bind("mousedown.jsp",bT(0,1)).bind("click.jsp",bV);if(bk.arrowScrollOnHover){by.bind("mouseover.jsp",bT(0,-1,by));bK.bind("mouseover.jsp",bT(0,1,bK))}bE(bz,bk.verticalArrowPositions,by,bK)}aM=aK;bD.find(">.jspVerticalBar>.jspCap:visible,>.jspVerticalBar>.jspArrow").each(function(){aM-=d(this).outerHeight()});bs.hover(function(){bs.addClass("jspHover")},function(){bs.removeClass("jspHover")}).bind("mousedown.jsp",function(h){d("html").bind("dragstart.jsp selectstart.jsp",bV);bs.addClass("jspActive");var g=h.pageY-bs.position().top;d("html").bind("mousemove.jsp",function(j){a5(j.pageY-g,false)}).bind("mouseup.jsp mouseleave.jsp",bo);return false});aQ()}}function aQ(){bz.height(aM+"px");bh=0;a3=bk.verticalGutter+bz.outerWidth();a2.width(bF-a3-aZ);if(a6.position().left===0){a2.css("margin-left",a3+"px")}}function bw(){if(bS){bD.append(d('<div class="jspHorizontalBar" />').append(d('<div class="jspCap jspCapLeft" />'),d('<div class="jspTrack" />').append(d('<div class="jspDrag" />').append(d('<div class="jspDragLeft" />'),d('<div class="jspDragRight" />'))),d('<div class="jspCap jspCapRight" />')));bC=bD.find(">.jspHorizontalBar");bl=bC.find(">.jspTrack");aX=bl.find(">.jspDrag");if(bk.showArrows){bm=d('<a class="jspArrow jspArrowLeft" />').bind("mousedown.jsp",bT(-1,0)).bind("click.jsp",bV);aI=d('<a class="jspArrow jspArrowRight" />').bind("mousedown.jsp",bT(1,0)).bind("click.jsp",bV);if(bk.arrowScrollOnHover){bm.bind("mouseover.jsp",bT(-1,0,bm));aI.bind("mouseover.jsp",bT(1,0,aI))}bE(bl,bk.horizontalArrowPositions,bm,aI)}aX.hover(function(){aX.addClass("jspHover")},function(){aX.removeClass("jspHover")}).bind("mousedown.jsp",function(h){d("html").bind("dragstart.jsp selectstart.jsp",bV);aX.addClass("jspActive");var g=h.pageX-aX.position().left;d("html").bind("mousemove.jsp",function(j){a4(j.pageX-g,false)}).bind("mouseup.jsp mouseleave.jsp",bo);return false});aT=bD.innerWidth();bI()}}function bI(){bD.find(">.jspHorizontalBar>.jspCap:visible,>.jspHorizontalBar>.jspArrow").each(function(){aT-=d(this).outerWidth()});bl.width(aT+"px");a0=0}function bn(){if(bS&&bi){var h=bl.outerHeight(),g=bz.outerWidth();aM-=h;d(bC).find(">.jspCap:visible,>.jspArrow").each(function(){aT+=d(this).outerWidth()});aT-=g;aK-=g;bF-=h;bl.parent().append(d('<div class="jspCorner" />').css("width",h+"px"));aQ();bI()}if(bS){a2.width((bD.outerWidth()-aZ)+"px")}a1=a2.outerHeight();aO=a1/aK;if(bS){bu=Math.ceil(1/s*aT);if(bu>bk.horizontalDragMaxWidth){bu=bk.horizontalDragMaxWidth}else{if(bu<bk.horizontalDragMinWidth){bu=bk.horizontalDragMinWidth}}aX.width(bu+"px");aV=aT-bu;bL(a0)}if(bi){bv=Math.ceil(1/aO*aM);if(bv>bk.verticalDragMaxHeight){bv=bk.verticalDragMaxHeight}else{if(bv<bk.verticalDragMinHeight){bv=bk.verticalDragMinHeight}}bs.height(bv+"px");aW=aM-bv;bM(bh)}}function bE(n,l,o,h){var g="before",m="after",j;if(l=="os"){l=/Mac/.test(navigator.platform)?"after":"split"}if(l==g){m=l}else{if(l==m){g=l;j=o;o=h;h=j}}n[g](o)[m](h)}function bT(j,g,h){return function(){bj(j,g,this,h);this.blur();return false}}function bj(m,n,g,j){g=d(g).addClass("jspActive");var l,o,p=true,h=function(){if(m!==0){ba.scrollByX(m*bk.arrowButtonSpeed)}if(n!==0){ba.scrollByY(n*bk.arrowButtonSpeed)}o=setTimeout(h,p?bk.initialDelay:bk.arrowRepeatFreq);p=false};h();l=j?"mouseout.jsp":"mouseup.jsp";j=j||d("html");j.bind(l,function(){g.removeClass("jspActive");o&&clearTimeout(o);o=null;j.unbind(l)})}function aP(){aJ();if(bi){bz.bind("mousedown.jsp",function(j){if(j.originalTarget===f||j.originalTarget==j.currentTarget){var m=d(this),g=m.offset(),l=j.pageY-g.top-bh,o,p=true,h=function(){var r=m.offset(),q=j.pageY-r.top-bv/2,u=aK*bk.scrollPagePercent,t=aW*u/(a1-aK);if(l<0){if(bh-t>q){ba.scrollByY(-u)}else{a5(q)}}else{if(l>0){if(bh+t<q){ba.scrollByY(u)}else{a5(q)}}else{n();return}}o=setTimeout(h,p?bk.initialDelay:bk.trackClickRepeatFreq);p=false},n=function(){o&&clearTimeout(o);o=null;d(document).unbind("mouseup.jsp",n)};h();d(document).bind("mouseup.jsp",n);return false}})}if(bS){bl.bind("mousedown.jsp",function(j){if(j.originalTarget===f||j.originalTarget==j.currentTarget){var m=d(this),g=m.offset(),l=j.pageX-g.left-a0,o,p=true,h=function(){var r=m.offset(),q=j.pageX-r.left-bu/2,u=bF*bk.scrollPagePercent,t=aV*u/(a7-bF);if(l<0){if(a0-t>q){ba.scrollByX(-u)}else{a4(q)}}else{if(l>0){if(a0+t<q){ba.scrollByX(u)}else{a4(q)}}else{n();return}}o=setTimeout(h,p?bk.initialDelay:bk.trackClickRepeatFreq);p=false},n=function(){o&&clearTimeout(o);o=null;d(document).unbind("mouseup.jsp",n)};h();d(document).bind("mouseup.jsp",n);return false}})}}function aJ(){if(bl){bl.unbind("mousedown.jsp")}if(bz){bz.unbind("mousedown.jsp")}}function bo(){d("html").unbind("dragstart.jsp selectstart.jsp mousemove.jsp mouseup.jsp mouseleave.jsp");if(bs){bs.removeClass("jspActive")}if(aX){aX.removeClass("jspActive")}}function a5(g,h){if(!bi){return}if(g<0){g=0}else{if(g>aW){g=aW}}if(h===f){h=bk.animateScroll}if(h){ba.animate(bs,"top",g,bM)}else{bs.css("top",g);bM(g)}}function bM(m){if(m===f){m=bs.position().top}bD.scrollTop(0);bh=m;var h=bh===0,l=bh==aW,j=m/aW,g=-j*(a1-aK);if(bG!=h||bQ!=l){bG=h;bQ=l;br.trigger("jsp-arrow-change",[bG,bQ,bb,aU])}aL(h,l);a2.css("top",g);br.trigger("jsp-scroll-y",[-g,h,l]).trigger("scroll")}function a4(h,g){if(!bS){return}if(h<0){h=0}else{if(h>aV){h=aV}}if(g===f){g=bk.animateScroll}if(g){ba.animate(aX,"left",h,bL)}else{aX.css("left",h);bL(h)}}function bL(m){if(m===f){m=aX.position().left}bD.scrollTop(0);a0=m;var h=a0===0,j=a0==aV,l=m/aV,g=-l*(a7-bF);if(bb!=h||aU!=j){bb=h;aU=j;br.trigger("jsp-arrow-change",[bG,bQ,bb,aU])}aN(h,j);a2.css("left",g);br.trigger("jsp-scroll-x",[-g,h,j]).trigger("scroll")}function aL(h,g){if(bk.showArrows){by[h?"addClass":"removeClass"]("jspDisabled");bK[g?"addClass":"removeClass"]("jspDisabled")}}function aN(h,g){if(bk.showArrows){bm[h?"addClass":"removeClass"]("jspDisabled");aI[g?"addClass":"removeClass"]("jspDisabled")}}function be(g,j){var h=g/(a1-aK);a5(h*aW,j)}function bd(j,g){var h=j/(a7-bF);a4(h*aV,g)}function bO(j,p,g){var r,v,u,w=0,l=0,h,q,n,o,m;try{r=d(j)}catch(t){return}v=r.outerHeight();u=r.outerWidth();bD.scrollTop(0);bD.scrollLeft(0);while(!r.is(".jspPane")){w+=r.position().top;l+=r.position().left;r=r.offsetParent();if(/^body|html$/i.test(r[0].nodeName)){return}}h=bW();q=h+aK;if(w<h||p){o=w-bk.verticalGutter}else{if(w+v>q){o=w-aK+v+bk.verticalGutter}}if(o){be(o,g)}viewportLeft=bU();n=viewportLeft+bF;if(l<viewportLeft||p){m=l-bk.horizontalGutter}else{if(l+u>n){m=l-bF+u+bk.horizontalGutter}}if(m){bd(m,g)}}function bU(){return -a2.position().left}function bW(){return -a2.position().top}function bJ(){bD.unbind(bN).bind(bN,function(j,h,l,n){var m=a0,g=bh;ba.scrollBy(l*bk.mouseWheelSpeed,-n*bk.mouseWheelSpeed,false);return m==a0&&g==bh})}function aR(){bD.unbind(bN)}function bV(){return false}function bg(){a2.find(":input,a").unbind("focus.jsp").bind("focus.jsp",function(g){bO(g.target,false)})}function bp(){a2.find(":input,a").unbind("focus.jsp")}function a8(){var g,j;a2.focus(function(){br.focus()});br.attr("tabindex",0).unbind("keydown.jsp keypress.jsp").bind("keydown.jsp",function(l){if(l.target!==this){return}var m=a0,n=bh;switch(l.keyCode){case 40:case 38:case 34:case 32:case 33:case 39:case 37:g=l.keyCode;h();break;case 35:be(a1-aK);g=null;break;case 36:be(0);g=null;break}j=l.keyCode==g&&m!=a0||n!=bh;return !j}).bind("keypress.jsp",function(l){if(l.keyCode==g){h()}return !j});if(bk.hideFocus){br.css("outline","none");if("hideFocus" in bD[0]){br.attr("hideFocus",true)}}else{br.css("outline","");if("hideFocus" in bD[0]){br.attr("hideFocus",false)}}function h(){var l=a0,m=bh;switch(g){case 40:ba.scrollByY(bk.keyboardSpeed,false);break;case 38:ba.scrollByY(-bk.keyboardSpeed,false);break;case 34:case 32:ba.scrollByY(aK*bk.scrollPagePercent,false);break;case 33:ba.scrollByY(-aK*bk.scrollPagePercent,false);break;case 39:ba.scrollByX(bk.keyboardSpeed,false);break;case 37:ba.scrollByX(-bk.keyboardSpeed,false);break}j=l!=a0||m!=bh;return j}}function a9(){br.attr("tabindex","-1").removeAttr("tabindex").unbind("keydown.jsp keypress.jsp")}function bt(){if(location.hash&&location.hash.length>1){var h,j;try{h=d(location.hash)}catch(g){return}if(h.length&&a2.find(location.hash)){if(bD.scrollTop()===0){j=setInterval(function(){if(bD.scrollTop()>0){bO(location.hash,true);d(document).scrollTop(bD.position().top);clearInterval(j)}},50)}else{bO(location.hash,true);d(document).scrollTop(bD.position().top)}}}}function bH(){d("a.jspHijack").unbind("click.jsp-hijack").removeClass("jspHijack")}function aS(){bH();d("a[href^=#]").addClass("jspHijack").bind("click.jsp-hijack",function(){var g=this.href.split("#"),h;if(g.length>1){h=g[1];if(h.length>0&&a2.find("#"+h).length>0){bO("#"+h,true);return false}}})}function bB(){var m,n,j,l,h,g=false;bD.unbind("touchstart.jsp touchmove.jsp touchend.jsp click.jsp-touchclick").bind("touchstart.jsp",function(p){var o=p.originalEvent.touches[0];m=bU();n=bW();j=o.pageX;l=o.pageY;h=false;g=true}).bind("touchmove.jsp",function(o){if(!g){return}var p=o.originalEvent.touches[0],q=a0,r=bh;ba.scrollTo(m+j-p.pageX,n+l-p.pageY);h=h||Math.abs(j-p.pageX)>5||Math.abs(l-p.pageY)>5;return q==a0&&r==bh}).bind("touchend.jsp",function(o){g=false}).bind("click.jsp-touchclick",function(o){if(h){h=false;return false}})}function aY(){var g=bW(),h=bU();br.removeClass("jspScrollable").unbind(".jsp");br.replaceWith(bA.append(a2.children()));bA.scrollTop(g);bA.scrollLeft(h)}d.extend(ba,{reinitialise:function(g){g=d.extend({},bk,g);bx(g)},scrollToElement:function(h,j,g){bO(h,j,g)},scrollTo:function(h,g,j){bd(h,j);be(g,j)},scrollToX:function(h,g){bd(h,g)},scrollToY:function(g,h){be(g,h)},scrollToPercentX:function(h,g){bd(h*(a7-bF),g)},scrollToPercentY:function(h,g){be(h*(a1-aK),g)},scrollBy:function(j,g,h){ba.scrollByX(j,h);ba.scrollByY(g,h)},scrollByX:function(g,j){var l=bU()+g,h=l/(a7-bF);a4(h*aV,j)},scrollByY:function(g,j){var l=bW()+g,h=l/(a1-aK);a5(h*aW,j)},positionDragX:function(g,h){a4(g,h)},positionDragY:function(h,g){a4(h,g)},animate:function(m,h,g,j){var l={};l[h]=g;m.animate(l,{duration:bk.animateDuration,ease:bk.animateEase,queue:false,step:j})},getContentPositionX:function(){return bU()},getContentPositionY:function(){return bW()},getContentWidth:function(){return a7()},getContentHeight:function(){return a1()},getPercentScrolledX:function(){return bU()/(a7-bF)},getPercentScrolledY:function(){return bW()/(a1-aK)},getIsScrollableH:function(){return bS},getIsScrollableV:function(){return bi},getContentPane:function(){return a2},scrollToBottom:function(g){a5(aW,g)},hijackInternalLinks:function(){aS()},destroy:function(){aY()}});bx(bc)}a=d.extend({},d.fn.jScrollPane.defaults,a);d.each(["mouseWheelSpeed","arrowButtonSpeed","trackClickSpeed","keyboardSpeed"],function(){a[this]=a[this]||a.speed});var b;this.each(function(){var l=d(this),j=l.data("jsp");if(j){j.reinitialise(a)}else{j=new c(l,a);l.data("jsp",j)}b=b?b.add(l):l});return b};d.fn.jScrollPane.defaults={showArrows:false,maintainPosition:true,clickOnTrack:true,autoReinitialise:false,autoReinitialiseDelay:500,verticalDragMinHeight:0,verticalDragMaxHeight:99999,horizontalDragMinWidth:0,horizontalDragMaxWidth:99999,animateScroll:false,animateDuration:300,animateEase:"linear",hijackInternalLinks:false,verticalGutter:4,horizontalGutter:4,mouseWheelSpeed:0,arrowButtonSpeed:0,arrowRepeatFreq:50,arrowScrollOnHover:false,trackClickSpeed:0,trackClickRepeatFreq:70,verticalArrowPositions:"split",horizontalArrowPositions:"split",enableKeyboardNavigation:true,hideFocus:false,keyboardSpeed:0,initialDelay:300,speed:30,scrollPagePercent:0.8}})(jQuery,this);(function(a){a.prettyPhoto={version:"3.1"};a.fn.prettyPhoto=function(d){d=jQuery.extend({animation_speed:"fast",slideshow:5000,autoplay_slideshow:false,opacity:0.8,show_title:true,allow_resize:true,default_width:500,default_height:344,counter_separator_label:"/",theme:"pp_default",horizontal_padding:20,hideflash:false,wmode:"opaque",autoplay:true,modal:false,overlay_gallery:true,keyboard_shortcuts:true,changepicturecallback:function(){},callback:function(){},ie6_fallback:true,markup:'<div class="pp_pic_holder">       <div class="ppt">&nbsp;</div>       <div class="pp_top">        <div class="pp_left"></div>        <div class="pp_middle"></div>        <div class="pp_right"></div>       </div>       <div class="pp_content_container">        <div class="pp_left">        <div class="pp_right">         <div class="pp_content">          <div class="pp_loaderIcon"></div>          <div class="pp_fade">           <a href="#" class="pp_expand" title="Expand the image">Expand</a>           <div class="pp_hoverContainer">            <a class="pp_next" href="#">next</a>            <a class="pp_previous" href="#">previous</a>           </div>           <div id="pp_full_res"></div>           <div class="pp_details">            <div class="pp_nav">             <a href="#" class="pp_arrow_previous">Previous</a>             <p class="currentTextHolder">0/0</p>             <a href="#" class="pp_arrow_next">Next</a>            </div>            <p class="pp_description"></p>            <a class="pp_close" href="#">Close</a>           </div>          </div>         </div>        </div>        </div>       </div>       <div class="pp_bottom">        <div class="pp_left"></div>        <div class="pp_middle"></div>        <div class="pp_right"></div>       </div>      </div>      <div class="pp_overlay"></div>',gallery_markup:'<div class="pp_gallery">         <a href="#" class="pp_arrow_previous">Previous</a>         <div>          <ul>           {gallery}          </ul>         </div>         <a href="#" class="pp_arrow_next">Next</a>        </div>',image_markup:'<img id="fullResImage" src="{path}" />',flash_markup:'<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="{width}" height="{height}"><param name="wmode" value="{wmode}" /><param name="allowfullscreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="movie" value="{path}" /><embed src="{path}" type="application/x-shockwave-flash" allowfullscreen="true" allowscriptaccess="always" width="{width}" height="{height}" wmode="{wmode}"></embed></object>',quicktime_markup:'<object classid="clsid:02BF25D5-8C17-4B23-BC80-D3488ABDDC6B" codebase="http://www.apple.com/qtactivex/qtplugin.cab" height="{height}" width="{width}"><param name="src" value="{path}"><param name="autoplay" value="{autoplay}"><param name="type" value="video/quicktime"><embed src="{path}" height="{height}" width="{width}" autoplay="{autoplay}" type="video/quicktime" pluginspage="http://www.apple.com/quicktime/download/"></embed></object>',iframe_markup:'<iframe src ="{path}" width="{width}" height="{height}" frameborder="no"></iframe>',inline_markup:'<div class="pp_inline">{content}</div>',custom_markup:""},d);var m=this,l=false,s,q,r,t,w,x,f=a(window).height(),A=a(window).width(),g;doresize=true,scroll_pos=y();a(window).unbind("resize.prettyphoto").bind("resize.prettyphoto",function(){p();v()});if(d.keyboard_shortcuts){a(document).unbind("keydown.prettyphoto").bind("keydown.prettyphoto",function(B){if(typeof $pp_pic_holder!="undefined"){if($pp_pic_holder.is(":visible")){switch(B.keyCode){case 37:a.prettyPhoto.changePage("previous");B.preventDefault();break;case 39:a.prettyPhoto.changePage("next");B.preventDefault();break;case 27:if(!settings.modal){a.prettyPhoto.close()}B.preventDefault();break}}}})}a.prettyPhoto.initialize=function(){settings=d;if(settings.theme=="pp_default"){settings.horizontal_padding=16}if(settings.ie6_fallback&&a.browser.msie&&parseInt(a.browser.version)==6){settings.theme="light_square"}theRel=a(this).attr("rel");galleryRegExp=/\[(?:.*)\]/;isSet=(galleryRegExp.exec(theRel))?true:false;pp_images=(isSet)?jQuery.map(m,function(C,B){if(a(C).attr("rel").indexOf(theRel)!=-1){return a(C).attr("href")}}):a.makeArray(a(this).attr("href"));pp_titles=(isSet)?jQuery.map(m,function(C,B){if(a(C).attr("rel").indexOf(theRel)!=-1){return(a(C).find("img").attr("alt"))?a(C).find("img").attr("alt"):""}}):a.makeArray(a(this).find("img").attr("alt"));pp_descriptions=(isSet)?jQuery.map(m,function(C,B){if(a(C).attr("rel").indexOf(theRel)!=-1){return(a(C).attr("title"))?a(C).attr("title"):""}}):a.makeArray(a(this).attr("title"));set_position=jQuery.inArray(a(this).attr("href"),pp_images);e(this);if(settings.allow_resize){a(window).bind("scroll.prettyphoto",function(){p()})}a.prettyPhoto.open();return false};a.prettyPhoto.open=function(B){if(typeof settings=="undefined"){settings=d;if(a.browser.msie&&a.browser.version==6){settings.theme="light_square"}pp_images=a.makeArray(arguments[0]);pp_titles=(arguments[1])?a.makeArray(arguments[1]):a.makeArray("");pp_descriptions=(arguments[2])?a.makeArray(arguments[2]):a.makeArray("");isSet=(pp_images.length>1)?true:false;set_position=0;e(B.target)}if(a.browser.msie&&a.browser.version==6){a("select").css("visibility","hidden")}if(settings.hideflash){a("object,embed").css("visibility","hidden")}j(a(pp_images).size());a(".pp_loaderIcon").show();if($ppt.is(":hidden")){$ppt.css("opacity",0).show()}$pp_overlay.show().fadeTo(settings.animation_speed,settings.opacity);$pp_pic_holder.find(".currentTextHolder").text((set_position+1)+settings.counter_separator_label+a(pp_images).size());$pp_pic_holder.find(".pp_description").show().html(unescape(pp_descriptions[set_position]));movie_width=(parseFloat(b("width",pp_images[set_position])))?b("width",pp_images[set_position]):settings.default_width.toString();movie_height=(parseFloat(b("height",pp_images[set_position])))?b("height",pp_images[set_position]):settings.default_height.toString();if(movie_height.indexOf("%")!=-1){movie_height=parseFloat((a(window).height()*parseFloat(movie_height)/100)-150);l=true}if(movie_width.indexOf("%")!=-1){movie_width=parseFloat((a(window).width()*parseFloat(movie_width)/100)-150);l=true}$pp_pic_holder.fadeIn(function(){(settings.show_title&&pp_titles[set_position]!=""&&typeof pp_titles[set_position]!="undefined")?$ppt.html(unescape(pp_titles[set_position])):$ppt.html("&nbsp;");imgPreloader="";skipInjection=false;switch(z(pp_images[set_position])){case"image":imgPreloader=new Image();nextImage=new Image();if(isSet&&set_position<a(pp_images).size()-1){nextImage.src=pp_images[set_position+1]}prevImage=new Image();if(isSet&&pp_images[set_position-1]){prevImage.src=pp_images[set_position-1]}$pp_pic_holder.find("#pp_full_res")[0].innerHTML=settings.image_markup.replace(/{path}/g,pp_images[set_position]);imgPreloader.onload=function(){s=o(imgPreloader.width,imgPreloader.height);h()};imgPreloader.onerror=function(){alert("Image cannot be loaded. Make sure the path is correct and image exist.");a.prettyPhoto.close()};imgPreloader.src=pp_images[set_position];break;case"youtube":s=o(movie_width,movie_height);movie="http://www.youtube.com/embed/"+b("v",pp_images[set_position]);if(settings.autoplay){movie+="?autoplay=1"}toInject=settings.iframe_markup.replace(/{width}/g,s["width"]).replace(/{height}/g,s["height"]).replace(/{wmode}/g,settings.wmode).replace(/{path}/g,movie);break;case"vimeo":s=o(movie_width,movie_height);movie_id=pp_images[set_position];var D=/http:\/\/(www\.)?vimeo.com\/(\d+)/;var C=movie_id.match(D);movie="http://player.vimeo.com/video/"+C[2]+"?title=0&amp;byline=0&amp;portrait=0";if(settings.autoplay){movie+="&autoplay=1;"}vimeo_width=s["width"]+"/embed/?moog_width="+s["width"];toInject=settings.iframe_markup.replace(/{width}/g,vimeo_width).replace(/{height}/g,s["height"]).replace(/{path}/g,movie);break;case"quicktime":s=o(movie_width,movie_height);s["height"]+=15;s["contentHeight"]+=15;s["containerHeight"]+=15;toInject=settings.quicktime_markup.replace(/{width}/g,s["width"]).replace(/{height}/g,s["height"]).replace(/{wmode}/g,settings.wmode).replace(/{path}/g,pp_images[set_position]).replace(/{autoplay}/g,settings.autoplay);break;case"flash":s=o(movie_width,movie_height);flash_vars=pp_images[set_position];flash_vars=flash_vars.substring(pp_images[set_position].indexOf("flashvars")+10,pp_images[set_position].length);filename=pp_images[set_position];filename=filename.substring(0,filename.indexOf("?"));toInject=settings.flash_markup.replace(/{width}/g,s["width"]).replace(/{height}/g,s["height"]).replace(/{wmode}/g,settings.wmode).replace(/{path}/g,filename+"?"+flash_vars);break;case"iframe":s=o(movie_width,movie_height);frame_url=pp_images[set_position];frame_url=frame_url.substr(0,frame_url.indexOf("iframe")-1);toInject=settings.iframe_markup.replace(/{width}/g,s["width"]).replace(/{height}/g,s["height"]).replace(/{path}/g,frame_url);break;case"ajax":doresize=false;s=o(movie_width,movie_height);doresize=true;skipInjection=true;a.get(pp_images[set_position],function(E){toInject=settings.inline_markup.replace(/{content}/g,E);$pp_pic_holder.find("#pp_full_res")[0].innerHTML=toInject;h()});break;case"custom":s=o(movie_width,movie_height);toInject=settings.custom_markup;break;case"inline":myClone=a(pp_images[set_position]).clone().append('<br clear="all" />').css({"width":settings.default_width}).wrapInner('<div id="pp_full_res"><div class="pp_inline"></div></div>').appendTo(a("body")).show();doresize=false;s=o(a(myClone).width(),a(myClone).height());doresize=true;a(myClone).remove();toInject=settings.inline_markup.replace(/{content}/g,a(pp_images[set_position]).html());break}if(!imgPreloader&&!skipInjection){$pp_pic_holder.find("#pp_full_res")[0].innerHTML=toInject;h()}});return false};a.prettyPhoto.changePage=function(B){currentGalleryPage=0;if(B=="previous"){set_position--;if(set_position<0){set_position=a(pp_images).size()-1}}else{if(B=="next"){set_position++;if(set_position>a(pp_images).size()-1){set_position=0}}else{set_position=B}}if(!doresize){doresize=true}a(".pp_contract").removeClass("pp_contract").addClass("pp_expand");n(function(){a.prettyPhoto.open()})};a.prettyPhoto.changeGalleryPage=function(B){if(B=="next"){currentGalleryPage++;if(currentGalleryPage>totalPage){currentGalleryPage=0}slide_speed=settings.animation_speed}else{if(B=="previous"){currentGalleryPage--;if(currentGalleryPage<0){currentGalleryPage=totalPage}slide_speed=settings.animation_speed}else{currentGalleryPage=B;slide_speed=0}}slide_to=currentGalleryPage*(itemsPerPage*itemWidth);itemsToSlide=(currentGalleryPage==totalPage)?pp_images.length-((totalPage)*itemsPerPage):itemsPerPage;$pp_gallery.find("ul").animate({left:-slide_to},slide_speed)};a.prettyPhoto.startSlideshow=function(){if(typeof g=="undefined"){$pp_pic_holder.find(".pp_play").unbind("click").removeClass("pp_play").addClass("pp_pause").click(function(){a.prettyPhoto.stopSlideshow();return false});g=setInterval(a.prettyPhoto.startSlideshow,settings.slideshow)}else{a.prettyPhoto.changePage("next")}};a.prettyPhoto.stopSlideshow=function(){$pp_pic_holder.find(".pp_pause").unbind("click").removeClass("pp_pause").addClass("pp_play").click(function(){a.prettyPhoto.startSlideshow();return false});clearInterval(g);g=undefined};a.prettyPhoto.close=function(){if($pp_overlay.is(":animated")){return}a.prettyPhoto.stopSlideshow();$pp_pic_holder.stop().find("object,embed").css("visibility","hidden");a("div.pp_pic_holder,div.ppt,.pp_fade").fadeOut(settings.animation_speed,function(){a(this).remove()});$pp_overlay.fadeOut(settings.animation_speed,function(){if(a.browser.msie&&a.browser.version==6){a("select").css("visibility","visible")}if(settings.hideflash){a("object,embed").css("visibility","visible")}a(this).remove();a(window).unbind("scroll.prettyphoto");settings.callback();doresize=true;q=false;delete settings})};function h(){a(".pp_loaderIcon").hide();$ppt.fadeTo(settings.animation_speed,1);projectedTop=scroll_pos["scrollTop"]+((f/2)-(s["containerHeight"]/2));if(projectedTop<0){projectedTop=0}$pp_pic_holder.find(".pp_content").animate({height:s["contentHeight"],width:s["contentWidth"]},settings.animation_speed);$pp_pic_holder.animate({"top":projectedTop,"left":(A/2)-(s["containerWidth"]/2),width:s["containerWidth"]},settings.animation_speed,function(){$pp_pic_holder.find(".pp_hoverContainer,#fullResImage").height(s["height"]).width(s["width"]);$pp_pic_holder.find(".pp_fade").fadeIn(settings.animation_speed);if(isSet&&z(pp_images[set_position])=="image"){$pp_pic_holder.find(".pp_hoverContainer").show()}else{$pp_pic_holder.find(".pp_hoverContainer").hide()}if(s["resized"]){a("a.pp_expand,a.pp_contract").show()}else{a("a.pp_expand").hide()}if(settings.autoplay_slideshow&&!g&&!q){a.prettyPhoto.startSlideshow()}settings.changepicturecallback();q=true});c()}function n(B){$pp_pic_holder.find("#pp_full_res object,#pp_full_res embed").css("visibility","hidden");$pp_pic_holder.find(".pp_fade").fadeOut(settings.animation_speed,function(){a(".pp_loaderIcon").show();B()})}function j(B){(B>1)?a(".pp_nav").show():a(".pp_nav").hide()}function o(C,B){resized=false;u(C,B);imageWidth=C,imageHeight=B;if(((x>A)||(w>f))&&doresize&&settings.allow_resize&&!l){resized=true,fitting=false;while(!fitting){if((x>A)){imageWidth=(A-200);imageHeight=(B/C)*imageWidth}else{if((w>f)){imageHeight=(f-200);imageWidth=(C/B)*imageHeight}else{fitting=true}}w=imageHeight,x=imageWidth}u(imageWidth,imageHeight);if((x>A)||(w>f)){o(x,w)}}return{width:Math.floor(imageWidth),height:Math.floor(imageHeight),containerHeight:Math.floor(w),containerWidth:Math.floor(x)+(settings.horizontal_padding*2),contentHeight:Math.floor(r),contentWidth:Math.floor(t),resized:resized}}function u(C,B){C=parseFloat(C);B=parseFloat(B);$pp_details=$pp_pic_holder.find(".pp_details");$pp_details.width(C);detailsHeight=parseFloat($pp_details.css("marginTop"))+parseFloat($pp_details.css("marginBottom"));$pp_details=$pp_details.clone().addClass(settings.theme).width(C).appendTo(a("body")).css({"position":"absolute","top":-10000});detailsHeight+=$pp_details.height();detailsHeight=(detailsHeight<=34)?36:detailsHeight;if(a.browser.msie&&a.browser.version==7){detailsHeight+=8}$pp_details.remove();$pp_title=$pp_pic_holder.find(".ppt");$pp_title.width(C);titleHeight=parseFloat($pp_title.css("marginTop"))+parseFloat($pp_title.css("marginBottom"));$pp_title=$pp_title.clone().appendTo(a("body")).css({"position":"absolute","top":-10000});titleHeight+=$pp_title.height();$pp_title.remove();r=B+detailsHeight;t=C;w=r+titleHeight+$pp_pic_holder.find(".pp_top").height()+$pp_pic_holder.find(".pp_bottom").height();x=C}function z(B){if(B.match(/youtube\.com\/watch/i)){return"youtube"}else{if(B.match(/vimeo\.com/i)){return"vimeo"}else{if(B.match(/\b.mov\b/i)){return"quicktime"}else{if(B.match(/\b.swf\b/i)){return"flash"}else{if(B.match(/\biframe=true\b/i)){return"iframe"}else{if(B.match(/\bajax=true\b/i)){return"ajax"}else{if(B.match(/\bcustom=true\b/i)){return"custom"}else{if(B.substr(0,1)=="#"){return"inline"}else{return"image"}}}}}}}}}function p(){if(doresize&&typeof $pp_pic_holder!="undefined"){scroll_pos=y();contentHeight=$pp_pic_holder.height(),contentwidth=$pp_pic_holder.width();projectedTop=(f/2)+scroll_pos["scrollTop"]-(contentHeight/2);if(projectedTop<0){projectedTop=0}if(contentHeight>f){return}$pp_pic_holder.css({"top":projectedTop,"left":(A/2)+scroll_pos["scrollLeft"]-(contentwidth/2)})}}function y(){if(self.pageYOffset){return{scrollTop:self.pageYOffset,scrollLeft:self.pageXOffset}}else{if(document.documentElement&&document.documentElement.scrollTop){return{scrollTop:document.documentElement.scrollTop,scrollLeft:document.documentElement.scrollLeft}}else{if(document.body){return{scrollTop:document.body.scrollTop,scrollLeft:document.body.scrollLeft}}}}}function v(){f=a(window).height(),A=a(window).width();if(typeof $pp_overlay!="undefined"){$pp_overlay.height(a(document).height()).width(A)}}function c(){if(isSet&&settings.overlay_gallery&&z(pp_images[set_position])=="image"&&(settings.ie6_fallback&&!(a.browser.msie&&parseInt(a.browser.version)==6))){itemWidth=52+5;navWidth=(settings.theme=="facebook"||settings.theme=="pp_default")?50:30;itemsPerPage=Math.floor((s["containerWidth"]-100-navWidth)/itemWidth);itemsPerPage=(itemsPerPage<pp_images.length)?itemsPerPage:pp_images.length;totalPage=Math.ceil(pp_images.length/itemsPerPage)-1;if(totalPage==0){navWidth=0;$pp_gallery.find(".pp_arrow_next,.pp_arrow_previous").hide()}else{$pp_gallery.find(".pp_arrow_next,.pp_arrow_previous").show()}galleryWidth=itemsPerPage*itemWidth;fullGalleryWidth=pp_images.length*itemWidth;$pp_gallery.css("margin-left",-((galleryWidth/2)+(navWidth/2))).find("div:first").width(galleryWidth+5).find("ul").width(fullGalleryWidth).find("li.selected").removeClass("selected");goToPage=(Math.floor(set_position/itemsPerPage)<totalPage)?Math.floor(set_position/itemsPerPage):totalPage;a.prettyPhoto.changeGalleryPage(goToPage);$pp_gallery_li.filter(":eq("+set_position+")").addClass("selected")}else{$pp_pic_holder.find(".pp_content").unbind("mouseenter mouseleave")}}function e(B){a("body").append(settings.markup);$pp_pic_holder=a(".pp_pic_holder"),$ppt=a(".ppt"),$pp_overlay=a("div.pp_overlay");if(isSet&&settings.overlay_gallery){currentGalleryPage=0;toInject="";for(var C=0;C<pp_images.length;C++){if(!pp_images[C].match(/\b(jpg|jpeg|png|gif)\b/gi)){classname="default";img_src=""}else{classname="";img_src=pp_images[C]}toInject+="<li class='"+classname+"'><a href='#'><img src='"+img_src+"' width='50' alt='' /></a></li>"}toInject=settings.gallery_markup.replace(/{gallery}/g,toInject);$pp_pic_holder.find("#pp_full_res").after(toInject);$pp_gallery=a(".pp_pic_holder .pp_gallery"),$pp_gallery_li=$pp_gallery.find("li");$pp_gallery.find(".pp_arrow_next").click(function(){a.prettyPhoto.changeGalleryPage("next");a.prettyPhoto.stopSlideshow();return false});$pp_gallery.find(".pp_arrow_previous").click(function(){a.prettyPhoto.changeGalleryPage("previous");a.prettyPhoto.stopSlideshow();return false});$pp_pic_holder.find(".pp_content").hover(function(){$pp_pic_holder.find(".pp_gallery:not(.disabled)").fadeIn()},function(){$pp_pic_holder.find(".pp_gallery:not(.disabled)").fadeOut()});itemWidth=52+5;$pp_gallery_li.each(function(D){a(this).find("a").click(function(){a.prettyPhoto.changePage(D);a.prettyPhoto.stopSlideshow();return false})})}if(settings.slideshow){$pp_pic_holder.find(".pp_nav").prepend('<a href="#" class="pp_play">Play</a>');$pp_pic_holder.find(".pp_nav .pp_play").click(function(){a.prettyPhoto.startSlideshow();return false})}$pp_pic_holder.attr("class","pp_pic_holder "+settings.theme);$pp_overlay.css({"opacity":0,"height":a(document).height(),"width":a(window).width()}).bind("click",function(){if(!settings.modal){a.prettyPhoto.close()}});a("a.pp_close").bind("click",function(){a.prettyPhoto.close();return false});a("a.pp_expand").bind("click",function(D){if(a(this).hasClass("pp_expand")){a(this).removeClass("pp_expand").addClass("pp_contract");doresize=false}else{a(this).removeClass("pp_contract").addClass("pp_expand");doresize=true}n(function(){a.prettyPhoto.open()});return false});$pp_pic_holder.find(".pp_previous, .pp_nav .pp_arrow_previous").bind("click",function(){a.prettyPhoto.changePage("previous");a.prettyPhoto.stopSlideshow();return false});$pp_pic_holder.find(".pp_next, .pp_nav .pp_arrow_next").bind("click",function(){a.prettyPhoto.changePage("next");a.prettyPhoto.stopSlideshow();return false});p()}return this.unbind("click.prettyphoto").bind("click.prettyphoto",a.prettyPhoto.initialize)};function b(e,d){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c="[\\?&]"+e+"=([^&#]*)";var g=new RegExp(c);var f=g.exec(d);return(f==null)?"":f[1]}})(jQuery);afStudio.TemplateSelector=Ext.extend(Ext.Window,{dataview:null,initComponent:function(){this.initDataview();var a={title:"Template Selector",width:463,height:250,closable:true,draggable:true,modal:true,resizable:false,bodyBorder:false,border:false,layout:"fit",items:this.dataview,buttons:[{text:"Set Template",handler:this.customize,scope:this,id:this.id+"-customize-btn",disabled:true},{text:"Cancel",handler:this.cancel,scope:this}],buttonAlign:"center",listeners:{show:function(){for(var b in this.dataview.store.data.items){if(this.dataview.store.data.items[b].json&&afTemplateConfig.template.current==this.dataview.store.data.items[b].json[1].toLowerCase()){this.dataview.selectRange(b,b)}}}}};Ext.apply(this,Ext.apply(this.initialConfig,a));afStudio.TemplateSelector.superclass.initComponent.apply(this,arguments)},initDataview:function(){var a=this;var c=[["desktoptemplate","Desktop","template_desktop.png"],["viewporttemplate","Viewport","template_viewport.png"]];var b=new Ext.data.SimpleStore({fields:[{name:"id"},{name:"name"},{name:"img"}],sortInfo:{field:"name",direction:"ASC"}});b.loadData(c);this.dataview=new Ext.DataView({itemSelector:"div.thumb-wrap",style:"overflow:auto",multiSelect:true,listeners:{"selectionchange":function(d,f){var e=Ext.getCmp(this.id+"-customize-btn");if(f.length){e.enable()}else{e.disable()}},"dblclick":function(d,f,g,h){a.customize();a.close()},scope:this},store:b,tpl:new Ext.XTemplate('<tpl for=".">','<div class="thumb-wrap" id="{id}">','<div class="thumb"><img src="appFlowerStudioPlugin/images/{img}"></div>',"<span>{name}</span></div>","</tpl>")})},customize:function(){var a=this;if(this.dataview.getSelectedIndexes()){var b=this.dataview.getSelectedRecords()[0].get("name");Ext.Ajax.request({url:window.afStudioWSUrls.getTemplateSelectorUrl(),method:"post",params:{cmd:"update",template:b},callback:function(d,e,c){c=Ext.decode(c.responseText);if(!c.success){afStudio.Msg.error(c.message)}else{afTemplateConfig.template.current=b.toLowerCase();afStudio.Msg.info(c.message);a.close()}}})}},cancel:function(){this.close()}});afStudio.TemplateDesigner=Ext.extend(Ext.Window,{dataview:null,initComponent:function(){this.initDataview();var a={title:"Template Designer",width:463,height:250,closable:true,draggable:true,modal:true,resizable:false,bodyBorder:false,border:false,layout:"fit",items:this.dataview,buttons:[{text:"Customize",handler:this.customize,scope:this,id:this.id+"-customize-btn",disabled:true},{text:"Cancel",handler:this.cancel,scope:this}],buttonAlign:"center"};Ext.apply(this,Ext.apply(this.initialConfig,a));afStudio.TemplateSelector.superclass.initComponent.apply(this,arguments)},initDataview:function(){var a=this;var c=afTemplateConfig.template.helpers[afTemplateConfig.template.current];var b=new Ext.data.SimpleStore({fields:[{name:"id"},{name:"name"},{name:"img"},{name:"editor"}]});b.loadData(c);this.dataview=new Ext.DataView({itemSelector:"div.thumb-wrap",style:"overflow:auto",multiSelect:true,listeners:{"selectionchange":function(d,f){var e=Ext.getCmp(this.id+"-customize-btn");if(f.length){e.enable()}else{e.disable()}},"dblclick":function(d,f,g,h){a.customize();a.close()},scope:this},store:b,tpl:new Ext.XTemplate('<tpl for=".">','<div class="thumb-wrap" id="{id}">','<div class="thumb"><img src="appFlowerStudioPlugin/images/{img}"></div>',"<span>{name}</span></div>","</tpl>")})},customize:function(){if(this.dataview.getSelectedIndexes()){var id=this.dataview.getSelectedRecords()[0].get("id");var name=this.dataview.getSelectedRecords()[0].get("name");var editor=this.dataview.getSelectedRecords()[0].get("editor");if(editor!=""){eval("new "+editor+"({helper: '"+id+"',title:'"+name+"'}).show()")}else{afStudio.Msg.error("There is not javascript Editor set for this button.")}this.close()}},cancel:function(){this.close()}});afStudio.BaseEditor=Ext.extend(Ext.Window,{initComponent:function(){this.checkHelperFileExist();this.createRegions();var a={width:813,height:550,closable:true,draggable:true,modal:true,resizable:false,bodyBorder:false,border:false,layout:"border",items:[this.centerPanel],buttons:[{text:"Cancel",handler:this.cancel,scope:this}],buttonAlign:"center"};Ext.apply(this,Ext.apply(this.initialConfig,a));afStudio.BaseEditor.superclass.initComponent.apply(this,arguments)},createRegions:function(){this.codeEditor=new Ext.ux.CodePress({delayedStart:false,closable:true,file:"root/apps/frontend/lib/helper/"+this.helper+"Helper.php",language:"php"});this.centerPanel=new Ext.Panel({layout:"fit",region:"center",items:[this.codeEditor],tbar:[{text:"Save",iconCls:"icon-save",handler:this.save,scope:this},"->",{text:"Template Designer",iconCls:"icon-run-run",handler:this.tdshortcut,scope:this}]})},save:function(){Ext.Ajax.request({url:window.afStudioWSUrls.getHelperFileSaveUrl(),params:{helper:this.helper},xmlData:this.codeEditor.getValue(),success:function(a,b){var c=Ext.decode(a.responseText);afStudio.Msg.info(c.message)}})},checkHelperFileExist:function(){Ext.Ajax.request({url:window.afStudioWSUrls.getCheckHelperFileExistUrl(),params:{helper:this.helper},failure:function(a,b){var c=Ext.decode(a.responseText);afStudio.Msg.error(a.responseText)}})},cancel:function(){this.close()},tdshortcut:function(){this.close();(new afStudio.TemplateDesigner()).show()}});afStudio.CssEditor=Ext.extend(Ext.Window,{initComponent:function(){this.createRegions();var a={title:"CSS Editor",width:813,height:550,closable:true,draggable:true,modal:true,resizable:false,bodyBorder:false,border:false,layout:"border",items:[this.westPanel,this.centerPanel],buttons:[{text:"Cancel",handler:this.cancel,scope:this}],buttonAlign:"center"};Ext.apply(this,Ext.apply(this.initialConfig,a));afStudio.CssEditor.superclass.initComponent.apply(this,arguments)},createRegions:function(){this.loader=new Ext.tree.TreeLoader({dataUrl:window.afStudioWSUrls.getCssFilestreeUrl()});this.westPanel=new Ext.ux.FileTreePanel({split:true,title:"Files",iconCls:"icon-models",region:"west",url:window.afStudioWSUrls.getFiletreeUrl(),width:220,rootPath:"root/plugins/appFlowerStudioPlugin/web/css",path:"pluigns",rootVisible:true,rootText:"CSS",newfileText:"file.css",maxFileSize:524288*2*10,topMenu:false,autoScroll:true,enableProgress:false,singleUpload:true,listeners:{click:function(a,b){if(a.leaf){this.codeEditor.loadFile("appFlowerStudioPlugin/css/"+a.text)}},scope:this}});this.loader.on({beforeload:function(a,b,c){(function(){b.getOwnerTree().body.mask("Loading, please Wait...","x-mask-loading")}).defer(100)},load:function(a,b,c){b.getOwnerTree().body.unmask()},loadexception:function(a,b,c){b.getOwnerTree().body.unmask()}});this.codeEditor=new Ext.ux.CodePress({delayedStart:true,closable:true,title:"Code editor - actions.class.php",path:"appFlowerStudioPlugin/desktop.html",tabTip:"appFlowerStudioPlugin/desktop.html",file:"appFlowerStudioPlugin/desktop.html"});this.centerPanel=new Ext.Panel({layout:"fit",region:"center",items:[this.codeEditor],tbar:[{text:"Save",iconCls:"icon-save",handler:this.save,scope:this},"->",{text:"Template Designer",iconCls:"icon-run-run",handler:this.tdshortcut,scope:this}]})},save:function(){Ext.Ajax.request({url:window.afStudioWSUrls.getCssFilesSaveUrl(),params:{node:this.westPanel.getSelectionModel().getSelectedNode().text},xmlData:this.codeEditor.getValue(),success:function(a,b){var c=Ext.decode(a.responseText);afStudio.Msg.info(c.message)}})},cancel:function(){this.close()},tdshortcut:function(){this.close();(new afStudio.TemplateDesigner()).show()}});