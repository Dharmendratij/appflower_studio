Ext.lib.Ajax.isCrossDomain=function(b){var a=/(?:(\w*:)\/\/)?([\w\.]*(?::\d*)?)/.exec(b);if(!a[1]){return false}return(a[1]!=location.protocol)||(a[2]!=location.host)};Ext.override(Ext.data.Connection,{request:function(e){var h=this;if(h.fireEvent("beforerequest",h,e)){if(e.el){if(!Ext.isEmpty(e.indicatorText)){h.indicatorText='<div class="loading-indicator">'+e.indicatorText+"</div>"}if(h.indicatorText){Ext.getDom(e.el).innerHTML=h.indicatorText}e.success=(Ext.isFunction(e.success)?e.success:function(){}).createInterceptor(function(m){Ext.getDom(e.el).innerHTML=m.responseText})}var c=e.params,b=e.url||h.url,a,f={success:h.handleResponse,failure:h.handleFailure,scope:h,argument:{options:e},timeout:Ext.num(e.timeout,h.timeout)},d,l;if(Ext.isFunction(c)){c=c.call(e.scope||WINDOW,e)}c=Ext.urlEncode(h.extraParams,Ext.isObject(c)?Ext.urlEncode(c):c);if(Ext.isFunction(b)){b=b.call(e.scope||WINDOW,e)}if((d=Ext.getDom(e.form))){b=b||d.action;if(e.isUpload||(/multipart\/form-data/i.test(d.getAttribute("enctype")))){return h.doFormUpload.call(h,e,c,b)}l=Ext.lib.Ajax.serializeForm(d);c=c?(c+"&"+l):l}a=e.method||h.method||((c||e.xmlData||e.jsonData)?"POST":"GET");if(a==="GET"&&(h.disableCaching&&e.disableCaching!==false)||e.disableCaching===true){var g=e.disableCachingParam||h.disableCachingParam;b=Ext.urlAppend(b,g+"="+(new Date().getTime()))}e.headers=Ext.apply(e.headers||{},h.defaultHeaders||{});if(e.autoAbort===true||h.autoAbort){h.abort()}if((a=="GET"||e.xmlData||e.jsonData)&&c){b=Ext.urlAppend(b,c);c=""}if(e.scriptTag||this.scriptTag||Ext.lib.Ajax.isCrossDomain(b)){h.transId=this.scriptRequest(a,b,f,c,e)}else{h.transId=Ext.lib.Ajax.request(a,b,f,c,e)}return h.transId}else{return e.callback?e.callback.apply(e.scope,[e,undefined,undefined]):null}},scriptRequest:function(a,c,e,f,l){var b=++Ext.data.ScriptTagProxy.TRANS_ID;var h={id:b,cb:l.callbackName||"stcCallback"+b,scriptId:"stcScript"+b,options:l};c+=(c.indexOf("?")!=-1?"&":"?")+f+String.format("&{0}={1}",l.callbackParam||this.callbackParam||"callback",h.cb);var d=this;window[h.cb]=function(m){d.handleScriptResponse(m,h)};h.timeoutId=this.handleScriptFailure.defer(e.timeout,this,[h]);var g=document.createElement("script");g.setAttribute("src",c);g.setAttribute("type","text/javascript");g.setAttribute("id",h.scriptId);document.getElementsByTagName("head")[0].appendChild(g);return h},handleScriptResponse:function(d,b){this.transId=false;this.destroyScriptTrans(b,true);var a=b.options;var c;if(typeof d=="string"){if(window.ActiveXObject){c=new ActiveXObject("Microsoft.XMLDOM");c.async="false";c.loadXML(d)}else{c=new DOMParser().parseFromString(d,"text/xml")}}response={responseObject:d,responseText:(typeof d=="object")?Ext.util.JSON.encode(d):String(d),responseXML:c,argument:a.argument};this.fireEvent("requestcomplete",this,response,a);Ext.callback(a.success,a.scope,[response,a]);Ext.callback(a.callback,a.scope,[a,true,response])},handleScriptFailure:function(b){this.transId=false;this.destroyScriptTrans(b,false);var a=b.options;response={argument:a.argument,status:500,statusText:"Server failed to respond",responseText:""};this.fireEvent("requestexception",this,response,a,{status:-1,statusText:"communication failure"});Ext.callback(a.failure,a.scope,[response,a]);Ext.callback(a.callback,a.scope,[a,false,response])},destroyScriptTrans:function(b,a){document.getElementsByTagName("head")[0].removeChild(document.getElementById(b.scriptId));clearTimeout(b.timeoutId);if(a){window[b.cb]=undefined;try{delete window[b.cb]}catch(c){}}else{window[b.cb]=function(){window[b.cb]=undefined;try{delete window[b.cb]}catch(d){}}}}});Ext.ns("afApp");function strstr(b,c,a){var d=0;b+="";d=b.indexOf(c);if(d==-1){return false}else{if(a){return b.substr(0,d)}else{return b.slice(d)}return true}}function in_array(e,d,c){var b="",a=!!c;if(a){for(b in d){if(strstr(d[b],e)){return true}}}else{for(b in d){if(strstr(d[b],e)){return true}}}return false}String.prototype.ucfirst=function(){return this.substr(0,1).toUpperCase()+this.substr(1)};Array.prototype.in_array=function(e,c){var b="",a=!!c,d=this;if(a){for(b in d){if(d[b]===e){return true}}}else{for(b in d){if(d[b]==e){return true}}}return false};afApp.createAddon=function(a,b,e){if(a.indexOf("http://")!=-1){a=afApp.urlPrefix+a}if(!b){var c=a.split(".");b=c[c.length-1]}if(b=="js"){var d=document.createElement("script");d.setAttribute("type","text/javascript");d.setAttribute("src",a);GLOBAL_JS_VAR.push(a)}else{if(b=="css"){var d=document.createElement("link");d.setAttribute("rel","stylesheet");d.setAttribute("type","text/css");d.setAttribute("href",a);GLOBAL_CSS_VAR.push(a)}}if(typeof d!="undefined"){document.getElementsByTagName("head")[0].appendChild(d)}if(b=="js"){d.onload=d.onreadystatechange=function(){if(!this.readyState||this.readyState=="loaded"||this.readyState=="complete"){e()}}}else{if(b=="css"){e()}}};afApp.hasDesktop=function(){var a=false;try{if(App&&App.desktop){a=true}}catch(b){a=false}return a};afApp.windows=new Ext.WindowGroup();afApp.activeWindow;afApp.minimizeWin=function(a){a.minimized=true;a.hide()};afApp.markActive=function(b){var a=b.id;if(afApp.activeWindow&&afApp.activeWindow!=b){afApp.markInactive(afApp.activeWindow)}if(afApp.hasDesktop()){App.desktop.taskbar.setActiveButton(b.taskButton);Ext.fly(b.taskButton.el).addClass("active-win");if(Ext.History.getToken()!=a){Ext.History.add(a)}}afApp.activeWindow=b;b.minimized=false};afApp.markInactive=function(b,a){if(b==afApp.activeWindow){afApp.activeWindow=null;if(afApp.hasDesktop()){Ext.fly(b.taskButton.el).removeClass("active-win")}}};afApp.removeWin=function(a){if(afApp.hasDesktop()){App.desktop.taskbar.removeTaskButton(a.taskButton);afApp.layout()}};afApp.layout=function(){if(afApp.hasDesktop()){var a=Ext.get("x-desktop");var b=Ext.get("ux-taskbar");a.setHeight(Ext.lib.Dom.getViewHeight()-b.getHeight())}};afApp.getWindow=function(a){return afApp.windows.get(a)};afApp.pack=function(f,b,c){var b=b||{};c=c?c:App;var a;try{a=c.getViewport()}catch(d){a=Ext.get("body")}f.on("show",function(o){if(b.applyTo){return}var m=o.findBy(function(r,q){return true});if(m&&m[0]){var n=m[0];var h=a.getBox().width;var l=a.getBox().height;var g=n.getBox().width+35;var e=n.getBox().height+35;g=g>h?(0.7*h):g;e=e>l?(0.7*l):e;o.setSize(g,e);o.center()}var p=o.getPosition();if(p[1]<0){o.setPosition(p[0],0)}o.on("move",function(r,q,s){if(s<0){r.setPosition(q,0)}if(q<100-r.getWidth()){r.setPosition(100-r.getWidth(),s)}if(q>Ext.getBody().getWidth()-100){r.setPosition(Ext.getBody().getWidth()-100,s)}if(s>Ext.getBody().getHeight()-100){r.setPosition(q,Ext.getBody().getHeight()-100)}})})};afApp.executeAddons=function(addons,json,title,superClass,winConfig,Application,widget){Application=Application?Application:App;var maskEl;try{var viewport=Application.getViewport();maskEl=viewport.layout.center.panel.getEl()}catch(e){maskEl=Ext.get("body")}var counter=0;var backup=new Array();var finish;var load=function(){if(counter>=addons.length){finish();return}afApp.loadingProgress(maskEl,(counter+1)/addons.length);var nextAddon=addons[counter++];afApp.createAddon(nextAddon,false,load)};finish=function(){eval(json.source);var backendWinConfig=eval(json.winConfig);var center_panel=(function(){return eval(json.center_panel)})();Ext.apply(center_panel,{frame:winConfig.applyTo?false:true,width:"auto",layout:"form"});Ext.applyIf(winConfig,{id:widget,autoScroll:true,minimizable:true,maximizable:true,draggable:true,closeAction:"hide",manager:afApp.windows,items:center_panel});Ext.apply(winConfig,backendWinConfig);if(winConfig.applyTo){winConfig=Ext.apply(winConfig,{frame:false});var win=new Ext.Panel(winConfig)}else{var win=new Ext.Window(winConfig)}if(title){win.setTitle(title)}if(win.resizer){win.resizer.widthIncrement=1;win.resizer.heightIncrement=1}if(afApp.hasDesktop()){win.taskButton=Application.desktop.taskbar.addTaskButton(win);win.animateTarget=win.taskButton.el}win.on({"activate":{fn:afApp.markActive},"beforeshow":{fn:afApp.markActive},"deactivate":{fn:afApp.markInactive},"minimize":{fn:afApp.minimizeWin},"close":{fn:afApp.removeWin},"resize":{fn:function(){}}});if(win.doLayout){win.doLayout()}if(win.show){win.show()}afApp.pack(win,winConfig,Application);if(win.doLayout){win.doLayout()}if(win.show){win.show()}if(win.center){win.center()}win.on("render",function(win){eval(json.public_source)},null,{single:true});afApp.loadingProgress(maskEl,1);win.on("hide",function(){if(superClass){superClass.onHide(win)}})};load()};afApp.widgetPopup=function(widget,title,superClass,winConfig,Application){Application=Application?Application:App;var maskEl;try{var viewport=Application.getViewport();maskEl=viewport.layout.center.panel.getEl()}catch(e){maskEl=Ext.get("body")}if(!winConfig){var winConfig={};winConfig.width=800;winConfig.height=500}else{winConfig=eval("({"+unescape(winConfig)+"});");winConfig.width=winConfig.width?winConfig.width:800;winConfig.height=winConfig.height?winConfig.height:500}var getWidgetText=function(widget){if(widget.length>45){return widget.substring(0,20)+"...."+widget.substring(widget.length-20,widget.length)}return widget};widget=widget.replace(document.location.protocol+"//"+document.location.host+afApp.urlPrefix,"");var uri=widget.split("#");uri[0]=uri[0]||"/";var futureTab=uri[1]?"#"+uri[1]:"";var futureHash=uri[0]+futureTab;afApp.currentWidget=uri[0];afApp.observable.fireEvent("beforeload",uri[0]);var win=afApp.getWindow(widget);if(win){win.show()}else{afApp.initLoadingProgress(maskEl);var ajax=Ext.Ajax.request({url:afApp.urlPrefix+uri[0],method:"GET",success:function(r){var json=Ext.util.JSON.decode(r.responseText);if(json.redirect&&json.message&&json.load){Ext.Msg.alert("Failure",json.message,function(){afApp.load(json.redirect,json.load)})}else{var total_addons=new Array();if(json.addons&&json.addons.js){for(var i=0;i<json.addons.js.length;i++){var addon=json.addons.js[i];if(!in_array(addon,GLOBAL_JS_VAR)){if(addon!=null){total_addons.push(addon)}}}}if(json.addons&&json.addons.css){for(var i=0;i<json.addons.css.length;i++){var addon=json.addons.css[i];if(!in_array(addon,GLOBAL_CSS_VAR)){if(addon!=null){total_addons.push(addon)}}}}Ext.Ajax.extraParams=Ext.Ajax.extraParams||{};Ext.Ajax.extraParams["af_referer"]=futureHash;afApp.executeAddons(total_addons,json,title,superClass,winConfig,Application,widget)}},params:{widget_popup_request:true}})}};afApp.attachHrefWidgetLoad=(function(){var a=function(d){d.stopEvent();var c=Ext.get(d.getTarget());var b=c.dom.href||c.dom.parentNode.href;afApp.load(b)};return function(){var b=Ext.select("a.widgetLoad");b.un("click",a);b.on("click",a)}})();afApp.initLoadingProgress=function(c){c.mask();var a=Ext.getCmp("progress-bar");var b=Ext.get("progress-bar-el");if(!b){b=Ext.DomHelper.append(c,{tag:"div",id:"progress-bar-el",style:"z-index:1000;position:absolute;top:40%;left:40%;width:20%"})}else{b=Ext.get("progress-bar-el")}if(!a){a=new Ext.ProgressBar({id:"progress-bar",text:"Loading.... Please wait....."});a.render(b)}else{a.updateProgress(0,"Loading.... Please wait.....");a.show()}};afApp.loadingProgress=function(b,c){var a=Ext.getCmp("progress-bar");a.updateProgress(c,Math.ceil(c*100)+"% complete...");if(!a.isVisible()){a.show()}if(c>=1){b.unmask();setTimeout(function(){a.hide()},500)}};afApp.executeAddonsLoadCenterWidget=function(viewport,addons,json){var pb;var counter=0;var finish;var load=function(){if(counter>=addons.length){finish();return}if(!Ext.getCmp("progress-bar")){pb=new Ext.ProgressBar()}else{pb=Ext.getCmp("progress-bar")}afApp.loadingProgress(viewport.layout.center.panel.getEl(),(counter+1)/addons.length);var nextAddon=addons[counter++];afApp.createAddon(nextAddon,false,load)};finish=function(){eval(json.source);var panel=viewport.layout.center.panel;panel.add(eval(json.center_panel_first));var divs=Ext.query("div[id=center_panel_first]");if(divs[0]){Ext.fly(divs[0]).remove()}panel.doLayout();afApp.loadingProgress(viewport.layout.center.panel.getEl(),1)};load()};afApp.loadCenterWidget=function(widget){widget=widget.replace(document.location.protocol+"//"+document.location.host+afApp.urlPrefix,"");var uri=widget.split("#");uri[0]=uri[0]||"/";var futureTab=uri[1]?"#"+uri[1]:"";var futureHash=uri[0]+futureTab;afApp.currentWidget=uri[0];afApp.observable.fireEvent("beforeload",uri[0]);var viewport=App.getViewport();afApp.initLoadingProgress(viewport.layout.center.panel.getEl());var ajax=Ext.Ajax.request({url:afApp.urlPrefix+uri[0],method:"GET",success:function(r){var json=Ext.util.JSON.decode(r.responseText);json.load=json.load?json.load:"center";json.title=json.title?json.title:"...";if(json.success===false){Ext.Msg.alert("Failure",json.message);return}if(json.redirect){afApp.loadingProgress(viewport.layout.center.panel.getEl(),1);if(json.message){Ext.Msg.alert(json.title,json.message,function(){afApp.load(json.redirect,json.load)})}else{afApp.load(json.redirect,json.load)}}else{var total_addons=new Array();if(json.addons&&json.addons.js){for(var i=0;i<json.addons.js.length;i++){var addon=json.addons.js[i];if(!in_array(addon,GLOBAL_JS_VAR)){if(addon!=null){total_addons.push(addon)}}}}if(json.addons&&json.addons.css){for(var i=0;i<json.addons.css.length;i++){var addon=json.addons.css[i];if(!in_array(addon,GLOBAL_CSS_VAR)){if(addon!=null){total_addons.push(addon)}}}}Ext.Ajax.extraParams=Ext.Ajax.extraParams||{};Ext.Ajax.extraParams["af_referer"]=futureHash;afApp.executeAddonsLoadCenterWidget(viewport,total_addons,json)}if(json.executeAfter){eval(json.executeAfter)}},failure:function(response){var msg="Unable to load the content: "+response.status+" "+response.statusText;Ext.Msg.alert("Failure",msg)},params:{widget_load:true}})};afApp.logTime=function(l){var c=new Date();var b=c.getDate();var g=c.getMonth();var f=c.getFullYear();var e=c.getHours();var a=c.getMinutes();var d=c.getSeconds();if(console){console.log("[",l,"]",b,"/",g,"/",f," ",e,":",a,":",d," | ",c.getTime())}};afApp.reloadGridsData=function(g){var a=new Array();var l=Ext.getCmp("center_panel_first_portal");if(l){if(l.layoutType=="NORMAL"){a[0]=l}else{if(l.layoutType=="TABBED"){for(var d=0;d<l.items.items.length;d++){a[d]=l.items.items[d].items.items[0]}}}for(var d=0;d<a.length;d++){var b;for(var h=0;h<a[d].items.getCount();h++){b=a[d].items.get(h);if(b.items){for(var e=0;e<b.items.getCount();e++){var f=b.items.get(e);if(g.in_array(f.idxml)&&f.getEl()&&f.getXType().toLowerCase().indexOf("grid")!=-1){f.store.reload()}}}}}}};afApp.load=function(a,b,c,d){if(a=="/false"||!a){return false}b=b||"center";c=c||"_self";d=d||null;if(d&&d.isPopup&&!d.forceRedirect){return false}if(c!="_self"){b="page"}if(a!=""){switch(b){case"page":window.open(a,c,d);break;case"center":a=a.replace(document.location.protocol+"//"+document.location.host,"");if(Ext.History.getToken()!=a){Ext.History.add(a)}else{if(!afApp.hasDesktop()){afApp.loadCenterWidget(a)}else{afApp.widgetPopup(a)}}break}}};afApp.loadPopupHelp=function(d){var a=App.getViewport();var b=new Ext.LoadMask(a.layout.center.panel.getEl(),{msg:"<b>Loading help</b> <br>Please Wait...",removeMask:true});b.show();var c=Ext.Ajax.request({url:afApp.urlPrefix+"/appFlower/popupHelp?idXml="+d,method:"GET",success:function(f){var e=Ext.util.JSON.decode(f.responseText);if(e.redirect&&e.message){b.hide();Ext.Msg.alert("Failure",e.message,function(){window.location.href=e.redirect})}else{Ext.applyIf(e.winConfig,{autoScroll:true,maximizable:true,draggable:true,closeAction:"hide",html:e.html});var g=new Ext.Window(e.winConfig);g.on("show",function(h){var l=h.getPosition();if(l[1]<0){h.setPosition(l[0],0)}});g.doLayout();g.show();g.on("move",function(l,h,m){if(m<0){l.setPosition(h,0)}if(h<100-l.getWidth()){l.setPosition(100-l.getWidth(),m)}if(h>Ext.getBody().getWidth()-100){l.setPosition(Ext.getBody().getWidth()-100,m)}if(m>Ext.getBody().getHeight()-100){l.setPosition(h,Ext.getBody().getHeight()-100)}});b.hide()}}})};afApp.changeTabHash=function(a){var b=document.location.href.split("#");b[1]=b[1]||"/";b[2]=a.slug;var c=b[1]+"#"+b[2];if(Ext.History.getToken()!=c){Ext.History.add(c)}Ext.Ajax.extraParams=Ext.Ajax.extraParams||{};Ext.Ajax.extraParams["af_referer"]=c};afApp.loadFirst=function(b){b=b||false;var e=document.location.href.split("#");e[1]=e[1]||"/";e[2]=e[2]?"#"+e[2]:"";var d=e[1]+e[2];if(!b){var f=App.getNorth();var c=App.getToolbar();f.add(c);f.doLayout();afApp.loadCenterWidget(d)}else{afApp.widgetPopup(d)}if(Boolean(window.console&&window.console.firebug)){var a={title:"Firebug is on :(",message:'If you would like to have a better experience with our products, please disable <b style="color:red;">Firebug</b>. You can do this using this shortcut: <b>SHIFT+F12</b>.<br><br>Thank you,<br>AppFlower Team',type:"ERROR",duration:20};if(b){a.heightPlus=30}new Ext.ux.InstantNotification(a)}};Ext.onReady(function(){afApp.attachHrefWidgetLoad()});Ext.History.on("change",function(b){if(b){var c=b.split("#");if(!afApp.hasDesktop()){if(afApp.currentWidget!=c[0]){afApp.loadCenterWidget(b)}else{if(c[1]){var a=App.getViewport();var d=a.layout.center.panel.items.items[0].items.items[0];if(d.getXType()=="tabpanel"){new Portals().onTabChange(d,c)}}}}else{if(afApp.currentWidget!=c[0]){afApp.widgetPopup(b)}}}});afApp.loadWestWidget=function(b){var d=App.getViewport();var f=d.layout.west.items;var c=d.layout.west.panel.items.items;for(var a=0;a<f.length;a++){if(f[a].id==b){var h=f[a];var e=c[a];if(h.loadClass&&h.loadMethod){var l=new Ext.LoadMask(e.getEl(),{msg:"<b>Loading</b> <br>Please Wait...",removeMask:true});l.show();var g=Ext.Ajax.request({url:afApp.urlPrefix+"/appFlower/loadWestContent",method:"POST",success:function(n){var m=Ext.util.JSON.decode(n.responseText);if(m.title){e.setTitle(m.title)}if(m.html){e.body.dom.innerHTML=m.html}l.hide()},params:{loadClass:h.loadClass,loadMethod:h.loadMethod}})}}}};afApp.currentWidget=false;afApp.observable=new Ext.util.Observable();Ext.override(Ext.layout.BorderLayout,{southTitleAdded:false,onLayout:function(d,L){var f;if(!this.rendered){L.position();L.addClass("x-border-layout-ct");var A=d.items.items;f=[];for(var E=0,F=A.length;E<F;E++){var I=A[E];var o=I.region;if(I.collapsed){f.push(I)}I.collapsed=false;if(!I.rendered){I.cls=I.cls?I.cls+" x-border-panel":"x-border-panel";I.render(L,E)}this[o]=o!="center"&&I.split?new Ext.layout.BorderLayout.SplitRegion(this,I.initialConfig,o):new Ext.layout.BorderLayout.Region(this,I.initialConfig,o);this[o].render(L,I)}this.rendered=true}var z=L.getViewSize();if(z.width<20||z.height<20){if(f){this.restoreCollapsed=f}return}else{if(this.restoreCollapsed){f=this.restoreCollapsed;delete this.restoreCollapsed}}var u=z.width,G=z.height;var r=u,D=G,p=0,q=0;var B=this.north,x=this.south,l=this.west,H=this.east,I=this.center;if(!I){throw"No center region defined in BorderLayout "+d.id}if(B&&B.isVisible()){var K=B.getSize();var C=B.getMargins();K.width=u-(C.left+C.right);K.x=C.left;K.y=C.top;p=K.height+K.y+C.bottom;D-=p;B.applyLayout(K)}if(x&&x.isVisible()){var K=x.getSize();var C=x.getMargins();K.width=u-(C.left+C.right);K.x=C.left;var J=(K.height+C.top+C.bottom);K.y=G-J+C.top;D-=J;x.applyLayout(K);if(typeof x.collapsedEl!="undefined"&&x.collapsedTitle&&this.southTitleAdded==false){this.southTitleAdded=true;var y=x.collapsedEl;var M=new Ext.Template('<div style="float: left;">{txt}</div>');var t=M.insertFirst(y,{txt:x.collapsedTitle});if(x.collapsedTitleStyle){y.applyStyles(x.collapsedTitleStyle)}if(x.collapsedTitleCls){Ext.get(t).addClass(x.collapsedTitleCls)}}}if(l&&l.isVisible()){var K=l.getSize();var C=l.getMargins();K.height=D-(C.top+C.bottom);K.x=C.left;K.y=p+C.top;var a=(K.width+C.left+C.right);q+=a;r-=a;l.applyLayout(K)}if(H&&H.isVisible()){var K=H.getSize();var C=H.getMargins();K.height=D-(C.top+C.bottom);var a=(K.width+C.left+C.right);K.x=u-a+C.left;K.y=p+C.top;r-=a;H.applyLayout(K)}var C=I.getMargins();var g={x:q+C.left,y:p+C.top,width:r-(C.left+C.right),height:D-(C.top+C.bottom)};I.applyLayout(g);if(f){for(var E=0,F=f.length;E<F;E++){f[E].collapse(false)}}if(Ext.isIE&&Ext.isStrict){L.repaint()}}});var gridUtil=function(b,a){a=Ext.decode(a);var c=function(){if(a.is_ajax){if(a.url=="#"){return}Ext.Ajax.request({url:a.url,params:a.params,success:function(d){if(a.onsuccess=="RELOAD"){b.getStore().reload();if(b.getSelectionModel){var e=b.getSelectionModel();e.clearSelections()}}if(a.onsuccess=="REDIRECT"){window.location.href=a.redirect}}})}else{window.location.href=a.url}};if(!b){alert("Component not found");return}if(a.confirmMsg){Ext.Msg.show({title:"Confirmation required.",msg:a.confirmMsg,buttons:Ext.Msg.YESNOCANCEL,fn:function(d,e){if(d=="yes"){c()}},icon:Ext.MessageBox.QUESTION})}else{c()}};Ext.apply(Ext.data.SortTypes,{asText:function(a){return Ext.data.SortTypes.asUCText(a)},htmlAsInt:function(a){return Ext.data.SortTypes.asInt(Ext.data.SortTypes.asUCText(a))},htmlAsFloat:function(a){return Ext.data.SortTypes.asFloat(Ext.data.SortTypes.asUCText(a))},htmlAsText:function(b){var a=/<\S[^>]*>/gi;return String(b).replace(a,"")},asIp:function(e){var f=String(e).split(".");var c="";for(var d=0;d<f.length;d++){var a=3-f[d].length;for(var b=0;b<a;b++){c+="0"}c+=f[d]}return Ext.data.SortTypes.asText(c==""?e:c)},htmlAsIp:function(a){return Ext.data.SortTypes.asIp(Ext.data.SortTypes.asUCText(a))},asSize:function(e){e=e.toUpperCase();var f=e.match(/([a-zA-Z\s]+)/);if(f){f=f[0].replace(/^\s*/,"").replace(/\s*$/,"")}var c=1;var d=[[/^BYTE/,/^KILO/,/^MEGA/,/^GIGA/,/^TERA/,/^PETA/,/^EXA/,/^ZETTA/,/^YOTTA/],[/^B/,/^KB/,/^MB/,/^GB/,/^TB/,/^PB/,/^EB/,/^ZB/,/^YB/],[/^B/,/^K/,/^M/,/^G/,/^T/,/^P/,/^E/,/^Z/,/^Y/]];for(var b=0;b<d.length;b++){for(var a=0;a<d[b].length;a++){if(d[b][a].test(f)){c=1024;c=Math.pow(c,a);break}}}return parseFloat(e)*c},htmlAsSize:function(a){return Ext.data.SortTypes.asSize(Ext.data.SortTypes.asUCText(a))},maskAsIp:function(a){var b=/\b(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b/;var c=a.match(b);if(!c){return}return Ext.data.SortTypes.htmlAsIp(c[0])}});Ext.override(Ext.form.Checkbox,{onFocus:function(){var a=this.wrap;if(!a){return}a.setStyle("float","left");a.setStyle("height","auto");a.setStyle("border","1px solid #7eadd9");Ext.DomHelper.insertAfter(a,{tag:"div",style:"clear:both"})},onBlur:function(){var a=this.wrap;if(!a){return}a.setStyle("border","0px solid #7eadd9")}});Ext.override(Ext.form.Radio,{onFocus:function(){},onBlur:function(){}});Ext.override(Ext.Button,{onFocus:function(){this.addClass("x-btn-over")},onBlur:function(){this.removeClass("x-btn-over")}});Ext.override(Ext.form.Field,{fireKeys:function(b){if(((Ext.isIE&&b.type=="keydown")||b.type=="keypress")&&b.isSpecialKey()){if(b.getKey()==b.ENTER){if(this.getXType()!="textarea"&&this.getXType()!="superboxselect"){var a=this.findParentByType("form");if(a){Ext.each(a.buttons,function(c){if(c.url&&c.url==a.url){c.handler.call(c.scope)}})}}}}},initEvents:function(){this.el.on("keydown",this.fireKeys,this);this.el.on("keypress",this.fireKeys,this);this.el.on("keyup",this.fireKeys,this);this.el.on("focus",this.onFocus,this);this.el.on("blur",this.onBlur,this)}});Ext.override(Ext.form.TextField,{initValue:function(){if(this.value){this.value=this.value.toString().trim()}if(this.value!==undefined){this.setValue(this.value)}else{if(!Ext.isEmpty(this.el.dom.value)&&this.el.dom.value!=this.emptyText){this.setValue(this.el.dom.value)}}this.originalValue=this.getValue()},preFocus:function(){var a=this.el,b;if(this.emptyText){if(a.dom.value==this.emptyText){this.setRawValue("");b=true}a.removeClass(this.emptyClass)}if(this.SelectOnFocus||b){a.dom.select()}if(this.PasswordFocus){a.dom.setAttribute("type","password")}},beforeBlur:function(){if(this.PasswordFocus&&this.getValue()==""){this.el.dom.setAttribute("type","text");this.reset()}}});Ext.override(Ext.form.HtmlEditor,{markInvalid:function(a){if(!this.rendered||this.preventMark){return}a=a||this.invalidText;switch(this.msgTarget){case"qtip":this.iframe.qtip=a;this.iframe.qclass="x-form-invalid-tip";Ext.get(this.iframe).addClass(this.invalidClass);break;case"side":Ext.get(this.iframe).addClass(this.invalidClass);this.errorDiv=Ext.DomHelper.append(this.wrap,{tag:"div",style:"top:0px;left:"+(this.wrap.getWidth()+85)+"px;z-index:1000;position:absolute;visibility:visible;",cls:"x-form-invalid-icon",qtip:a,qclass:"x-form-invalid-tip"});break}return Ext.form.TextArea.superclass.markInvalid.call(this,[a])},clearInvalid:function(){if(!this.rendered||this.preventMark){return}switch(this.msgTarget){case"qtip":this.iframe.qtip="";Ext.get(this.iframe).removeClass(this.invalidClass);break;case"side":if(this.errorDiv){Ext.get(this.errorDiv).remove()}Ext.get(this.iframe).removeClass(this.invalidClass);break}return Ext.form.TextArea.superclass.clearInvalid.call(this)}});Ext.lib.Event.resolveTextNode=Ext.isGecko?function(b){if(!b){return}var a=HTMLElement.prototype.toString.call(b);if(a=="[xpconnect wrapped native prototype]"||a=="[object XULElement]"){return}return b.nodeType==3?b.parentNode:b}:function(a){return a&&a.nodeType==3?a.parentNode:a};Ext.override(Ext.ToolTip,{onMouseMove:function(d){var a=d.getPageX(),f=d.getPageY();var b=this.delegate?d.getTarget(this.delegate):this.triggerElement=true;if(b){this.targetXY=d.getXY();if(b===this.triggerElement){if(!this.hidden&&this.trackMouse){var c=this.getBox();if(c.x+c.width>Ext.getBody().getWidth()){a=Ext.getBody().getWidth()-(c.width+10);this.targetXY=[a,f]}this.setPagePosition(this.getTargetXY())}}else{this.hide();this.lastActive=new Date(0);this.onTargetOver(d)}}else{if(!this.closable&&this.isVisible()){this.hide()}}}});Ext.override(Ext.Panel,{setIconClass:function(b){var a=this.iconCls;this.iconCls=b;if(this.rendered&&this.header){var d=this.header.dom;var c=d.firstChild&&String(d.firstChild.tagName).toLowerCase()=="img"?d.firstChild:null;if(c){Ext.fly(c).replaceClass(a,this.iconCls)}else{Ext.DomHelper.insertBefore(d.firstChild,{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-panel-inline-icon "+this.iconCls})}}}});Ext.override(Ext.TabPanel,{initTab:function(m,e){var f=new Ext.Template('<li class="{cls}" id="{id}" style="overflow:hidden">','<tpl if="closable">','<a class="x-tab-strip-close"></a>',"</tpl>",'<a class="x-tab-right" href="#" style="padding-left:6px">','<em class="x-tab-left">','<span class="x-tab-strip-inner">','<img src="'+Ext.BLANK_IMAGE_URL+'" style="float:left;margin:3px 3px 0 0">','<span  class="x-tab-strip-text {iconCls}">{text} {extra}</span>',"</span>","</em>","</a>","</li>");f.disableFormats=true;f.compile();Ext.TabPanel.prototype.itemTpl=f;var a=Ext.BLANK_IMAGE_URL;var h="";if(m.icon&&m.icon!=""){a=m.icon}if(m.iconCls&&m.iconCls!=""){h="{iconCls}"}if(m.icon||m.iconCls){var f=new Ext.Template('<li class="{cls}" id="{id}" style="overflow:hidden">','<tpl if="closable">','<a class="x-tab-strip-close"></a>',"</tpl>",'<a class="x-tab-right" href="#" style="padding-left:6px">','<em class="x-tab-left">','<span class="x-tab-strip-inner">','<img src="'+a+'" class="x-tab-strip-text '+h+'" width="16" height="16" style="padding:0px;float:left;margin-top:2px; margin-right:4px">','<span style="'+(m.icon?"margin-left:20px":"")+'" class="x-tab-strip-text ">{text} {extra}</span>',"</span>","</em>","</a>","</li>");f.disableFormats=true;f.compile();Ext.TabPanel.prototype.itemTpl=f}var g=this.strip.dom.childNodes[e],b=this.getTemplateArgs(m),c=g?this.itemTpl.insertBefore(g,b):this.itemTpl.append(this.strip,b),l="x-tab-strip-over",d=Ext.get(c);d.hover(function(){if(!m.disabled){d.addClass(l)}},function(){d.removeClass(l)});if(m.tabTip){d.child("span.x-tab-strip-text",true).qtip=m.tabTip}m.tabEl=c;d.select("a").on("click",function(n){if(!n.getPageX()){this.onStripMouseDown(n)}},this,{preventDefault:true});m.on({scope:this,disable:this.onItemDisabled,enable:this.onItemEnabled,titlechange:this.onItemTitleChanged,iconchange:this.onItemIconChanged,beforeshow:this.onBeforeShowItem})}});
/*
 * Ext JS Library 3.2.1
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.Loader=Ext.apply({},{load:function(l,h,m,c){var m=m||this,f=document.getElementsByTagName("head")[0],b=document.createDocumentFragment(),a=l.length,g=0,e=this;var n=function(o){f.appendChild(e.buildScriptTag(l[o],d))};var d=function(){g++;if(a==g&&typeof h=="function"){h.call(m)}else{if(c===true){n(g)}}};if(c===true){n.call(this,0)}else{Ext.each(l,function(p,o){b.appendChild(this.buildScriptTag(p,d))},this);f.appendChild(b)}},buildScriptTag:function(b,c){var a=document.createElement("script");a.type="text/javascript";a.src=b;if(a.readyState){a.onreadystatechange=function(){if(a.readyState=="loaded"||a.readyState=="complete"){a.onreadystatechange=null;c()}}}else{a.onload=c}return a}});var pxMatch=/(\d+(?:\.\d+)?)px/;Ext.override(Ext.Element,{getViewSize:function(e){var p=document,g=this,c=g.dom,f=Ext.lib.Dom,l=(c==p||c==p.body),n,q,b,m=0,r=0,a=0,o=0;if(l){return{width:f.getViewWidth(),height:f.getViewHeight()}}n=g.isBorderBox();m=g.getBorderWidth("tb");r=g.getBorderWidth("lr");a=g.getPadding("tb");o=g.getPadding("lr");if(q=g.getStyle("width").match(pxMatch)){if((q=Math.round(q[1]))&&n){q-=(r+o)}if(!e){q+=o}c.clientWidth&&(c.clientWidth<q)&&(q=c.clientWidth)}else{if(!(q=c.clientWidth)&&(q=c.offsetWidth)){q-=r}if(q&&e){q-=o}}if(b=g.getStyle("height").match(pxMatch)){if((b=Math.round(b[1]))&&n){b-=(m+a)}if(!e){b+=a}c.clientHeight&&(c.clientHeight<b)&&(b=c.clientHeight)}else{if(!(b=c.clientHeight)&&(b=c.offsetHeight)){b-=m}if(b&&e){b-=a}}return{width:q,height:b}}});Ext.override(Ext.layout.ColumnLayout,{onLayout:function(e,l,a){var f=e.items.items,g=f.length,m,b;if(!this.innerCt){this.innerCt=l.createChild({cls:"x-column-inner"});this.innerCt.createChild({cls:"x-clear"})}this.renderAll(e,this.innerCt);var p=a||l.getViewSize(true);if(p.width<1&&p.height<1){return}var n=p.width-this.scrollOffset,d=p.height,o=n;this.innerCt.setWidth(n);for(b=0;b<g;b++){m=f[b];if(!m.columnWidth){o-=(m.getSize().width+m.getPositionEl().getMargins("lr"))}}o=o<0?0:o;for(b=0;b<g;b++){m=f[b];if(m.columnWidth){m.setSize(Math.floor(m.columnWidth*o)-m.getPositionEl().getMargins("lr"))}}if(!a&&((p=l.getViewSize(true)).width!=n)){this.onLayout(e,l,p)}}});Ext.isJsonString=function(a){var b=null;try{b=new RegExp('^("(\\\\.|[^"\\\\\\n\\r])*?"|[,:{}\\[\\]0-9.\\-+Eaeflnr-u \\n\\r\\t])+?$')}catch(c){b=/^(true|false|null|\[.*\]|\{.*\}|".*"|\d+|\d+\.\d+)$/}return b.test(a)};Ext.ux.NotificationMgr={positions:[],heights:[]};Ext.ux.Notification=function(a){this.config=Ext.apply({},a)};Ext.ux.Notification=Ext.extend(Ext.Window,{notificationType:"ERROR",heightPlus:0,initComponent:function(){Ext.apply(this,{autoHeight:true,closeAction:"close",plain:false,shadow:false,draggable:false,bodyStyle:"text-align:left;padding:10px;",resizable:false});if(this.autoDestroy){this.task=new Ext.util.DelayedTask(this.close,this)}else{this.closable=true}Ext.ux.Notification.superclass.initComponent.call(this)},setMessage:function(a){this.body.update(a)},onRender:function(b,a){Ext.ux.Notification.superclass.onRender.call(this,b,a)},onDestroy:function(){Ext.ux.NotificationMgr.positions.remove(this.pos);Ext.ux.Notification.superclass.onDestroy.call(this)},afterShow:function(){Ext.ux.Notification.superclass.afterShow.call(this);this.on("move",function(){Ext.ux.NotificationMgr.positions.remove(this.pos);if(this.autoDestroy){this.task.cancel()}},this);if(this.autoDestroy){this.task.delay(this.hideDelay||5000)}},animShow:function(){this.pos=0;var a=0;while(Ext.ux.NotificationMgr.positions.indexOf(this.pos)>-1){a+=Ext.ux.NotificationMgr.heights[this.pos];this.pos++}Ext.ux.NotificationMgr.positions.push(this.pos);Ext.ux.NotificationMgr.heights[this.pos]=this.getSize().height+10;a=a+this.heightPlus;this.el.alignTo(this.animateTarget||document,"br-tr",[-1,-1-(a)]);this.el.slideIn("b",{duration:0.7,callback:this.afterShow,scope:this})},animHide:function(){Ext.ux.NotificationMgr.positions.remove(this.pos);if(this.el){this.el.ghost("b",{duration:1,remove:false})}},start:function(a){new Ext.ux.Notification.start(a)}});Ext.ns("Ext.ux.Notification");Ext.ux.Notification.Base=function(){};Ext.ux.Notification.Base=Ext.extend(Ext.util.Observable,{showNotification:function(a){var b=new Ext.ux.Notification(Ext.apply({animateTarget:this.notificationEl,autoDestroy:false,notificationType:"ERROR"},a));if(b.notificationType=="ERROR"){b.iconCls="icon-notification-error";b.bodyStyle+="background-color:#fddcdc;"}if(b.notificationType=="WARNING"){b.iconCls="icon-notification-warning";b.bodyStyle+="background-color:#fefcc7;"}if(b.notificationType=="INFO"){b.iconCls="icon-notification-info";b.bodyStyle+="background-color:#fff;"}b.bodyStyle+="padding-bottom:20px;";b.show();return b},hideNotification:function(b,a){if(b){b.close.defer(a||3000,b)}},growl:function(d,a,f,b,c){var e=this.showNotification({width:300,notificationType:f,title:d,html:a,heightPlus:c});this.hideNotification(e,b*1000)}});Ext.ux.InstantNotification=Ext.extend(Ext.ux.Notification.Base,{constructor:function(a){Ext.ux.InstantNotification.superclass.constructor.call(this,a);this.notificationEl=Ext.get("growl-notification-el")?Ext.get("growl-notification-el"):Ext.DomHelper.append(Ext.getBody(),{tag:"div",id:"growl-notification-el",style:"width:300px;position:absolute;bottom:0;right:0"});a.type=a.type||"INFO";a.duration=a.duration||10;a.heightPlus=a.heightPlus||0;this.growl(a.title,a.message,a.type,a.duration,a.heightPlus)}});Ext.ux.Notification.start=function(a){Ext.onReady(function(){var b=Ext.get("growl-notification-el")?Ext.get("growl-notification-el"):Ext.DomHelper.append(Ext.getBody(),{tag:"div",id:"growl-notification-el",style:"width:300px;position:absolute;bottom:0;right:0"});this.showNotification=function(d){var e=new Ext.ux.Notification(Ext.apply({animateTarget:b,autoDestroy:false,notificationType:"ERROR"},d));if(e.notificationType=="ERROR"){e.iconCls="icon-notification-error";e.bodyStyle+="background-color:#fddcdc;"}if(e.notificationType=="WARNING"){e.iconCls="icon-notification-warning";e.bodyStyle+="background-color:#fefcc7;"}if(e.notificationType=="INFO"){e.iconCls="icon-notification-info";e.bodyStyle+="background-color:#fff;"}e.bodyStyle+="padding-bottom:20px;";e.show();return e};this.hideNotification=function(e,d){if(e){e.close.defer(d||3000,e)}};this.growl=function(f,d,h,e){var g=this.showNotification({width:300,notificationType:h,title:f,html:d});this.hideNotification(g,e*1000)};this.sendRequest={url:a,success:function(d){var f=Ext.decode(d.responseText);if(f){var e=0;var h=0;var g=500;Ext.each(f.data,function(m){e++;if(m.duration>h){h=m.duration}var l=[];l.push(m.title);l.push(m.message);l.push(m.type);l.push(m.duration);this.growl.defer(g*e,this,l)},this);new Ext.util.DelayedTask(function(){this.ajax.request(Ext.apply(this.sendRequest,{params:{limit:(3-Ext.ux.NotificationMgr.positions.length)}}))}).delay(e*g+10000)}}};this.ajax=Ext.Ajax;this.ajax.timeout=0;this.ajax.request(this.sendRequest);this.ajax.on("requestcomplete",function(d,e,f){},this);function c(){var d=document.title;var f="New Notification !! "+d;var e=setInterval(function(){document.title=document.title==f?" ":f},1000);window.onmousemove=function(){clearInterval(e);document.title=d;window.onmousemove=null}}})};Ext.override(Ext.Container,{render:function(){Ext.Container.superclass.render.apply(this,arguments);if(this.layout){if(typeof this.layout=="string"){this.layout=new Ext.Container.LAYOUTS[this.layout.toLowerCase()](this.layoutConfig)}this.setLayout(this.layout);if(this.activeItem!==undefined){var a=this.activeItem;delete this.activeItem;this.layout.setActiveItem(a)}}if(!this.ownerCt){this.doLayout()}if(this.monitorResize===true){Ext.EventManager.onWindowResize(this.doLayout,this,[false])}}});Ext.override(Ext.layout.Accordion,{setActiveItem:function(a){a=this.container.getComponent(a);if(this.activeItem!=a){if(a.rendered&&a.collapsed){a.expand()}else{this.activeItem=a}}},renderItem:function(a){if(this.animate===false){a.animCollapse=false}a.collapsible=true;if(this.autoWidth){a.autoWidth=true}if(this.titleCollapse){a.titleCollapse=true}if(this.hideCollapseTool){a.hideCollapseTool=true}if(this.collapseFirst!==undefined){a.collapseFirst=this.collapseFirst}if(!this.activeItem&&!a.collapsed){this.activeItem=a}else{if(this.activeItem){a.collapsed=this.activeItem!=a}}Ext.layout.Accordion.superclass.renderItem.apply(this,arguments);a.header.addClass("x-accordion-hd");a.on("beforeexpand",this.beforeExpand,this)}});Ext.ns("Ext.ux");Ext.ux.MaximizeTool=function(){this.init=function(l){var d={id:"maximize",handler:b,scope:l,qtip:"Maximize"};l.tools=l.tools||[];var m=l.tools.slice();l.tools=m;for(var h=0,c=l.tools.length;h<c;h++){if(l.tools[h].id=="maximize"){return}}var g;if(l.tools.length>0){for(var e in l.tools){if(l.tools[e].id=="close"){g=l.tools[e];l.tools.splice(e,1)}}}if(g){l.tools[l.tools.length]=g}if(l.tools.length>0){var f=l.tools[l.tools.length-1];if(f.id=="close"){l.tools[l.tools.length-1]=d;l.tools[l.tools.length]=f}else{l.tools[l.tools.length]=d}}else{l.tools[l.tools.length]=d}};function b(f,e,d){d.originalOwnerCt=d.ownerCt;d.originalPosition=d.ownerCt.items.indexOf(d);d.originalSize=d.getSize();if(!e.window){var c={id:(d.getId()+"-MAX"),width:(Ext.getBody().getSize().width-100),height:(Ext.getBody().getSize().height-100),resizable:true,draggable:true,closable:true,closeAction:"hide",hideBorders:true,plain:true,layout:"fit",autoScroll:true,border:false,bodyBorder:false,frame:true,pinned:true,maximizable:true,bodyStyle:"background-color: #ffffff;"};e.window=new Ext.Window(c);e.window.on("hide",a,d)}if(!d.dummyComponent){var g={title:d.title,width:d.getSize().width,height:d.getSize().height,html:'<div style="margin-top:20px;  text-align:center; font-family:verdana;font-size:10px"><b>'+d.title+"</b><br>This widget is maximized<br><br>Closing the maximized widget window will restore the widget in this area.</div>"};d.dummyComponent=new Ext.Panel(g)}e.window.add(d);if(d.tools["toggle"]){d.tools["toggle"].setVisible(false)}if(d.tools["close"]){d.tools["close"].setVisible(false)}d.tools["maximize"].setVisible(false);d.originalOwnerCt.insert(d.originalPosition,d.dummyComponent);d.originalOwnerCt.doLayout();d.dummyComponent.setSize(d.originalSize);d.dummyComponent.setVisible(true);e.window.show(this)}function a(c){this.dummyComponent.setVisible(false);this.originalOwnerCt.insert(this.originalPosition,this);this.originalOwnerCt.doLayout();this.setSize(this.originalSize);this.tools["maximize"].setVisible(true);if(this.tools["toggle"]){this.tools["toggle"].setVisible(true)}if(this.tools["close"]){this.tools["close"].setVisible(true)}}};Ext.ns("Ext.ux.form");Ext.ux.form.ComboBox=Ext.extend(Ext.form.ComboBox,{defaultAutoCreate:{tag:"input",type:"text",size:"24",autocomplete:"off"},listClass:"",selectedClass:"x-combo-selected",triggerClass:"x-form-arrow-trigger",shadow:"sides",listAlign:"tl-bl?",maxHeight:300,minHeight:90,triggerAction:"query",minChars:4,typeAhead:false,queryDelay:500,pageSize:0,selectOnFocus:false,queryParam:"query",loadingText:"Loading...",resizable:false,handleHeight:8,editable:true,allQuery:"",mode:"remote",minListWidth:70,forceSelection:false,typeAheadDelay:250,lazyInit:true,initComponent:function(){Ext.form.ComboBox.superclass.initComponent.call(this);this.addEvents("expand","collapse","beforeselect","select","beforequery");if(this.transform){this.allowDomMove=false;var c=Ext.getDom(this.transform);if(!this.hiddenName){this.hiddenName=c.name}if(!this.store){this.mode="local";var h=[],e=c.options;for(var b=0,a=e.length;b<a;b++){var g=e[b];var f=(Ext.isIE?g.getAttributeNode("value").specified:g.hasAttribute("value"))?g.value:g.text;if(g.selected){this.value=f}h.push([f,g.text])}this.store=new Ext.data.SimpleStore({"id":0,fields:["value","text"],data:h});this.valueField="value";this.displayField="text"}c.name=Ext.id();if(!this.lazyRender){this.target=true;this.el=Ext.DomHelper.insertBefore(c,this.autoCreate||this.defaultAutoCreate);Ext.removeNode(c);this.render(this.el.parentNode)}else{Ext.removeNode(c)}}else{if(Ext.isArray(this.store)){if(Ext.isArray(this.store[0])){this.store=new Ext.data.SimpleStore({fields:["value","text","color"],data:this.store});this.valueField="value"}else{this.store=new Ext.data.SimpleStore({fields:["text"],data:this.store,expandData:true});this.valueField="text"}this.displayField="text";this.mode="local"}}this.selectedIndex=-1;if(this.mode=="local"){if(this.initialConfig.queryDelay===undefined){this.queryDelay=10}if(this.initialConfig.minChars===undefined){this.minChars=0}}},onRender:function(b,a){Ext.form.ComboBox.superclass.onRender.call(this,b,a);if(this.hiddenName){this.hiddenField=this.el.insertSibling({tag:"input",type:"hidden",name:this.hiddenName,id:(this.hiddenId||this.hiddenName)},"before",true);this.el.dom.removeAttribute("name")}if(Ext.isGecko){this.el.dom.setAttribute("autocomplete","off")}if(!this.lazyInit){this.initList()}else{this.on("focus",this.initList,this,{single:true})}if(!this.editable){this.editable=true;this.setEditable(false)}},initValue:function(){Ext.form.ComboBox.superclass.initValue.call(this);if(this.hiddenField){this.hiddenField.value=this.hiddenValue!==undefined?this.hiddenValue:this.value!==undefined?this.value:""}},initList:function(){if(!this.list){var a="x-combo-list";this.list=new Ext.Layer({shadow:this.shadow,cls:[a,this.listClass].join(" "),constrain:false});var b=this.listWidth||Math.max(this.wrap.getWidth(),this.minListWidth);this.list.setWidth(b);this.list.swallowEvent("mousewheel");this.assetHeight=0;if(this.title){this.header=this.list.createChild({cls:a+"-hd",html:this.title});this.assetHeight+=this.header.getHeight()}this.innerList=this.list.createChild({cls:a+"-inner"});this.innerList.on("mouseover",this.onViewOver,this);this.innerList.on("mousemove",this.onViewMove,this);this.innerList.setWidth(b-this.list.getFrameWidth("lr"));if(this.pageSize){this.footer=this.list.createChild({cls:a+"-ft"});this.pageTb=new Ext.PagingToolbar({store:this.store,pageSize:this.pageSize,renderTo:this.footer});this.assetHeight+=this.footer.getHeight()}if(!this.tpl){this.tpl='<tpl for="."><div class="'+a+'-item" style="background-color:{color};" qtip="{'+this.displayField+'}">{'+this.displayField+"}</div></tpl>"}this.view=new Ext.DataView({applyTo:this.innerList,tpl:this.tpl,singleSelect:true,selectedClass:this.selectedClass,itemSelector:this.itemSelector||"."+a+"-item"});this.view.on("click",this.onViewClick,this);this.bindStore(this.store,true);if(this.resizable){this.resizer=new Ext.Resizable(this.list,{pinned:true,handles:"se"});this.resizer.on("resize",function(e,c,d){this.maxHeight=d-this.handleHeight-this.list.getFrameWidth("tb")-this.assetHeight;this.listWidth=c;this.innerList.setWidth(c-this.list.getFrameWidth("lr"));this.restrictHeight()},this);this[this.pageSize?"footer":"innerList"].setStyle("margin-bottom",this.handleHeight+"px")}}},bindStore:function(a,b){if(this.store&&!b){this.store.un("beforeload",this.onBeforeLoad,this);this.store.un("load",this.onLoad,this);this.store.un("loadexception",this.collapse,this);if(!a){this.store=null;if(this.view){this.view.setStore(null)}}}if(a){this.store=Ext.StoreMgr.lookup(a);this.store.on("beforeload",this.onBeforeLoad,this);this.store.on("load",this.onLoad,this);this.store.on("loadexception",this.collapse,this);if(this.view){this.view.setStore(a)}}},initEvents:function(){Ext.form.ComboBox.superclass.initEvents.call(this);this.keyNav=new Ext.KeyNav(this.el,{"up":function(a){this.inKeyMode=true;this.selectPrev()},"down":function(a){if(!this.isExpanded()){this.onTriggerClick()}else{this.inKeyMode=true;this.selectNext()}},"enter":function(a){this.onViewClick();this.delayedCheck=true;this.unsetDelayCheck.defer(10,this)},"esc":function(a){this.collapse()},"tab":function(a){this.onViewClick(false);return true},scope:this,doRelay:function(c,b,a){if(a=="down"||this.scope.isExpanded()){return Ext.KeyNav.prototype.doRelay.apply(this,arguments)}return true},forceKeyDown:true});this.queryDelay=Math.max(this.queryDelay||10,this.mode=="local"?10:250);this.dqTask=new Ext.util.DelayedTask(this.initQuery,this);if(this.typeAhead){this.taTask=new Ext.util.DelayedTask(this.onTypeAhead,this)}if(this.enableKeyUpEvent!==false&&this.editable!==false){this.el.on("keyup",this.onKeyUp,this)}if(this.forceSelection){this.on("blur",this.doForce,this)}},onDestroy:function(){if(this.view){this.view.el.removeAllListeners();this.view.el.remove();this.view.purgeListeners()}if(this.list){this.list.destroy()}this.bindStore(null);Ext.form.ComboBox.superclass.onDestroy.call(this)},unsetDelayCheck:function(){delete this.delayedCheck},fireKey:function(a){if(a.isNavKeyPress()&&!this.isExpanded()&&!this.delayedCheck){this.fireEvent("specialkey",this,a)}},onResize:function(a,b){Ext.form.ComboBox.superclass.onResize.apply(this,arguments);if(this.list&&this.listWidth===undefined){var c=Math.max(a,this.minListWidth);this.list.setWidth(c);this.innerList.setWidth(c-this.list.getFrameWidth("lr"))}},onEnable:function(){Ext.form.ComboBox.superclass.onEnable.apply(this,arguments);if(this.hiddenField){this.hiddenField.disabled=false}},onDisable:function(){Ext.form.ComboBox.superclass.onDisable.apply(this,arguments);if(this.hiddenField){this.hiddenField.disabled=true}},setEditable:function(a){if(a==this.editable){return}this.editable=a;if(!a){this.el.dom.setAttribute("readOnly",true);this.el.on("mousedown",this.onTriggerClick,this);this.el.addClass("x-combo-noedit")}else{this.el.dom.setAttribute("readOnly",false);this.el.un("mousedown",this.onTriggerClick,this);this.el.removeClass("x-combo-noedit")}},onBeforeLoad:function(){if(!this.hasFocus){return}this.innerList.update(this.loadingText?'<div class="loading-indicator">'+this.loadingText+"</div>":"");this.restrictHeight();this.selectedIndex=-1},onLoad:function(){if(!this.hasFocus){return}if(this.store.getCount()>0){this.expand();this.restrictHeight();if(this.lastQuery==this.allQuery){if(this.editable){this.el.dom.select()}if(!this.selectByValue(this.value,true)){this.select(0,true)}}else{this.selectNext();if(this.typeAhead&&this.lastKey!=Ext.EventObject.BACKSPACE&&this.lastKey!=Ext.EventObject.DELETE){this.taTask.delay(this.typeAheadDelay)}}}else{this.onEmptyResults()}},onTypeAhead:function(){if(this.store.getCount()>0){var b=this.store.getAt(0);var c=b.data[this.displayField];var a=c.length;var d=this.getRawValue().length;if(d!=a){this.setRawValue(c);this.selectText(d,c.length)}}},onSelect:function(a,b){if(this.fireEvent("beforeselect",this,a,b)!==false){this.setValue(a.data[this.valueField||this.displayField]);this.collapse();this.fireEvent("select",this,a,b)}},getValue:function(){if(this.valueField){return typeof this.value!="undefined"?this.value:""}else{return Ext.form.ComboBox.superclass.getValue.call(this)}},clearValue:function(){if(this.hiddenField){this.hiddenField.value=""}this.setRawValue("");this.lastSelectionText="";this.applyEmptyText();this.value=""},setValue:function(a){var c=a;if(this.valueField){var b=this.findRecord(this.valueField,a);if(b){c=b.data[this.displayField]}else{if(this.valueNotFoundText!==undefined){c=this.valueNotFoundText}}}this.lastSelectionText=c;if(this.hiddenField){this.hiddenField.value=a}Ext.form.ComboBox.superclass.setValue.call(this,c);this.value=a},findRecord:function(c,b){var a;if(this.store.getCount()>0){this.store.each(function(d){if(d.data[c]==b){a=d;return false}})}return a},onViewMove:function(b,a){this.inKeyMode=false},onViewOver:function(d,b){if(this.inKeyMode){return}var c=this.view.findItemFromChild(b);if(c){var a=this.view.indexOf(c);this.select(a,false)}},onViewClick:function(b){var a=this.view.getSelectedIndexes()[0];var c=this.store.getAt(a);if(c){this.onSelect(c,a)}if(b!==false){this.el.focus()}},restrictHeight:function(){this.innerList.dom.style.height="";var b=this.innerList.dom;var e=this.list.getFrameWidth("tb")+(this.resizable?this.handleHeight:0)+this.assetHeight;var c=Math.max(b.clientHeight,b.offsetHeight,b.scrollHeight);var a=this.getPosition()[1]-Ext.getBody().getScroll().top;var f=Ext.lib.Dom.getViewHeight()-a-this.getSize().height;var d=Math.max(a,f,this.minHeight||0)-this.list.shadowOffset-e-5;c=Math.min(c,d,this.maxHeight);this.innerList.setHeight(c);this.list.beginUpdate();this.list.setHeight(c+e);this.list.alignTo(this.wrap,this.listAlign);this.list.endUpdate()},onEmptyResults:function(){this.collapse()},isExpanded:function(){return this.list&&this.list.isVisible()},selectByValue:function(a,c){if(a!==undefined&&a!==null){var b=this.findRecord(this.valueField||this.displayField,a);if(b){this.select(this.store.indexOf(b),c);return true}}return false},select:function(a,c){this.selectedIndex=a;this.view.select(a);if(c!==false){var b=this.view.getNode(a);if(b){this.innerList.scrollChildIntoView(b,false)}}},selectNext:function(){var a=this.store.getCount();if(a>0){if(this.selectedIndex==-1){this.select(0)}else{if(this.selectedIndex<a-1){this.select(this.selectedIndex+1)}}}},selectPrev:function(){var a=this.store.getCount();if(a>0){if(this.selectedIndex==-1){this.select(0)}else{if(this.selectedIndex!=0){this.select(this.selectedIndex-1)}}}},onKeyUp:function(a){if(this.editable!==false&&!a.isSpecialKey()){this.lastKey=a.getKey();this.dqTask.delay(this.queryDelay)}},validateBlur:function(){return !this.list||!this.list.isVisible()},initQuery:function(){this.doQuery(this.getRawValue())},doForce:function(){if(this.el.dom.value.length>0){this.el.dom.value=this.lastSelectionText===undefined?"":this.lastSelectionText;this.applyEmptyText()}},doQuery:function(c,b){if(c===undefined||c===null){c=""}var a={query:c,forceAll:b,combo:this,cancel:false};if(this.fireEvent("beforequery",a)===false||a.cancel){return false}c=a.query;b=a.forceAll;if(b===true||(c.length>=this.minChars)){if(this.lastQuery!==c){this.lastQuery=c;if(this.mode=="local"){this.selectedIndex=-1;if(b){this.store.clearFilter()}else{this.store.filter(this.displayField,c)}this.onLoad()}else{this.store.baseParams[this.queryParam]=c;this.store.load({params:this.getParams(c)});this.expand()}}else{this.selectedIndex=-1;this.onLoad()}}},getParams:function(a){var b={};if(this.pageSize){b.start=0;b.limit=this.pageSize}return b},collapse:function(){if(!this.isExpanded()){return}this.list.hide();Ext.getDoc().un("mousewheel",this.collapseIf,this);Ext.getDoc().un("mousedown",this.collapseIf,this);this.fireEvent("collapse",this)},collapseIf:function(a){if(!a.within(this.wrap)&&!a.within(this.list)){this.collapse()}},expand:function(){if(this.isExpanded()||!this.hasFocus){return}this.list.alignTo(this.wrap,this.listAlign);this.list.show();this.innerList.setOverflow("auto");Ext.getDoc().on("mousewheel",this.collapseIf,this);Ext.getDoc().on("mousedown",this.collapseIf,this);this.fireEvent("expand",this)},onTriggerClick:function(){if(this.disabled){return}if(this.isExpanded()){this.collapse();this.el.focus()}else{this.onFocus({});if(this.triggerAction=="all"){this.doQuery(this.allQuery,true)}else{this.doQuery(this.getRawValue())}this.el.focus()}}});Ext.reg("combowcolors",Ext.ux.form.ComboBox);Ext.namespace("Ext.ux.plugins");Ext.ux.plugins.HelpText={init:function(a){Ext.apply(a,{onRender:a.onRender.createSequence(function(f,b){if(typeof this.helpText=="string"){switch(this.helpType){case"comment":this.wrap=this.wrap||this.el.wrap();var d=this.el.dom;d=this.wrap.dom;Ext.DomHelper.append(d.parentNode,{tag:"div",cls:typeof this.helpTextClass!="undefined"?this.helpTextClass:"",style:typeof this.helpTextStyle!="undefined"?this.helpTextStyle:"clear: right; font-size: 11px; color: #888888;",html:this.helpText});break;case"inline":var h=this.getEl();var c=h.findParent(".x-form-item");if(c){var e=Ext.select("label",true,c);label=e.elements[0]}var g="padding-left:2px;";if(!label){break}switch(this.xtype){case"radio":label=e.elements[1];break;default:var g="padding-right:2px;float:left";break}this.helpText=(this.helpText+"").replace(/[\\"']/g,"'");Ext.DomHelper.insertFirst(label,{tag:"span",style:g,html:'<img src="/appFlowerPlugin/images/help.png" qtip="'+this.helpText+'">'});break}}}),findByClassName:function(d,c){var b;while(b=d.parentNode){if(b.className.match(c)){return b}d=b}return false}})}};Ext.ux.plugins.HelpText=Ext.extend(Ext.ux.plugins.HelpText,Ext.util.Observable);Ext.namespace("Ext.ux.plugins");Ext.ns("Ext.ux.plugins");Ext.ux.plugins.RealtimeWidgetUpdate=function(a){Ext.apply(this,a)};Ext.extend(Ext.ux.plugins.RealtimeWidgetUpdate,Ext.util.Observable,{init:function(widget){var me=this;var numRequests=0;var autoReload;var stopTool={id:"stop-reload",hidden:this.startInitial?false:true,handler:function(){autoReload.stop();widget.tools["stop-reload"].setVisible(false);widget.tools["start-reload"].setVisible(true)},scope:widget,qtip:"Pause auto widget reload."};var startTool={id:"start-reload",hidden:this.startInitial?true:false,handler:function(){autoReload.started=true;widget.tools["start-reload"].setVisible(false);widget.tools["stop-reload"].setVisible(true);this.reloadNow()},scope:widget,qtip:"Start auto widget reload."};widget.tools=widget.tools||[];if(this.reloadToolVisible){for(var i=0,len=widget.tools.length;i<len;i++){if(widget.tools[i].id=="start-reload"){return}}widget.tools.reverse();widget.tools[widget.tools.length]=stopTool;widget.tools[widget.tools.length]=startTool;widget.tools.reverse()}autoReload={started:me.startInitial,ajaxId:undefined,stop:function(){autoReload.started=false;autoReload._abortAjax()},_abortAjax:function(){if(autoReload.ajaxId){numRequests-=1;Ext.Ajax.abort(autoReload.ajaxId);autoReload.ajaxId=undefined}},isEnabled:function(){return autoReload.started},task:new Ext.util.DelayedTask(function(){if(autoReload.isEnabled()){widget.reloadNow()}}),beforeLoad:function(){numRequests+=1;autoReload._abortAjax()},afterLoad:function(){autoReload.ajaxId=undefined;numRequests-=1;if(autoReload.isEnabled()){autoReload.task.delay(me.rate)}},afterFailure:function(){window.setTimeout(autoReload.afterLoad,10000)}};if(widget.getStore){widget.getStore().on("beforeload",autoReload.beforeLoad);widget.getStore().on("load",autoReload.afterLoad);widget.getStore().on("exception",autoReload.afterFailure)}Ext.apply(widget,{gridReload:function(){if(numRequests<=0){numRequests=0;widget.disableLoadMask=true;if(widget.loadMask&&widget.loadMask.disable){widget.loadMask.disable()}var store=widget.getStore();if(store.proxy.conn.disableCaching===false){store.proxy.conn.disableCaching=true}if(store.proxy.setUrl){var url=store.proxy.url;if(url.indexOf("?")>0){url=url+"&_wait=1"}else{url=url+"?_wait=1"}store.proxy.setUrl(url)}store.reload();autoReload.ajaxId=undefined;if(store.proxy.activeRequest){autoReload.ajaxId=store.proxy.activeRequest.read}}},htmlReload:function(){var owner=this;if(!autoReload.ajaxId){autoReload.ajaxId=Ext.Ajax.request({url:me.url,method:"POST",params:Ext.apply(me.requestParams,{reload:"true"}),success:owner.onSuccess,failure:function(){autoReload.afterFailure()}})}},reloadNow:function(){var owner=this;if(widget.getStore){owner.gridReload()}else{owner.htmlReload()}},onHide:function(){this.reloadNow()},onSuccess:function(r){autoReload.afterLoad();var rc=null;try{rc=new RegExp('^("(\\\\.|[^"\\\\\\n\\r])*?"|[,:{}\\[\\]0-9.\\-+Eaeflnr-u \\n\\r\\t])+?$')}catch(z){rc=/^(true|false|null|\[.*\]|\{.*\}|".*"|\d+|\d+\.\d+)$/}if(!rc.test(r.responseText)){return}var json=Ext.util.JSON.decode(r.responseText);if(json.html&&json.js){var html=json.html;var js=json.js;if(widget&&widget.items&&widget.items.items[0]&&widget.items.items[0].getEl()&&widget.items.items[0].getEl().dom){widget.items.items[0].getEl().dom.innerHTML=html;if(js){eval(js)}}}else{if(json.html){var html=json.html;if(widget&&widget.items&&widget.items.items[0]&&widget.items.items[0].getEl()&&widget.items.items[0].getEl().dom){var div=document.createElement("div");div.innerHTML=html;if(div.firstChild.onmouseover){if(widget.items.items[0].getEl().dom.firstChild){div.firstChild.style.height=widget.items.items[0].getEl().dom.firstChild.style.height;html=div.innerHTML}}widget.items.items[0].getEl().dom.innerHTML=html}else{if(widget&&widget.getEl()&&widget.getEl()){var el=widget.getEl().dom;if(el){var p=el.firstChild.childNodes[0];if(p){p.innerHTML=html}}}}}}}})}});Ext.ns("ux");Ext.ux.GridColorView=function(a){Ext.apply(this,a);Ext.ux.GridColorView.superclass.constructor.call(this)};Ext.extend(Ext.ux.GridColorView,Ext.grid.GridView,{initTemplates:function(){var a=this.templates||{};a.row=new Ext.Template('<div class="x-grid3-row {alt}" style="{tstyle}"><table class="x-grid3-row-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle} {color}">',"<tbody><tr>{cells}</tr>",(this.enableRowBody?'<tr class="x-grid3-row-body-tr" style="{bodyStyle}"><td colspan="{cols}" class="x-grid3-body-cell" tabIndex="0" hidefocus="on"><div class="x-grid3-row-body">{body}</div></td></tr>':""),"</tbody></table></div>");a.cell=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}" tabIndex="0" {cellAttr}>','<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on" {attr} style="{cell_color}">{value}</div>',"</td>");this.templates=a;Ext.ux.GridColorView.superclass.initTemplates.call(this)},doRender:function(f,h,s,a,q,x){var b=this.templates,e=b.cell,g=b.row,l=q-1;var d="width:"+this.getTotalWidth()+";";var B=[],t,C,u={},m={tstyle:d},o;for(var w=0,z=h.length;w<z;w++){o=h[w];t=[];var n=(w+a);for(var y=0;y<q;y++){C=f[y];u.id=C.id;u.css=y===0?"x-grid3-cell-first ":(y==l?"x-grid3-cell-last ":"");u.attr=u.cellAttr="";u.value=C.renderer(o.data[C.name],u,o,n,y,s);u.style=C.style;if(Ext.isEmpty(u.value)){u.value="&#160;"}if(this.markDirty&&o.dirty&&typeof o.modified[C.name]!=="undefined"){u.css+=" x-grid3-dirty-cell"}u.cell_color="";if(o.data["_cell_color"]&&o.data["_cell_color"][C.name]){u.cell_color="background-color:"+o.data["_cell_color"][C.name]+";"}t[t.length]=e.apply(u)}var D=[];if(x&&((n+1)%2===0)){D[0]="x-grid3-row-alt"}if(o.dirty){D[1]=" x-grid3-dirty-row"}m.cols=q;if(this.getRowClass){D[2]=this.getRowClass(o,n,m,s)}m.alt=D.join(" ");m.cells=t.join("");if(o.data["_color"]!=""){m.color="background-color:"+o.data["_color"]+";"}if(this.grid.select&&o.data["_selected"]){var A=this.grid.getSelectionModel();A.selectRow(s.indexOf(o),true)}B[B.length]=g.apply(m)}return B.join("")}});Ext.ns("ux");Ext.ux.GroupingColorView=function(a){Ext.apply(this,a);Ext.ux.GroupingColorView.superclass.constructor.call(this)};Ext.ux.GroupingColorView=Ext.extend(Ext.ux.GridColorView,{groupByText:"Group By This Field",showGroupsText:"Show in Groups",hideGroupedColumn:false,showGroupName:true,startCollapsed:false,enableGrouping:true,enableGroupingMenu:true,enableNoGroups:true,emptyGroupText:"(None)",ignoreAdd:false,groupTextTpl:"{text}",gidSeed:1000,initTemplates:function(){Ext.ux.GroupingColorView.superclass.initTemplates.call(this);this.state={};var a=this.grid.getSelectionModel();a.on(a.selectRow?"beforerowselect":"beforecellselect",this.onBeforeRowSelect,this);if(!this.startGroup){this.startGroup=new Ext.XTemplate('<div id="{groupId}" class="x-grid-group {cls}">','<div id="{groupId}-hd" class="x-grid-group-hd" style="{style}"><div class="x-grid-group-title">',this.groupTextTpl,"</div></div>",'<div id="{groupId}-bd" class="x-grid-group-body">')}this.startGroup.compile();this.endGroup="</div></div>"},findGroup:function(a){return Ext.fly(a).up(".x-grid-group",this.mainBody.dom)},getGroups:function(){return this.hasRows()?this.mainBody.dom.childNodes:[]},onAdd:function(){if(this.enableGrouping&&!this.ignoreAdd){var a=this.getScrollState();this.refresh();this.restoreScroll(a)}else{if(!this.enableGrouping){Ext.ux.GroupingColorView.superclass.onAdd.apply(this,arguments)}}},onRemove:function(e,a,b,d){Ext.ux.GroupingColorView.superclass.onRemove.apply(this,arguments);var c=document.getElementById(a._groupId);if(c&&c.childNodes[1].childNodes.length<1){Ext.removeNode(c)}this.applyEmptyText()},refreshRow:function(a){if(this.ds.getCount()==1){this.refresh()}else{this.isUpdating=true;Ext.ux.GroupingColorView.superclass.refreshRow.apply(this,arguments);this.isUpdating=false}},beforeMenuShow:function(){var c,a=this.hmenu.items,b=this.cm.config[this.hdCtxIndex].groupable===false;if((c=a.get("groupBy"))){c.setDisabled(b)}if((c=a.get("showGroups"))){c.setDisabled(b);c.setChecked(!!this.getGroupField(),true)}},renderUI:function(){var a=Ext.grid.GroupingView.superclass.renderUI.call(this);if(this.enableGroupingMenu&&this.hmenu){this.hmenu.add("-",{itemId:"groupBy",text:this.groupByText,handler:this.onGroupByClick,scope:this,iconCls:"x-group-by-icon"});if(this.enableNoGroups){this.hmenu.add({itemId:"showGroups",text:this.showGroupsText,checked:true,checkHandler:this.onShowGroupsClick,scope:this})}this.hmenu.on("beforeshow",this.beforeMenuShow,this)}return a},onGroupByClick:function(){this.grid.store.groupBy(this.cm.getDataIndex(this.hdCtxIndex));this.beforeMenuShow()},onShowGroupsClick:function(a,b){if(b){this.onGroupByClick()}else{this.grid.store.clearGrouping()}},toggleGroup:function(c,b){this.grid.stopEditing(true);c=Ext.getDom(c);var a=Ext.fly(c);b=b!==undefined?b:a.hasClass("x-grid-group-collapsed");this.state[a.dom.id]=b;a[b?"removeClass":"addClass"]("x-grid-group-collapsed")},toggleAllGroups:function(c){var b=this.getGroups();for(var d=0,a=b.length;d<a;d++){this.toggleGroup(b[d],c)}},expandAllGroups:function(){this.toggleAllGroups(true)},collapseAllGroups:function(){this.toggleAllGroups(false)},interceptMouse:function(b){var a=b.getTarget(".x-grid-group-hd",this.mainBody);if(a){b.stopEvent();this.toggleGroup(a.parentNode)}},getGroup:function(a,d,f,h,b,e){var c=f?f(a,{},d,h,b,e):String(a);if(c===""){c=this.cm.config[b].emptyGroupText||this.emptyGroupText}return c},getGroupField:function(){return this.grid.store.getGroupState()},afterRender:function(){Ext.ux.GroupingColorView.superclass.afterRender.call(this);if(this.grid.deferRowRender){this.updateGroupWidths()}},renderRows:function(){var a=this.getGroupField();var d=!!a;if(this.hideGroupedColumn){var b=this.cm.findColumnIndex(a);if(!d&&this.lastGroupField!==undefined){this.mainBody.update("");this.cm.setHidden(this.cm.findColumnIndex(this.lastGroupField),false);delete this.lastGroupField}else{if(d&&this.lastGroupField===undefined){this.lastGroupField=a;this.cm.setHidden(b,true)}else{if(d&&this.lastGroupField!==undefined&&a!==this.lastGroupField){this.mainBody.update("");var c=this.cm.findColumnIndex(this.lastGroupField);this.cm.setHidden(c,false);this.lastGroupField=a;this.cm.setHidden(b,true)}}}}return Ext.ux.GroupingColorView.superclass.renderRows.apply(this,arguments)},doRender:function(d,h,u,a,t,x){if(h.length<1){return""}var E=this.getGroupField(),s=this.cm.findColumnIndex(E),B;this.enableGrouping=!!E;if(!this.enableGrouping||this.isUpdating){return Ext.ux.GroupingColorView.superclass.doRender.apply(this,arguments)}var l="width:"+this.getTotalWidth()+";";var w=this.grid.getGridEl().id;var f=this.cm.config[s];var b=f.groupRenderer||f.renderer;var y=this.showGroupName?(f.groupName||f.header)+": ":"";var D=[],o,z,A,q;for(z=0,A=h.length;z<A;z++){var n=a+z,p=h[z],e=p.data[E];B=this.getGroup(e,p,b,n,s,u);if(!o||o.group!=B){q=w+"-gp-"+E+"-"+Ext.util.Format.htmlEncode(B);var c=typeof this.state[q]!=="undefined"?!this.state[q]:this.startCollapsed;var m=c?"x-grid-group-collapsed":"";o={group:B,gvalue:e,text:y+B,groupId:q,startRow:n,rs:[p],cls:m,style:l};D.push(o)}else{o.rs.push(p)}p._groupId=q}var C=[];for(z=0,A=D.length;z<A;z++){B=D[z];this.doGroupStart(C,B,d,u,t);C[C.length]=Ext.ux.GroupingColorView.superclass.doRender.call(this,d,B.rs,u,B.startRow,t,x);this.doGroupEnd(C,B,d,u,t)}return C.join("")},getGroupId:function(f){var d=this.grid.getGridEl().id;var c=this.getGroupField();var e=this.cm.findColumnIndex(c);var b=this.cm.config[e];var g=b.groupRenderer||b.renderer;var a=this.getGroup(f,{data:{}},g,0,e,this.ds);return d+"-gp-"+c+"-"+Ext.util.Format.htmlEncode(f)},doGroupStart:function(a,d,b,e,c){a[a.length]=this.startGroup.apply(d)},doGroupEnd:function(a,d,b,e,c){a[a.length]=this.endGroup},getRows:function(){if(!this.enableGrouping){return Ext.ux.GroupingColorView.superclass.getRows.call(this)}var h=[];var f,c=this.getGroups();for(var e=0,a=c.length;e<a;e++){f=c[e].childNodes[1].childNodes;for(var d=0,b=f.length;d<b;d++){h[h.length]=f[d]}}return h},updateGroupWidths:function(){if(!this.enableGrouping||!this.hasRows()){return}var c=Math.max(this.cm.getTotalWidth(),this.el.dom.offsetWidth-this.scrollOffset)+"px";var b=this.getGroups();for(var d=0,a=b.length;d<a;d++){b[d].firstChild.style.width=c}},onColumnWidthUpdated:function(c,a,b){Ext.ux.GroupingColorView.superclass.onColumnWidthUpdated.call(this,c,a,b);this.updateGroupWidths()},onAllColumnWidthsUpdated:function(a,b){Ext.ux.GroupingColorView.superclass.onAllColumnWidthsUpdated.call(this,a,b);this.updateGroupWidths()},onColumnHiddenUpdated:function(b,c,a){Ext.ux.GroupingColorView.superclass.onColumnHiddenUpdated.call(this,b,c,a);this.updateGroupWidths()},onLayout:function(){this.updateGroupWidths()},onBeforeRowSelect:function(d,c){if(!this.enableGrouping){return}var b=this.getRow(c);if(b&&!b.offsetParent){var a=this.findGroup(b);this.toggleGroup(a,true)}}});Ext.ux.GroupingColorView.GROUP_ID=1000;Ext.override(Ext.data.GroupingStore,{applySort:function(){Ext.data.GroupingStore.superclass.applySort.call(this);if(!this.groupOnSort&&!this.remoteGroup){var a=this.getGroupState();var b=this.sortInfo||{};if(a&&a!=b.field){this.sortData(this.groupField)}}}});
/*
 * Ext JS Library 3.0.0
 * Copyright(c) 2006-2009 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ns("Ext.ux.grid");Ext.ux.grid.RowExpander=Ext.extend(Ext.util.Observable,{expandOnEnter:true,expandOnDblClick:true,header:"",width:20,sortable:false,fixed:true,menuDisabled:true,dataIndex:"",id:"expander",lazyRender:true,enableCaching:true,constructor:function(a){Ext.apply(this,a);this.addEvents({beforeexpand:true,expand:true,beforecollapse:true,collapse:true});Ext.ux.grid.RowExpander.superclass.constructor.call(this);if(this.tpl){if(typeof this.tpl=="string"){this.tpl=new Ext.Template(this.tpl)}this.tpl.compile()}this.state={};this.bodyContent={}},getRowClass:function(a,e,d,c){d.cols=d.cols-1;var b=this.bodyContent[a.id];if(!b&&!this.lazyRender){b=this.getBodyContent(a,e)}if(b){d.body=b}return this.state[a.id]?"x-grid3-row-expanded":"x-grid3-row-collapsed"},init:function(b){this.grid=b;var a=b.getView();a.getRowClass=this.getRowClass.createDelegate(this);a.enableRowBody=true;b.on("render",this.onRender,this);b.on("destroy",this.onDestroy,this)},onRender:function(){var a=this.grid;var b=a.getView().mainBody;b.on("mousedown",this.onMouseDown,this,{delegate:".x-grid3-row-expander"});if(this.expandOnEnter){this.keyNav=new Ext.KeyNav(this.grid.getGridEl(),{"enter":this.onEnter,scope:this})}if(this.expandOnDblClick){a.on("rowdblclick",this.onRowDblClick,this)}},onDestroy:function(){this.keyNav.disable();delete this.keyNav;var a=this.grid.getView().mainBody;a.un("mousedown",this.onMouseDown,this)},onRowDblClick:function(a,b,c){this.toggleRow(b)},onEnter:function(h){var f=this.grid;var l=f.getSelectionModel();var b=l.getSelections();for(var c=0,a=b.length;c<a;c++){var d=f.getStore().indexOf(b[c]);this.toggleRow(d)}},getBodyContent:function(a,b){if(!this.enableCaching){return this.tpl.apply(a.data)}var c=this.bodyContent[a.id];if(!c){c=this.tpl.apply(a.data);this.bodyContent[a.id]=c}return c},onMouseDown:function(b,a){b.stopEvent();var c=b.getTarget(".x-grid3-row");this.toggleRow(c)},renderer:function(b,c,a){c.cellAttr='rowspan="2"';return'<div class="x-grid3-row-expander">&#160;</div>'},beforeExpand:function(b,a,c){if(this.fireEvent("beforeexpand",this,b,a,c)!==false){if(this.tpl&&this.lazyRender){a.innerHTML=this.getBodyContent(b,c)}return true}else{return false}},toggleRow:function(a){if(typeof a=="number"){a=this.grid.view.getRow(a)}this[Ext.fly(a).hasClass("x-grid3-row-collapsed")?"expandRow":"collapseRow"](a)},expandRow:function(c){if(typeof c=="number"){c=this.grid.view.getRow(c)}var b=this.grid.store.getAt(c.rowIndex);var a=Ext.DomQuery.selectNode("tr:nth(2) div.x-grid3-row-body",c);if(this.beforeExpand(b,a,c.rowIndex)){this.state[b.id]=true;Ext.fly(c).replaceClass("x-grid3-row-collapsed","x-grid3-row-expanded");this.fireEvent("expand",this,b,a,c.rowIndex)}},collapseRow:function(c){if(typeof c=="number"){c=this.grid.view.getRow(c)}var b=this.grid.store.getAt(c.rowIndex);var a=Ext.fly(c).child("tr:nth(1) div.x-grid3-row-body",true);if(this.fireEvent("beforecollapse",this,b,a,c.rowIndex)!==false){this.state[b.id]=false;Ext.fly(c).replaceClass("x-grid3-row-expanded","x-grid3-row-collapsed");this.fireEvent("collapse",this,b,a,c.rowIndex)}}});Ext.preg("rowexpander",Ext.ux.grid.RowExpander);Ext.grid.RowExpander=Ext.ux.grid.RowExpander;function panelHtmlCheat(b){var a=document.getElementById("center_panel");var a=a.childNodes[1];a=a.firstChild;a=a.firstChild;a=a.firstChild;if(a.childNodes[1]){a=a.childNodes[1]}else{a=a.firstChild}b.style.height=parseInt(a.style.height)-65+"px"}if("function"!==typeof RegExp.escape){RegExp.escape=function(a){if("string"!==typeof a){return a}return a.replace(/([.*+?\^=!:${}()|\[\]\/\\])/g,"\\$1")}}Ext.ux.GridRowActions=function(a){Ext.apply(this,a);this.addEvents("beforeaction","action","beforegroupaction","groupaction");Ext.ux.GridRowActions.superclass.constructor.call(this)};Ext.extend(Ext.ux.GridRowActions,Ext.util.Observable,{actionEvent:"click",autoWidth:true,header:"",isColumn:true,keepSelection:false,menuDisabled:true,sortable:false,tplGroup:'<tpl for="actions">'+'<div class="ux-grow-action-item<tpl if="\'right\'===align"> ux-action-right</tpl> '+'{cls}" style="{style}" qtip="{qtip}">{text}</div>'+"</tpl>",tplRow:'<div class="ux-row-action">'+'<tpl for="actions">'+"{url_start}"+'<div class="ux-row-action-item {cls} <tpl if="text">'+'ux-row-action-text</tpl>" style="{hide}{style}" qtip="{qtip}">'+'<tpl if="text"><span qtip="{qtip}">{text}</span></tpl></div>'+"{url_end}"+"</tpl>"+"</div>",widthIntercept:4,widthSlope:21,init:function(g){var d=0;for(var f=0;f<this.actions.length;f++){if(this.actions[f].hidden){continue}d++}this.grid=g;var a=g.getColumnModel();var e=a.getColumnsBy(function(l){return l.dataIndex=="conditional_row_action"});if(e&&e[0]){e[0].renderer=function(l){return l?"<span style='color:green'>Yes</span>":"<span style='color:red'>No</span>"}}this.id=this.id||Ext.id();var h=g.getColumnModel().lookup;delete (h[undefined]);h[this.id]=this;if(!this.tpl){this.tpl=this.processActions(this.actions)}if(this.autoWidth){this.width=this.widthSlope*d+this.widthIntercept;this.fixed=true;if(this.width<45){this.width=45}}var c=g.getView();var b={scope:this};b[this.actionEvent]=this.onClick;g.on({render:{scope:this,fn:function(){c.mainBody.on(b)}}});if(!this.renderer){this.renderer=function(q,l,m,r,p,n){l.css+=(l.css?" ":"")+"ux-row-action-cell";var o=m.get("conditional_row_action");if(o!=false){return this.tpl.apply(this.getData(q,l,m,r,p,n))}}.createDelegate(this)}if(c.groupTextTpl&&this.groupActions){c.interceptMouse=c.interceptMouse.createInterceptor(function(l){if(l.getTarget(".ux-grow-action-item")){return false}});c.groupTextTpl='<div class="ux-grow-action-text">'+c.groupTextTpl+"</div>"+this.processActions(this.groupActions,this.tplGroup).apply()}},getData:function(e,a,b,f,d,c){return b.data||{}},processActions:function(e,c){var a=[];Ext.each(e,function(g,h){if(g.hidden){return}if(g.iconCls&&"function"===typeof(g.callback||g.cb)){this.callbacks=this.callbacks||{};this.callbacks[g.iconCls]=g.callback||g.cb}if(!g.message){g.message=g.confirmMsg}if(!g.message){g.message="Are you sure to perform this operation?"}if(g.icon){if(g.style){g.style+=";background-image:url("+g.icon+");background-repeat:no-repeat;"}else{g.style="background-image:url("+g.icon+");background-repeat:no-repeat;"}}g.load=g.load?g.load:"center";if(g.script){var f=g.urlIndex?('<tpl if="this.isUrl('+g.urlIndex+')"><a href="javascript:void(0);" onclick="'+g.script+'">'):""}else{if(g.name&&g.name.match("_expand$")){if(g.iconCls){g.iconCls+=" icon-expand-row af-expand-row"}else{g.iconCls=" icon-expand-row af-expand-row"}if(g.confirm){g.iconCls+="  af-confirm-row"}var f=g.urlIndex?('<tpl if="this.isUrl('+g.urlIndex+')"><a href="'+afApp.urlPrefix+"{"+g.urlIndex+'}" confirmmsg="'+g.confirmMsg+'">'):""}else{var f=g.urlIndex?('<tpl if="this.isUrl('+g.urlIndex+')"><a href="<tpl if="!'+g.confirm+"&&this.isLoadCenter('"+g.load+"')\">"+afApp.urlPrefix+"/"+afApp.sharpPrefix+"#</tpl>{"+g.urlIndex+'}" <tpl if="'+g.confirm+"\">onclick=\"Ext.Msg.confirm('Confirmation','"+g.message+"', function(btn){if (btn=='yes'){ afApp.load('"+afApp.urlPrefix+"{"+g.urlIndex+"}','"+g.load+"'); return false; }else{ return true;}});return false;\"</tpl>>"):""}}var m="";if(g.post&&g.name&&!g.name.match("_expand")){m="Ext.Ajax.request({"+'url: "'+afApp.urlPrefix+"{"+g.urlIndex+'}",'+'method:"post",'+"success: Ext.ux.GridRowActions.onActionSuccess,"+"failure: Ext.ux.GridRowActions.onActionFailure"+"});"+";";f=g.urlIndex?('<tpl if="this.isUrl('+g.urlIndex+')"><a href="'+afApp.urlPrefix+"{"+g.urlIndex+'}" <tpl if="!'+g.confirm+"\">onclick='"+m+"; return false;'</tpl><tpl if=\""+g.confirm+'">onclick=\'Ext.Msg.confirm("Confirmation","'+g.message+'", function(btn){if (btn=="yes"){ '+m+" }}); return false;'</tpl>>"):""}if(g.popup){g.popupSettings=escape(g.popupSettings);f=g.urlIndex?('<tpl if="this.isUrl('+g.urlIndex+')"><a href="'+afApp.urlPrefix+"{"+g.urlIndex+'}" <tpl if="!'+g.confirm+'">onclick=\'afApp.widgetPopup("{'+g.urlIndex+'}","","","'+g.popupSettings+'"); return false;\'</tpl><tpl if="'+g.confirm+'">onclick=\'Ext.Msg.confirm("Confirmation","'+g.message+'", function(btn){if (btn=="yes"){ afApp.widgetPopup("'+afApp.urlPrefix+"{"+g.urlIndex+"}\"); }}); return false;'</tpl>>"):""}var l={cls:g.iconIndex?"{"+g.iconIndex+"}":(g.iconCls?g.iconCls:""),qtip:g.qtipIndex?"{"+g.qtipIndex+"}":(g.tooltip||g.qtip?g.tooltip||g.qtip:""),text:g.textIndex?"{"+g.textIndex+"}":(g.text?g.text:""),url_start:f,url_end:g.urlIndex?("</a></tpl>"):"",hide:g.hideIndex?'<tpl if="'+g.hideIndex+'">visibility:hidden;</tpl>':(g.hide?"visibility:hidden;":""),align:g.align||"right",style:g.style?g.style:"",confirmMsg:g.confirmMsg?g.confirmMsg:""};a.push(l)},this);var b=new Ext.XTemplate(c||this.tplRow,{isUrl:function(f){if(f.length>0){return true}else{return false}}});var d=new Ext.XTemplate(b.apply({actions:a}),{isUrl:function(f){if(f.length>0){return true}else{return false}},isLoadCenter:function(f){if(f=="center"){return true}else{return false}}});return d},expandRequest:function(e){e.stopEvent();var row=e.getTarget(".x-grid3-row");var grid=this.grid;var obj=this;var url=e.getTarget().parentNode;var link=e.getTarget();var extlink=Ext.get(link);if(!this.isRowExpanded(row)){var mask=new Ext.LoadMask(Ext.get("body"),{msg:"<b>Getting data from server.....</b> <br>Please wait..",removeMask:true});mask.show();var ajax=Ext.Ajax.request({url:url,method:"POST",success:function(response){var rc=null;try{rc=new RegExp('^("(\\\\.|[^"\\\\\\n\\r])*?"|[,:{}\\[\\]0-9.\\-+Eaeflnr-u \\n\\r\\t])+?$')}catch(z){rc=/^(true|false|null|\[.*\]|\{.*\}|".*"|\d+|\d+\.\d+)$/}if(rc.test(response.responseText)){json=Ext.util.JSON.decode(response.responseText);if(!json.success){Ext.Msg.alert("Error",json.message);mask.hide();return}if(json.html){Ext.DomHelper.append(row,{tag:"div",cls:"imm-row-expand",style:"padding:5px;",html:json.html})}if(json.script){eval(json.script)}}else{Ext.DomHelper.append(row,{tag:"div",cls:"imm-row-expand",style:"padding:5px;",html:response.responseText})}extlink.removeClass("icon-expand-row");extlink.addClass("icon-collapse-row");mask.hide()},failure:function(){mask.hide();Ext.Msg.alert("Error !","Some error has occured while connecting to server. <br>Please try again.")}})}else{var div=this.getExpandedDiv(row);if(div.style.display!="none"){div.style.display="none";extlink.addClass("icon-expand-row");extlink.removeClass("icon-collapse-row")}else{div.style.display="block";extlink.removeClass("icon-expand-row");extlink.addClass("icon-collapse-row")}}},findByClassName:function(d,c){var e=d.getElementsByTagName("div");var b=new Array();for(var a=0;a<e.length;a++){if(e[a].className==c){b.push(e[a])}}return b},isRowExpanded:function(a){return this.findByClassName(a,"imm-row-expand")[0]?true:false},getExpandedDiv:function(a){return this.isRowExpanded(a)?this.findByClassName(a,"imm-row-expand")[0]:null},onClick:function(h,l){var m=this.grid.getView();var c=false;var q=h.getTarget(".x-grid3-row");if(h.getTarget(".af-expand-row")){if(h.getTarget(".af-confirm-row")){var f=this;Ext.Msg.confirm("Confirmation",h.getTarget(".af-confirm-row").parentNode.getAttribute("confirmmsg"),function(e){if(e=="yes"){f.expandRequest(h);return false}else{return true}});h.stopEvent()}else{this.expandRequest(h);return false}}var a=m.findCellIndex(l.parentNode.parentNode);var p=h.getTarget(".ux-row-action-item");if(p){c=p.className.replace(/ux-row-action-item /,"");if(c){c=c.replace(/ ux-row-action-text/,"");c=c.trim()}}if(false!==q&&false!==a&&false!==c){var g=this.grid.store.getAt(q.rowIndex);if(this.callbacks&&"function"===typeof this.callbacks[c]){this.callbacks[c](this.grid,g,c,q.rowIndex,a)}if(true!==this.eventsSuspended&&false===this.fireEvent("beforeaction",this.grid,g,c,q.rowIndex,a)){return}else{if(true!==this.eventsSuspended){this.fireEvent("action",this.grid,g,c,q.rowIndex,a)}}}p=h.getTarget(".ux-grow-action-item");if(p){var n=m.findGroup(l);var d=n?n.id.replace(/ext-gen[0-9]+-gp-/,""):null;var b;if(d){var o=new RegExp(d);b=this.grid.store.queryBy(function(e){return e._groupId.match(o)});b=b?b.items:[]}c=p.className.replace(/ux-grow-action-item (ux-action-right )*/,"");if("function"===typeof this.callbacks[c]){this.callbacks[c](this.grid,b,c,d)}if(true!==this.eventsSuspended&&false===this.fireEvent("beforegroupaction",this.grid,b,c,d)){return false}this.fireEvent("groupaction",this.grid,b,c,d)}}});Ext.ux.GridRowActions.onActionSuccess=function(response,options){response=Ext.decode(response.responseText);if(!response.success){return Ext.ux.GridRowActions.onActionFailure(response,options)}if(response.executeAfter){eval(response.executeAfter)}if(response.message){Ext.Msg.alert("Success",response.message,function(){if(response.redirect){afApp.load(response.redirect,response.load)}})}else{if(response.redirect){afApp.load(response.redirect,response.load)}}};Ext.ux.GridRowActions.onActionFailure=function(a,b){if(a.responseText){a=Ext.decode(a.responseText)}var c=a.message||"Unable to do the operation.";Ext.Msg.alert("Failure",c,function(){if(a.redirect){afApp.load(a.redirect,a.load)}})};Ext.reg("rowactions",Ext.ux.GridRowActions);if("function"!==typeof RegExp.escape){RegExp.escape=function(a){if("string"!==typeof a){return a}return a.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}}Ext.ns("Ext.ux.form");Ext.ux.form.LovCombo=Ext.extend(Ext.form.ComboBox,{selectAllOn:"select-deselect-all",checkField:"checked",separator:",",displaySeparator:",",initComponent:function(){Ext.ux.form.LovCombo.superclass.initComponent.apply(this,arguments);if(!this.tpl){this.tpl='<tpl for=".">'+'<div class="x-combo-list-item">'+'<img src="'+Ext.BLANK_IMAGE_URL+'" '+'class="ux-lovcombo-icon ux-lovcombo-icon-'+"{[values."+this.checkField+'?"checked":"unchecked"'+']}">'+'<div class="ux-lovcombo-item-text">{'+(this.displayField||"text")+"}</div>"+"</div>"+"</tpl>"}this.on({scope:this,beforequery:this.onBeforeQuery});this.onRender=this.onRender.createSequence(function(){if(!this.getStore()){return}var MyRecordType=Ext.data.Record.create([this.valueField,this.displayField]);var json='({"'+this.valueField+'":"select-deselect-all","'+this.displayField+'":"<span style=\'display:block\'><b>Select/Deselect All</b></span>"})';myrec=new MyRecordType(eval(json));this.getStore().insert(0,myrec);if(this.selectAllCheck){var record=this.getStore().getAt(0);record.set(this.checkField,true);this.doQuery(this.allQuery)}});this.onLoad=this.onLoad.createSequence(function(){if(this.el){var v=this.el.dom.value;this.el.dom.value="";this.el.dom.value=v}});this.hideTask=new Ext.util.DelayedTask(this.hideList,this)},initEvents:function(){Ext.ux.form.LovCombo.superclass.initEvents.apply(this,arguments);this.keyNav.tab=false},clearValue:function(){this.value="";this.setRawValue(this.value);this.store.clearFilter();this.store.each(function(a){a.set(this.checkField,false)},this);if(this.hiddenField){this.hiddenField.value=""}this.applyEmptyText()},getCheckedDisplay:function(){var a=new RegExp(RegExp.escape(this.separator),"g");return this.getCheckedValue(this.displayField).replace(a,RegExp.escape(this.displaySeparator)+" ")},getCheckedValue:function(b){b=b||this.valueField;var d=[];var a=this.store.snapshot||this.store.data;a.each(function(c){if(c.get(this.checkField)&&c.data[this.valueField]!==this.selectAllOn){d.push(c.get(b))}},this);return d.join(this.separator)},selectAllCheck:function(){var a=this.store.snapshot||this.store.data;var b=true;a.each(function(c){if(c.data[this.valueField]!==this.selectAllOn&&!c.get(this.checkField)){b=false;return}},this);return b},onBeforeQuery:function(a){a.query=a.query.replace(new RegExp(this.getCheckedDisplay()+"[ "+RegExp.escape(this.separator)+"]*"),"")},beforeBlur:function(){this.list.hide();var d=this.getRawValue();var a=d.split(new RegExp(RegExp.escape(this.displaySeparator)+" *"));var c=[];var b=this.store.snapshot||this.store.data;Ext.each(a,function(e){b.each(function(f){if(e===f.get(this.displayField)){c.push(f.get(this.valueField))}},this)},this);this.store.clearFilter()},onSelect:function(a,b){if(this.fireEvent("beforeselect",this,a,b)!==false){a.set(this.checkField,!a.get(this.checkField));if(this.store.isFiltered()){this.doQuery(this.allQuery)}if(a.data[this.valueField]===this.selectAllOn){if(a.get(this.checkField)){this.selectAll()}else{this.deselectAll()}}else{this.setValue(this.getCheckedValue())}this.fireEvent("select",this,a,b)}this.hideTask.delay(3000)},hideList:function(){this.list.hide()},setValue:function(a){if(a){a=""+a;if(this.valueField){this.store.clearFilter();this.store.each(function(c){if(c.data[this.valueField]===this.selectAllOn&&this.selectAllCheck()){c.set(this.checkField,true)}else{if(c.data[this.valueField]===this.selectAllOn){c.set(this.checkField,null)}else{var b=!(!a.match("(^|"+RegExp.escape(this.separator)+")"+RegExp.escape(c.get(this.valueField))+"("+RegExp.escape(this.separator)+"|$)"));c.set(this.checkField,b)}}},this);this.value=this.getCheckedValue();this.setRawValue(this.getCheckedDisplay());if(this.hiddenField){this.hiddenField.value=this.value}}else{this.value=a;this.setRawValue(a);if(this.hiddenField){this.hiddenField.value=a}}if(this.el){this.el.removeClass(this.emptyClass)}}else{this.clearValue()}},selectAll:function(){this.store.each(function(a){a.set(this.checkField,true)},this);this.doQuery(this.allQuery);this.setValue(this.getCheckedValue())},deselectAll:function(){this.clearValue()}});Ext.reg("lovcombo",Ext.ux.form.LovCombo);Ext.ux.CheckboxSelectionModel=Ext.extend(Ext.grid.CheckboxSelectionModel,{header:'<div class="x-grid3-hd-checker" id="hd-checker">&#160;</div>',width:20,sortable:false,menuDisabled:true,fixed:true,dataIndex:"",id:"checker",initEvents:function(){Ext.grid.CheckboxSelectionModel.superclass.initEvents.call(this);this.grid.on("render",function(){var a=this.grid.getView();a.mainBody.on("mousedown",this.onMouseDown,this);Ext.fly(a.innerHd).on("mousedown",this.onHdMouseDown,this)},this)},onMouseDown:function(l,f){if(l.button===0&&f.className=="x-grid3-row-checker"){l.stopEvent();var h=l.getTarget(".x-grid3-row"),b=this.grid.getView(),d=h.rowIndex,c=this.grid.getStore(),a,g={};a=c.getAt(d);if(h){if(this.isSelected(d)){this.myDeselectRow(a);if(this.grid.tree&&!this.grid.remoteLoad){this.clearSelectionsFrom(a);this.clearSelectionsUpFrom(a)}}else{this.selectRow(d,true);if(this.grid.tree&&!this.grid.remoteLoad){this.selectAllFrom(a);this.selectAllUpFrom(a)}}}}},onHdMouseDown:function(c,a){if(a.className=="x-grid3-hd-checker"){c.stopEvent();var b=Ext.fly(a.parentNode);if(!b){return}var d=b.hasClass("x-grid3-hd-checker-on");if(d){b.removeClass("x-grid3-hd-checker-on");this.clearSelections()}else{b.addClass("x-grid3-hd-checker-on");this.selectAll()}}},getSelectionsJSON:function(a){var b=this.getSelections(),c=new Array();for(i=0,len=b.length;i<len;i++){if(a){var d=new Array();for(j=0;j<a.length;j++){d.push(b[i].json[a[j]])}c.push(d)}else{c.push(b[i].json)}}return Ext.encode(c)},selectAllFrom:function(b){var a=this.grid.getView(),c=this.grid.getStore(),d;if(c.isLeafNode(b)){return}if(c.isExpandedNode(b)){if(c.isVisibleNode(b)){d=c.getNodeChildren(b);if(d.length>0){for(i=0,len=d.length;i<len;i++){child_index=c.indexOf(d[i]);this.selectRow(child_index,true);this.selectAllFrom(d[i])}}}}else{if(!this.grid.remoteLoad){c.expandNode(b);d=c.getNodeChildren(b);if(d.length>0){for(i=0,len=d.length;i<len;i++){child_index=c.indexOf(d[i]);this.selectRow(child_index,true);this.selectAllFrom(d[i])}}c.on("expandnode2",this.onStoreExpandNode,this)}}},onStoreExpandNode:function(d,c){var a=this.grid.getView(),b=this.grid.getStore();if(d.isVisibleNode(c)){children=d.getNodeChildren(c);if(children.length>0){for(i=0,len=children.length;i<len;i++){child_index=d.indexOf(children[i]);this.selectRow(child_index,true);this.selectAllFrom(children[i])}}}b.un("expandnode2",this.onStoreExpandNode,this)},clearSelectionsUpFrom:function(a){var b=this.grid.getStore();var c=b.getNodeParent(a);if(c!=null&&!this.parentHasSelections(c)){this.myDeselectRow(c);this.clearSelectionsUpFrom(c)}},selectAllUpFrom:function(a){var b=this.grid.getStore();var c=b.getNodeParent(a);if(c!=null&&this.parentHasSelections(c)){this.selectRow(b.indexOf(c),true);this.selectAllUpFrom(c)}},clearSelectionsFrom:function(b){var a=this.grid.getView(),c=this.grid.getStore(),e;if(c.isLeafNode(b)){return}if(c.isVisibleNode(b)){e=c.getNodeChildren(b);if(e.length>0){for(i=0,len=e.length;i<len;i++){this.myDeselectRow(e[i]);this.clearSelectionsFrom(e[i])}}}if(this.selections.length==0){var d=Ext.get("hd-checker");var f=Ext.fly(d.dom.parentNode);f.removeClass("x-grid3-hd-checker-on")}},parentHasSelections:function(b,f){var a=this.grid.getView(),d=this.grid.getStore(),e,c;e=d.getNodeChildren(b);if(f){c=true;if(e.length>0){for(i=0,len=e.length;i<len;i++){child_index=d.indexOf(e[i]);if(!this.isSelected(child_index)){c=false;break}}}}else{c=false;if(e.length>0){for(i=0,len=e.length;i<len;i++){child_index=d.indexOf(e[i]);if(this.isSelected(child_index)){c=true;break}}}}return c},selectRow:function(b,d,a){if(this.locked||(b<0||b>=this.grid.store.getCount())||this.isSelected(b)){return}var c=this.grid.store.getAt(b);if(c&&this.fireEvent("beforerowselect",this,b,d,c)!==false){this.selections.add(c);this.last=this.lastActive=b;if(!a){this.grid.getView().onRowSelect(b)}this.fireEvent("rowselect",this,b,c);this.fireEvent("selectionchange",this)}},myDeselectRow:function(b){var a=this.grid.getView(),c=this.grid.getStore();var d=c.indexOf(b);this.selections.remove(b);b.data[this.grid.store.selected_field_name]=false;a.removeRowClass(d,"x-grid3-row-selected");this.fireEvent("rowdeselect",this,d,b);this.fireEvent("selectionchange",this)},renderer:function(b,c,a){return'<div class="x-grid3-row-checker">&#160;</div>'}});Ext.namespace("Ext.ux.menu");Ext.ux.menu.EditableItem=Ext.extend(Ext.menu.BaseItem,{itemCls:"x-menu-item",hideOnClick:false,initComponent:function(){this.addEvents({keyup:true});this.editor=this.editor||new Ext.form.TextField();if(this.text){this.editor.setValue(this.text)}},onRender:function(a){var b=a.createChild({cls:this.itemCls,html:'<img id="my" src="'+(Ext.BLANK_IMAGE_URL)+'" class="x-menu-item-icon'+(this.iconCls?" "+this.iconCls:"")+'" style="margin: 3px 7px 2px 2px;" />'});Ext.apply(this.config,{width:125});this.editor.render(b);this.el=b;this.relayEvents(this.editor.el,["keyup"]);if(Ext.isGecko){b.setStyle("overflow","auto")}a.dom.firstChild.className="x-menu-item-icon";if(this.iconCls&&this.iconCls=="ux-rangemenu-lt"){b.dom.firstChild.style.margin="28px 7px 2px 2px"}else{if(this.iconCls&&this.iconCls=="ux-rangemenu-eq"){b.dom.firstChild.style.margin="60px 7px 2px 2px"}else{if(this.iconCls&&this.iconCls=="ux-rangemenu-ne"){b.dom.firstChild.style.margin="83px 7px 2px 2px"}}}this.editor.el.setStyle("marginLeft","0px");Ext.ux.menu.EditableItem.superclass.onRender.apply(this,arguments)},getValue:function(){return this.editor.getValue()},setValue:function(a){this.editor.setValue(a)},isValid:function(a){return this.editor.isValid(a)}});Ext.namespace("Ext.ux.menu");Ext.ux.menu.ComboMenu=Ext.extend(Ext.menu.BaseItem,{itemCls:"x-menu-item",hideOnClick:false,tempValue:null,initComponent:function(){this.addEvents({keyup:true});var a;if(this.lovcombo){a=new Ext.ux.form.LovCombo({store:this.store,mode:"local",triggerAction:"all",emptyText:"Select an option...",selectOnFocus:true,resizable:true})}else{a=new Ext.form.ComboBox({store:this.store,typeAhead:true,mode:"local",triggerAction:"all",emptyText:"Select an option...",selectOnFocus:true,resizable:true})}this.editor=a;if(this.text){this.editor.setValue(this.text)}},onRender:function(a){var b=a.createChild({cls:this.itemCls});Ext.apply(this.config,{width:225});this.editor.render(b);this.el=b;this.relayEvents(this.editor.el,["keyup"]);if(Ext.isGecko){b.setStyle("overflow","auto")}if(this.tempValue!==null){this.setValue(this.tempValue)}Ext.ux.menu.ComboMenu.superclass.onRender.apply(this,arguments)},getValue:function(){if(this.editor.el){return this.editor.getValue()}else{return this.tempValue}},setValue:function(a){if(this.editor.el){this.editor.setValue(a)}else{this.tempValue=a;this.tempDisplayValue=a}},isValid:function(a){return this.editor.isValid(a)},getDisplayValue:function(){var c=new Array();var f=[];v=this.getValue();var b=this.editor.getStore();if(v.toString().match(/,/)){c=v.toString().split(",")}else{c[0]=v}for(var e=0;e<c.length;e++){if(c[e]==""){continue}var d=b.findExact("field1",parseInt(c[e]));if(d==-1){d=b.find("field1",c[e])}var a=b.getAt(d);f.push(a.get("field2"))}return f.join(", ")}});Ext.namespace("Ext.ux.menu");Ext.ux.menu.RangeMenu=function(){Ext.ux.menu.RangeMenu.superclass.constructor.apply(this,arguments);this.updateTask=new Ext.util.DelayedTask(this.fireUpdate,this);var c=this.fieldCfg;var b=this.fieldCls;var a=this.fields=Ext.applyIf(this.fields||{},{"gt":new Ext.ux.menu.EditableItem({iconCls:this.icons.gt,editor:new b(typeof c=="object"?c.gt||"":c)}),"lt":new Ext.ux.menu.EditableItem({iconCls:this.icons.lt,editor:new b(typeof c=="object"?c.lt||"":c)}),"eq":new Ext.ux.menu.EditableItem({iconCls:this.icons.eq,editor:new b(typeof c=="object"?c.gt||"":c)}),"ne":new Ext.ux.menu.EditableItem({iconCls:this.icons.ne,editor:new b(typeof c=="object"?c.gt||"":c)})});this.add(a.gt,a.lt,"-",a.eq,a.ne);for(var d in a){a[d].on("keyup",function(f,e,h,g){if(f.getKey()==f.ENTER&&g.isValid()){this.updateTask.delay(this.updateBuffer);this.hide(true);return}if(g==a.eq){a.gt.setValue(null);a.lt.setValue(null);a.ne.setValue(null)}else{if(g==a.ne){a.gt.setValue(null);a.lt.setValue(null);a.eq.setValue(null)}else{a.eq.setValue(null);a.ne.setValue(null)}}}.createDelegate(this,[a[d]],true))}this.addEvents({"update":true})};Ext.extend(Ext.ux.menu.RangeMenu,Ext.menu.Menu,{fieldCls:Ext.form.NumberField,fieldCfg:"",updateBuffer:500,icons:{gt:"ux-rangemenu-gt",lt:"ux-rangemenu-lt",eq:"ux-rangemenu-eq",ne:"ux-rangemenu-ne"},fireUpdate:function(){this.fireEvent("update",this)},setValue:function(b){for(var a in this.fields){this.fields[a].setValue(b[a]!==undefined?b[a]:"")}this.fireEvent("update",this)},getValue:function(){var a={};for(var b in this.fields){var c=this.fields[b];if(c.isValid()&&String(c.getValue()).length>0){a[b]=c.getValue()}}return a}});Ext.grid.GridView.prototype.handleHdMenuClick=function(c){var b=this.hdCtxIndex;var a=this.cm,d=this.ds;switch(c.getItemId()){case"asc":d.sort(a.getDataIndex(b),"ASC");break;case"desc":d.sort(a.getDataIndex(b),"DESC");break;default:b=a.getIndexById(c.getItemId().substr(4));if(b!=-1){if(c.checked&&a.getColumnsBy(this.isHideableColumn,this).length<=1){this.onDenyColumnHide();return false}a.setHidden(b,c.checked)}}return true};Ext.namespace("Ext.ux.grid");Ext.ux.grid.GridFilters=function(b){this.filters=new Ext.util.MixedCollection();this.filters.getKey=function(d){return d?d.dataIndex:null};for(var c=0,a=b.filters.length;c<a;c++){this.addFilter(b.filters[c])}this.deferredUpdate=new Ext.util.DelayedTask(this.reload,this);delete b.filters;Ext.apply(this,b)};Ext.extend(Ext.ux.grid.GridFilters,Ext.util.Observable,{updateBuffer:500,paramPrefix:"filter",filterCls:"ux-filtered-column",local:false,autoReload:true,stateId:undefined,showMenu:true,menuFilterText:"Filters",mode:"menu",showFilterInfo:"panel",init:function(a){if(a instanceof Ext.grid.GridPanel){this.grid=a;this.grid.originalTitle=this.grid.originalTitle?this.grid.originalTitle:a.title;this.store=this.grid.getStore();if(this.local){this.store.on("load",function(b){b.filterBy(this.getRecordFilter())},this)}else{this.store.on("beforeload",this.onBeforeLoad,this);this.store.on("load",function(){if(this.showFilterInfo){new Ext.ux.FilterInfo(this.grid,this.showFilterInfo)}},this)}this.grid.filters=this;this.grid.addEvents({"filterupdate":true});a.on("render",this.onRender,this);a.on("beforerender",this.applyState,this);if(this.applyPrivateCookie()){this.saveState(this.grid,this.applyPrivateCookie());this.grid.saveState()}a.on("beforestaterestore",this.applyState,this);a.on("beforestatesave",this.saveState,this)}else{if(a instanceof Ext.PagingToolbar){this.toolbar=a}}},applyState:function(c,f){this.suspendStateStore=true;this.clearFilters();var e;f=(e=this.applyPrivateCookie())?e:f;if(f&&f.filters){for(var b in f.filters){var d=this.filters.get(b);if(d){d.setValue(f.filters[b]);d.setActive(true)}}}this.deferredUpdate.cancel();if(this.local){this.reload()}this.suspendStateStore=false;if(this.filterby&&this.filterbyKeyword){var a=new Ext.ux.SaveSearchState(this.grid);a.restore(this.filterby,this.filterbyKeyword)}},saveState:function(a,c){var b={};this.filters.each(function(d){if(d.active){b[d.dataIndex]=d.getValue()}});return c.filters=b},applyPrivateCookie:function(){var f=this.grid.path;var e=new Ext.state.CookieProvider({});var a=e.get("search_result_cookie");if(a){var d=Ext.util.JSON.decode(a);for(key in d){var b=this.filters.get(key);if(b){if(b.type=="date"){for(k in d[key]){d[key][k]=new Date(Date.parseDate(d[key][k],"Y-m-d"))}}if(b.type=="string"){d[key]=d[key].toString().replace(/\+/g," ")}}}var c={filters:d};return c}return false},onRender:function(){if(this.mode=="header"){new Ext.ux.RePositionFilters(this.grid);return}var a;if(this.showMenu){a=this.grid.getView().hmenu;this.sep=a.addSeparator();this.menu=a.add(new Ext.menu.CheckItem({text:this.menuFilterText,menu:new Ext.menu.Menu()}));this.menu.on("checkchange",this.onCheckChange,this);this.menu.on("beforecheckchange",this.onBeforeCheck,this);a.on("beforeshow",this.onMenu,this)}this.grid.getView().on("refresh",this.onRefresh,this);this.updateColumnHeadings(this.grid.getView())},onMenu:function(b){var a=this.getMenuFilter();if(a){this.menu.menu=a.menu;this.menu.setChecked(a.active,false)}this.menu.setVisible(a!==undefined)},onCheckChange:function(a,b){this.getMenuFilter().setActive(b)},onBeforeCheck:function(a,b){return !b||this.getMenuFilter().isActivatable()},onStateChange:function(c,b){if(c=="serialize"){return}if(b==this.getMenuFilter()&&this.mode=="hmenu"){this.menu.setChecked(b.active,false)}if(this.autoReload||this.local){this.deferredUpdate.delay(this.updateBuffer)}var a=this.grid.getView();this.updateColumnHeadings(a);this.grid.saveState();this.grid.fireEvent("filterupdate",this,b)},onBeforeLoad:function(a,b){b.params=b.params||{};this.cleanParams(b.params);var c=this.buildQuery(this.getFilterData());Ext.apply(b.params,c)},onRefresh:function(a){this.updateColumnHeadings(a)},getMenuFilter:function(){var a=this.grid.getView();if(!a||a.hdCtxIndex===undefined){return null}return this.filters.get(a.cm.config[a.hdCtxIndex].dataIndex)},updateColumnHeadings:function(b){if(!b||!b.mainHd){return}if(this.mode=="header"){return}var e=b.mainHd.select("td").removeClass(this.filterCls);for(var c=0,a=b.cm.config.length;c<a;c++){var d=this.getFilter(b.cm.config[c].dataIndex);if(d&&d.active){e.item(c).addClass(this.filterCls)}}},reload:function(){if(this.local){this.grid.store.clearFilter(true);this.grid.store.filterBy(this.getRecordFilter())}else{this.deferredUpdate.cancel();var a=this.grid.store;if(this.toolbar){var b=this.toolbar.paramNames.start;if(a.lastOptions&&a.lastOptions.params&&a.lastOptions.params[b]){a.lastOptions.params[b]=0}}if(a.lastOptions&&a.lastOptions.params&&a.lastOptions.params.start){a.lastOptions.params.start=0}a.reload()}},getRecordFilter:function(){var b=[];this.filters.each(function(c){if(c.active){b.push(c)}});var a=b.length;return function(c){for(var d=0;d<a;d++){if(!b[d].validateRecord(c)){return false}}return true}},addFilter:function(a){var b=a.menu?a:new (this.getFilterClass(a.type))(a);this.filters.add(b);Ext.util.Observable.capture(b,this.onStateChange,this);return b},getFilter:function(a){return this.filters.get(a)},clearFilters:function(){this.filters.each(function(a){a.setActive(false)})},getFilterData:function(){var b=[],a=this.grid.getStore().fields;this.filters.each(function(g){if(g.active){var h=[].concat(g.serialize());for(var e=0,c=h.length;e<c;e++){b.push({field:g.dataColumn?g.dataColumn:g.dataIndex,data:h[e]})}}});return b},buildQuery:function(e){var h={};for(var d=0,a=e.length;d<a;d++){var g=e[d];var b=[this.paramPrefix,"[",d,"]"].join("");h[b+"[field]"]=g.field;var l=b+"[data]";for(var c in g.data){h[[l,"[",c,"]"].join("")]=g.data[c]}}return h},cleanParams:function(c){var b=new RegExp("^"+this.paramPrefix+"[[0-9]+]");for(var a in c){if(b.test(a)){delete c[a]}}},getFilterClass:function(a){return Ext.ux.grid.filter[a.substr(0,1).toUpperCase()+a.substr(1)+"Filter"]}});Ext.ns("Ext.ux");Ext.ux.DrillFilter=function(b,g){var q=g.getTarget();var n=b.getView().findCellIndex(q.parentNode);var h=b.getView().findRowIndex(q);var m=b.getColumnModel();var l=m.getDataIndex(n);var f=b.filters;if(!f){return}var c=f.filters.get(l);if(!c){return}if(q.className!="ux-grid-filter"){if(!c.selectable){return}}var d=b.getView().getCell(h,n).innerHTML;var p=Ext.DomQuery.selectNode(".ux-grid-filter-hidden-value",b.getView().getCell(h,n));var o=new Ext.Imm.SelectedText();o=o.toString();if(!o&&!p){return}var a=o?o:p.innerHTML;if(c.type=="numeric"){a={"eq":a}}if(c.type=="list"){a=[a]}if(c.type=="text"){c.makeChanges("and",[a]);c.execute();c.setActive(true);return}c.setValue(a);c.setActive(true)};Ext.ns("Ext.Imm");Ext.Imm.SelectedText=function(){var a=null;if(window.getSelection){a=window.getSelection()}else{if(document.getSelection){a=document.getSelection()}else{if(document.selection){a=document.selection.createRange().text}else{return}}}return a};Ext.ns("Ext.ux");Ext.ux.RePositionFilters=function(c){c.addEvents("spresize");var a=c.getColumnModel();this.grid=c;this.applyTemplate=function(){var d="";this.eachColumn(function(f){var g=this.getFilterDivId(f.id);var h=f.hidden?" style='display:none'":"";d+="<td"+h+'><div class="x-small-editor" id="'+g+'"></div></td>'});var e=new Ext.Template('<table border="0" cellspacing="0" cellpadding="0" style="{tstyle}">','<thead><tr class="x-grid3-hd-row">{cells}</tr></thead>','<tbody><tr class="filter-row-header">',d,"</tr></tbody>","</table>");return e};this.getFilterFieldDom=function(d){return d.wrap?d.wrap.dom:d.el.dom};this.eachColumn=function(d){Ext.each(this.grid.getColumnModel().config,d,this)};this.getFilterDivId=function(d){return this.grid.id+"-filter-"+d};this.resizeSp=function(e,f){if(e.sp){var d=50;if(f<d){a.setColumnWidth(a.getIndexById(e.dataIndex),d);f=d}e.sp.setWidth(f)}};this.resizeAllSp=function(){var d=this.grid.getColumnModel();this.eachColumn(function(e,f){this.resizeSp(e,d.getColumnWidth(f))})};this.renderFields=function(){this.eachColumn(function(e){var d=Ext.get(this.getFilterDivId(e.id));var f=this.getFilterField(e);this.grid.filters.menu=f;if(f){if(f.rendered){d.appendChild(this.getFilterFieldDom(f))}else{f.render(d)}}})};this.getFilterField=function(e){if(e.sp){return e.sp}if(!e.dataIndex){return}var d=this.getFilterForColumn(e);if(!d){return e.sp=new Ext.Button({width:e.width,disabled:true})}var g=this.getFilterMenuForColumn(e);var f=new Ext.SplitButton({text:this.grid.filters.menuFilterText,menu:g,width:e.width,allowDepress:true,layout:"fit",arrowTooltip:"Click for filter options",enableToggle:true,tooltip:"Click to enable/disable this filter",disabled:d?false:true});f.on("toggle",function(h,l){if(d.getValue()&&d.isActivatable()){d.setActive(l)}else{h.toggle(false)}},this);f.on("render",function(){if(d.active){f.toggle(true)}},this);d.on("activate",function(){f.toggle(true)},this);d.on("deactivate",function(){f.toggle(false)},this);e.sp=f;return f};this.getFilterMenuForColumn=function(e){if(!this.grid.filters.filters){return}var d=this.grid.filters.filters.get(e.dataIndex);if(d){return d.menu}return null};this.getFilterForColumn=function(e){if(!this.grid.filters.filters){return}var d=this.grid.filters.filters.get(e.dataIndex);return d};var b=this.grid.getView();Ext.applyIf(b,{templates:{}});b.templates.header=this.applyTemplate();b.refresh(true);this.renderFields();a.on("widthchange",function(d,e,f){this.resizeAllSp()},this);a.on("hiddenchange",function(e,f,g){var d=Ext.get(this.getFilterDivId(e.getColumnId(f)));if(d){d.parent().dom.style.display=g?"none":""}this.resizeAllSp()},this);c.on("columnresize",function(e,d){this.resizeAllSp()},this);c.on("resize",function(){this.resizeAllSp()},this);a.on("columnmoved",function(d,g,f){var e=this.grid.getView();Ext.applyIf(e,{templates:{}});e.templates.header=this.applyTemplate();e.refresh(true);this.renderFields()},this)};Ext.ns("Ext.ux");Ext.ux.SaveSearchState=function(b){var a=b.filters;if(!a){return}var c=new Ext.state.Provider();this.saveUrl=afApp.urlPrefix+"/appFlower/saveFilter";this.listUrl=afApp.urlPrefix+"/appFlower/listFilter";this.removeUrl=afApp.urlPrefix+"/appFlower/removeFilter";this.save=function(){var e=[];var d=this.list;a.filters.each(function(f){if(f.active){var g={dataIndex:f.dataIndex,value:c.encodeValue(f.getValue())};e.push(g)}});if(e.length<1){Ext.Msg.alert("Error","Filter criteria is empty.");return}Ext.Msg.prompt("Name","Please input filter name:",function(g,h){if(g=="ok"){if(h==""){Ext.Msg.alert("Error","Filter name is required.");return}var f=Ext.util.JSON.encode(e);Ext.Ajax.request({method:"POST",url:this.saveUrl,success:function(m){var l=Ext.util.JSON.decode(m.responseText);Ext.Msg.show({title:l.success?"Success":"Failed",msg:l.message,buttons:Ext.Msg.OK,icon:l.success?Ext.MessageBox.INFO:Ext.MessageBox.ERROR});if(d&&d.getStore()){d.getStore().reload()}},failure:function(l){},params:{path:b.path,name:h,state:f,title:b.name?b.name:b.path}})}},this)};this.viewSavedList=function(){var g=b.name?b.name:b.path;var d=new Ext.data.JsonStore({fields:["id","name","filter"],url:this.listUrl,root:"rows",autoLoad:true,baseParams:{path:g}});var e=new Ext.grid.GridPanel({store:d,columns:[new Ext.grid.RowNumberer(),{id:"name",header:"Name",dataIndex:"name",menuDisabled:true},{id:"action",header:"Action",dataIndex:null,width:50,menuDisabled:true,renderer:function(){return'<a href="#"><img class="remove-saved-filter-button" src="/images/famfamfam/cross.png" qtip="Remove this filter"/></a>'}}],tbar:[{text:"Save current filter",icon:"/images/famfamfam/disk.png",handler:function(){var h=b.filters;if(!h){return}var l=Ext.ux.SaveSearchState(b);l.save()}},"-",{text:"Clear current filter",icon:"/images/famfamfam/drink_empty.png",handler:function(){var h=b.filters;if(!h){return}h.clearFilters()}}],autoExpandColumn:"name",loadMask:true});this.list=e;e.on("cellclick",function(h,s,r,p){var q=p.getTarget();if(q.className=="ux-grid-filter-apply"){var n=h.getStore().getAt(s);var m=n.get("filter");var o=n.get("name");this.restore(m,o)}if(q.className=="restore-saved-filter-button"){var n=h.getStore().getAt(s);var m=n.get("filter");var o=n.get("name");this.restore(m,o)}if(q.className=="remove-saved-filter-button"){var n=h.getStore().getAt(s);var l=n.get("id");Ext.Ajax.request({method:"POST",url:this.removeUrl,success:function(u){var t=Ext.util.JSON.decode(u.responseText);if(t.success){var w=h.getView().getRow(s);Ext.get(w).fadeOut({endOpacity:0,easing:"easeOut",duration:0.5,remove:true,useDisplay:false,callback:function(){h.getStore().remove(n);h.getView().refresh()}})}},failure:function(t){},params:{id:l}})}},this);var f=new Ext.Window({width:500,height:300,layout:"fit",title:"Saved filters for "+g,items:e,closeAction:"close",maximizable:true,collapsible:true});f.show()};this.restore=function(e,d){if(!b.originalTitle){b.originalTitle=b.title}b.setTitle(b.originalTitle+": <font color=red>(Filtered by keyword: '"+d.replace(/<\S[^><]*>/g,"")+"')</font>");a.clearFilters();a.filters.each(function(g){var h=Ext.util.JSON.decode(e);for(var f=0;f<h.length;f++){if(h[f].dataIndex==g.dataIndex){var l=h[f].value;l=c.decodeValue(l);g.setActive(false);g.setValue(l);g.setActive(true)}}})};return this};Ext.ns("Ext.ux");Ext.ux.FilterInfo=function(b,h){var m=this;var q=b.getColumnModel();var g=b.filters;if(!g){return}var d=b.getGridEl();var n=Ext.DomQuery.selectNode(".ux-grid-filter-info-clear",d.dom);if(h=="panel"){var p=n?n:Ext.DomHelper.insertFirst(d,{tag:"span",html:"&nbsp;",cls:"ux-grid-filter-info-clear"})}var c=Ext.DomQuery.selectNode(".ux-grid-filter-info",d.dom);if(h=="panel"){var r=c?c:Ext.DomHelper.insertFirst(d,{tag:"div",html:"",cls:"ux-grid-filter-info"})}var l=Ext.DomHelper.createTemplate({tag:"div",cls:"ux-grid-filter-info-box",html:'{html}&nbsp;&nbsp;<a title="Remove this filter" id="{id}" href="#" onclick="Ext.ux.FilterInfo.remove(this)"></a>'});if(r){r.innerHTML=""}var e=[];var f="";var o=null;g.filters.each(function(t){var s=t.dataIndex;var x=q.getColumnHeader(q.findColumnIndex(s));if(t.active){var u="";if(t.getDisplayValue){u=t.getDisplayValue()}else{u=t.getValue()}if(u){f+="'"+u+"', ";var w=Ext.id(null,"filter-");e.push(new Ext.Button(new Ext.Action({handler:function(){t.setActive(false)},itemId:w+"-action",hidden:true})));if(h=="panel"){l.append(r,{html:"<b>"+x+":</b> "+u,id:w})}}}});if(h=="panel"){var a=new Ext.Panel({renderTo:r,items:e,id:"filter-info-action-panel"})}if(h=="title"){if(f){b.setTitle(b.originalTitle+" <font color='red'>Filtered by keyword: "+f+"</font>")}else{b.setTitle(b.originalTitle)}}};Ext.ns("Ext.ux.FilterInfo");Ext.ux.FilterInfo.remove=function(b){var a=Ext.getCmp("filter-info-action-panel");var c=a.getComponent(b.id+"-action");c.baseAction.execute()};Ext.namespace("Ext.ux.grid.filter");Ext.ux.grid.filter.Filter=function(a){Ext.apply(this,a);this.events={"activate":true,"deactivate":true,"update":true,"serialize":true};Ext.ux.grid.filter.Filter.superclass.constructor.call(this);this.menu=new Ext.menu.Menu();this.init();if(a&&a.value){this.setValue(a.value);this.setActive(a.active!==false,true);delete a.value}this.hideTask=new Ext.util.DelayedTask(this.hideMenu,this)};Ext.extend(Ext.ux.grid.filter.Filter,Ext.util.Observable,{active:false,dataIndex:null,menu:null,init:Ext.emptyFn,hideMenu:function(){this.menu.hide(true)},fireUpdate:function(){this.value=this.item.getValue();if(this.active){this.fireEvent("update",this)}this.setActive(this.value.length>0)},isActivatable:function(){return true},setActive:function(b,a){if(this.active!=b){this.active=b;if(a!==true){this.fireEvent(b?"activate":"deactivate",this)}}this.hideTask.delay(2000)},getValue:Ext.emptyFn,setValue:Ext.emptyFn,serialize:Ext.emptyFn,validateRecord:function(){return true},setFilterOptions:function(a){this.filterOptions=a},getFilterOptions:function(){return this.filterOptions}});Ext.ux.grid.filter.BooleanFilter=Ext.extend(Ext.ux.grid.filter.Filter,{defaultValue:false,yesText:"Yes",noText:"No",init:function(){var b=Ext.id();this.options=[new Ext.menu.CheckItem({text:this.yesText,group:b,checked:this.defaultValue===true}),new Ext.menu.CheckItem({text:this.noText,group:b,checked:this.defaultValue===false})];this.menu.add(this.options[0],this.options[1]);for(var a=0;a<this.options.length;a++){this.options[a].on("click",this.fireUpdate,this);this.options[a].on("checkchange",this.fireUpdate,this)}},isActivatable:function(){return true},fireUpdate:function(){this.fireEvent("update",this);this.setActive(true)},setValue:function(a){this.options[a?0:1].setChecked(true)},getValue:function(){return this.options[0].checked},serialize:function(){var a={type:"boolean",value:this.getValue()};this.fireEvent("serialize",a,this);return a},validateRecord:function(a){return a.get(this.dataIndex)==this.getValue()}});Ext.ux.grid.filter.ComboFilter=Ext.extend(Ext.ux.grid.filter.Filter,{updateBuffer:500,icon:"ux-gridfilter-text-icon",init:function(){var a=this.value=new Ext.ux.menu.ComboMenu({lovcombo:this.lovcombo,iconCls:this.icon,store:this.options});a.editor.on("select",function(){this.setActive(true);this.fireUpdate()},this);this.menu.add(a);this.updateTask=new Ext.util.DelayedTask(this.fireUpdate,this)},onKeyUp:function(a){if(a.getKey()==a.ENTER){this.menu.hide(true);return}this.updateTask.delay(this.updateBuffer)},isActivatable:function(){return this.value.getValue()?true:false},fireUpdate:function(){if(this.active){this.fireEvent("update",this)}this.setActive(this.isActivatable())},setValue:function(a){this.value.setValue(a);this.fireEvent("update",this)},getValue:function(){return this.value.getValue()?this.value.getValue().toString():null},serialize:function(){var a={type:"combo",value:this.getValue()};this.fireEvent("serialize",a,this);return a},validateRecord:function(a){var b=a.get(this.dataIndex);if(typeof b!="combo"){return this.getValue().length==0}return b.toLowerCase().indexOf(this.getValue().toLowerCase())>-1},getDisplayValue:function(){return this.value.getDisplayValue()}});Ext.ux.grid.filter.DateFilter=Ext.extend(Ext.ux.grid.filter.Filter,{dateFormat:"Y-m-d",pickerOpts:{},beforeText:"To",afterText:"From",onText:"On",init:function(){var c=Ext.apply(this.pickerOpts,{minDate:this.minDate,maxDate:this.maxDate,format:this.dateFormat});var d=this.dates={"before":new Ext.menu.CheckItem({text:this.beforeText,menu:new Ext.menu.DateMenu(c)}),"after":new Ext.menu.CheckItem({text:this.afterText,menu:new Ext.menu.DateMenu(c)}),"on":new Ext.menu.CheckItem({text:this.onText,menu:new Ext.menu.DateMenu(c)})};this.menu.add(d.after,d.before,"-",d.on);for(var b in d){var a=d[b];a.menu.on("select",function(f,g,h,e){f.setChecked(true);if(f==d.on){d.before.setChecked(false,true);d.after.setChecked(false,true)}else{d.on.setChecked(false,true);if(f==d.after&&d.before.menu.picker.value<h){d.before.setChecked(false,true)}else{if(f==d.before&&d.after.menu.picker.value>h){d.after.setChecked(false,true)}}}this.fireEvent("update",this)}.createDelegate(this,[a],0));a.on("checkchange",function(){this.setActive(this.isActivatable())},this)}},getFieldValue:function(a){return this.dates[a].menu.picker.getValue()},getPicker:function(a){return this.dates[a].menu.picker},isActivatable:function(){return this.dates.on.checked||this.dates.after.checked||this.dates.before.checked},setValue:function(b){for(var a in this.dates){if(b[a]){this.dates[a].menu.picker.setValue(b[a]);this.dates[a].setChecked(true)}else{this.dates[a].setChecked(false)}}},getValue:function(){var a={};for(var b in this.dates){if(this.dates[b].checked){a[b]=this.dates[b].menu.picker.getValue()}}return a},serialize:function(){var a=[];if(this.dates.before.checked){a=[{type:"date",comparison:"lt",value:this.getFieldValue("before").format(this.dateFormat)}]}if(this.dates.after.checked){a.push({type:"date",comparison:"gt",value:this.getFieldValue("after").format(this.dateFormat)})}if(this.dates.on.checked){a={type:"date",comparison:"eq",value:this.getFieldValue("on").format(this.dateFormat)}}this.fireEvent("serialize",a,this);return a},validateRecord:function(a){var b=a.get(this.dataIndex).clearTime(true).getTime();if(this.dates.on.checked&&b!=this.getFieldValue("on").clearTime(true).getTime()){return false}if(this.dates.before.checked&&b>=this.getFieldValue("before").clearTime(true).getTime()){return false}if(this.dates.after.checked&&b<=this.getFieldValue("after").clearTime(true).getTime()){return false}return true},getDisplayValue:function(){if(this.getValue().on){return this.getFormatedDate(this.getValue().on)}if(this.getValue().after&&this.getValue().before){return"From: "+this.getFormatedDate(this.getValue().after)+", To: "+this.getFormatedDate(this.getValue().before)}if(this.getValue().after){return"From: "+this.getFormatedDate(this.getValue().after)}if(this.getValue().before){return"To: "+this.getFormatedDate(this.getValue().before)}},getFormatedDate:function(a){return a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()}});Ext.ux.grid.filter.ListFilter=Ext.extend(Ext.ux.grid.filter.Filter,{labelField:"text",loadingText:"Loading...",loadOnShow:true,value:[],loaded:false,phpMode:false,init:function(){this.menu.add('<span class="loading-indicator">'+this.loadingText+"</span>");if(this.store){if(this.loadOnShow){this.menu.on("show",this.onMenuLoad,this)}}else{if(this.options){var b=[];for(var c=0,a=this.options.length;c<a;c++){var d=this.options[c];switch(Ext.type(d)){case"array":b.push(d);break;case"object":b.push([d.id,d[this.labelField]]);break;case"string":b.push([d,d]);break}}this.store=new Ext.data.Store({reader:new Ext.data.ArrayReader({id:0},["id",this.labelField])});this.options=b;this.menu.on("show",this.onMenuLoad,this)}}this.store.on("load",this.onLoad,this);this.bindShowAdapter()},onRender:function(){this.onMenuLoad()},bindShowAdapter:function(){var b=this.menu.show;var a=null;this.menu.show=function(){if(arguments.length==0){b.apply(this,a)}else{a=arguments;b.apply(this,arguments)}}},onMenuLoad:function(){if(!this.loaded){if(this.options){this.store.loadData(this.options)}else{this.store.load()}}},onLoad:function(c,b){var g=this.menu.isVisible();this.menu.hide(false);this.menu.removeAll();var e=this.single?Ext.id():null;for(var d=0,a=b.length;d<a;d++){var f=new Ext.menu.CheckItem({text:b[d].get(this.labelField),group:e,checked:this.value.indexOf(b[d].id.toString())>-1,hideOnClick:false});f.itemId=b[d].id;f.on("checkchange",this.checkChange,this);this.menu.add(f)}this.setActive(this.isActivatable());this.loaded=true;if(g){this.menu.show()}},checkChange:function(b,a){var c=[];this.menu.items.each(function(d){if(d.checked){c.push(d.itemId)}},this);this.value=c;this.setActive(this.isActivatable());this.fireEvent("update",this)},isActivatable:function(){return this.value.length>0},setValue:function(a){var a=this.value=[].concat(a);if(this.loaded){this.menu.items.each(function(d){d.setChecked(false,true);for(var c=0,b=a.length;c<b;c++){if(d.itemId==a[c]){d.setChecked(true,true)}}},this)}this.fireEvent("update",this)},getValue:function(){return this.value.toString()},serialize:function(){var a={type:"list",value:this.phpMode?this.value.join(","):this.value};this.fireEvent("serialize",a,this);return a},validateRecord:function(a){return this.getValue().indexOf(a.get(this.dataIndex))>-1},getDisplayValue:function(){var a=new Array();var e=[];v=this.getValue();var b=this.options;if(v.toString().match(/,/)){a=v.toString().split(",")}else{a[0]=v}for(var d=0;d<a.length;d++){for(var c in b){if(b[c][0]==a[d]){e.push(b[c][1])}}}return e.join(",")}});Ext.ux.grid.filter.NumericFilter=Ext.extend(Ext.ux.grid.filter.Filter,{init:function(){this.menu=new Ext.ux.menu.RangeMenu();this.menu.on("update",this.fireUpdate,this)},fireUpdate:function(){this.setActive(this.isActivatable());this.fireEvent("update",this)},isActivatable:function(){var a=this.menu.getValue();return a.eq!==undefined||a.gt!==undefined||a.lt!==undefined||a.ne!==undefined},setValue:function(a){this.menu.setValue(a)},getValue:function(){return this.menu.getValue()},serialize:function(){var b=[];var a=this.menu.getValue();for(var c in a){b.push({type:"numeric",comparison:c,value:a[c]})}this.fireEvent("serialize",b,this);return b},validateRecord:function(a){var c=a.get(this.dataIndex),b=this.menu.getValue();if(b.eq!=undefined&&c!=b.eq){return false}if(b.lt!=undefined&&c>=b.lt){return false}if(b.gt!=undefined&&c<=b.gt){return false}return true},getDisplayValue:function(){if(this.getValue().eq){return this.getValue().eq}if(this.getValue().ne){return"!= "+this.getValue().ne}if(this.getValue().gt&&this.getValue().lt){return this.getValue().gt+" &lt; x &lt; "+this.getValue().lt}if(this.getValue().gt){return"&gt;"+this.getValue().gt}if(this.getValue().lt){return"&lt;"+this.getValue().lt}}});Ext.ux.grid.filter.StringFilter=Ext.extend(Ext.ux.grid.filter.Filter,{updateBuffer:0,icon:"ux-gridfilter-text-icon",init:function(){var a=this.value=new Ext.ux.menu.EditableItem({iconCls:this.icon});a.on("keyup",this.onKeyUp,this);this.menu.add(a);this.options=new Ext.ux.FilterOption(this,"string");this.updateTask=new Ext.util.DelayedTask(this.fireUpdate,this)},onKeyUp:function(a){if(a.getKey()==a.ENTER){this.fireUpdate()}},isActivatable:function(){return this.value.getValue().length>0},fireUpdate:function(){if(this.active){this.fireEvent("update",this)}this.setActive(this.isActivatable())},setValue:function(a){this.value.setValue(a);this.fireEvent("update",this)},getValue:function(){return this.value.getValue()},serialize:function(){var a={type:"string",value:this.getValue(),options:this.getFilterOptions()};this.fireEvent("serialize",a,this);return a},validateRecord:function(b){var f=b.get(this.dataIndex);if(typeof f!="string"){return this.getValue().length==0}var a=[];var e=this.getValue().toLowerCase();a=e.split(";");a.push(e);var c=false;for(var d=0;d<a.length;d++){c=(f.toLowerCase().indexOf(a[d])>-1);if(c){break}}return c}});SampleGrid=function(h){function c(l){return"<i>"+l+"</i>"}function g(l){if(l>0){return'<span style="color:green;">'+l+"</span>"}else{if(l<0){return'<span style="color:red;">'+l+"</span>"}}return l}function b(l){if(l>0){return'<span style="color:green;">'+l+"%</span>"}else{if(l<0){return'<span style="color:red;">'+l+"%</span>"}}return l}var e=[{id:"company",header:"Company",width:160,sortable:true,dataIndex:"company"},{header:"Price",width:75,sortable:true,renderer:Ext.util.Format.usMoney,dataIndex:"price"},{header:"Change",width:75,sortable:true,renderer:g,dataIndex:"change"},{header:"% Change",width:75,sortable:true,renderer:b,dataIndex:"pctChange"},{header:"Last Updated",width:85,sortable:true,renderer:Ext.util.Format.dateRenderer("m/d/Y"),dataIndex:"lastChange"}];if(h){var f=[];for(var d=0,a=h.length;d<a;d++){f.push(e[h[d]])}e=f}SampleGrid.superclass.constructor.call(this,{store:new Ext.data.Store({reader:new Ext.data.ArrayReader({},[{name:"company"},{name:"price",type:"float"},{name:"change",type:"float"},{name:"pctChange",type:"float"},{name:"lastChange",type:"date",dateFormat:"n/j h:ia"}]),data:[["3m Co",71.72,0.02,0.03,"9/1 12:00am"],["Alcoa Inc",29.01,0.42,1.47,"9/1 12:00am"],["Altria Group Inc",83.81,0.28,0.34,"9/1 12:00am"],["American Express Company",52.55,0.01,0.02,"9/1 12:00am"],["American International Group, Inc.",64.13,0.31,0.49,"9/1 12:00am"],["AT&T Inc.",31.61,-0.48,-1.54,"9/1 12:00am"],["Boeing Co.",75.43,0.53,0.71,"9/1 12:00am"],["Caterpillar Inc.",67.27,0.92,1.39,"9/1 12:00am"],["Citigroup, Inc.",49.37,0.02,0.04,"9/1 12:00am"],["E.I. du Pont de Nemours and Company",40.48,0.51,1.28,"9/1 12:00am"],["Exxon Mobil Corp",68.1,-0.43,-0.64,"9/1 12:00am"],["General Electric Company",34.14,-0.08,-0.23,"9/1 12:00am"],["General Motors Corporation",30.27,1.09,3.74,"9/1 12:00am"],["Hewlett-Packard Co.",36.53,-0.03,-0.08,"9/1 12:00am"],["Honeywell Intl Inc",38.77,0.05,0.13,"9/1 12:00am"],["Intel Corporation",19.88,0.31,1.58,"9/1 12:00am"],["International Business Machines",81.41,0.44,0.54,"9/1 12:00am"],["Johnson & Johnson",64.72,0.06,0.09,"9/1 12:00am"],["JP Morgan & Chase & Co",45.73,0.07,0.15,"9/1 12:00am"],["McDonald's Corporation",36.76,0.86,2.4,"9/1 12:00am"],["Merck & Co., Inc.",40.96,0.41,1.01,"9/1 12:00am"],["Microsoft Corporation",25.84,0.14,0.54,"9/1 12:00am"],["Pfizer Inc",27.96,0.4,1.45,"9/1 12:00am"],["The Coca-Cola Company",45.07,0.26,0.58,"9/1 12:00am"],["The Home Depot, Inc.",34.64,0.35,1.02,"9/1 12:00am"],["The Procter & Gamble Company",61.91,0.01,0.02,"9/1 12:00am"],["United Technologies Corporation",63.26,0.55,0.88,"9/1 12:00am"],["Verizon Communications",35.57,0.39,1.11,"9/1 12:00am"],["Wal-Mart Stores, Inc.",45.45,0.73,1.63,"9/1 12:00am"]]}),columns:e,autoExpandColumn:"company",height:250,width:600})};Ext.extend(SampleGrid,Ext.grid.GridPanel);function Portals(){var a=this;this.input=false;this.window=false;this.createNewTab=function(e,b,d){var c=new Array();c.push({text:"Create now",handler:function(){if(a.input.getValue()!=""){var f=new Ext.ux.Portal({region:"center",portalLayoutType:"[100]",portalWidgets:d,bodyBorder:false,style:"padding-right:5px;",bodyStyle:"overflow-x:hidden;overflow-y:hidden;padding-right:5px;",items:[{columnWidth:1,style:"padding:10px 0 10px 10px;",items:[]}]});b.add({title:a.input.getValue(),items:[f]}).show();f.showWidgetSelector(e,"Widget Selector for "+a.input.getValue());a.window.hide()}}});c.push({text:"Cancel",handler:function(){a.window.hide()}});this.showInputWindow(c)};this.removeTab=function(f,d){var e=d.getActiveTab();var c=e.items.items[0].getConfig();var b=d.items.indexOf(e);if(b==0&&d.items.length==1){Ext.Msg.alert("Failure","You can't remove the only tab in this portal!")}else{Ext.Msg.confirm("Confirmation","Are you sure you would like to remove this tab?",function(g){if(g=="yes"){Ext.Ajax.request({url:"/appFlower/removePortalState",method:"post",params:{"config":c},success:function(h,l){d.remove(e,true);d.setActiveTab()},failure:function(h,l){if(h.message){Ext.Msg.alert("Failure",h.message)}}})}})}};this.reset=function(d,b){var c=b.getConfig();Ext.Msg.confirm("Confirmation","<b>Are you sure you would like to reset the page?</b><br>This will reset the content to the default one!",function(e){if(e=="yes"){Ext.Ajax.request({url:"/appFlower/resetPortalState",method:"post",params:{"config":c},success:function(f,g){window.location.reload()},failure:function(f,g){if(f.message){Ext.Msg.alert("Failure",f.message)}}})}})};this.changeTitle=function(e,b){var c=b.getActiveTab();var d=new Array();d.push({text:"Save",handler:function(){if(a.input.getValue()!=""&&a.input.getValue()!=c.title){c.setTitle(a.input.getValue());var f=c.items.items[0].getConfig();Ext.Ajax.request({url:"/appFlower/savePortalState",method:"post",params:{"config":f},success:function(g,h){},failure:function(g,h){if(g.message){Ext.Msg.alert("Failure",g.message)}}});a.window.hide()}}});d.push({text:"Cancel",handler:function(){a.window.hide()}});this.showInputWindow(d,c.title)};this.showInputWindow=function(c,b){if(!this.input){this.input=new Ext.form.TextField({width:150,height:50,style:"font-size:20px;"})}if(!this.window){this.window=new Ext.Window({layout:"fit",title:"Choose tab title",closeAction:"hide",width:200,height:100,plain:true,items:[a.input],buttons:c})}if(b){this.input.setValue(b)}this.window.show()};this.onTabChange=function(e,c){e.afterLayoutOnceEvent=true;if(c==null){c=document.location.href.split("#")}var b=0;for(var d=0;d<e.items.items.length;d++){if(e.items.items[d].slug==c[c.length-1]){b=d}}e.setActiveTab(b)}}Ext.ns("Ext.ux");Ext.ux.ClassicFormPanel=function(a){Ext.ux.ClassicFormPanel.superclass.constructor.call(this,a)};Ext.extend(Ext.ux.ClassicFormPanel,Ext.form.FormPanel,{onSubmit:Ext.emptyFn,submit:function(a){if(this.fileUpload){this.getForm().getEl().dom.enctype="multipart/form-data"}this.getForm().getEl().dom.action=a.url;this.getForm().getEl().dom.method=a.method;this.getForm().getEl().dom.submit()}});
/*
 * Ext JS Library 3.2.1
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ns("Ext.ux.grid");Ext.ux.grid.RowEditor=Ext.extend(Ext.Panel,{floating:true,shadow:false,layout:"hbox",cls:"x-small-editor",buttonAlign:"center",baseCls:"x-row-editor",elements:"header,footer,body",frameWidth:5,buttonPad:3,clicksToEdit:"auto",monitorValid:true,focusDelay:250,errorSummary:true,saveText:"Save",cancelText:"Cancel",commitChangesText:"You need to commit or cancel your changes",errorText:"Errors",defaults:{normalWidth:true},initComponent:function(){Ext.ux.grid.RowEditor.superclass.initComponent.call(this);this.addEvents("beforeedit","canceledit","validateedit","afteredit")},init:function(a){this.grid=a;this.ownerCt=a;if(this.clicksToEdit===2){a.on("rowdblclick",this.onRowDblClick,this)}else{a.on("rowclick",this.onRowClick,this);if(Ext.isIE){a.on("rowdblclick",this.onRowDblClick,this)}}a.getStore().on("remove",function(){this.stopEditing(false)},this);a.on({scope:this,keydown:this.onGridKey,columnresize:this.verifyLayout,columnmove:this.refreshFields,reconfigure:this.refreshFields,beforedestroy:this.beforedestroy,destroy:this.destroy,bodyscroll:{buffer:250,fn:this.positionButtons}});a.getColumnModel().on("hiddenchange",this.verifyLayout,this,{delay:1});a.getView().on("refresh",this.stopEditing.createDelegate(this,[]))},beforedestroy:function(){this.stopMonitoring();this.grid.getStore().un("remove",this.onStoreRemove,this);this.stopEditing(false);Ext.destroy(this.btns,this.tooltip)},refreshFields:function(){this.initFields();this.verifyLayout()},isDirty:function(){var a;this.items.each(function(b){if(String(this.values[b.id])!==String(b.getValue())){a=true;return false}},this);return a},startEditing:function(m,r){if(this.editing&&this.isDirty()){this.showTooltip(this.commitChangesText);return}if(Ext.isObject(m)){m=this.grid.getStore().indexOf(m)}if(this.fireEvent("beforeedit",this,m)!==false){this.editing=true;var e=this.grid,n=e.getView(),q=n.getRow(m),c=e.store.getAt(m);this.record=c;this.rowIndex=m;this.values={};if(!this.rendered){this.render(n.getEditorParent())}var o=Ext.fly(q).getWidth();this.setSize(o);if(!this.initialized){this.initFields()}var p=e.getColumnModel(),d=this.items.items,l,a;for(var b=0,h=p.getColumnCount();b<h;b++){a=this.preEditValue(c,p.getDataIndex(b));l=d[b];l.setValue(a);this.values[l.id]=Ext.isEmpty(a)?"":a}this.verifyLayout(true);if(!this.isVisible()){this.setPagePosition(Ext.fly(q).getXY())}else{this.el.setXY(Ext.fly(q).getXY(),{duration:0.15})}if(!this.isVisible()){this.show().doLayout()}if(r!==false){this.doFocus.defer(this.focusDelay,this)}}},stopEditing:function(n){this.editing=false;if(!this.isVisible()){return}if(n===false||!this.isValid()){this.hide();this.fireEvent("canceledit",this,n===false);return}var g={},b=this.record,h=false,m=this.grid.colModel,e=this.items.items;for(var d=0,f=m.getColumnCount();d<f;d++){if(!m.isHidden(d)){var c=m.getDataIndex(d);if(!Ext.isEmpty(c)){var a=b.data[c],l=this.postEditValue(e[d].getValue(),a,b,c);if(String(a)!==String(l)){g[c]=l;h=true}}}}if(h&&this.fireEvent("validateedit",this,g,b,this.rowIndex)!==false){b.beginEdit();Ext.iterate(g,function(o,p){b.set(o,p)});b.endEdit();this.fireEvent("afteredit",this,g,b,this.rowIndex)}this.hide()},verifyLayout:function(e){if(this.el&&(this.isVisible()||e===true)){var g=this.grid.getView().getRow(this.rowIndex);this.setSize(Ext.fly(g).getWidth(),Ext.isIE?Ext.fly(g).getHeight()+9:undefined);var c=this.grid.colModel,b=this.items.items;for(var d=0,a=c.getColumnCount();d<a;d++){if(!c.isHidden(d)){var f=0;if(d===(a-1)){f+=3}else{f+=1}b[d].show();b[d].setWidth(c.getColumnWidth(d)-f)}else{b[d].hide()}}this.doLayout();this.positionButtons()}},slideHide:function(){this.hide()},initFields:function(){var b=this.grid.getColumnModel(),f=Ext.layout.ContainerLayout.prototype.parseMargins;this.removeAll(false);for(var e=0,a=b.getColumnCount();e<a;e++){var g=b.getColumnAt(e),d=g.getEditor();if(!d){d=g.displayEditor||new Ext.form.DisplayField()}if(e==0){d.margins=f("0 1 2 1")}else{if(e==a-1){d.margins=f("0 0 2 1")}else{if(Ext.isIE){d.margins=f("0 0 2 0")}else{d.margins=f("0 1 2 0")}}}d.setWidth(b.getColumnWidth(e));d.column=g;if(d.ownerCt!==this){d.on("focus",this.ensureVisible,this);d.on("specialkey",this.onKey,this)}this.insert(e,d)}this.initialized=true},onKey:function(a,b){if(b.getKey()===b.ENTER){this.stopEditing(true);b.stopPropagation()}},onGridKey:function(c){if(c.getKey()===c.ENTER&&!this.isVisible()){var b=this.grid.getSelectionModel().getSelected();if(b){var a=this.grid.store.indexOf(b);this.startEditing(a);c.stopPropagation()}}},ensureVisible:function(a){if(this.isVisible()){this.grid.getView().ensureVisible(this.rowIndex,this.grid.colModel.getIndexById(a.column.id),true)}},onRowClick:function(b,d,c){if(this.clicksToEdit=="auto"){var a=this.lastClickIndex;this.lastClickIndex=d;if(a!=d&&!this.isVisible()){return}}this.startEditing(d,false);this.doFocus.defer(this.focusDelay,this,[c.getPoint()])},onRowDblClick:function(a,c,b){this.startEditing(c,false);this.doFocus.defer(this.focusDelay,this,[b.getPoint()])},onRender:function(){Ext.ux.grid.RowEditor.superclass.onRender.apply(this,arguments);this.el.swallowEvent(["keydown","keyup","keypress"]);this.btns=new Ext.Panel({baseCls:"x-plain",cls:"x-btns",elements:"body",layout:"table",width:(this.minButtonWidth*2)+(this.frameWidth*2)+(this.buttonPad*4),items:[{ref:"saveBtn",itemId:"saveBtn",xtype:"button",text:this.saveText,width:this.minButtonWidth,handler:this.stopEditing.createDelegate(this,[true])},{xtype:"button",text:this.cancelText,width:this.minButtonWidth,handler:this.stopEditing.createDelegate(this,[false])}]});this.btns.render(this.bwrap)},afterRender:function(){Ext.ux.grid.RowEditor.superclass.afterRender.apply(this,arguments);this.positionButtons();if(this.monitorValid){this.startMonitoring()}},onShow:function(){if(this.monitorValid){this.startMonitoring()}Ext.ux.grid.RowEditor.superclass.onShow.apply(this,arguments)},onHide:function(){Ext.ux.grid.RowEditor.superclass.onHide.apply(this,arguments);this.stopMonitoring();this.grid.getView().focusRow(this.rowIndex)},positionButtons:function(){if(this.btns){var e=this.grid,d=this.el.dom.clientHeight,b=e.getView(),a=b.scroller.dom.scrollLeft,f=this.btns.getWidth(),c=Math.min(e.getWidth(),e.getColumnModel().getTotalWidth());this.btns.el.shift({left:(c/2)-(f/2)+a,top:d-2,stopFx:true,duration:0.2})}},preEditValue:function(a,c){var b=a.data[c];return this.autoEncode&&typeof b==="string"?Ext.util.Format.htmlDecode(b):b},postEditValue:function(c,a,b,d){return this.autoEncode&&typeof c=="string"?Ext.util.Format.htmlEncode(c):c},doFocus:function(f){if(this.isVisible()){var d=0,b=this.grid.getColumnModel(),g;if(f){d=this.getTargetColumnIndex(f)}for(var e=d||0,a=b.getColumnCount();e<a;e++){g=b.getColumnAt(e);if(!g.hidden&&g.getEditor()){g.getEditor().focus();break}}}},getTargetColumnIndex:function(m){var a=this.grid,l=a.view,h=m.left,f=a.colModel.config,b=0,d=false;for(var e=f.length,g;g=f[b];b++){if(!g.hidden){if(Ext.fly(l.getHeaderCell(b)).getRegion().right>=h){d=b;break}}}return d},startMonitoring:function(){if(!this.bound&&this.monitorValid){this.bound=true;Ext.TaskMgr.start({run:this.bindHandler,interval:this.monitorPoll||200,scope:this})}},stopMonitoring:function(){this.bound=false;if(this.tooltip){this.tooltip.hide()}},isValid:function(){var a=true;this.items.each(function(b){if(!b.isValid(true)){a=false;return false}});return a},bindHandler:function(){if(!this.bound){return false}var a=this.isValid();if(!a&&this.errorSummary){this.showTooltip(this.getErrorText().join(""))}this.btns.saveBtn.setDisabled(!a);this.fireEvent("validation",this,a)},lastVisibleColumn:function(){var a=this.items.getCount()-1,b;for(;a>=0;a--){b=this.items.items[a];if(!b.hidden){return b}}},showTooltip:function(f){var c=this.tooltip;if(!c){c=this.tooltip=new Ext.ToolTip({maxWidth:600,cls:"errorTip",width:300,title:this.errorText,autoHide:false,anchor:"left",anchorToTarget:true,mouseOffset:[40,0]})}var b=this.grid.getView(),e=parseInt(this.el.dom.style.top,10),a=b.scroller.dom.scrollTop,d=this.el.getHeight();if(e+d>=a){c.initTarget(this.lastVisibleColumn().getEl());if(!c.rendered){c.show();c.hide()}c.body.update(f);c.doAutoWidth(20);c.show()}else{if(c.rendered){c.hide()}}},getErrorText:function(){var a=["<ul>"];this.items.each(function(b){if(!b.isValid(true)){a.push("<li>",b.getActiveError(),"</li>")}});a.push("</ul>");return a}});Ext.preg("roweditor",Ext.ux.grid.RowEditor);Ext.ns("Ext.ux.form");Ext.ux.form.GroupingComboBox=Ext.extend(Ext.form.ComboBox,{initComponent:function(){if(this.transform){this.allowDomMove=false;var m=Ext.getDom(this.transform);if(!this.hiddenName){this.hiddenName=m.name}if(!this.store){this.mode="local";var f=[],a=m.options;for(var c=0,e=a.length;c<e;c++){var b=a[c];var g=(Ext.isIE?b.getAttributeNode("value").specified:b.hasAttribute("value"))?b.value:b.text;if(b.selected){this.value=g}var l=b.parentNode,h=l.tagName.toLowerCase()=="optgroup"?l.label:false;f.push([g,b.text,h])}this.store=new Ext.data.SimpleStore({"id":0,fields:["value","text","group"],data:f});this.valueField="value";this.displayField="text";this.groupField="group"}m.name=Ext.id();if(!this.lazyRender){this.target=true;this.el=Ext.DomHelper.insertBefore(m,this.autoCreate||this.defaultAutoCreate);Ext.removeNode(m);this.render(this.el.parentNode)}else{Ext.removeNode(m)}}delete this.transform;Ext.ux.form.GroupingComboBox.superclass.initComponent.call(this)},initList:function(){if(!this.list&&!this.tpl){this.tpl='<tpl for=".">'+'<tpl if="values.'+this.groupField+" && (xindex == 1 || parent[xindex - 2]."+this.groupField+" != values."+this.groupField+')">'+'<div class="x-combo-list-group">{'+this.groupField+"}</div>"+"</tpl>"+'<div class="x-combo-list-item">'+'<tpl if="values.'+this.groupField+'">&nbsp;</tpl>'+"{"+this.displayField+"}</div>"+"</tpl>"}Ext.ux.form.GroupingComboBox.superclass.initList.call(this)}});